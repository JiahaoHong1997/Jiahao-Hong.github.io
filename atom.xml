<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ´ªç¬³æ·çš„ä¸ªäººåšå®¢</title>
  
  
  <link href="http://jiahaohong1997.github.io/atom.xml" rel="self"/>
  
  <link href="http://jiahaohong1997.github.io/"/>
  <updated>2022-04-13T00:16:01.759Z</updated>
  <id>http://jiahaohong1997.github.io/</id>
  
  <author>
    <name>æ´ªç¬³æ·</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 11ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/13/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%2011%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/13/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%2011%EF%BC%89/</id>
    <published>2022-04-12T22:00:00.000Z</published>
    <updated>2022-04-13T00:16:01.759Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode353-è´ªåƒè›‡"><a href="#LeetCode353-è´ªåƒè›‡" class="headerlink" title="LeetCode353. è´ªåƒè›‡"></a><a class="link" href="https://leetcode-cn.com/problems/design-snake-game/">LeetCode353. è´ªåƒè›‡<i class="fas fa-external-link-alt"></i></a></h2><p>#é˜Ÿåˆ— #è®¾è®¡é¢˜</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>è¯·ä½ è®¾è®¡ä¸€ä¸ªÂ è´ªåƒè›‡æ¸¸æˆï¼Œè¯¥æ¸¸æˆå°†ä¼šåœ¨ä¸€ä¸ª å±å¹•å°ºå¯¸ = å®½åº¦ x é«˜åº¦Â çš„å±å¹•ä¸Šè¿è¡Œã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰è¿™ä¸ªæ¸¸æˆï¼Œå¯ä»¥Â ç‚¹å‡»è¿™é‡ŒÂ åœ¨çº¿è¯•ç©ã€‚<br>èµ·åˆæ—¶ï¼Œè›‡åœ¨å·¦ä¸Šè§’çš„ (0, 0) ä½ç½®ï¼Œèº«ä½“é•¿åº¦ä¸º 1 ä¸ªå•ä½ã€‚<br>ä½ å°†ä¼šè¢«ç»™å‡ºä¸€ä¸ªæ•°ç»„å½¢å¼çš„é£Ÿç‰©ä½ç½®åºåˆ— food ï¼Œå…¶ä¸­Â food[i] = (ri, ci) ã€‚å½“è›‡åƒåˆ°é£Ÿç‰©æ—¶ï¼Œèº«å­çš„é•¿åº¦ä¼šå¢åŠ  1 ä¸ªå•ä½ï¼Œå¾—åˆ†ä¹Ÿä¼š +1 ã€‚<br>é£Ÿç‰©ä¸ä¼šåŒæ—¶å‡ºç°ï¼Œä¼šæŒ‰åˆ—è¡¨çš„é¡ºåºé€ä¸€æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚æ¯”æ–¹è®²ï¼Œç¬¬ä¸€ä¸ªé£Ÿç‰©è¢«è›‡åƒæ‰åï¼Œç¬¬äºŒä¸ªé£Ÿç‰©æ‰ä¼šå‡ºç°ã€‚<br>å½“ä¸€ä¸ªé£Ÿç‰©åœ¨å±å¹•ä¸Šå‡ºç°æ—¶ï¼Œä¿è¯ ä¸ä¼š å‡ºç°åœ¨è¢«è›‡èº«ä½“å æ®çš„æ ¼å­é‡Œã€‚<br>å¦‚æœè›‡è¶Šç•Œï¼ˆä¸è¾¹ç•Œç›¸æ’ï¼‰æˆ–è€…å¤´ä¸ ç§»åŠ¨å çš„èº«ä½“ç›¸æ’ï¼ˆå³ï¼Œèº«é•¿ä¸º 4 çš„è›‡æ— æ³•ä¸è‡ªå·±ç›¸æ’ï¼‰ï¼Œæ¸¸æˆç»“æŸã€‚</p></blockquote><blockquote><p>å®ç° <code>SnakeGame</code> ç±»ï¼š<br>SnakeGame(int width, int height, int[][] food) åˆå§‹åŒ–å¯¹è±¡ï¼Œå±å¹•å¤§å°ä¸º height x width ï¼Œé£Ÿç‰©ä½ç½®åºåˆ—ä¸º food<br>int move(String direction) è¿”å›è›‡åœ¨æ–¹å‘ direction ä¸Šç§»åŠ¨åçš„å¾—åˆ†ã€‚å¦‚æœæ¸¸æˆç»“æŸï¼Œè¿”å› -1 ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="snake.jpg" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š</span><br><span class="line">[&quot;SnakeGame&quot;, &quot;move&quot;, &quot;move&quot;, &quot;move&quot;, &quot;move&quot;, &quot;move&quot;, &quot;move&quot;]</span><br><span class="line">[[3, 2, [[1, 2], [0, 1]]], [&quot;R&quot;], [&quot;D&quot;], [&quot;R&quot;], [&quot;U&quot;], [&quot;L&quot;], [&quot;U&quot;]]</span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line">[null, 0, 0, 1, 1, 2, -1]</span><br><span class="line"></span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">SnakeGame snakeGame &#x3D; new SnakeGame(3, 2, [[1, 2], [0, 1]]);</span><br><span class="line">snakeGame.move(&quot;R&quot;); &#x2F;&#x2F; è¿”å› 0</span><br><span class="line">snakeGame.move(&quot;D&quot;); &#x2F;&#x2F; è¿”å› 0</span><br><span class="line">snakeGame.move(&quot;R&quot;); &#x2F;&#x2F; è¿”å› 1 ï¼Œè›‡åƒæ‰äº†ç¬¬ä¸€ä¸ªé£Ÿç‰©ï¼ŒåŒæ—¶ç¬¬äºŒä¸ªé£Ÿç‰©å‡ºç°åœ¨ (0, 1)</span><br><span class="line">snakeGame.move(&quot;U&quot;); &#x2F;&#x2F; è¿”å› 1</span><br><span class="line">snakeGame.move(&quot;L&quot;); &#x2F;&#x2F; è¿”å› 2 ï¼Œè›‡åƒæ‰äº†ç¬¬äºŒä¸ªé£Ÿç‰©ï¼Œæ²¡æœ‰å‡ºç°æ›´å¤šé£Ÿç‰©</span><br><span class="line">snakeGame.move(&quot;U&quot;); &#x2F;&#x2F; è¿”å› -1 ï¼Œè›‡ä¸è¾¹ç•Œç›¸æ’ï¼Œæ¸¸æˆç»“æŸ</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; width, height &lt;&#x3D; 104</span><br><span class="line">1 &lt;&#x3D; food.length &lt;&#x3D; 50</span><br><span class="line">food[i].length &#x3D;&#x3D; 2</span><br><span class="line">0 &lt;&#x3D; ri &lt; height</span><br><span class="line">0 &lt;&#x3D; ci &lt; width</span><br><span class="line">direction.length &#x3D;&#x3D; 1</span><br><span class="line">direction is &#39;U&#39;, &#39;D&#39;, &#39;L&#39;, or &#39;R&#39;.</span><br><span class="line">æœ€å¤šè°ƒç”¨ 104 æ¬¡ move æ–¹æ³•</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆæ˜ç¡®ç»“æ„ä½“ä¸­éœ€è¦ä»€ä¹ˆå…ƒç´ ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è®°å½•è›‡èº«ä½“åœ¨çš„ä½ç½®ï¼Œå…¶æ¬¡è¿˜éœ€è¦ä¸€ä¸ªç´¢å¼•å·æ¥è®°å½•å½“å‰å‡ºç°çš„é£Ÿç‰©æ˜¯ç¬¬å‡ ä¸ªï¼›<br>(2). åœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè¦æ ¹æ®ç§»åŠ¨çš„æ–¹å‘ç¡®è®¤ğŸå¤´åº”è¯¥å‡ºç°åœ¨çš„æ–°ä½ç½®çš„åæ ‡æ˜¯å¦åœ¨ç•Œé™å†…ã€‚ç„¶åæ ¹æ®é£Ÿç‰©åº”è¯¥å‡ºç°çš„ä½ç½®ï¼ˆæˆ–è€…é£Ÿç‰©è¢«åƒå®Œï¼‰ç¡®å®šğŸå¤´æ˜¯å¦ç¢°è§¦åˆ°é£Ÿç‰©ï¼›<br>(3). å¦‚æœç¢°è§¦åˆ°ï¼Œé‚£ä¹ˆå°±åƒæ‰ï¼Œå¹¶ä¸”é£Ÿç‰©ç´¢å¼•å· +1ï¼›å¦‚æœæ²¡æœ‰ç¢°è§¦åˆ°ï¼Œé‚£ä¹ˆå°±åˆ¤æ–­æ˜¯å¦ä¼šâ€œå’¬åˆ°â€è‡ªå·±çš„èº«ä½“ã€‚</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> SnakeGame <span class="keyword">struct</span> &#123;</span><br><span class="line">snakePos [][]<span class="keyword">int</span></span><br><span class="line">width <span class="keyword">int</span></span><br><span class="line">height <span class="keyword">int</span></span><br><span class="line">food [][]<span class="keyword">int</span></span><br><span class="line">foodIndex <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(width <span class="keyword">int</span>, height <span class="keyword">int</span>, food [][]<span class="keyword">int</span>)</span> <span class="title">SnakeGame</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> SnakeGame &#123;</span><br><span class="line">snakePos : [][]<span class="keyword">int</span>&#123;&#123;<span class="number">0</span>,<span class="number">0</span>&#125;&#125;,</span><br><span class="line">width : width,</span><br><span class="line">height : height,</span><br><span class="line">food : food,</span><br><span class="line">foodIndex : <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *SnakeGame)</span> <span class="title">Move</span><span class="params">(direction <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">h, w := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">switch</span> direction &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;R&quot;</span>:</span><br><span class="line">h, w = this.snakePos[<span class="number">0</span>][<span class="number">0</span>], this.snakePos[<span class="number">0</span>][<span class="number">1</span>]+<span class="number">1</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;L&quot;</span>:</span><br><span class="line">h, w = this.snakePos[<span class="number">0</span>][<span class="number">0</span>], this.snakePos[<span class="number">0</span>][<span class="number">1</span>]<span class="number">-1</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;U&quot;</span>:</span><br><span class="line">h, w = this.snakePos[<span class="number">0</span>][<span class="number">0</span>]<span class="number">-1</span>, this.snakePos[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;D&quot;</span>:</span><br><span class="line">h, w = this.snakePos[<span class="number">0</span>][<span class="number">0</span>]+<span class="number">1</span>, this.snakePos[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (h &lt; <span class="number">0</span> || h &gt;= this.height) || (w &lt; <span class="number">0</span> || w &gt;= this.width) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">this.snakePos = <span class="built_in">append</span>([][]<span class="keyword">int</span>&#123;&#123;h,w&#125;&#125;, this.snakePos...)</span><br><span class="line"><span class="keyword">if</span> this.foodIndex &lt; <span class="built_in">len</span>(this.food) &#123;</span><br><span class="line"><span class="keyword">if</span> h == this.food[this.foodIndex][<span class="number">0</span>] &amp;&amp; w == this.food[this.foodIndex][<span class="number">1</span>] &#123;</span><br><span class="line">this.foodIndex++</span><br><span class="line"><span class="keyword">return</span> this.foodIndex</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">this.snakePos = this.snakePos[:<span class="built_in">len</span>(this.snakePos)<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(this.snakePos); i++ &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> this.snakePos[i][<span class="number">0</span>] == h &amp;&amp; this.snakePos[i][<span class="number">1</span>] == w &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> this.foodIndex</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">this.snakePos = this.snakePos[:<span class="built_in">len</span>(this.snakePos)<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(this.snakePos); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> this.snakePos[i][<span class="number">0</span>] == h &amp;&amp; this.snakePos[i][<span class="number">1</span>] == w &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> this.foodIndex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Your SnakeGame object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment">* obj := Constructor(width, height, food);</span></span><br><span class="line"><span class="comment">* param_1 := obj.Move(direction);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h2 id="LeetCode256-ç²‰åˆ·æˆ¿å­"><a href="#LeetCode256-ç²‰åˆ·æˆ¿å­" class="headerlink" title="LeetCode256. ç²‰åˆ·æˆ¿å­"></a><a class="link" href="https://leetcode-cn.com/problems/paint-house/">LeetCode256. ç²‰åˆ·æˆ¿å­<i class="fas fa-external-link-alt"></i></a></h2><p>#åŠ¨æ€è§„åˆ’</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>å‡å¦‚æœ‰ä¸€æ’æˆ¿å­ï¼Œå…± n ä¸ªï¼Œæ¯ä¸ªæˆ¿å­å¯ä»¥è¢«ç²‰åˆ·æˆçº¢è‰²ã€è“è‰²æˆ–è€…ç»¿è‰²è¿™ä¸‰ç§é¢œè‰²ä¸­çš„ä¸€ç§ï¼Œä½ éœ€è¦ç²‰åˆ·æ‰€æœ‰çš„æˆ¿å­å¹¶ä¸”ä½¿å…¶ç›¸é‚»çš„ä¸¤ä¸ªæˆ¿å­é¢œè‰²ä¸èƒ½ç›¸åŒã€‚<br>å½“ç„¶ï¼Œå› ä¸ºå¸‚åœºä¸Šä¸åŒé¢œè‰²æ²¹æ¼†çš„ä»·æ ¼ä¸åŒï¼Œæ‰€ä»¥æˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æˆæœ¬ä¹Ÿæ˜¯ä¸åŒçš„ã€‚æ¯ä¸ªæˆ¿å­ç²‰åˆ·æˆä¸åŒé¢œè‰²çš„èŠ±è´¹æ˜¯ä»¥ä¸€ä¸ªÂ n x 3Â çš„æ­£æ•´æ•°çŸ©é˜µ costs æ¥è¡¨ç¤ºçš„ã€‚<br>ä¾‹å¦‚ï¼Œcosts[0][0] è¡¨ç¤ºç¬¬ 0 å·æˆ¿å­ç²‰åˆ·æˆçº¢è‰²çš„æˆæœ¬èŠ±è´¹ï¼›costs[1][2]Â è¡¨ç¤ºç¬¬ 1 å·æˆ¿å­ç²‰åˆ·æˆç»¿è‰²çš„èŠ±è´¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚<br>è¯·è®¡ç®—å‡ºç²‰åˆ·å®Œæ‰€æœ‰æˆ¿å­æœ€å°‘çš„èŠ±è´¹æˆæœ¬ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥: costs &#x3D; [[17,2,17],[16,16,5],[14,3,19]]</span><br><span class="line">è¾“å‡º: 10</span><br><span class="line">è§£é‡Š: å°† 0 å·æˆ¿å­ç²‰åˆ·æˆè“è‰²ï¼Œ1 å·æˆ¿å­ç²‰åˆ·æˆç»¿è‰²ï¼Œ2 å·æˆ¿å­ç²‰åˆ·æˆè“è‰²ã€‚</span><br><span class="line">Â     æœ€å°‘èŠ±è´¹: 2 + 5 + 3 &#x3D; 10ã€‚</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥: costs &#x3D; [[7,6,2]]</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤º:</span><br><span class="line">costs.length &#x3D;&#x3D; n</span><br><span class="line">costs[i].length &#x3D;&#x3D; 3</span><br><span class="line">1 &lt;&#x3D; n &lt;&#x3D; 100</span><br><span class="line">1 &lt;&#x3D; costs[i][j] &lt;&#x3D; 20</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>åŠ¨æ€è§„åˆ’ï¼Œå®æ—¶æ›´æ–°åˆ†åˆ«ä½¿ç”¨ä¸‰ç§æ²¹æ¼†ä½œä¸ºæœ€åä¸€æ ‹æˆ¿å­çš„ç»“æœã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minCost</span><span class="params">(costs [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">a, b, c := costs[<span class="number">0</span>][<span class="number">0</span>], costs[<span class="number">0</span>][<span class="number">1</span>], costs[<span class="number">0</span>][<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(costs); i++ &#123;</span><br><span class="line">a, b, c = min(b, c)+costs[i][<span class="number">0</span>], min(a, c)+costs[i][<span class="number">1</span>], min(a, b)+costs[i][<span class="number">2</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> min(a, min(b, c))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode186-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯-II"><a href="#LeetCode186-ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯-II" class="headerlink" title="LeetCode186. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ II"></a><a class="link" href="https://leetcode-cn.com/problems/reverse-words-in-a-string-ii/">LeetCode186. ç¿»è½¬å­—ç¬¦ä¸²é‡Œçš„å•è¯ II<i class="fas fa-external-link-alt"></i></a></h2><p>#å­—ç¬¦ä¸² #åŒæŒ‡é’ˆ</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€ä¸ªç¿»è½¬å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">è¾“å…¥: [&quot;t&quot;,&quot;h&quot;,&quot;e&quot;,&quot; &quot;,&quot;s&quot;,&quot;k&quot;,&quot;y&quot;,&quot; &quot;,&quot;i&quot;,&quot;s&quot;,&quot; &quot;,&quot;b&quot;,&quot;l&quot;,&quot;u&quot;,&quot;e&quot;]</span><br><span class="line">è¾“å‡º: [&quot;b&quot;,&quot;l&quot;,&quot;u&quot;,&quot;e&quot;,&quot; &quot;,&quot;i&quot;,&quot;s&quot;,&quot; &quot;,&quot;s&quot;,&quot;k&quot;,&quot;y&quot;,&quot; &quot;,&quot;t&quot;,&quot;h&quot;,&quot;e&quot;]</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼š</span><br><span class="line">å•è¯çš„å®šä¹‰æ˜¯ä¸åŒ…å«ç©ºæ ¼çš„ä¸€ç³»åˆ—å­—ç¬¦</span><br><span class="line">è¾“å…¥å­—ç¬¦ä¸²ä¸­ä¸ä¼šåŒ…å«å‰ç½®æˆ–å°¾éšçš„ç©ºæ ¼</span><br><span class="line">å•è¯ä¸å•è¯ä¹‹é—´æ°¸è¿œæ˜¯ä»¥å•ä¸ªç©ºæ ¼éš”å¼€çš„</span><br><span class="line"></span><br><span class="line">è¿›é˜¶ï¼šä½¿ç”¨Â O(1) é¢å¤–ç©ºé—´å¤æ‚åº¦çš„åŸåœ°è§£æ³•ã€‚</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>å•è¯ä»¥ç©ºæ ¼åˆ†éš”ï¼Œå…ˆå¯¹æ¯ä¸ªå•è¯è¿›è¡Œreverseï¼Œå†å¯¹æ•´ä¸ªå­—ç¬¦ä¸²reverseï¼Œå³å¯å¾—åˆ°ç¿»è½¬å•è¯é¡ºåºï¼Œä½†æ˜¯å•è¯ä¸­å­—æ¯é¡ºåºä¸å˜çš„æ•ˆæœã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseWords</span><span class="params">(s []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> reverse <span class="function"><span class="keyword">func</span><span class="params">([]<span class="keyword">byte</span>)</span></span></span><br><span class="line">reverse = <span class="function"><span class="keyword">func</span><span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(b)/<span class="number">2</span>; i++ &#123;</span><br><span class="line">b[i], b[<span class="built_in">len</span>(b)-i<span class="number">-1</span>] = b[<span class="built_in">len</span>(b)-i<span class="number">-1</span>], b[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">first := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;=<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> i == <span class="built_in">len</span>(s) || s[i] == <span class="string">&#x27; &#x27;</span> &#123;</span><br><span class="line">reverse(s[first:i])</span><br><span class="line">first = i+<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reverse(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode353-è´ªåƒè›‡&quot;&gt;&lt;a href=&quot;#LeetCode353-è´ªåƒè›‡&quot; class=&quot;headerlink&quot; title=&quot;LeetCode353. è´ªåƒè›‡&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;https://leetcode-c</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 10ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/11/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%2010%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/11/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%2010%EF%BC%89/</id>
    <published>2022-04-10T22:00:00.000Z</published>
    <updated>2022-04-11T00:03:38.203Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode28-å®ç°-strStr"><a href="#LeetCode28-å®ç°-strStr" class="headerlink" title="LeetCode28. å®ç° strStr()"></a><a class="link" href="https://leetcode-cn.com/problems/implement-strstr/">LeetCode28. å®ç° strStr()<i class="fas fa-external-link-alt"></i></a></h2><p>#å­—ç¬¦ä¸²</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>å®ç°Â strStr()Â å‡½æ•°ã€‚<br>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸²Â haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å›Â  -1 ã€‚<br>è¯´æ˜ï¼š<br>å½“Â needleÂ æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚<br>å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“Â needleÂ æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸ C è¯­è¨€çš„Â strstr()Â ä»¥åŠ Java çš„Â indexOf()Â å®šä¹‰ç›¸ç¬¦ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šhaystack &#x3D; &quot;hello&quot;, needle &#x3D; &quot;ll&quot;</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šhaystack &#x3D; &quot;aaaaa&quot;, needle &#x3D; &quot;bba&quot;</span><br><span class="line">è¾“å‡ºï¼š-1</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line">è¾“å…¥ï¼šhaystack &#x3D; &quot;&quot;, needle &#x3D; &quot;&quot;</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; haystack.length, needle.length &lt;&#x3D; 104</span><br><span class="line">haystack å’Œ needle ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ç›´æ¥ä¸€æ¬¡éå†æ¯”å¯¹å³å¯</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>$O(M-N)$</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strStr</span><span class="params">(haystack <span class="keyword">string</span>, needle <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">m, n := <span class="built_in">len</span>(haystack), <span class="built_in">len</span>(needle)</span><br><span class="line"><span class="keyword">if</span> m &lt; n &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;m-n+<span class="number">1</span>; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> haystack[i:i+n] == needle &#123;</span><br><span class="line"><span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode1442-å½¢æˆä¸¤ä¸ªå¼‚æˆ–ç›¸ç­‰æ•°ç»„çš„ä¸‰å…ƒç»„æ•°ç›®"><a href="#LeetCode1442-å½¢æˆä¸¤ä¸ªå¼‚æˆ–ç›¸ç­‰æ•°ç»„çš„ä¸‰å…ƒç»„æ•°ç›®" class="headerlink" title="LeetCode1442. å½¢æˆä¸¤ä¸ªå¼‚æˆ–ç›¸ç­‰æ•°ç»„çš„ä¸‰å…ƒç»„æ•°ç›®"></a><a class="link" href="https://leetcode-cn.com/problems/count-triplets-that-can-form-two-arrays-of-equal-xor/">LeetCode1442. å½¢æˆä¸¤ä¸ªå¼‚æˆ–ç›¸ç­‰æ•°ç»„çš„ä¸‰å…ƒç»„æ•°ç›®<i class="fas fa-external-link-alt"></i></a></h2><p>#ä½è¿ç®— #å‰ç¼€å¼‚æˆ–</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ arr ã€‚<br>ç°éœ€è¦ä»æ•°ç»„ä¸­å–ä¸‰ä¸ªä¸‹æ ‡ iã€j å’Œ k ï¼Œå…¶ä¸­ (0 &lt;= i &lt; j &lt;= k &lt; arr.length) ã€‚<br>a å’Œ b å®šä¹‰å¦‚ä¸‹ï¼š<br>a = arr[i] ^ arr[i + 1] ^ â€¦ ^ arr[j - 1]<br>b = arr[j] ^ arr[j + 1] ^ â€¦ ^ arr[k]<br>æ³¨æ„ï¼š^ è¡¨ç¤º æŒ‰ä½å¼‚æˆ– æ“ä½œã€‚<br>è¯·è¿”å›èƒ½å¤Ÿä»¤ a == b æˆç«‹çš„ä¸‰å…ƒç»„ (i, j , k) çš„æ•°ç›®ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šarr &#x3D; [2,3,1,6,7]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line">è§£é‡Šï¼šæ»¡è¶³é¢˜æ„çš„ä¸‰å…ƒç»„åˆ†åˆ«æ˜¯ (0,1,2), (0,2,2), (2,3,4) ä»¥åŠ (2,4,4)</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šarr &#x3D; [1,1,1,1,1]</span><br><span class="line">è¾“å‡ºï¼š10</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line">è¾“å…¥ï¼šarr &#x3D; [2,3]</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 4ï¼š</span><br><span class="line">è¾“å…¥ï¼šarr &#x3D; [1,3,5,7,9]</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 5ï¼š</span><br><span class="line">è¾“å…¥ï¼šarr &#x3D; [7,11,12,9,5,2,7,17,22]</span><br><span class="line">è¾“å‡ºï¼š8</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; arr.length &lt;&#x3D; 300</span><br><span class="line">1 &lt;&#x3D; arr[i] &lt;&#x3D; 10^8</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). ä¸€å¼€å§‹å¾ˆç›´è§‚æƒ³åˆ°æšä¸¾å…¨éƒ¨ä¸‰å…ƒç»„ï¼Œç„¶åå†æ ¹æ®è§„åˆ™ï¼Œä» <code>i</code> éå†åˆ° <code>j-1</code>ï¼Œå†ä» <code>j</code> éå†åˆ° <code>k</code> æ¥åˆ¤æ–­æ˜¯å¦æ˜¯åˆæ³•ä¸‰å…ƒç»„ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦æ˜¯ $O(N^4)$ï¼›<br>(2). ç„¶åæ€è€ƒä¼˜åŒ–çš„æ€è·¯ï¼Œé‚£ä¹ˆåœ¨å“ªé‡Œå¯ä»¥ç®€åŒ–å‘¢ï¼Ÿå…¶å®å¯ä»¥ä»å¼‚æˆ–çš„è¿‡ç¨‹å…¥æ‰‹ï¼Œæˆ‘ä»¬å¯èƒ½æ¯”è¾ƒç†Ÿæ‚‰ <code>å‰ç¼€å’Œ</code> äº†ï¼Œé‚£ä¹ˆåŒæ ·å¯ä»¥æ€è€ƒåˆ° <code>å‰ç¼€å¼‚æˆ–</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾æˆ‘ä»¬æœ‰æ•°ç»„ arr: [1, 2, 3, 4, 7, 9]; </span><br><span class="line">å‰é›¶é¡¹çš„å¼‚æˆ–å€¼ä¸º: 0 &#x3D; 0</span><br><span class="line">å‰ä¸€é¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 &#x3D; 1</span><br><span class="line">å‰äºŒé¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 âŠ• 2 &#x3D; 3</span><br><span class="line">å‰ä¸‰é¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 âŠ• 2 âŠ• 3 &#x3D; 0</span><br><span class="line">å‰å››é¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 âŠ• 2 âŠ• 3 âŠ• 4 &#x3D; 4</span><br><span class="line">å‰äº”é¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 âŠ• 2 âŠ• 3 âŠ• 4 âŠ• 7 &#x3D; 3</span><br><span class="line">å‰å…­é¡¹çš„å¼‚æˆ–å€¼ä¸º: 1 âŠ• 2 âŠ• 3 âŠ• 4 âŠ• 7 âŠ• 9 &#x3D; 10</span><br><span class="line"></span><br><span class="line">å› æ­¤å®ƒçš„å‰ç¼€å¼‚æˆ–æ•°ç»„ä¸º preXOR: [0, 1, 3, 0, 4, 3, 10];</span><br><span class="line"></span><br><span class="line">å‡è®¾ç°åœ¨æˆ‘ä»¬æƒ³æ±‚ç¬¬ 3 é¡¹åˆ°ç¬¬ 6 é¡¹çš„å¼‚æˆ–å€¼ï¼Œ æ­¤æ—¶æˆ‘ä»¬ä¸éœ€è¦å»æš´åŠ›è®¡ç®— &quot;3 âŠ• 4 âŠ• 7 âŠ• 9&quot;</span><br><span class="line">æˆ‘ä»¬çŸ¥é“ (3 âŠ• 4 âŠ• 7 âŠ• 9) &#x3D; (1 âŠ• 2) âŠ• (1 âŠ• 2 âŠ• 3 âŠ• 4 âŠ• 7 âŠ• 9) </span><br><span class="line">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰ç¼€å¼‚æˆ–çš„æ•°ç»„æ¥è®¡ç®—ç¬¬ 3 é¡¹åˆ°ç¬¬ 6 é¡¹çš„å¼‚æˆ–å€¼</span><br><span class="line">(1 âŠ• 2) ä¸ºå‰ 2 é¡¹çš„å¼‚æˆ–å€¼ä¸º â€œ3â€</span><br><span class="line">(1 âŠ• 2 âŠ• 3 âŠ• 4 âŠ• 7 âŠ• 9) ä¸ºå‰ 6 é¡¹å¼‚æˆ–å€¼ä¸º â€œ10â€</span><br><span class="line">å› æ­¤ç¬¬ 3 é¡¹åˆ°ç¬¬ 6 é¡¹çš„å¼‚æˆ–å€¼ä¸ºï¼š3 âŠ• 10 &#x3D; 9</span><br><span class="line">æ‰€æœ‰å¯¹äºå‰ç¼€å¼‚æˆ–æˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥ç”¨O(1)çš„æ—¶é—´è®¡ç®—åŒºé—´å†…çš„å¼‚æˆ–å€¼</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥æœ‰æ•ˆèŠ‚çœæ—¶é—´å¼€é”€ï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦æ˜¯ $O(N^3)$ï¼›<br>(3). å†è€ƒè™‘è¿›è¡Œä¼˜åŒ–ï¼Œåˆ©ç”¨å¼‚æˆ–çš„æ€§è´¨ é¢˜ç›®è®©æˆ‘ä»¬æ‰¾åˆ°æ»¡è¶³ <code>a == b</code> çš„åæ ‡ï¼Œé‚£ä¹ˆå½“ <code>a</code> ç­‰äº <code>b</code> æ—¶æ»¡è¶³ä»€ä¹ˆæ€§è´¨? <code>a âŠ• b = 0</code>! æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° <code>arr[i] ^...^ arr[j-1]^ arr[j] ^...^ arr[k] = 0</code>ã€‚å› æ­¤åœ¨ <code>i</code> ä¹‹å‰çš„å‰ç¼€å¼‚æˆ–å€¼åˆ° <code>k</code> æ—¶ä¸ä¼šå˜ã€‚å› ä¸º<code>[iï¼Œk]</code> çš„åŒºé—´å¼‚æˆ–å€¼ä¸º0ï¼Œå¯ä»¥å¾—åˆ°ï¼š <code>xor[i] == preXor[k+1]</code>ã€‚å…¶å¦ä¸€ç‚¹é‡ç‚¹åœ¨äºåœ¨åŒºé—´ <code>[i, k]</code>å†… <code>j</code> åœ¨å“ªå¹¶ä¸é‡è¦ï¼Œ å› ä¸ºæ— è®º <code>j</code> åœ¨å“ªï¼Œ<code>i</code> åˆ° <code>k</code> çš„å¼‚æˆ–å€¼éƒ½ç­‰äº 0ï¼Œä¸å½±å“ç»“æœã€‚æ­¤æ—¶æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(N^2)</code><br>(4). å¯¹äºä¸‹æ ‡ <code>k</code>ï¼Œè‹¥ä¸‹æ ‡ i=$i_1$,$i_2$,â€¦,$i_m$ æ—¶å‡æ»¡è¶³ $xor_i$ = $xor_{k+1}$ï¼Œæ ¹æ®ä¹‹å‰æ–¹æ³•ï¼Œè¿™äº›äºŒå…ƒç»„ $(i_1,k),(i_2,k),â€¦,(i_m,k)$å¯¹ç­”æ¡ˆçš„è´¡çŒ®ä¹‹å’Œä¸º:<br>$\left(k-i_{1}\right)+\left(k-i_{2}\right)+\cdots+\left(k-i_{m}\right)=m \cdot k-\left(i_{1}+i_{2}+\cdots+i_{m}\right)$<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“éå†ä¸‹æ ‡ <code>k</code> æ—¶ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ‰€æœ‰æ»¡è¶³$xor_i$ = $xor_{k+1}$ çš„</p><ul><li>ä¸‹æ ‡ <code>i</code> çš„å‡ºç°æ¬¡æ•° <code>m</code></li><li>ä¸‹æ ‡ <code>i</code> ä¹‹å’Œ<br>æˆ‘ä»¬å¯ä»¥åœ¨è®¡ç®—å¼‚æˆ–å‰ç¼€å’Œçš„åŒæ—¶è®¡ç®—ç­”æ¡ˆï¼Œä»è€Œåšåˆ°ä»…éå† <code>arr</code> ä¸€æ¬¡å°±è®¡ç®—å‡ºç­”æ¡ˆã€‚æ­¤æ—¶æ—¶é—´å¤æ‚åº¦å¯ä»¥å‹ç¼©åˆ° $O(N)$</li></ul><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><p>æš´åŠ›ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countTriplets</span><span class="params">(arr []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">var</span> opration <span class="function"><span class="keyword">func</span><span class="params">(i, j, k <span class="keyword">int</span>)</span> <span class="title">bool</span></span>  </span><br><span class="line"> opration = <span class="function"><span class="keyword">func</span><span class="params">(i, j, k <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;  </span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">0</span>  </span><br><span class="line"><span class="keyword">for</span> idx1 := i; idx1 &lt;= j<span class="number">-1</span>; idx1++ &#123;  </span><br><span class="line"> a ^= arr[idx1]  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">for</span> idx2 := j; idx2 &lt;= k; idx2++ &#123;  </span><br><span class="line"> b ^= arr[idx2]  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a == b  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   count := <span class="number">0</span>  </span><br><span class="line"> path := []<span class="keyword">int</span>&#123;&#125;  </span><br><span class="line">   <span class="keyword">var</span> backTacking <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span>, k <span class="keyword">int</span>)</span></span>  </span><br><span class="line">   backTacking = <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span>, k <span class="keyword">int</span>)</span></span> &#123;  </span><br><span class="line">      <span class="keyword">if</span> k == <span class="number">0</span> &#123;  </span><br><span class="line">         <span class="keyword">if</span> opration(path[<span class="number">0</span>], path[<span class="number">1</span>], path[<span class="number">2</span>]) &#123;  </span><br><span class="line">            <span class="comment">// fmt.Println(path)  </span></span><br><span class="line"> count++  </span><br><span class="line"> &#125;  </span><br><span class="line">       <span class="keyword">return</span>  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> i := start; i &lt; <span class="built_in">len</span>(arr); i++ &#123;  </span><br><span class="line">         path = <span class="built_in">append</span>(path, i)  </span><br><span class="line">         <span class="keyword">if</span> k == <span class="number">3</span> &#123;  </span><br><span class="line">            backTacking(i+<span class="number">1</span>, k<span class="number">-1</span>)  </span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            backTacking(i, k<span class="number">-1</span>)  </span><br><span class="line">         &#125;  </span><br><span class="line">  </span><br><span class="line">         path = path[:<span class="built_in">len</span>(path)<span class="number">-1</span>]  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   backTacking(<span class="number">0</span>, <span class="number">3</span>)  </span><br><span class="line">   <span class="keyword">return</span> count  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æš´åŠ›+å‰ç¼€å’Œä¼˜åŒ–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countTriplets</span><span class="params">(arr []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;  </span><br><span class="line">  </span><br><span class="line">   xor := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(arr)+<span class="number">1</span>)  </span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= <span class="built_in">len</span>(arr); i++ &#123;  </span><br><span class="line">      xor[i] = xor[i<span class="number">-1</span>] ^ arr[i<span class="number">-1</span>]  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">var</span> opration <span class="function"><span class="keyword">func</span><span class="params">(i, j, k <span class="keyword">int</span>)</span> <span class="title">bool</span></span>  </span><br><span class="line"> opration = <span class="function"><span class="keyword">func</span><span class="params">(i, j, k <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;  </span><br><span class="line">      a, b := <span class="number">0</span>, <span class="number">0</span>  </span><br><span class="line"> a = xor[j] ^ xor[i]  </span><br><span class="line">      b = xor[k+<span class="number">1</span>] ^ xor[j]  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> a == b  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   count := <span class="number">0</span>  </span><br><span class="line"> path := []<span class="keyword">int</span>&#123;&#125;  </span><br><span class="line">   <span class="keyword">var</span> backTacking <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span>, k <span class="keyword">int</span>)</span></span>  </span><br><span class="line">   backTacking = <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span>, k <span class="keyword">int</span>)</span></span> &#123;  </span><br><span class="line">      <span class="keyword">if</span> k == <span class="number">0</span> &#123;  </span><br><span class="line">         <span class="keyword">if</span> opration(path[<span class="number">0</span>], path[<span class="number">1</span>], path[<span class="number">2</span>]) &#123;  </span><br><span class="line">            <span class="comment">// fmt.Println(path)  </span></span><br><span class="line"> count++  </span><br><span class="line"> &#125;  </span><br><span class="line">         <span class="keyword">return</span>  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">      <span class="keyword">for</span> i := start; i &lt; <span class="built_in">len</span>(arr); i++ &#123;  </span><br><span class="line">         path = <span class="built_in">append</span>(path, i)  </span><br><span class="line">         <span class="keyword">if</span> k == <span class="number">3</span> &#123;  </span><br><span class="line">            backTacking(i+<span class="number">1</span>, k<span class="number">-1</span>)  </span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            backTacking(i, k<span class="number">-1</span>)  </span><br><span class="line">         &#125;  </span><br><span class="line">  </span><br><span class="line">         path = path[:<span class="built_in">len</span>(path)<span class="number">-1</span>]  </span><br><span class="line">      &#125;  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   backTacking(<span class="number">0</span>, <span class="number">3</span>)  </span><br><span class="line">   <span class="keyword">return</span> count  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å¼‚æˆ–æ€§è´¨ä¸¤æ¬¡éå†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countTriplets</span><span class="params">(arr []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">xor := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(arr)+<span class="number">1</span>)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;=<span class="built_in">len</span>(arr); i++ &#123;</span><br><span class="line">xor[i] = xor[i<span class="number">-1</span>]^arr[i<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">count := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(arr)<span class="number">-1</span>; i++ &#123;</span><br><span class="line"><span class="keyword">for</span> k:=i+<span class="number">1</span>; k&lt;<span class="built_in">len</span>(arr); k++ &#123;</span><br><span class="line"><span class="keyword">if</span> xor[i] == xor[k+<span class="number">1</span>] &#123;</span><br><span class="line">count += k-i</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€æ¬¡éå†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countTriplets</span><span class="params">(arr []<span class="keyword">int</span>)</span> <span class="params">(ans <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">cnt := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">total := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">s := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, val := <span class="keyword">range</span> arr &#123;</span><br><span class="line"><span class="keyword">if</span> m, has := cnt[s^val]; has &#123;</span><br><span class="line">ans += m*k - total[s^val]</span><br><span class="line">&#125;</span><br><span class="line">cnt[s]++</span><br><span class="line">total[s] += k</span><br><span class="line">s ^= val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode28-å®ç°-strStr&quot;&gt;&lt;a href=&quot;#LeetCode28-å®ç°-strStr&quot; class=&quot;headerlink&quot; title=&quot;LeetCode28. å®ç° strStr()&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;h</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 9ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/10/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%209%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/10/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%209%EF%BC%89/</id>
    <published>2022-04-10T14:00:00.000Z</published>
    <updated>2022-04-10T15:25:45.257Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹ 2022.04.09 å‘¨èµ›çš„å¤ç›˜</p><h2 id="LeetCode6037-æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—"><a href="#LeetCode6037-æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—" class="headerlink" title="LeetCode6037. æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—"></a><a class="link" href="https://leetcode-cn.com/problems/largest-number-after-digit-swaps-by-parity/">LeetCode6037. æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—<i class="fas fa-external-link-alt"></i></a></h2><p>#æ•°ç»„</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•° <code>num</code> ã€‚ä½ å¯ä»¥äº¤æ¢ <code>num</code> ä¸­ <strong>å¥‡å¶æ€§</strong> ç›¸åŒçš„ä»»æ„ä¸¤ä½æ•°å­—ï¼ˆå³ï¼Œéƒ½æ˜¯å¥‡æ•°æˆ–è€…å¶æ•°ï¼‰ã€‚<br>è¿”å›äº¤æ¢ <strong>ä»»æ„</strong> æ¬¡ä¹‹å <code>num</code> çš„ <strong>æœ€å¤§</strong> å¯èƒ½å€¼ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnum &#x3D; 1234</span><br><span class="line">è¾“å‡ºï¼š3412</span><br><span class="line">è§£é‡Šï¼šäº¤æ¢æ•°å­— 3 å’Œæ•°å­— 1 ï¼Œç»“æœå¾—åˆ° 3214 ã€‚</span><br><span class="line">äº¤æ¢æ•°å­— 2 å’Œæ•°å­— 4 ï¼Œç»“æœå¾—åˆ° 3412 ã€‚</span><br><span class="line">æ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å…¶ä»–äº¤æ¢åºåˆ—ï¼Œä½†æ˜¯å¯ä»¥è¯æ˜ 3412 æ˜¯æœ€å¤§å¯èƒ½å€¼ã€‚</span><br><span class="line">æ³¨æ„ï¼Œä¸èƒ½äº¤æ¢æ•°å­— 4 å’Œæ•°å­— 1 ï¼Œå› ä¸ºå®ƒä»¬å¥‡å¶æ€§ä¸åŒã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnum &#x3D; 65875</span><br><span class="line">è¾“å‡ºï¼š87655</span><br><span class="line">è§£é‡Šï¼šäº¤æ¢æ•°å­— 8 å’Œæ•°å­— 6 ï¼Œç»“æœå¾—åˆ° 85675 ã€‚</span><br><span class="line">äº¤æ¢æ•°å­— 5 å’Œæ•°å­— 7 ï¼Œç»“æœå¾—åˆ° 87655 ã€‚</span><br><span class="line">æ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å…¶ä»–äº¤æ¢åºåˆ—ï¼Œä½†æ˜¯å¯ä»¥è¯æ˜ 87655 æ˜¯æœ€å¤§å¯èƒ½å€¼ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; num &lt;&#x3D; 109</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). åˆå§‹åŒ–ä¸‰ä¸ªæ•°ç»„ <code>array</code>ã€<code>array1</code>ã€<code>array2</code>ï¼Œ<code>array</code>ç”¨äºè®°å½•æ•°å­—å¯¹åº”ä½ç½®ä¸Šæ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ã€<code>array1</code>ç”¨äºä¿å­˜å¹¶æ’åºæ‰€æœ‰çš„å¶æ•°ã€<code>array2</code>ç”¨äºä¿å­˜å¹¶æ’åºæ‰€æœ‰çš„å¥‡æ•°ï¼›<br>(2). æ ¹æ® <code>array</code> ä¿å­˜çš„å¯¹åº”ä½ç½®çš„å¥‡å¶è¡Œï¼Œä»å¤§åˆ°å°ä¾æ¬¡å–å‡º<code>array1</code>æˆ–<code>array2</code> ä¸­çš„æ•°ï¼›</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestInteger</span><span class="params">(num <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">array1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">array2 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">array := <span class="built_in">make</span>([]<span class="keyword">bool</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num &gt; <span class="number">0</span> &#123;</span><br><span class="line">x := num % <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> x%<span class="number">2</span> == <span class="number">0</span> &#123;</span><br><span class="line">array1 = <span class="built_in">append</span>(array1, x)</span><br><span class="line">array = <span class="built_in">append</span>(array, <span class="literal">true</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">array2 = <span class="built_in">append</span>(array2, x)</span><br><span class="line">array = <span class="built_in">append</span>(array, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">num /= <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sort.Ints(array1)</span><br><span class="line">sort.Ints(array2)</span><br><span class="line"></span><br><span class="line">ret := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="built_in">len</span>(array)<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i-- &#123;</span><br><span class="line">ret *= <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> array[i] &#123;</span><br><span class="line">ret += array1[<span class="built_in">len</span>(array1)<span class="number">-1</span>]</span><br><span class="line">array1 = array1[:<span class="built_in">len</span>(array1)<span class="number">-1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret += array2[<span class="built_in">len</span>(array2)<span class="number">-1</span>]</span><br><span class="line">array2 = array2[:<span class="built_in">len</span>(array2)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode6038-å‘è¡¨è¾¾å¼æ·»åŠ æ‹¬å·åçš„æœ€å°ç»“æœ"><a href="#LeetCode6038-å‘è¡¨è¾¾å¼æ·»åŠ æ‹¬å·åçš„æœ€å°ç»“æœ" class="headerlink" title="LeetCode6038. å‘è¡¨è¾¾å¼æ·»åŠ æ‹¬å·åçš„æœ€å°ç»“æœ"></a><a class="link" href="https://leetcode-cn.com/problems/minimize-result-by-adding-parentheses-to-expression/">LeetCode6038. å‘è¡¨è¾¾å¼æ·»åŠ æ‹¬å·åçš„æœ€å°ç»“æœ<i class="fas fa-external-link-alt"></i></a></h2><p>#å­—ç¬¦ä¸²</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0 å¼€å§‹çš„å­—ç¬¦ä¸² expression ï¼Œæ ¼å¼ä¸º â€œ&lt;num1&gt;+&lt;num2&gt;â€ ï¼Œå…¶ä¸­ &lt;num1&gt; å’Œ &lt;num2&gt; è¡¨ç¤ºæ­£æ•´æ•°ã€‚<br>è¯·ä½ å‘ expression ä¸­æ·»åŠ ä¸€å¯¹æ‹¬å·ï¼Œä½¿å¾—åœ¨æ·»åŠ ä¹‹åï¼Œ expression ä»ç„¶æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­¦è¡¨è¾¾å¼ï¼Œå¹¶ä¸”è®¡ç®—åå¯ä»¥å¾—åˆ° æœ€å° å¯èƒ½å€¼ã€‚å·¦æ‹¬å· å¿…é¡» æ·»åŠ åœ¨ â€˜+â€™ çš„å·¦ä¾§ï¼Œè€Œå³æ‹¬å·å¿…é¡»æ·»åŠ åœ¨ â€˜+â€™ çš„å³ä¾§ã€‚<br>è¿”å›æ·»åŠ ä¸€å¯¹æ‹¬å·åå½¢æˆçš„è¡¨è¾¾å¼Â expression ï¼Œä¸”æ»¡è¶³ expression è®¡ç®—å¾—åˆ° æœ€å° å¯èƒ½å€¼ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªç­”æ¡ˆéƒ½èƒ½äº§ç”Ÿç›¸åŒç»“æœï¼Œè¿”å›ä»»æ„ä¸€ä¸ªç­”æ¡ˆã€‚<br>ç”Ÿæˆçš„è¾“å…¥æ»¡è¶³ï¼šexpression çš„åŸå§‹å€¼å’Œæ·»åŠ æ»¡è¶³è¦æ±‚çš„ä»»ä¸€å¯¹æ‹¬å·ä¹‹å expression çš„å€¼ï¼Œéƒ½ç¬¦åˆ 32-bit å¸¦ç¬¦å·æ•´æ•°èŒƒå›´ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šexpression &#x3D; &quot;247+38&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;2(47+38)&quot;</span><br><span class="line">è§£é‡Šï¼šè¡¨è¾¾å¼è®¡ç®—å¾—åˆ° 2 * (47 + 38) &#x3D; 2 * 85 &#x3D; 170 ã€‚</span><br><span class="line">æ³¨æ„ &quot;2(4)7+38&quot; ä¸æ˜¯æœ‰æ•ˆçš„ç»“æœï¼Œå› ä¸ºå³æ‹¬å·å¿…é¡»æ·»åŠ åœ¨ &#39;+&#39; çš„å³ä¾§ã€‚</span><br><span class="line">å¯ä»¥è¯æ˜ 170 æ˜¯æœ€å°å¯èƒ½å€¼ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šexpression &#x3D; &quot;12+34&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;1(2+3)4&quot;</span><br><span class="line">è§£é‡Šï¼šè¡¨è¾¾å¼è®¡ç®—å¾—åˆ° 1 * (2 + 3) * 4 &#x3D; 1 * 5 * 4 &#x3D; 20 ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line">è¾“å…¥ï¼šexpression &#x3D; &quot;999+999&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;(999+999)&quot;</span><br><span class="line">è§£é‡Šï¼šè¡¨è¾¾å¼è®¡ç®—å¾—åˆ° 999 + 999 &#x3D; 1998 ã€‚</span><br><span class="line">Â </span><br><span class="line">æç¤ºï¼š</span><br><span class="line">3 &lt;&#x3D; expression.length &lt;&#x3D; 10</span><br><span class="line">expression ä»…ç”±æ•°å­— &#39;1&#39; åˆ° &#39;9&#39; å’Œ &#39;+&#39; ç»„æˆ</span><br><span class="line">expression ç”±æ•°å­—å¼€å§‹å’Œç»“æŸ</span><br><span class="line">expression æ°å¥½ä»…å«æœ‰ä¸€ä¸ª &#39;+&#39;.</span><br><span class="line">expression çš„åŸå§‹å€¼å’Œæ·»åŠ æ»¡è¶³è¦æ±‚çš„ä»»ä¸€å¯¹æ‹¬å·ä¹‹å expression çš„å€¼ï¼Œéƒ½ç¬¦åˆ 32-bit å¸¦ç¬¦å·æ•´æ•°èŒƒå›´</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆè¦å®Œæˆä¸€ä¸ªå¯¹ç‰¹å®šå­—ç¬¦ä¸²ç»“æœçš„è®¡ç®—å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ç­›é€‰å‡ºè®¡ç®—è¡¨è¾¾å¼çš„å‰ä¸­åä¸‰ä¸ªéƒ¨åˆ†å³å¯ï¼›<br>(2). åˆ†åˆ«å°† â€œ+â€ å‰åçš„æ•°å­—å­—ç¬¦ä¸²æå–å‡ºæ¥ï¼Œåˆ†åˆ«åœ¨å¯èƒ½çš„ä½ç½®æ·»åŠ æ­£åæ‹¬å·ï¼›<br>(3). å¯¹äº â€˜(â€˜ è€Œè¨€ï¼Œå¯èƒ½æ·»åŠ çš„ä½ç½®åœ¨ <code>b1</code> çš„ <code>[0,len(b1))</code>ï¼›<br>(3). å¯¹äº â€˜)â€™ è€Œè¨€ï¼Œå¯èƒ½æ·»åŠ çš„ä½ç½®åœ¨ <code>b2</code> çš„ <code>[1,len(b2)]</code>ï¼›</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p><code>O(len(s1)*len(s2))</code></p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minimizeResult</span><span class="params">(expression <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cal <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>)</span> <span class="title">int</span></span></span><br><span class="line">cal = <span class="function"><span class="keyword">func</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">s1 := <span class="string">&quot;&quot;</span></span><br><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> ; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span> &#123;</span><br><span class="line">s1 += s[i:i+<span class="number">1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i++</span><br><span class="line">a, b, pre := <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> ; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span> &amp;&amp; pre &#123;</span><br><span class="line">a += s[i:i+<span class="number">1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;+&#x27;</span> &#123;</span><br><span class="line">pre = <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span> &amp;&amp; !pre &#123;</span><br><span class="line">b += s[i:i+<span class="number">1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> preNum <span class="keyword">int</span></span><br><span class="line"><span class="keyword">if</span> s1 == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">preNum = <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">preNum, _ = strconv.Atoi(s1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mid1, _ := strconv.Atoi(a)</span><br><span class="line">mid2, _ := strconv.Atoi(b)</span><br><span class="line"></span><br><span class="line">s2 := <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> ; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span> &#123;</span><br><span class="line">s2 += s[i:i+<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s2 != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">lastNum, _ := strconv.Atoi(s2)</span><br><span class="line"><span class="keyword">return</span> preNum*(mid1+mid2)*lastNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> preNum*(mid1+mid2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">str := strings.Split(expression, <span class="string">&quot;+&quot;</span>)</span><br><span class="line">x1, _ := strconv.Atoi((str[<span class="number">0</span>]))</span><br><span class="line">x2, _ := strconv.Atoi(str[<span class="number">1</span>])</span><br><span class="line">ret := x1+x2</span><br><span class="line">retS := <span class="string">&quot;(&quot;</span>+expression+<span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">b1 := []<span class="keyword">byte</span>(str[<span class="number">0</span>])</span><br><span class="line">b2 := []<span class="keyword">byte</span>(str[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(b1); i++ &#123;</span><br><span class="line">b1 = <span class="built_in">append</span>(b1[:i], <span class="built_in">append</span>([]<span class="keyword">byte</span>&#123;<span class="string">&#x27;(&#x27;</span>&#125;, b1[i:]...)...)</span><br><span class="line"><span class="comment">// fmt.Println(b1)</span></span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">1</span>; j&lt;=<span class="built_in">len</span>(b2); j++ &#123;</span><br><span class="line"></span><br><span class="line">b2 = <span class="built_in">append</span>(b2[:j], <span class="built_in">append</span>([]<span class="keyword">byte</span>&#123;<span class="string">&#x27;)&#x27;</span>&#125;, b2[j:]...)...)</span><br><span class="line">t := cal(<span class="keyword">string</span>(b1)+<span class="string">&quot;+&quot;</span>+<span class="keyword">string</span>(b2))</span><br><span class="line"><span class="comment">//fmt.Println(string(b1)+&quot;+&quot;+string(b2), t)</span></span><br><span class="line"><span class="keyword">if</span> t &lt; ret &#123;</span><br><span class="line">ret = t</span><br><span class="line">retS = <span class="keyword">string</span>(b1)+<span class="string">&quot;+&quot;</span>+<span class="keyword">string</span>(b2)</span><br><span class="line">&#125;</span><br><span class="line">b2 = <span class="built_in">append</span>(b2[:j], b2[j+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b1 = <span class="built_in">append</span>(b1[:i], b1[i+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> retS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode6039-K-æ¬¡å¢åŠ åçš„æœ€å¤§ä¹˜ç§¯"><a href="#LeetCode6039-K-æ¬¡å¢åŠ åçš„æœ€å¤§ä¹˜ç§¯" class="headerlink" title="LeetCode6039. K æ¬¡å¢åŠ åçš„æœ€å¤§ä¹˜ç§¯"></a><a class="link" href="https://leetcode-cn.com/problems/maximum-product-after-k-increments/">LeetCode6039. K æ¬¡å¢åŠ åçš„æœ€å¤§ä¹˜ç§¯<i class="fas fa-external-link-alt"></i></a></h2><p>#æ•°ç»„</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„Â numsÂ å’Œä¸€ä¸ªæ•´æ•°Â kÂ ã€‚æ¯æ¬¡æ“ä½œï¼Œä½ å¯ä»¥é€‰æ‹©Â numsÂ ä¸­ ä»»ä¸€Â å…ƒç´ å¹¶å°†å®ƒ å¢åŠ Â 1Â ã€‚<br>è¯·ä½ è¿”å› è‡³å¤šÂ kÂ æ¬¡æ“ä½œåï¼Œèƒ½å¾—åˆ°çš„Â numsçš„Â æœ€å¤§ä¹˜ç§¯Â ã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·ä½ å°†ç­”æ¡ˆå¯¹Â 109 + 7Â å–ä½™åè¿”å›ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [0,4], k &#x3D; 5</span><br><span class="line">è¾“å‡ºï¼š20</span><br><span class="line">è§£é‡Šï¼šå°†ç¬¬ä¸€ä¸ªæ•°å¢åŠ  5 æ¬¡ã€‚</span><br><span class="line">å¾—åˆ° nums &#x3D; [5, 4] ï¼Œä¹˜ç§¯ä¸º 5 * 4 &#x3D; 20 ã€‚</span><br><span class="line">å¯ä»¥è¯æ˜ 20 æ˜¯èƒ½å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å› 20 ã€‚</span><br><span class="line">å­˜åœ¨å…¶ä»–å¢åŠ  nums çš„æ–¹æ³•ï¼Œä¹Ÿèƒ½å¾—åˆ°æœ€å¤§ä¹˜ç§¯ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [6,3,3,2], k &#x3D; 2</span><br><span class="line">è¾“å‡ºï¼š216</span><br><span class="line">è§£é‡Šï¼šå°†ç¬¬äºŒä¸ªæ•°å¢åŠ  1 æ¬¡ï¼Œå°†ç¬¬å››ä¸ªæ•°å¢åŠ  1 æ¬¡ã€‚</span><br><span class="line">å¾—åˆ° nums &#x3D; [6, 4, 3, 3] ï¼Œä¹˜ç§¯ä¸º 6 * 4 * 3 * 3 &#x3D; 216 ã€‚</span><br><span class="line">å¯ä»¥è¯æ˜ 216 æ˜¯èƒ½å¾—åˆ°çš„æœ€å¤§ä¹˜ç§¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿”å› 216 ã€‚</span><br><span class="line">å­˜åœ¨å…¶ä»–å¢åŠ  nums çš„æ–¹æ³•ï¼Œä¹Ÿèƒ½å¾—åˆ°æœ€å¤§ä¹˜ç§¯ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; nums.length, k &lt;&#x3D; 105</span><br><span class="line">0 &lt;&#x3D; nums[i] &lt;&#x3D; 106</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å…ˆä»å¤§åˆ°å°æ’åºæ•°ç»„ï¼›<br>(2). è¿›å…¥å¾ªç¯ï¼Œå¾ªç¯çš„ç»“æŸæ¡ä»¶æ˜¯ <code>k&lt;0</code>ï¼›<br>(3). ä»æ•°ç»„çš„æœ«å°¾å‘å‰éå†ï¼Œå¦‚æœå½“å‰æ•°å­—ç­‰äºä¸Šä¸€æ¬¡å¾ªç¯ä¸­æœªè¿›è¡Œæ›´æ”¹çš„åé¢æ•°å­—ï¼Œé‚£ä¹ˆå°†å½“å‰æ•°å­—åŠ  1ï¼›<br>(4). å¦‚æœå½“å‰æ•°å­—å¤§äºè¾“ä¸€æ¬¡å¾ªç¯ä¸­ä¸ºè¿›è¡Œæ›´æ”¹çš„åé¢æ•°å­—ï¼Œé‚£ä¹ˆå›åˆ°æ•°ç»„æœ«å°¾è¿›è¡Œå¾ªç¯ï¼›<br>(5). å½“ä»åå‘å‰éå†å®Œæ•´ä¸ªæ•°ç»„ï¼Œå†æ¬¡å›åˆ°æ•°ç»„æœ«å°¾ï¼›<br>(6). è·³å‡ºå¾ªç¯åï¼Œä»å¤´åˆ°å°¾è®¡ç®—ç»“æœã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(k*N)</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maximumProduct</span><span class="params">(nums []<span class="keyword">int</span>, k <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Max = <span class="number">1000000007</span></span><br><span class="line">sort.Slice(nums, <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> nums[i] &gt; nums[j]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">i := <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">x := nums[i]</span><br><span class="line"><span class="keyword">for</span> k &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> i &gt;= <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] == x &#123;</span><br><span class="line">nums[i]++</span><br><span class="line">i--</span><br><span class="line">k--</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[i] &gt;= x+<span class="number">1</span> &#123;</span><br><span class="line">i = <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">x = nums[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">i = <span class="built_in">len</span>(nums)<span class="number">-1</span></span><br><span class="line">x = nums[i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//fmt.Println(nums)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//fmt.Println(nums)</span></span><br><span class="line">ret := <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">ret = ret*nums[i]%Max</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode6040-èŠ±å›­çš„æœ€å¤§æ€»ç¾ä¸½å€¼"><a href="#LeetCode6040-èŠ±å›­çš„æœ€å¤§æ€»ç¾ä¸½å€¼" class="headerlink" title="LeetCode6040. èŠ±å›­çš„æœ€å¤§æ€»ç¾ä¸½å€¼"></a><a class="link" href="https://leetcode-cn.com/problems/maximum-total-beauty-of-the-gardens/">LeetCode6040. èŠ±å›­çš„æœ€å¤§æ€»ç¾ä¸½å€¼<i class="fas fa-external-link-alt"></i></a></h2><p>#äºŒåˆ†æŸ¥æ‰¾ #å‰ç¼€å’Œ</p><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>Alice æ˜¯Â nÂ ä¸ªèŠ±å›­çš„å›­ä¸ï¼Œå¥¹æƒ³é€šè¿‡ç§èŠ±ï¼Œæœ€å¤§åŒ–å¥¹æ‰€æœ‰èŠ±å›­çš„æ€»ç¾ä¸½å€¼ã€‚<br>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0Â å¼€å§‹å¤§å°ä¸º nÂ çš„æ•´æ•°æ•°ç»„Â flowersÂ ï¼Œå…¶ä¸­Â flowers[i]Â æ˜¯ç¬¬ iÂ ä¸ªèŠ±å›­é‡Œå·²ç»ç§çš„èŠ±çš„æ•°ç›®ã€‚å·²ç»ç§äº†çš„èŠ± ä¸èƒ½Â ç§»èµ°ã€‚åŒæ—¶ç»™ä½ Â newFlowersÂ ï¼Œè¡¨ç¤º Alice é¢å¤–å¯ä»¥ç§èŠ±çš„Â æœ€å¤§æ•°ç›®Â ã€‚åŒæ—¶ç»™ä½ çš„è¿˜æœ‰æ•´æ•°Â targetÂ ï¼ŒfullÂ å’ŒÂ partialÂ ã€‚<br>å¦‚æœä¸€ä¸ªèŠ±å›­æœ‰ è‡³å°‘Â targetÂ æœµèŠ±ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ±å›­ç§°ä¸º å®Œå–„çš„Â ï¼ŒèŠ±å›­çš„ æ€»ç¾ä¸½å€¼Â ä¸ºä»¥ä¸‹åˆ†æ•°ä¹‹ å’Œ ï¼š<br>å®Œå–„ èŠ±å›­æ•°ç›®ä¹˜ä»¥Â full.<br>å‰©ä½™ ä¸å®Œå–„Â èŠ±å›­é‡Œï¼ŒèŠ±çš„ æœ€å°‘æ•°ç›®Â ä¹˜ä»¥Â partialÂ ã€‚å¦‚æœæ²¡æœ‰ä¸å®Œå–„èŠ±å›­ï¼Œé‚£ä¹ˆè¿™ä¸€éƒ¨åˆ†çš„å€¼ä¸ºÂ 0Â ã€‚<br>è¯·ä½ è¿”å› Alice ç§æœ€å¤š newFlowersÂ æœµèŠ±ä»¥åï¼Œèƒ½å¾—åˆ°çš„Â æœ€å¤§Â æ€»ç¾ä¸½å€¼ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šflowers &#x3D; [1,3,1,1], newFlowers &#x3D; 7, target &#x3D; 6, full &#x3D; 12, partial &#x3D; 1</span><br><span class="line">è¾“å‡ºï¼š14</span><br><span class="line">è§£é‡Šï¼šAlice å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹æ¡ˆç§èŠ±</span><br><span class="line">- åœ¨ç¬¬ 0 ä¸ªèŠ±å›­ç§ 2 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 1 ä¸ªèŠ±å›­ç§ 3 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 2 ä¸ªèŠ±å›­ç§ 1 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 3 ä¸ªèŠ±å›­ç§ 1 æœµèŠ±</span><br><span class="line">èŠ±å›­é‡ŒèŠ±çš„æ•°ç›®ä¸º [3,6,2,2] ã€‚æ€»å…±ç§äº† 2 + 3 + 1 + 1 &#x3D; 7 æœµèŠ±ã€‚</span><br><span class="line">åªæœ‰ 1 ä¸ªèŠ±å›­æ˜¯å®Œå–„çš„ã€‚</span><br><span class="line">ä¸å®Œå–„èŠ±å›­é‡ŒèŠ±çš„æœ€å°‘æ•°ç›®æ˜¯ 2 ã€‚</span><br><span class="line">æ‰€ä»¥æ€»ç¾ä¸½å€¼ä¸º 1 * 12 + 2 * 1 &#x3D; 12 + 2 &#x3D; 14 ã€‚</span><br><span class="line">æ²¡æœ‰å…¶ä»–æ–¹æ¡ˆå¯ä»¥è®©èŠ±å›­æ€»ç¾ä¸½å€¼è¶…è¿‡ 14 ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šflowers &#x3D; [2,4,5,3], newFlowers &#x3D; 10, target &#x3D; 5, full &#x3D; 2, partial &#x3D; 6</span><br><span class="line">è¾“å‡ºï¼š30</span><br><span class="line">è§£é‡Šï¼šAlice å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹æ¡ˆç§èŠ±</span><br><span class="line">- åœ¨ç¬¬ 0 ä¸ªèŠ±å›­ç§ 3 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 1 ä¸ªèŠ±å›­ç§ 0 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 2 ä¸ªèŠ±å›­ç§ 0 æœµèŠ±</span><br><span class="line">- åœ¨ç¬¬ 3 ä¸ªèŠ±å›­ç§ 2 æœµèŠ±</span><br><span class="line">èŠ±å›­é‡ŒèŠ±çš„æ•°ç›®ä¸º [5,4,5,5] ã€‚æ€»å…±ç§äº† 3 + 0 + 0 + 2 &#x3D; 5 æœµèŠ±ã€‚</span><br><span class="line">æœ‰ 3 ä¸ªèŠ±å›­æ˜¯å®Œå–„çš„ã€‚</span><br><span class="line">ä¸å®Œå–„èŠ±å›­é‡ŒèŠ±çš„æœ€å°‘æ•°ç›®ä¸º 4 ã€‚</span><br><span class="line">æ‰€ä»¥æ€»ç¾ä¸½å€¼ä¸º 3 * 2 + 4 * 6 &#x3D; 6 + 24 &#x3D; 30 ã€‚</span><br><span class="line">æ²¡æœ‰å…¶ä»–æ–¹æ¡ˆå¯ä»¥è®©èŠ±å›­æ€»ç¾ä¸½å€¼è¶…è¿‡ 30 ã€‚</span><br><span class="line">æ³¨æ„ï¼ŒAliceå¯ä»¥è®©æ‰€æœ‰èŠ±å›­éƒ½å˜æˆå®Œå–„çš„ï¼Œä½†è¿™æ ·å¥¹çš„æ€»ç¾ä¸½å€¼åè€Œæ›´å°ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; flowers.length &lt;&#x3D; 105</span><br><span class="line">1 &lt;&#x3D; flowers[i], target &lt;&#x3D; 105</span><br><span class="line">1 &lt;&#x3D; newFlowers &lt;&#x3D; 1010</span><br><span class="line">1 &lt;&#x3D; full, partial &lt;&#x3D; 105</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å°† <code>flowers</code> ä»å°åˆ°å¤§æ’åºï¼›<br>(2). è´ªå¿ƒï¼šè®©é åçš„ <code>flowers[i]</code> å¢åŠ è‡³ <code>target</code>ï¼Œå…¶ä½™çš„ <code>flowers</code> çš„æœ€å°å€¼å°½é‡å¤§ï¼›<br>(3). å¤–å±‚å¾ªç¯åœ¨æšä¸¾å®Œå–„èŠ±å›­ä¸ªæ•°çš„å‰æä¸‹ï¼Œå†…å±‚å¾ªç¯æˆ‘ä»¬è¦å»è®¡ç®—å‰©ä½™<code>newFlowers</code> èŠ±æœµæ•°ç›®ä¸‹ä¸å®Œå–„èŠ±å›­åŒºé—´å†…èƒ½æ‹¿åˆ°çš„æœ€å°å€¼ï¼Œè¿™é‡Œé¢æˆ‘ä»¬é€šè¿‡äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼æ¥æšä¸¾æœ€å°å€¼ï¼ˆå…·æœ‰äºŒæ®µæ€§ï¼‰ï¼Œ<code>check</code> å‡½æ•°é‡Œé¢å…ˆæ‰¾åˆ°å¤§äºç­‰äº<code>mid</code> çš„ä½ç½®ï¼Œç„¶ååˆ¤æ–­å‰©ä¸‹çš„æ•°å…¨éƒ¨è¡¥å……åˆ° <code>mid</code> æœµèŠ±å¤Ÿä¸å¤Ÿï¼Œæœ€åäºŒåˆ†çš„ç»“æœå°±æ˜¯å½“å‰ä¸å®Œå–„èŠ±å›­åŒºé—´å†…èƒ½æ‹¿åˆ°çš„æœ€å°å€¼ï¼Œæ›´æ–°ç­”æ¡ˆå³å¯ã€‚<br>æ³¨ï¼š å¤–å±‚å¾ªç¯æšä¸¾æ—¶ç‰¹åˆ¤ä¸€ä¸‹iiç­‰äº00çš„æƒ…å†µï¼Œå› ä¸ºæ­¤æ—¶<code>j = i - 1</code>ä¼šè¶Šç•Œã€‚</p><h3 id="è§£é¢˜ä»£ç -3"><a href="#è§£é¢˜ä»£ç -3" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maximumBeauty</span><span class="params">(flowers []<span class="keyword">int</span>, newFlowers <span class="keyword">int64</span>, target <span class="keyword">int</span>, full <span class="keyword">int</span>, partial <span class="keyword">int</span>)</span> <span class="title">int64</span></span> &#123;  </span><br><span class="line">   sort.Ints(flowers)  </span><br><span class="line">   n := <span class="built_in">len</span>(flowers)  </span><br><span class="line">  </span><br><span class="line">   <span class="comment">// count:å·²ç»å®Œå–„çš„ä¸ªæ•°  </span></span><br><span class="line"> count := <span class="number">0</span>  </span><br><span class="line"> <span class="comment">// è®¡ç®— &gt;= targetæ•°ç›®, é€€å‡ºå¾ªç¯å flowers[0, idx] &lt; target idx := n - 1  </span></span><br><span class="line"> <span class="keyword">for</span> idx &gt;= <span class="number">0</span> &amp;&amp; flowers[idx] &gt;= target &#123;  </span><br><span class="line">      count++  </span><br><span class="line"> idx--  </span><br><span class="line"> &#125;  </span><br><span class="line">   <span class="comment">//fmt.Println(&quot;idx:&quot;, idx, &quot;count:&quot;, count)  </span></span><br><span class="line">  </span><br><span class="line"> <span class="comment">// å…¨éƒ¨éƒ½æ˜¯å®Œå–„çš„  </span></span><br><span class="line"> <span class="keyword">if</span> idx == <span class="number">-1</span> &#123;  </span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">int64</span>(n * full)  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   sum := <span class="built_in">make</span>([]<span class="keyword">int64</span>, n + <span class="number">1</span>)  </span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= n; i++ &#123;  </span><br><span class="line">      sum[i] = sum[i - <span class="number">1</span>] + <span class="keyword">int64</span>(flowers[i - <span class="number">1</span>])  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   check := <span class="function"><span class="keyword">func</span><span class="params">(left, right, remain, t <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;  </span><br><span class="line">      <span class="comment">// 1.æ‰¾åˆ°å€¼ &lt; tçš„åŒºé—´çš„å³ç«¯ç‚¹  </span></span><br><span class="line"> <span class="keyword">for</span> left &lt; right &#123;  </span><br><span class="line">         mid := left + (right - left + <span class="number">1</span>) / <span class="number">2</span>  </span><br><span class="line"> <span class="keyword">if</span> flowers[mid] &lt; t &#123;  </span><br><span class="line">            left = mid  </span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            right = mid - <span class="number">1</span>  </span><br><span class="line"> &#125;  </span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="comment">// 2.æ£€æŸ¥åŒºé—´[0, left] æ˜¯å¦å¯ä»¥å®Œå–„ä¸ºt  </span></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">int64</span>(remain) &gt;= <span class="keyword">int64</span>(t * (left + <span class="number">1</span>)) - sum[left + <span class="number">1</span>]  </span><br><span class="line">  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">var</span> res <span class="keyword">int64</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="comment">// cnt: æ–°çš„å˜æˆå®Œå–„çš„ä¸ªæ•°, ä»å³å¾€å·¦å¡«  </span></span><br><span class="line"> <span class="keyword">for</span> cnt := <span class="number">0</span>; cnt &lt;= idx + <span class="number">1</span>; cnt++ &#123;  </span><br><span class="line">      <span class="comment">// åŒºé—´ï¼š[idx - cnt + 1,idx]å®Œå–„, [0, idx - cnt]ä¸å®Œå–„ï¼Œå¹¶è®¡ç®—[0, idx - cnt]ä¸­çš„æœ€å°å€¼çš„æœ€å¤§å€¼  </span></span><br><span class="line"> <span class="comment">// å¡«å……å®ŒåŒºé—´[idx - cnt + 1, idx]åå‰©ä½™å¯ç§çš„èŠ±çš„æ•°ç›®  </span></span><br><span class="line"> remain := newFlowers - (<span class="keyword">int64</span>(target * cnt) - (sum[idx + <span class="number">1</span>] - sum[idx - cnt + <span class="number">1</span>]))  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">//fmt.Println(&quot;remain:&quot;, remain)  </span></span><br><span class="line"> <span class="keyword">if</span> remain &lt; <span class="number">0</span> &#123;  </span><br><span class="line">         <span class="keyword">break</span>  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">// è®¡ç®— [0, i - 1]ä¸­çš„æœ€å°å€¼, ç›´æ¥äºŒåˆ†ç­”æ¡ˆã€‚  </span></span><br><span class="line"> left, right := flowers[<span class="number">0</span>], target - <span class="number">1</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="keyword">for</span> left &lt; right &#123;  </span><br><span class="line">         mid := left + (right - left + <span class="number">1</span>) / <span class="number">2</span>  </span><br><span class="line"> <span class="comment">// æ£€æŸ¥æ˜¯å¦èƒ½å¤Ÿå°†åŒºé—´[0, idx -cnt]ä¸­ï¼Œå€¼ &lt; midçš„åŒºé—´ï¼ˆå‡è®¾æ˜¯åŒºé—´[0, j]ï¼‰å…¨éƒ¨å®Œå–„ä¸ºmid  </span></span><br><span class="line"> <span class="keyword">if</span> check(<span class="number">0</span>, idx - cnt, <span class="keyword">int</span>(remain), mid) &#123;  </span><br><span class="line">            left = mid  </span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            right = mid - <span class="number">1</span>  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line">      &#125;  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">//fmt.Println(i, count + idx - i + 1, left)  </span></span><br><span class="line">  </span><br><span class="line"> <span class="comment">// å¦‚æœå…¨éƒ¨å®Œå–„ï¼Œ åˆ™åªæœ‰ å®Œå–„æ•°ç›® * full if count + cnt == n &#123;  </span></span><br><span class="line">         res = max(res, <span class="keyword">int64</span>((count + cnt) * full))  </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">         <span class="comment">// å®Œå–„çš„æ•°é‡ï¼šcount + cnt, æœªå®Œå–„ä¸­æœ€å°å€¼ï¼šleft  </span></span><br><span class="line"> res = max(res, <span class="keyword">int64</span>((count + cnt) * full + left * partial))  </span><br><span class="line">      &#125;  </span><br><span class="line">  </span><br><span class="line">   &#125;  </span><br><span class="line">  </span><br><span class="line">   <span class="keyword">return</span> res  </span><br><span class="line">  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a, b <span class="keyword">int64</span>)</span> <span class="title">int64</span></span> &#123;  </span><br><span class="line">   <span class="keyword">if</span> a &gt;= b &#123;  </span><br><span class="line">      <span class="keyword">return</span> a  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="keyword">return</span> b  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ 2022.04.09 å‘¨èµ›çš„å¤ç›˜&lt;/p&gt;
&lt;h2 id=&quot;LeetCode6037-æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—&quot;&gt;&lt;a href=&quot;#LeetCode6037-æŒ‰å¥‡å¶æ€§äº¤æ¢åçš„æœ€å¤§æ•°å­—&quot; class=&quot;headerlink&quot; title=&quot;LeetCode6037.</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 8ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/08/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%208%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/08/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%208%EF%BC%89/</id>
    <published>2022-04-07T22:00:00.000Z</published>
    <updated>2022-04-09T15:15:15.105Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode536-ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘"><a href="#LeetCode536-ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘" class="headerlink" title="LeetCode536. ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘"></a><a class="link" href="https://leetcode-cn.com/problems/construct-binary-tree-from-string/">LeetCode536. ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘<i class="fas fa-external-link-alt"></i></a></h2><p>#é€’å½’ #æ ˆ #äºŒå‰æ ‘</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ä½ éœ€è¦ç”¨ä¸€ä¸ªåŒ…æ‹¬æ‹¬å·å’Œæ•´æ•°çš„å­—ç¬¦ä¸²æ„å»ºä¸€æ£µäºŒå‰æ ‘ã€‚<br>è¾“å…¥çš„å­—ç¬¦ä¸²ä»£è¡¨ä¸€æ£µäºŒå‰æ ‘ã€‚å®ƒåŒ…æ‹¬æ•´æ•°å’Œéšåçš„ 0 ã€1 æˆ– 2 å¯¹æ‹¬å·ã€‚æ•´æ•°ä»£è¡¨æ ¹çš„å€¼ï¼Œä¸€å¯¹æ‹¬å·å†…è¡¨ç¤ºåŒæ ·ç»“æ„çš„å­æ ‘ã€‚<br>è‹¥å­˜åœ¨å­ç»“ç‚¹ï¼Œåˆ™ä»å·¦å­ç»“ç‚¹å¼€å§‹æ„å»ºã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="butree.jpg" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼š s &#x3D; &quot;4(2(3)(1))(6(5))&quot;</span><br><span class="line">è¾“å‡ºï¼š [4,2,6,3,1,5]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼š s &#x3D; &quot;4(2(3)(1))(6(5)(7))&quot;</span><br><span class="line">è¾“å‡ºï¼š [4,2,6,3,1,5,7]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3:</span><br><span class="line">è¾“å…¥ï¼š s &#x3D; &quot;-4(2(3)(1))(6(5)(7))&quot;</span><br><span class="line">è¾“å‡ºï¼š [-4,2,6,3,1,5,7]</span><br><span class="line">Â </span><br><span class="line">æç¤ºï¼š</span><br><span class="line">0 &lt;&#x3D; s.length &lt;&#x3D; 3 * 104</span><br><span class="line">è¾“å…¥å­—ç¬¦ä¸²ä¸­åªåŒ…å«Â &#39;(&#39;, &#39;)&#39;, &#39;-&#39;Â å’ŒÂ &#39;0&#39; ~ &#39;9&#39;Â </span><br><span class="line">ç©ºæ ‘ç”±Â &quot;&quot;Â è€Œé&quot;()&quot;è¡¨ç¤ºã€‚</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å¾ˆæ˜æ˜¾çš„é€’å½’é¢˜ï¼Œè€Œä¸”é¢˜ç›®ä¸­åŒ…å«æœ‰å¯¹æ‹¬å·çš„å¤„ç†ï¼Œé‡åˆ°æ‹¬å·é¦–å…ˆå°±æ˜¯è€ƒè™‘ä½¿ç”¨æ ˆæ¥è®°å½•ä¸‹åˆæ³•æ‹¬å·å†…çš„å­—ç¬¦ä¸²ï¼›<br>(2). é¦–å…ˆè¦å°†çˆ¶èŠ‚ç‚¹çš„å€¼ä»å­—ç¬¦ä¸²ä¸­æŠ å‡ºæ¥ï¼Œç„¶ååˆ†åˆ«è®°å½•ä¸‹å·¦å­æ ‘å’Œå³å­æ ‘çš„å­—ç¬¦ä¸²ï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸ªå“¨å…µï¼Œå½“å·¦å­æ ‘è¢«åˆ†ç¦»å‡ºæ¥åï¼Œç”¨å“¨å…µè®°å½•ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è®°å½•çš„åˆæ³•å­—ç¬¦ä¸²å°±æ˜¯å³å­æ ‘ã€‚</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Definition for a binary tree node.</span></span><br><span class="line"><span class="comment">* type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment">* Val int</span></span><br><span class="line"><span class="comment">* Left *TreeNode</span></span><br><span class="line"><span class="comment">* Right *TreeNode</span></span><br><span class="line"><span class="comment">* &#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">str2tree</span><span class="params">(s <span class="keyword">string</span>)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> backTracking <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>)</span> *<span class="title">TreeNode</span></span></span><br><span class="line">backTracking = <span class="function"><span class="keyword">func</span><span class="params">(b <span class="keyword">string</span>)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(b) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h* TreeNode</span><br><span class="line"><span class="keyword">var</span> index <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> x <span class="keyword">int</span></span><br><span class="line">num := <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ; index&lt;<span class="built_in">len</span>(b); index++ &#123;</span><br><span class="line"><span class="keyword">if</span> b[index] != <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">num += b[index:index+<span class="number">1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x,_ = strconv.Atoi(num)</span><br><span class="line">h = &amp;TreeNode&#123;</span><br><span class="line">Val : x,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bb := <span class="string">&quot;&quot;</span></span><br><span class="line">l := <span class="number">0</span></span><br><span class="line">f := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ; index&lt;<span class="built_in">len</span>(b); index++ &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b[index] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> l == <span class="number">0</span> &#123;</span><br><span class="line">l++</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">l++</span><br><span class="line">bb += <span class="string">&quot;(&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (b[index] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; b[index] &lt;= <span class="string">&#x27;9&#x27;</span>) || b[index] == <span class="string">&#x27;-&#x27;</span> &#123;</span><br><span class="line">bb += b[index:index+<span class="number">1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">l--</span><br><span class="line"><span class="keyword">if</span> l != <span class="number">0</span> &#123;</span><br><span class="line">bb += <span class="string">&quot;)&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> f == <span class="number">0</span> &#123;</span><br><span class="line">leftNode := backTracking(bb)</span><br><span class="line">h.Left = leftNode</span><br><span class="line">bb = <span class="string">&quot;&quot;</span></span><br><span class="line">f = <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">rightNode := backTracking(bb)</span><br><span class="line">h.Right = rightNode</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> backTracking(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode370-åŒºé—´åŠ æ³•"><a href="#LeetCode370-åŒºé—´åŠ æ³•" class="headerlink" title="LeetCode370. åŒºé—´åŠ æ³•"></a><a class="link" href="https://leetcode-cn.com/problems/range-addition/">LeetCode370. åŒºé—´åŠ æ³•<i class="fas fa-external-link-alt"></i></a></h2><p>#å·®åˆ†æ•°ç»„</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>å‡è®¾ä½ æœ‰ä¸€ä¸ªé•¿åº¦ä¸ºÂ nÂ çš„æ•°ç»„ï¼Œåˆå§‹æƒ…å†µä¸‹æ‰€æœ‰çš„æ•°å­—å‡ä¸ºÂ 0ï¼Œä½ å°†ä¼šè¢«ç»™å‡ºÂ k ä¸ªæ›´æ–°çš„æ“ä½œã€‚<br>å…¶ä¸­ï¼Œæ¯ä¸ªæ“ä½œä¼šè¢«è¡¨ç¤ºä¸ºä¸€ä¸ªä¸‰å…ƒç»„ï¼š[startIndex, endIndex, inc]ï¼Œä½ éœ€è¦å°†å­æ•°ç»„Â A[startIndex â€¦ endIndex]ï¼ˆåŒ…æ‹¬ startIndex å’Œ endIndexï¼‰å¢åŠ Â incã€‚<br>è¯·ä½ è¿”å›Â kÂ æ¬¡æ“ä½œåçš„æ•°ç»„ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹:</span><br><span class="line">è¾“å…¥: length &#x3D; 5, updates &#x3D; [[1,3,2],[2,4,3],[0,2,-2]]</span><br><span class="line">è¾“å‡º: [-2,0,3,5,3]</span><br><span class="line">è§£é‡Š:</span><br><span class="line"></span><br><span class="line">åˆå§‹çŠ¶æ€:</span><br><span class="line">[0,0,0,0,0]</span><br><span class="line"></span><br><span class="line">è¿›è¡Œäº†æ“ä½œ [1,3,2] åçš„çŠ¶æ€:</span><br><span class="line">[0,2,2,2,0]</span><br><span class="line"></span><br><span class="line">è¿›è¡Œäº†æ“ä½œ [2,4,3] åçš„çŠ¶æ€:</span><br><span class="line">[0,2,5,5,3]</span><br><span class="line"></span><br><span class="line">è¿›è¡Œäº†æ“ä½œ [0,2,-2] åçš„çŠ¶æ€:</span><br><span class="line">[-2,0,3,5,3]</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å¦‚æœé‡‡ç”¨æš´åŠ›çš„æ–¹å¼ï¼Œéœ€è¦åœ¨éå† <code>updates</code> çš„åŒæ—¶éå†ç»“æœæ•°ç»„ï¼Œæ—¶é—´ä»£ä»·å·¨å¤§ï¼›<br>(2). è§‚å¯Ÿåˆ°æ‰§è¡Œ <code>updates</code> çš„é¡ºåºä¸æœ€ç»ˆç»“æœæ— å…³ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é’ˆå¯¹åŒºé—´è¿›è¡Œæ›´æ–°ï¼›<br>(3). å…·ä½“çš„æ€è·¯æ˜¯ï¼šå¯¹äºæ¯ä¸€ç»„ <code>updates[i]</code>ï¼Œæˆ‘ä»¬æå–å‡º <code>left</code>ã€<code>right</code>ã€<code>val</code> è¿™ä¸‰ä¸ªå€¼åˆ†åˆ«ä»£è¡¨å·¦è¾¹ç•Œã€å³è¾¹ç•Œã€æ›´æ–°å€¼ã€‚æˆ‘ä»¬åªéœ€è¦å»ºç«‹ä¸€ä¸ªå·®åˆ†æ•°ç»„ <code>diff</code>ï¼Œå¯¹ <code>diff[left]</code> åŠ ä¸Š <code>val</code>ï¼Œå¯¹ <code>diff[right+1]</code> å‡å» <code>val</code>ï¼Œé‚£ä¹ˆä¹‹åå°±å¯ä»¥é€šè¿‡åŒºé—´çš„è®°å½•è¿˜åŸæœ€ç»ˆçš„è¾“å‡ºç»“æœï¼›<br>(4). æœ€åé€šè¿‡å‰ç¼€å’Œè®¡ç®—æœ€ç»ˆçš„è¾“å‡ºç»“æœ</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getModifiedArray</span><span class="params">(length <span class="keyword">int</span>, updates [][]<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">nums := <span class="built_in">make</span>([]<span class="keyword">int</span>, length)</span><br><span class="line">diff := <span class="built_in">make</span>([]<span class="keyword">int</span>, length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(updates); i++ &#123;</span><br><span class="line">left, right, val := updates[i][<span class="number">0</span>], updates[i][<span class="number">1</span>], updates[i][<span class="number">2</span>]</span><br><span class="line">diff[left] += val</span><br><span class="line"><span class="keyword">if</span> right+<span class="number">1</span> &gt;= length &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">diff[right+<span class="number">1</span>] -= val</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">nums[<span class="number">0</span>] = diff[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;length; i++ &#123;</span><br><span class="line">nums[i] = nums[i<span class="number">-1</span>]+diff[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode692-å‰Kä¸ªé«˜é¢‘å•è¯"><a href="#LeetCode692-å‰Kä¸ªé«˜é¢‘å•è¯" class="headerlink" title="LeetCode692. å‰Kä¸ªé«˜é¢‘å•è¯"></a><a class="link" href="https://leetcode-cn.com/problems/top-k-frequent-words/">LeetCode692. å‰Kä¸ªé«˜é¢‘å•è¯<i class="fas fa-external-link-alt"></i></a></h2><p>#ä¼˜å…ˆé˜Ÿåˆ— #å­—å…¸åº </p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªå•è¯åˆ—è¡¨Â wordsÂ å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¿”å›å‰Â kÂ ä¸ªå‡ºç°æ¬¡æ•°æœ€å¤šçš„å•è¯ã€‚<br>è¿”å›çš„ç­”æ¡ˆåº”è¯¥æŒ‰å•è¯å‡ºç°é¢‘ç‡ç”±é«˜åˆ°ä½æ’åºã€‚å¦‚æœä¸åŒçš„å•è¯æœ‰ç›¸åŒå‡ºç°é¢‘ç‡ï¼Œ æŒ‰å­—å…¸é¡ºåº æ’åºã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥: words &#x3D; [&quot;i&quot;, &quot;love&quot;, &quot;leetcode&quot;, &quot;i&quot;, &quot;love&quot;, &quot;coding&quot;], k &#x3D; 2</span><br><span class="line">è¾“å‡º: [&quot;i&quot;, &quot;love&quot;]</span><br><span class="line">è§£æ: &quot;i&quot; å’Œ &quot;love&quot; ä¸ºå‡ºç°æ¬¡æ•°æœ€å¤šçš„ä¸¤ä¸ªå•è¯ï¼Œå‡ä¸º2æ¬¡ã€‚</span><br><span class="line">    æ³¨æ„ï¼ŒæŒ‰å­—æ¯é¡ºåº &quot;i&quot; åœ¨ &quot;love&quot; ä¹‹å‰ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥: [&quot;the&quot;, &quot;day&quot;, &quot;is&quot;, &quot;sunny&quot;, &quot;the&quot;, &quot;the&quot;, &quot;the&quot;, &quot;sunny&quot;, &quot;is&quot;, &quot;is&quot;], k &#x3D; 4</span><br><span class="line">è¾“å‡º: [&quot;the&quot;, &quot;is&quot;, &quot;sunny&quot;, &quot;day&quot;]</span><br><span class="line">è§£æ: &quot;the&quot;, &quot;is&quot;, &quot;sunny&quot; å’Œ &quot;day&quot; æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„å››ä¸ªå•è¯ï¼Œ</span><br><span class="line">    å‡ºç°æ¬¡æ•°ä¾æ¬¡ä¸º 4, 3, 2 å’Œ 1 æ¬¡ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼š</span><br><span class="line">1 &lt;&#x3D; words.length &lt;&#x3D; 500</span><br><span class="line">1 &lt;&#x3D; words[i] &lt;&#x3D; 10</span><br><span class="line">words[i]Â ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆã€‚</span><br><span class="line">k çš„å–å€¼èŒƒå›´æ˜¯Â [1, ä¸åŒ words[i] çš„æ•°é‡]</span><br><span class="line">Â </span><br><span class="line">è¿›é˜¶ï¼šå°è¯•ä»¥Â O(n log k) æ—¶é—´å¤æ‚åº¦å’ŒÂ O(n) ç©ºé—´å¤æ‚åº¦è§£å†³ã€‚</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). ä»¥Â O(n log k) æ—¶é—´å¤æ‚åº¦å’ŒÂ O(n) ç©ºé—´å¤æ‚åº¦è§£å†³ï¼Œæœ¬é¢˜é€‚åˆä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¯¹äºè¿™ç§æ—¢è¦è€ƒè™‘ä¼˜å…ˆçº§ï¼Œåˆè¦è€ƒè™‘å­—ç¬¦ä¸²æ„æˆçš„æƒ…å†µï¼Œæ€æ ·æ„å»ºä¼˜å…ˆé˜Ÿåˆ—å¯ä»¥å‚è€ƒ <a href="https://jiahaohong1997.github.io/2021/09/27/%E5%A0%86%E7%9A%84Go%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0/">å †çš„Goè¯­è¨€å®ç°</a><br>(2). æ³¨æ„è€ƒè™‘åœ¨å‡ºç°æ¬¡æ•°ä¸€æ ·çš„æƒ…å†µä¸‹ï¼Œè¦ä¾èµ–å­—ç¬¦ä¸²çš„å­—å…¸åºæ’åºï¼Œå¯ä»¥ä½¿ç”¨ <code>strings.Compare</code> æ–¹æ³•æ¥æ¯”è¾ƒå­—å…¸åºï¼›<br>(3). è¦è¾“å‡ºæœ€å¤§çš„ <code>k</code> ä¸ªï¼Œå¯ä»¥é‡‡å–å»ºç«‹å®¹é‡ä¸Šé™ä¸º <code>k</code> çš„å°æ ¹å †çš„åšæ³•ã€‚</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> wordCount <span class="keyword">struct</span> &#123;</span><br><span class="line">word <span class="keyword">string</span></span><br><span class="line">priority <span class="keyword">int</span></span><br><span class="line">index <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> priorityQueue []*wordCount</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq priorityQueue)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(pq)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq priorityQueue)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">pq[i], pq[j] = pq[j], pq[i]</span><br><span class="line">pq[i].index = j</span><br><span class="line">pq[j].index = i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq priorityQueue)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> pq[i].priority == pq[j].priority &#123;</span><br><span class="line"><span class="keyword">if</span> strings.Compare(pq[i].word, pq[j].word) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="comment">// pq[i].word çš„å­—å…¸åºåœ¨ pq[j].word çš„åé¢ï¼Œé‚£åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­å°±æ’å‰é¢</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> strings.Compare(pq[i].word, pq[j].word) == <span class="number">-1</span> &#123;</span><br><span class="line"><span class="comment">// pq[i].word çš„å­—å…¸åºåœ¨ pq[j].word çš„å‰é¢ï¼Œé‚£åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­å°±æ’åé¢</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> pq[i].priority &lt; pq[j].priority</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *priorityQueue)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">n := <span class="built_in">len</span>(*pq)</span><br><span class="line">item := x.(*wordCount)</span><br><span class="line">item.index = n</span><br><span class="line">*pq = <span class="built_in">append</span>(*pq, item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *priorityQueue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">old := *pq</span><br><span class="line">n := <span class="built_in">len</span>(old)</span><br><span class="line">item := old[n<span class="number">-1</span>]</span><br><span class="line">old[n<span class="number">-1</span>] = <span class="literal">nil</span></span><br><span class="line">item.index = <span class="number">-1</span></span><br><span class="line">*pq = old[:n<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> item</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">topKFrequent</span><span class="params">(words []<span class="keyword">string</span>, k <span class="keyword">int</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pq priorityQueue</span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(words); i++ &#123;</span><br><span class="line">m[words[i]]++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> w, v := <span class="keyword">range</span> m &#123;</span><br><span class="line"><span class="keyword">if</span> i &lt; k &#123;</span><br><span class="line">wc := &amp;wordCount &#123;</span><br><span class="line">word : w,</span><br><span class="line">index : i,</span><br><span class="line">priority : v,</span><br><span class="line">&#125;</span><br><span class="line">i++</span><br><span class="line">heap.Push(&amp;pq, wc)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> v &gt; pq[<span class="number">0</span>].priority || (v == pq[<span class="number">0</span>].priority &amp;&amp; strings.Compare(w, pq[<span class="number">0</span>].word) == <span class="number">-1</span>) &#123;</span><br><span class="line">heap.Pop(&amp;pq)</span><br><span class="line">wc := &amp;wordCount &#123;</span><br><span class="line">word : w,</span><br><span class="line">index : k<span class="number">-1</span>,</span><br><span class="line">priority : v,</span><br><span class="line">&#125;</span><br><span class="line">heap.Push(&amp;pq, wc)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret := <span class="built_in">make</span>([]<span class="keyword">string</span>, k)</span><br><span class="line"><span class="keyword">for</span> k &gt; <span class="number">0</span> &#123;</span><br><span class="line">ret[k<span class="number">-1</span>] = heap.Pop(&amp;pq).(*wordCount).word</span><br><span class="line">k--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode536-ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘&quot;&gt;&lt;a href=&quot;#LeetCode536-ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘&quot; class=&quot;headerlink&quot; title=&quot;LeetCode536. ä»å­—ç¬¦ä¸²ç”ŸæˆäºŒå‰æ ‘&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>å¸¸ç”¨æ’åºç®—æ³•</title>
    <link href="http://jiahaohong1997.github.io/2022/04/07/%E5%B8%B8%E7%94%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
    <id>http://jiahaohong1997.github.io/2022/04/07/%E5%B8%B8%E7%94%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</id>
    <published>2022-04-07T11:51:00.000Z</published>
    <updated>2022-04-12T02:02:02.737Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é€‰æ‹©æ’åº"><a href="#é€‰æ‹©æ’åº" class="headerlink" title="é€‰æ‹©æ’åº"></a>é€‰æ‹©æ’åº</h2><h2 id="æ’å…¥æ’åº"><a href="#æ’å…¥æ’åº" class="headerlink" title="æ’å…¥æ’åº"></a>æ’å…¥æ’åº</h2><h2 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h2><h2 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h2><h3 id="Go-è¯­è¨€ä»£ç "><a href="#Go-è¯­è¨€ä»£ç " class="headerlink" title="Go è¯­è¨€ä»£ç "></a>Go è¯­è¨€ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quickSort</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> backTracking <span class="function"><span class="keyword">func</span><span class="params">(arr []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(arr) == <span class="number">0</span> || <span class="built_in">len</span>(arr) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">l, r := <span class="number">0</span>, <span class="built_in">len</span>(arr)<span class="number">-1</span></span><br><span class="line">mid := l</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l &lt; r &#123;</span><br><span class="line"><span class="keyword">for</span> l &lt; r &amp;&amp; arr[r] &gt;= arr[mid] &#123;</span><br><span class="line">r--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l &lt; r &amp;&amp; arr[l] &lt;= arr[mid] &#123;</span><br><span class="line">l++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[l], arr[r] = arr[r], arr[l]</span><br><span class="line">&#125;</span><br><span class="line">arr[l], arr[mid] = arr[mid], arr[l]</span><br><span class="line"></span><br><span class="line">backTracking(arr[:l])</span><br><span class="line">backTracking(arr[l+<span class="number">1</span>:])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backTracking(nums)</span><br><span class="line"><span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h2><h3 id="Go-è¯­è¨€ä»£ç -1"><a href="#Go-è¯­è¨€ä»£ç -1" class="headerlink" title="Go è¯­è¨€ä»£ç "></a>Go è¯­è¨€ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeSort</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> backTracking <span class="function"><span class="keyword">func</span><span class="params">(arr []<span class="keyword">int</span>)</span> []<span class="title">int</span></span></span><br><span class="line">backTracking = <span class="function"><span class="keyword">func</span><span class="params">(arr []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(arr) == <span class="number">0</span> || <span class="built_in">len</span>(arr) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">n := <span class="built_in">len</span>(arr)</span><br><span class="line">a := backTracking(arr[:n/<span class="number">2</span>])</span><br><span class="line">b := backTracking(arr[n/<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line">ret := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i &lt; <span class="built_in">len</span>(a) || j &lt; <span class="built_in">len</span>(b) &#123;</span><br><span class="line"><span class="keyword">if</span> i == <span class="built_in">len</span>(a) &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, b...)</span><br><span class="line">j = <span class="built_in">len</span>(b)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> j == <span class="built_in">len</span>(b) &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, a...)</span><br><span class="line">i = <span class="built_in">len</span>(a)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> a[i] &lt;= b[j] &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, a[i])</span><br><span class="line">i++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, b[j])</span><br><span class="line">j++</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> backTracking(nums)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h2 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h2><h2 id="åŸºæ•°æ’åº"><a href="#åŸºæ•°æ’åº" class="headerlink" title="åŸºæ•°æ’åº"></a>åŸºæ•°æ’åº</h2><h3 id="ç®—æ³•ä»‹ç»"><a href="#ç®—æ³•ä»‹ç»" class="headerlink" title="ç®—æ³•ä»‹ç»"></a>ç®—æ³•ä»‹ç»</h3><p>&emsp;&emsp;<strong>åŸºæ•°æ’åº</strong>ï¼ˆè‹±è¯­ï¼šRadix sortï¼‰æ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚å®ƒæ˜¯è¿™æ ·å®ç°çš„ï¼šå°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ï¼ˆæ­£æ•´æ•°ï¼‰ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶ã€‚ç„¶åï¼Œä»æœ€ä½ä½å¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åºã€‚è¿™æ ·ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥åï¼Œæ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚åŸºæ•°æ’åºçš„æ–¹å¼å¯ä»¥é‡‡ç”¨LSDï¼ˆLeast significant digitalï¼‰æˆ–MSDï¼ˆMost significant digitalï¼‰ï¼ŒLSDçš„æ’åºæ–¹å¼ç”±é”®å€¼çš„æœ€å³è¾¹å¼€å§‹ï¼Œè€ŒMSDåˆ™ç›¸åï¼Œç”±é”®å€¼çš„æœ€å·¦è¾¹å¼€å§‹ã€‚</p><h3 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h3><p>&emsp;&emsp;åŸºæ•°æ’åºçš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(k * N)$ï¼Œå…¶ä¸­ $N$æ˜¯æ’åºå…ƒç´ ä¸ªæ•°ï¼Œ$k$ æ˜¯æ•°å­—ä½æ•°ã€‚æ³¨æ„è¿™ä¸æ˜¯è¯´è¿™ä¸ªæ—¶é—´å¤æ‚åº¦ä¸€å®šä¼˜äº $O(NlogN)$ï¼Œ$k$ çš„å¤§å°å–å†³äºæ•°å­—ä½çš„é€‰æ‹©ï¼ˆæ¯”å¦‚æ¯”ç‰¹ä½æ•°ï¼‰ï¼Œå’Œå¾…æ’åºæ•°æ®æ‰€å±æ•°æ®ç±»å‹çš„å…¨é›†çš„å¤§å°ï¼›$k$ å†³å®šäº†è¿›è¡Œå¤šå°‘è½®å¤„ç†ï¼Œè€Œ $N$ æ˜¯æ¯è½®å¤„ç†çš„æ“ä½œæ•°ç›®ã€‚</p><h3 id="Go-è¯­è¨€ä»£ç -2"><a href="#Go-è¯­è¨€ä»£ç -2" class="headerlink" title="Go è¯­è¨€ä»£ç "></a>Go è¯­è¨€ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">radixSort</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> maxNum <span class="function"><span class="keyword">func</span><span class="params">(...<span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">maxNum = <span class="function"><span class="keyword">func</span><span class="params">(array ...<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">max := array[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(array); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> array[i] &gt; max &#123;</span><br><span class="line">max = array[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> max</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cnt := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">buf := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line"><span class="keyword">for</span> exp:=<span class="number">1</span>; exp&lt;=maxNum(nums...); exp*=<span class="number">10</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">digit := nums[i] / exp % <span class="number">10</span></span><br><span class="line">cnt[digit]++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="number">10</span>; i++ &#123;</span><br><span class="line">cnt[i] += cnt[i<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="built_in">len</span>(nums)<span class="number">-1</span>; i&gt;=<span class="number">0</span>; i-- &#123;</span><br><span class="line">digit := nums[i] / exp % <span class="number">10</span></span><br><span class="line">buf[cnt[digit]<span class="number">-1</span>] = nums[i]</span><br><span class="line">cnt[digit]--</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é€‰æ‹©æ’åº&quot;&gt;&lt;a href=&quot;#é€‰æ‹©æ’åº&quot; class=&quot;headerlink&quot; title=&quot;é€‰æ‹©æ’åº&quot;&gt;&lt;/a&gt;é€‰æ‹©æ’åº&lt;/h2&gt;&lt;h2 id=&quot;æ’å…¥æ’åº&quot;&gt;&lt;a href=&quot;#æ’å…¥æ’åº&quot; class=&quot;headerlink&quot; title=&quot;æ’å…¥æ’åº&quot;&gt;&lt;/a</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ’åº" scheme="http://jiahaohong1997.github.io/tags/%E6%8E%92%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 7ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/06/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%207%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/06/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%207%EF%BC%89/</id>
    <published>2022-04-06T09:38:00.000Z</published>
    <updated>2022-04-08T00:08:22.610Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ²¡æ—©èµ·åˆ·é¢˜ï¼Œæ—©èµ·æŠ¢èœå»äº†ã€‚æ·¦ï¼</p><h2 id="LeetCode253-ä¼šè®®å®¤-II"><a href="#LeetCode253-ä¼šè®®å®¤-II" class="headerlink" title="LeetCode253. ä¼šè®®å®¤ II"></a><a class="link" href="https://leetcode-cn.com/problems/meeting-rooms-ii/">LeetCode253. ä¼šè®®å®¤ II<i class="fas fa-external-link-alt"></i></a></h2><p>#å †æ’åº</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªä¼šè®®æ—¶é—´å®‰æ’çš„æ•°ç»„ intervals ï¼Œæ¯ä¸ªä¼šè®®æ—¶é—´éƒ½ä¼šåŒ…æ‹¬å¼€å§‹å’Œç»“æŸçš„æ—¶é—´ intervals[i] = [starti, endi] ï¼Œè¿”å› æ‰€éœ€ä¼šè®®å®¤çš„æœ€å°æ•°é‡ ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šintervals &#x3D; [[0,30],[5,10],[15,20]]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šintervals &#x3D; [[7,10],[2,4]]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">Â </span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D;Â intervals.length &lt;&#x3D; 104</span><br><span class="line">0 &lt;&#x3D; starti &lt; endi &lt;&#x3D; 106</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æŒ‰ç…§æœ€æœ´ç´ çš„æƒ³æ³•ï¼Œè¦ç»™å…¬å¸éƒ¨é—¨å®‰æ’ä¼šè®®ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯ä¼˜å…ˆè€ƒè™‘ä¼šè®®å¼€å§‹å¾—æ—©çš„éƒ¨é—¨ï¼Œé‚£ä¹ˆé¦–å…ˆå°±æ˜¯è¦æ’åºã€‚æ’åºçš„æ¡ä»¶å°±æ˜¯å¼€å§‹æ—¶é—´è¶Šæ—©è¶Šé å‰ï¼›<br>(2). å®‰æ’æ–°ä¼šè®®å®¤çš„åŸåˆ™æ˜¯æ‰€æœ‰å·²ç”³è¯·çš„ä¼šè®®å®¤éƒ½è¢«å ç”¨ã€‚é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ€å°å †ï¼Œå †ä¸­ä¿å­˜çš„æ˜¯æ¯åœºä¼šè®®çš„ç»“æŸæ—¶é—´ï¼›<br>(3). å½“å½“å‰ä¼šè®®å¼€å§‹æ—¶ï¼Œå †é¡¶çš„ä¼šè®®è¿˜æ²¡ç»“æŸï¼Œè¯´æ˜å †ä¸­æ‰€æœ‰çš„ä¼šè®®éƒ½ä¸å¯èƒ½ç»“æŸï¼Œé‚£ä¹ˆå°±è¦ç”³è¯·æ–°çš„ä¼šè®®å®¤ï¼›<br>(4). éå†å®Œæ•´ä¸ªä¼šè®®çš„è®°å½•ï¼Œå°±å¯ä»¥å¾—åˆ°è¦å¼€è¾Ÿçš„æœ€å¤§ä¼šè®®å®¤æ•°é‡ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(Nlog(N))</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> intHeap []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h intHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h intHeap)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">h[i], h[j] = h[j], h[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h intHeap)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> h[i] &lt; h[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *intHeap)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">*h = <span class="built_in">append</span>(*h, x.(<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *intHeap)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">old := *h</span><br><span class="line">n := <span class="built_in">len</span>(old)</span><br><span class="line">x := old[n<span class="number">-1</span>]</span><br><span class="line">*h = old[:n<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minMeetingRooms</span><span class="params">(intervals [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">sort.Slice(intervals, <span class="function"><span class="keyword">func</span><span class="params">(i,j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> intervals[i][<span class="number">0</span>] == intervals[j][<span class="number">0</span>] &#123;</span><br><span class="line"><span class="keyword">return</span> intervals[i][<span class="number">1</span>] &lt; intervals[j][<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> intervals[i][<span class="number">0</span>] &lt; intervals[j][<span class="number">0</span>]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h intHeap</span><br><span class="line">heap.Push(&amp;h, intervals[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">room := <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(intervals); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> intervals[i][<span class="number">0</span>] &gt;= h[<span class="number">0</span>] &#123;</span><br><span class="line">heap.Pop(&amp;h)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">room++</span><br><span class="line">&#125;</span><br><span class="line">heap.Push(&amp;h, intervals[i][<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> room</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode163-ç¼ºå¤±çš„åŒºé—´"><a href="#LeetCode163-ç¼ºå¤±çš„åŒºé—´" class="headerlink" title="LeetCode163. ç¼ºå¤±çš„åŒºé—´"></a><a class="link" href="https://leetcode-cn.com/problems/missing-ranges/">LeetCode163. ç¼ºå¤±çš„åŒºé—´<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ’åºçš„æ•´æ•°æ•°ç»„ _<strong>nums</strong>_ ï¼Œå…¶ä¸­å…ƒç´ çš„èŒƒå›´åœ¨ <strong>é—­åŒºé—´</strong> <strong>[<em>lower, upper</em>]</strong> å½“ä¸­ï¼Œè¿”å›ä¸åŒ…å«åœ¨æ•°ç»„ä¸­çš„ç¼ºå¤±åŒºé—´ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">è¾“å…¥: nums &#x3D; [0, 1, 3, 50, 75], lower &#x3D; 0 å’Œ upper &#x3D; 99,</span><br><span class="line">è¾“å‡º: [&quot;2&quot;, &quot;4-&gt;49&quot;, &quot;51-&gt;74&quot;, &quot;76-&gt;99&quot;]</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). è¿™é“æ¨¡æ‹Ÿé¢˜æŒºæ¶å¿ƒçš„ï¼Œè¾¹ç•Œå¤„ç†æ˜¯å…³é”®ï¼›<br>(2). æ ¹æ®æ•°æ®èŒƒå›´éå† <code>nums</code>ï¼Œä¸èƒ½æŒ‰ä» <code>lower</code> åˆ° <code>upper</code>ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findMissingRanges</span><span class="params">(nums []<span class="keyword">int</span>, lower <span class="keyword">int</span>, upper <span class="keyword">int</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">ret := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> lower == upper &#123;</span><br><span class="line">s := strconv.Itoa(lower)</span><br><span class="line">ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">s := strconv.Itoa(lower) + <span class="string">&quot;-&gt;&quot;</span> + strconv.Itoa(upper)</span><br><span class="line">ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pre := lower</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line"><span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line"><span class="keyword">if</span> i == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] != pre &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] == pre+<span class="number">1</span> &#123;</span><br><span class="line">s = strconv.Itoa(pre)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">s = strconv.Itoa(pre) + <span class="string">&quot;-&gt;&quot;</span> + strconv.Itoa(nums[i]<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">pre = nums[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] == pre + <span class="number">2</span> &#123;</span><br><span class="line">s = strconv.Itoa(nums[i]<span class="number">-1</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[i] == pre + <span class="number">1</span> &#123;</span><br><span class="line">s = <span class="string">&quot;&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">s = strconv.Itoa(pre+<span class="number">1</span>) + <span class="string">&quot;-&gt;&quot;</span> + strconv.Itoa(nums[i]<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pre = nums[i]</span><br><span class="line"><span class="keyword">if</span> s != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i == <span class="built_in">len</span>(nums)<span class="number">-1</span> &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] != upper &#123;</span><br><span class="line"><span class="keyword">if</span> nums[i] == upper<span class="number">-1</span> &#123;</span><br><span class="line">s = strconv.Itoa(upper)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">s = strconv.Itoa(nums[i]+<span class="number">1</span>) + <span class="string">&quot;-&gt;&quot;</span> + strconv.Itoa(upper)</span><br><span class="line">&#125;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, s)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode694-ä¸åŒå²›å±¿çš„æ•°é‡"><a href="#LeetCode694-ä¸åŒå²›å±¿çš„æ•°é‡" class="headerlink" title="LeetCode694. ä¸åŒå²›å±¿çš„æ•°é‡"></a><a class="link" href="https://leetcode-cn.com/problems/number-of-distinct-islands/">LeetCode694. ä¸åŒå²›å±¿çš„æ•°é‡<i class="fas fa-external-link-alt"></i></a></h2><p>#DFS</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªéç©º 01 äºŒç»´æ•°ç»„è¡¨ç¤ºçš„ç½‘æ ¼ï¼Œä¸€ä¸ªå²›å±¿ç”±å››è¿é€šï¼ˆä¸Šã€ä¸‹ã€å·¦ã€å³å››ä¸ªæ–¹å‘ï¼‰çš„ 1 ç»„æˆï¼Œä½ å¯ä»¥è®¤ä¸ºç½‘æ ¼çš„å››å‘¨è¢«æµ·æ°´åŒ…å›´ã€‚<br>è¯·ä½ è®¡ç®—è¿™ä¸ªç½‘æ ¼ä¸­å…±æœ‰å¤šå°‘ä¸ªå½¢çŠ¶ä¸åŒçš„å²›å±¿ã€‚ä¸¤ä¸ªå²›å±¿è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„ï¼Œå½“ä¸”ä»…å½“ä¸€ä¸ªå²›å±¿å¯ä»¥é€šè¿‡å¹³ç§»å˜æ¢ï¼ˆä¸å¯ä»¥æ—‹è½¬ã€ç¿»è½¬ï¼‰å’Œå¦ä¸€ä¸ªå²›å±¿é‡åˆã€‚</p></blockquote><p>Â <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">11000</span><br><span class="line">11000</span><br><span class="line">00011</span><br><span class="line">00011</span><br><span class="line">ç»™å®šä¸Šå›¾ï¼Œè¿”å›ç»“æœ 1 ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">11011</span><br><span class="line">10000</span><br><span class="line">00001</span><br><span class="line">11011</span><br><span class="line">ç»™å®šä¸Šå›¾ï¼Œè¿”å›ç»“æœ 3 ã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„ï¼š</span><br><span class="line"></span><br><span class="line">11</span><br><span class="line">1</span><br><span class="line">å’Œ</span><br><span class="line"></span><br><span class="line"> 1</span><br><span class="line">11</span><br><span class="line">æ˜¯ä¸åŒçš„å²›å±¿ï¼Œå› ä¸ºæˆ‘ä»¬ä¸è€ƒè™‘æ—‹è½¬ã€ç¿»è½¬æ“ä½œã€‚</span><br></pre></td></tr></table></figure></p><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æµ·å²›é—®é¢˜çš„æ‹“å±•ï¼Œä¸€èˆ¬æ€è·¯å°±ä¸¤ç§ï¼šdfs æˆ– bfsï¼›<br>(2). è¿™é“é¢˜è¦æ±‚è¾“å‡ºçš„æ˜¯ä¸åŒå½¢çŠ¶æµ·å²›çš„æ•°é‡ï¼Œé‚£ä¹ˆå…³é”®é—®é¢˜å°±æ˜¯æ€æ ·è¡¨ç¤ºæµ·å²›çš„å½¢çŠ¶ï¼›<br>(3). å›å¿†ä¸€ä¸‹æˆ‘ä»¬é€šè¿‡ dfs æ‰¾æµ·å²›çš„è¿‡ç¨‹ï¼Œæ¯æ¬¡éƒ½æ˜¯å…ˆæ‰¾åˆ°æµ·å²›æœ€å·¦ä¸Šè§’çš„ç‚¹ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬é¢„è®¾çš„æ–¹å‘æ•°ç»„æ¥æ§åˆ¶å¯»æ‰¾çš„è·¯å¾„ï¼Œé‚£ä¹ˆé€šè¿‡è¿™æ¡å¯»æ‰¾è·¯å¾„ï¼Œå°±èƒ½ç¡®å®šæµ·å²›çš„å½¢çŠ¶ï¼›<br>(4). è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªæµ·å²›å·¦ä¸Šè§’çš„èµ·å§‹ç‚¹éƒ½æ˜¯å…¶åæ ‡ï¼Œè¦å°†å…¶å½’é›¶æ‰å¯ä»¥åœ¨åŒä¸€æ•°å€¼èŒƒå›´å†…è¿›è¡Œåˆ¤æ–­ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨éå† <code>grid</code> çš„ç‚¹çš„æ—¶å€™è®°å½•ä¸‹æ­¤æ—¶çš„åæ ‡ï¼Œå°±å¯ä»¥è®¡ç®—è¯¥æµ·å²›ä¸Šæ¯ä¸ªç‚¹ç›¸å¯¹äºå·¦ä¸Šè§’ç‚¹çš„åæ ‡ä½ç½®ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N^2)</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numDistinctIslands</span><span class="params">(grid [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line">h_idx := []<span class="keyword">int</span>&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>&#125;</span><br><span class="line">w_idx := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>&#125;</span><br><span class="line"></span><br><span class="line">height, weight := <span class="built_in">len</span>(grid), <span class="built_in">len</span>(grid[<span class="number">0</span>])</span><br><span class="line">s := <span class="string">&quot;&quot;</span></span><br><span class="line">bi, bj := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span></span><br><span class="line">dfs = <span class="function"><span class="keyword">func</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">grid[i][j] = <span class="number">0</span></span><br><span class="line">s += fmt.Sprintf(<span class="string">&quot;-%d-%d&quot;</span>, i-bi, j-bj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k:=<span class="number">0</span>; k&lt;<span class="number">4</span>; k++ &#123;</span><br><span class="line">h, w := i+h_idx[k], j+w_idx[k]</span><br><span class="line"><span class="keyword">if</span> h &gt;= <span class="number">0</span> &amp;&amp; h &lt; height &amp;&amp; w &gt;= <span class="number">0</span> &amp;&amp; w &lt; weight &amp;&amp; grid[h][w] == <span class="number">1</span> &#123;</span><br><span class="line">dfs(h,w)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;height; i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>; j&lt;weight; j++ &#123;</span><br><span class="line"><span class="keyword">if</span> grid[i][j] == <span class="number">1</span> &#123;</span><br><span class="line">bi, bj, s = i, j, <span class="string">&quot;&quot;</span></span><br><span class="line">dfs(i,j)</span><br><span class="line">m[s] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// for k, _ := range m &#123;</span></span><br><span class="line"><span class="comment">// fmt.Println(k)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(m)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="164-æœ€å¤§é—´è·"><a href="#164-æœ€å¤§é—´è·" class="headerlink" title="164. æœ€å¤§é—´è·"></a><a class="link" href="https://leetcode-cn.com/problems/maximum-gap/">164. æœ€å¤§é—´è·<i class="fas fa-external-link-alt"></i></a></h2><p>#åŸºæ•°æ’åº</p><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªæ— åºçš„æ•°ç»„Â numsï¼Œè¿”å› æ•°ç»„åœ¨æ’åºä¹‹åï¼Œç›¸é‚»å…ƒç´ ä¹‹é—´æœ€å¤§çš„å·®å€¼ ã€‚å¦‚æœæ•°ç»„å…ƒç´ ä¸ªæ•°å°äº 2ï¼Œåˆ™è¿”å› 0 ã€‚<br>æ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªåœ¨ã€Œçº¿æ€§æ—¶é—´ã€å†…è¿è¡Œå¹¶ä½¿ç”¨ã€Œçº¿æ€§é¢å¤–ç©ºé—´ã€çš„ç®—æ³•ã€‚</p></blockquote><p>Â <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> ç¤ºä¾‹Â 1:</span><br><span class="line">è¾“å…¥: nums &#x3D; [3,6,9,1]</span><br><span class="line">è¾“å‡º: 3</span><br><span class="line">è§£é‡Š: æ’åºåçš„æ•°ç»„æ˜¯ [1,3,6,9], å…¶ä¸­ç›¸é‚»å…ƒç´  (3,6) å’Œ (6,9) ä¹‹é—´éƒ½å­˜åœ¨æœ€å¤§å·®å€¼ 3ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹Â 2:</span><br><span class="line">è¾“å…¥: nums &#x3D; [10]</span><br><span class="line">è¾“å‡º: 0</span><br><span class="line">è§£é‡Š: æ•°ç»„å…ƒç´ ä¸ªæ•°å°äº 2ï¼Œå› æ­¤è¿”å› 0ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤º:</span><br><span class="line">1 &lt;&#x3D; nums.length &lt;&#x3D; 105</span><br><span class="line">0 &lt;&#x3D; nums[i] &lt;&#x3D; 109</span><br></pre></td></tr></table></figure></p><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆæ³¨æ„é¢˜ç›®çš„è¦æ±‚ï¼š<strong>æ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªåœ¨ã€Œçº¿æ€§æ—¶é—´ã€å†…è¿è¡Œå¹¶ä½¿ç”¨ã€Œçº¿æ€§é¢å¤–ç©ºé—´ã€çš„ç®—æ³•ã€‚</strong> è¿™å°±å¯¹é€‰æ‹©çš„ç®—æ³•æœ‰äº†é™åˆ¶ã€‚å¿«æ’å’Œå †æ’çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ O(Nlog(N))ï¼ŒåŸºæ•°æ’åºæ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯ O(N)ï¼Œç¬¦åˆé¢˜ç›®è¦æ±‚ï¼›<br>(2). é‚£ä¹ˆè¿™é“é¢˜å°±è½¬åŒ–æˆä¸€é“åŸºæ•°æ’åºçš„ç®—æ³•äº†ã€‚åŸºæ•°æ’åºå¯ä»¥å‚è€ƒå¦ä¸€ç¯‡åšå®¢<a href="https://jiahaohong1997.github.io/2022/04/07/%E5%B8%B8%E7%94%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">å¸¸ç”¨æ’åºç®—æ³•</a></p><h3 id="æ—¶é—´å¤æ‚åº¦-3"><a href="#æ—¶é—´å¤æ‚åº¦-3" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -3"><a href="#è§£é¢˜ä»£ç -3" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maximumGap</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="params">(ans <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">int</span>, n)</span><br><span class="line">    maxVal := max(nums...)</span><br><span class="line">    <span class="keyword">for</span> exp := <span class="number">1</span>; exp &lt;= maxVal; exp *= <span class="number">10</span> &#123;</span><br><span class="line">        cnt := [<span class="number">10</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">            digit := v / exp % <span class="number">10</span></span><br><span class="line">            cnt[digit]++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">            cnt[i] += cnt[i<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> i := n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">            digit := nums[i] / exp % <span class="number">10</span></span><br><span class="line">            buf[cnt[digit]<span class="number">-1</span>] = nums[i]</span><br><span class="line">            cnt[digit]--</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">copy</span>(nums, buf)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        ans = max(ans, nums[i]-nums[i<span class="number">-1</span>])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a ...<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    res := a[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> a[<span class="number">1</span>:] &#123;</span><br><span class="line">        <span class="keyword">if</span> v &gt; res &#123;</span><br><span class="line">            res = v</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©æ²¡æ—©èµ·åˆ·é¢˜ï¼Œæ—©èµ·æŠ¢èœå»äº†ã€‚æ·¦ï¼&lt;/p&gt;
&lt;h2 id=&quot;LeetCode253-ä¼šè®®å®¤-II&quot;&gt;&lt;a href=&quot;#LeetCode253-ä¼šè®®å®¤-II&quot; class=&quot;headerlink&quot; title=&quot;LeetCode253. ä¼šè®®å®¤ II&quot;&gt;&lt;/a&gt;&lt;a cla</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>MIT6.824 Lab è¸©å‘è®°å½•</title>
    <link href="http://jiahaohong1997.github.io/2022/04/06/MIT6.824%20Lab%20%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/"/>
    <id>http://jiahaohong1997.github.io/2022/04/06/MIT6.824%20Lab%20%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/</id>
    <published>2022-04-06T04:40:00.000Z</published>
    <updated>2022-04-08T13:57:45.349Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Lab1"><a href="#Lab1" class="headerlink" title="Lab1"></a>Lab1</h1><h2 id="go-plugin"><a href="#go-plugin" class="headerlink" title="go plugin"></a>go plugin</h2><h3 id="è¸©å‘åœºæ™¯"><a href="#è¸©å‘åœºæ™¯" class="headerlink" title="è¸©å‘åœºæ™¯"></a>è¸©å‘åœºæ™¯</h3><p>&emsp;&emsp;é¡¹ç›®çš„åˆå§‹åŒ–å°±æ˜¯å°† Map å’Œ Reduce æ–¹æ³•åˆ†åˆ«æ‰“åŒ…æˆæ’ä»¶çš„å½¢å¼ä¾› worker ç«¯è°ƒç”¨ã€‚è¿™æ ·è®¾è®¡çš„ç†ç”±æ˜¯æµ‹è¯•ç”¨ä¾‹ä¸­åŒ…å«äº†ä¸åŒçš„ Map å’Œ Reduce æ–¹æ³•ï¼Œè¦é€šè¿‡æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä½¿ç”¨æ’ä»¶çš„å½¢å¼æ›´åŠ è‡ªç”±ã€‚<br>&emsp;&emsp;ä½†æ˜¯åœ¨å¯åŠ¨é¡¹ç›®çš„ä¸€å¼€å§‹å°±æŠ¥é”™ï¼š<code>plugin was built with a different version of package runtime</code>ã€‚åœ¨ç½‘ä¸ŠæŸ¥äº†å¾ˆä¹…ï¼Œåªèƒ½çŸ¥é“æ˜¯ä½œä¸º plugin çš„æ’ä»¶æ–‡ä»¶å’Œè°ƒç”¨è¿™ä¸ªæ’ä»¶çš„æ–‡ä»¶ç¼–è¯‘ç¯å¢ƒä¸åŒå¯¼è‡´çš„ã€‚ä½†æ˜¯é—®é¢˜æ˜¯æˆ‘éƒ½æ˜¯åœ¨æœ¬åœ°ç¼–è¯‘çš„ï¼Œæ€ä¹ˆè¿˜å­˜åœ¨è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>&emsp;&emsp;æ— ä»–ï¼Œé‡æ–°è£…äº† go çš„ç¯å¢ƒã€‚ã€‚ã€‚æˆåŠŸè§£å†³è¯¥é—®é¢˜ã€‚å·¨ tm é­”å¹»ã€‚<br>&emsp;&emsp;å¦å¤–ï¼Œ<code>mr</code> åŒ…ä¸‹çš„ä»»ä½•æ”¹åŠ¨éƒ½éœ€è¦é‡æ–° <code>go build --plugin</code>ï¼Œå¦åˆ™ worker æ— æ³•ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ’ä»¶ç¼–è¯‘ã€‚</p><h3 id="å»ºè®®"><a href="#å»ºè®®" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h3><p>&emsp;&emsp;go plugin ç›®å‰è¿˜æ˜¯ä¸€ä¸ªä¸æˆç†Ÿçš„æ–¹æ¡ˆï¼Œå—é™å› ç´ å¤ªå¤šï¼Œå¯èƒ½ä¼šå‡ºç°å„ç§è«åå…¶å¦™çš„é—®é¢˜ï¼Œå»ºè®®ä¹‹åè‡ªå·±çš„å¼€å‘ä¸­è¿˜æ˜¯é¿å…æ˜¯ç”¨ go pluginã€‚</p><h2 id="for-select-ä¸­çš„breakã€continueã€return"><a href="#for-select-ä¸­çš„breakã€continueã€return" class="headerlink" title="for-select ä¸­çš„breakã€continueã€return"></a>for-select ä¸­çš„breakã€continueã€return</h2><h3 id="è¸©å‘åœºæ™¯-1"><a href="#è¸©å‘åœºæ™¯-1" class="headerlink" title="è¸©å‘åœºæ™¯"></a>è¸©å‘åœºæ™¯</h3><p>&emsp;&emsp;åœ¨ worker å†…éƒ¨å®ç° map task çš„æ—¶å€™ï¼Œå†™äº†ä¸€ä¸ªå¤–å±‚çš„ for å‡½æ•°ï¼Œé‡Œé¢æ˜¯ä¸€ä¸ª selectï¼Œcase 1 æ˜¯å½“å‡ºç°è¶…æ—¶ï¼ˆ10sï¼‰ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å› falseï¼Œå¦åˆ™å°±æ˜¯ default æ‰§è¡Œæ“ä½œï¼›å½“è¯»åˆ°æ–‡ä»¶æœ«å°¾ <code>EOF</code>æ—¶ï¼Œå®Œæˆæ“ä½œåéœ€è¦ break è·³å‡º for å¾ªç¯ã€‚æ­¤æ—¶å°±å‡ºç°äº†é—®é¢˜ï¼šbreakåªèƒ½è·³å‡ºselectï¼Œæ— æ³•è·³å‡ºforï¼Œå¯¼è‡´å‡ºç°æ­»å¾ªç¯ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>æ–¹æ¡ˆä¸€ï¼šæ ‡ç­¾<br>çœ‹å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestBreak</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">tick := time.Tick(time.Second)</span><br><span class="line"><span class="comment">//FORæ˜¯æ ‡ç­¾</span></span><br><span class="line">FOR:</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> t := &lt;-tick:</span><br><span class="line">fmt.Println(t)</span><br><span class="line"><span class="comment">//breakå‡ºFORæ ‡ç­¾æ ‡è¯†çš„ä»£ç </span></span><br><span class="line"><span class="keyword">break</span> FOR</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆäºŒï¼šgoto</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestBreak</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">tick := time.Tick(time.Second)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> t := &lt;-tick:</span><br><span class="line">fmt.Println(t)</span><br><span class="line"><span class="comment">//è·³åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line"><span class="keyword">goto</span> END</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">END:</span><br><span class="line">fmt.Println(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ä¸¤ç§æ–¹å¼éƒ½èƒ½å¤ŸæˆåŠŸè·³å‡º for å¾ªç¯ï¼Œæˆ‘é€‰æ‹©äº†æ–¹æ¡ˆäºŒã€‚</p><blockquote><p>continueï¼šå•ç‹¬åœ¨selectä¸­æ˜¯ä¸èƒ½ä½¿ç”¨continueï¼Œä¼šç¼–è¯‘é”™è¯¯ï¼Œåªèƒ½ç”¨åœ¨for-selectä¸­ã€‚  <strong>continueçš„è¯­ä¹‰å°±ç±»ä¼¼forä¸­çš„è¯­ä¹‰ï¼Œselectåçš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œåˆ°ã€‚</strong><br>returnï¼šå’Œå‡½æ•°ä¸­çš„returnä¸€æ ·ï¼Œè·³å‡ºselectï¼Œå’Œforï¼Œåç»­ä»£ç éƒ½ä¸æ‰§è¡Œ</p></blockquote><h2 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h2><h3 id="è¸©å‘åœºæ™¯-2"><a href="#è¸©å‘åœºæ™¯-2" class="headerlink" title="è¸©å‘åœºæ™¯"></a>è¸©å‘åœºæ™¯</h3><p>&emsp;&emsp;Map ä»»åŠ¡éœ€è¦æ‰“å¼€æ–‡ä»¶åç»Ÿè®¡å•è¯å‡ºç°é¢‘ç‡ï¼Œæ­¤æ—¶æœ‰ä¸¤ç§è¯»æ–‡ä»¶çš„æ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯æ‰“å¼€æ–‡ä»¶åé€è¡Œè¯»å–ï¼Œç¬¬äºŒç§æ˜¯æ‰“å¼€æ–‡ä»¶åç›´æ¥å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯ç”¨æ—¶é—´æ¢ç©ºé—´çš„åšæ³•ï¼Œåœ¨æ–‡ä»¶æ˜¯ä¸ªè¶…å¤§å‹æ–‡ä»¶ï¼Œä½†æ˜¯å†…å­˜ä¸å¤Ÿçš„æƒ…å†µä¸‹åªèƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯å¾ˆæ…¢ï¼ŒIO æ“ä½œç›¸å½“å¯†é›†ï¼Œå¾ˆå½±å“é€Ÿåº¦ï¼›ç¬¬äºŒç§æ–¹å¼éœ€è¦å ç”¨è¾ƒå¤§çš„å†…å­˜ï¼Œä½†æ˜¯åªéœ€è¦ä¸€æ¬¡æ€§å°†æ–‡ä»¶å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­å³å¯ï¼Œæ—¶é—´ä¸Šä¼šå¿«å¾ˆå¤šã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>&emsp;&emsp;åœ¨æœ¬ lab çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ª job åªæœ‰ 10s çš„æ—¶é—´å¤„ç†æ–‡ä»¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶åº”è¯¥é‡‡ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚æˆ‘ä¸€å¼€å§‹å°±æ˜¯é‡‡ç”¨çš„é€è¡Œè¯»å–çš„æ–¹å¼ï¼Œå‘ç°æœ‰çš„æ–‡ä»¶åœ¨å• worker è¿ç®—æ—¶ç”šè‡³å®Œå…¨æ— æ³•åœ¨ 10s å†…ç»Ÿè®¡å®Œã€‚<br>&emsp;&emsp;åŒæ—¶è¿˜é‡‡ç”¨äº†ä¸´æ—¶æ–‡ä»¶çš„æ–¹å¼ï¼Œä¸´æ—¶æ–‡ä»¶ä¼šé»˜è®¤ä¿å­˜åœ¨ç³»ç»Ÿçš„<code>/tmp</code> è·¯å¾„ä¸‹ï¼Œå¦‚æœè¦æ”¾åœ¨å½“å‰ç›®å½•ä¸‹éœ€è¦æŒ‡å®šï¼Œæ¯ä¸ªä¸´æ—¶æ–‡ä»¶çš„æœ«å°¾ä¼šå¸¦ä¸Šä¸€ä¸²éšæœºçš„æ•°å­—ï¼Œå¯ä»¥åœ¨å‘½åçš„æ—¶å€™åšä¸€äº›çº¦å®šï¼Œæ–¹ä¾¿ä¹‹åçš„å¤„ç†ã€‚<br>&emsp;&emsp;å¯¹æ–‡ä»¶çš„å‘½åå¸¦ä¸Šäº†é€’å¢çš„ jobIdï¼Œé‚£ä¹ˆå°±é¿å…äº†å†²çªé—®é¢˜ã€‚</p><h3 id="å»ºè®®-1"><a href="#å»ºè®®-1" class="headerlink" title="å»ºè®®"></a>å»ºè®®</h3><ul><li>å› ä¸ºå‘½åè§„åˆ™å¯èƒ½å­˜åœ¨ç¼ºé™·ï¼Œé‡‡ç”¨ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼å¯ä»¥é¿å…ä»»åŠ¡å¤±è´¥åï¼Œä»»åŠ¡è¢«å…¶ä»–çš„ <code>worker</code> æ¥ç®¡é€ æˆçš„æ–‡ä»¶å†²çªï¼›</li><li>è¿˜å¯ä»¥é€šè¿‡çº¦å®šå‘½åè§„åˆ™ï¼Œæ¯”å¦‚å¸¦ä¸Šè‡ªå¢çš„ JobIdï¼Œé‚£ä¹ˆåœ¨ä¹‹åçš„æµç¨‹ä¸­åªä¼šå¯¹æˆåŠŸçš„ JobId çš„æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚</li></ul><h2 id="chan-int"><a href="#chan-int" class="headerlink" title="[ ]chan int"></a>[ ]chan int</h2><h3 id="è¸©å‘åœºæ™¯-3"><a href="#è¸©å‘åœºæ™¯-3" class="headerlink" title="è¸©å‘åœºæ™¯"></a>è¸©å‘åœºæ™¯</h3><p>&emsp;&emsp;åœ¨ <code>Coordinator</code> ç»“æ„ä½“ä¸­å£°æ˜äº†ä¸€ä¸ªåˆ‡ç‰‡ï¼š<code>workerDone   []chan int</code>ï¼Œç”¨äºæ¥æ”¶å¯¹åº” <code>worker</code> åœ¨è§„å®šæ—¶é—´å†…å®Œæˆä»»åŠ¡çš„ä¿¡å·ã€‚ä¸€å¼€å§‹åªæ˜¯å»ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ‡ç‰‡ï¼š<code>workerDone := make([]chan int, 20)</code>ï¼Œåœ¨ä¸€ä¸ªæ–°çš„ <code>worker</code> å»ºç«‹è¿æ¥è·å¾—å·¥å·åå¦‚æœè¶…å‡ºé•¿åº¦ï¼Œé‚£ä¹ˆå°±å†æ‰©å®¹ 20 ä¸ªä½ç½®ã€‚å¯æ˜¯å¿½ç•¥äº†äº†ä¸€ä¸ªäº‹å®ï¼Œè¿™æ ·å»ºç«‹çš„åˆ‡ç‰‡ï¼Œæ¯ä¸ªå…ƒç´ å…¶å®æ˜¯ <code>nil</code>ï¼Œæ‰€ä»¥ä¸€ç›´ä¸èƒ½æ­£ç¡®çš„ä¼ é€’ä¿¡å·ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-3"><a href="#è§£å†³æ–¹æ¡ˆ-3" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>è¦é€šè¿‡ä¸‹é¢çš„æ–¹å¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.workerDone[workerNum] = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™æ ·æ‰èƒ½æ­£ç¡®çš„å®Œæˆå¯¹åº”å·¥å·çš„åˆå§‹åŒ–ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Lab1&quot;&gt;&lt;a href=&quot;#Lab1&quot; class=&quot;headerlink&quot; title=&quot;Lab1&quot;&gt;&lt;/a&gt;Lab1&lt;/h1&gt;&lt;h2 id=&quot;go-plugin&quot;&gt;&lt;a href=&quot;#go-plugin&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼ç³»ç»Ÿ" scheme="http://jiahaohong1997.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="è¸©å‘" scheme="http://jiahaohong1997.github.io/tags/%E8%B8%A9%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>MIT6.824 Lab1</title>
    <link href="http://jiahaohong1997.github.io/2022/04/06/MIT6.824%20Lab1/"/>
    <id>http://jiahaohong1997.github.io/2022/04/06/MIT6.824%20Lab1/</id>
    <published>2022-04-06T04:36:00.000Z</published>
    <updated>2022-04-11T00:11:15.793Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»»åŠ¡æ¢³ç†"><a href="#ä»»åŠ¡æ¢³ç†" class="headerlink" title="ä»»åŠ¡æ¢³ç†"></a>ä»»åŠ¡æ¢³ç†</h1><h2 id="mapreduce-ä»‹ç»åŠéƒ¨ç½²"><a href="#mapreduce-ä»‹ç»åŠéƒ¨ç½²" class="headerlink" title="mapreduce ä»‹ç»åŠéƒ¨ç½²"></a>mapreduce ä»‹ç»åŠéƒ¨ç½²</h2><p><img lazyload src="/images/loading.svg" data-src="mapreduce.jpg" alt="avatar"></p><h3 id="lab1-ç®€ä»‹"><a href="#lab1-ç®€ä»‹" class="headerlink" title="lab1 ç®€ä»‹"></a>lab1 ç®€ä»‹</h3><p>&emsp;&emsp;å®ç°ä¸€ä¸ª <code>mapreduce</code> çš„ demoï¼Œä¹Ÿå°±æ˜¯åœ¨å•æœºä¸Šéƒ¨ç½²çš„åˆ†å¸ƒå¼è¯é¢‘ç»Ÿè®¡ç³»ç»Ÿã€‚è‡³äºå’Œå®é™…ç”Ÿäº§åœºæ™¯ä¸Šæœ€å¤§çš„åŒºåˆ«å°±åœ¨äºæ–‡ä»¶ç³»ç»Ÿã€‚åœ¨å•æœºä¸Šéƒ¨ç½²å…±ç”¨ä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå®é™…ç”Ÿäº§ç«¯è¦å¤æ‚å¾ˆå¤šã€‚</p><h3 id="å®é™…éƒ¨ç½²"><a href="#å®é™…éƒ¨ç½²" class="headerlink" title="å®é™…éƒ¨ç½²"></a>å®é™…éƒ¨ç½²</h3><p>&emsp;&emsp;å®Œæ•´çš„éƒ¨ç½²æµç¨‹ä»¥åŠå®éªŒç»†èŠ‚è¯¦è§ <a class="link" href="https://pdos.csail.mit.edu/6.824/labs/lab-mr.html">6.824 Lab 1: MapReduce<i class="fas fa-external-link-alt"></i></a></p><ol><li><p>ä¸²è¡ŒåŒ–çš„éƒ¨ç½²æµç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git://g.csail.mit.edu/6.824-golabs-2022 6.824</span><br><span class="line">$ <span class="built_in">cd</span> 6.824</span><br><span class="line">$ ls</span><br><span class="line">Makefile src</span><br><span class="line">$</span><br><span class="line">$ <span class="built_in">cd</span> ~/6.824</span><br><span class="line">$ <span class="built_in">cd</span> src/main</span><br><span class="line">$ go build -race -buildmode=plugin ../mrapps/wc.go</span><br><span class="line">$ rm mr-out*</span><br><span class="line">$ go run -race mrsequential.go wc.so pg*.txt</span><br><span class="line">$ more mr-out-0</span><br><span class="line">A 509</span><br><span class="line">ABOUT 2</span><br><span class="line">ACT 8</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p>mapreduce éƒ¨ç½²æµç¨‹<br>(1). ä½¿ç”¨ go plugin å°† <code>map</code> å’Œ <code>reduce</code> å‡½æ•°æ’ä»¶åŒ–<br>æ¶å¿ƒçš„ go pluginï¼Œæ˜¯ä¸ªä¸æˆç†Ÿçš„æ–¹æ¡ˆï¼Œå·®ç‚¹è®©æˆ‘å€’åœ¨äº†ç¬¬ä¸€æ­¥ï¼Œå…·ä½“çš„è¸©å‘æƒ…å†µè§<a href="https://jiahaohong1997.github.io/2022/04/06/MIT6.824%20Lab%20%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/">MIT6.824 Lab è¸©å‘è®°å½•</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go build -race -buildmode=plugin ../mrapps/wc.go</span><br></pre></td></tr></table></figure></li></ol><p>(2). å¯åŠ¨ <code>coordinator</code> è¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ rm mr-out*</span><br><span class="line">$ go run -race mrcoordinator.go pg-*.txt</span><br></pre></td></tr></table></figure><p>(3). å¼€å¯å¤šä¸ªç»ˆç«¯çª—å£ï¼Œå¯åŠ¨å¤šä¸ª <code>worker</code> è¿›ç¨‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go run -race mrworker.go wc.so</span><br></pre></td></tr></table></figure><ol start="3"><li>æœ€ç»ˆæµ‹è¯•ç»“æœå±•ç¤º<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ bash test-mr.sh       </span><br><span class="line">*** Starting wc <span class="built_in">test</span>.</span><br><span class="line">--- wc <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting indexer <span class="built_in">test</span>.</span><br><span class="line">--- indexer <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting map parallelism <span class="built_in">test</span>.</span><br><span class="line">--- map parallelism <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting reduce parallelism <span class="built_in">test</span>.</span><br><span class="line">--- reduce parallelism <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting job count <span class="built_in">test</span>.</span><br><span class="line">--- job count <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting early <span class="built_in">exit</span> <span class="built_in">test</span>.</span><br><span class="line">--- early <span class="built_in">exit</span> <span class="built_in">test</span>: PASS</span><br><span class="line">*** Starting crash <span class="built_in">test</span>.</span><br><span class="line">--- crash <span class="built_in">test</span>: PASS</span><br><span class="line">*** PASSED ALL TESTS</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h2><p>&emsp;&emsp;æ•´ä¸ªç³»ç»Ÿä¸­ <code>worker</code> å’Œ <code>coordinator</code> çš„äº¤äº’çŠ¶æ€åŒ…å«ä¸‹å›¾æ‰€ç¤ºçš„ä¸€ç³»åˆ—æƒ…å†µï¼š<br><img lazyload src="/images/loading.svg" data-src="keyStatus.png" alt="avatar"></p><h3 id="RPC-é€šä¿¡"><a href="#RPC-é€šä¿¡" class="headerlink" title="RPC é€šä¿¡"></a>RPC é€šä¿¡</h3><ol><li>å»ºç«‹è¿æ¥ï¼Œç»™æ¯ä¸ª <code>worker</code> åˆ†é…ä¸“å±å·¥å·<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ask for WorkerNum and Contruct Connection  </span></span><br><span class="line"><span class="keyword">type</span> HelloArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">   X <span class="keyword">string</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> HelloReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">   Y <span class="keyword">int</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>&emsp;&emsp;<code>HelloArgs</code> çš„ <code>X</code> å…ƒç´ æ˜¯åŒæ–¹çº¦å®šå¥½çš„å­—ç¬¦ä¸²ï¼Œ<code>coordinator</code> åªæœ‰åœ¨æ”¶åˆ°çº¦å®šçš„ä¿¡æ¯åæ‰èƒ½å»ºç«‹è¿æ¥ï¼Œåˆ†é…å·¥å·ã€‚</p><ol start="2"><li>map ä»»åŠ¡çš„è¯·æ±‚ä¸å®Œæˆ<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map tasks Arguments and Reply  </span></span><br><span class="line"><span class="keyword">type</span> MapArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">WorkerNum <span class="keyword">int</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> MapReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">NReducer <span class="keyword">int</span>  </span><br><span class="line">Finished <span class="keyword">bool</span>  </span><br><span class="line">FileName <span class="keyword">string</span>  </span><br><span class="line">JobId <span class="keyword">int</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Finish Map Task  </span></span><br><span class="line"><span class="keyword">type</span> FinishMapArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">X <span class="keyword">bool</span>  </span><br><span class="line">WorkerNum <span class="keyword">int</span>  </span><br><span class="line">FileName []<span class="keyword">string</span>  </span><br><span class="line">JobId <span class="keyword">int</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> FinishMapReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">Y <span class="keyword">int</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><p>è¯·æ±‚ <code>map</code> ä»»åŠ¡<br><code>worker</code> è¯·æ±‚ <code>map</code> ä»»åŠ¡æ—¶å¸¦ä¸Šè‡ªå·±çš„å·¥å·ï¼Œå¦‚æœè¢«æˆåŠŸåˆ†é…äº† <code>map</code> ä»»åŠ¡ï¼Œé‚£ä¹ˆå°†ä¼šå¾—åˆ° <code>reducer</code> çš„æ•°é‡ã€æ˜¯å¦å®Œæˆå…¨éƒ¨ <code>map</code> ä»»åŠ¡çš„ä¿¡å·ã€è¦æ‰§è¡Œçš„æ–‡ä»¶åç§°ã€è¢«åˆ†é…çš„äº‹åŠ¡ <code>Id</code>ï¼ˆç”¨äºå‘½åä¸­é—´ä¸´æ—¶æ–‡ä»¶ï¼Œé¿å… <code>crash</code>ï¼‰ã€‚</p></li><li><p>å‘é€ç»“æŸ <code>map</code> ä»»åŠ¡çš„ä¿¡å·<br><code>worker</code> åœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­æ‰§è¡Œå®Œï¼ˆæˆ–æœªèƒ½æˆåŠŸæ‰§è¡Œï¼‰ï¼Œå°†ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶åï¼ˆåœ°å€ï¼‰è½¬å‘Š <code>coordinator</code> ã€‚</p></li></ul><ol start="3"><li>reduce ä»»åŠ¡çš„è¯·æ±‚ä¸å®Œæˆ<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Reduce Task  </span></span><br><span class="line"><span class="keyword">type</span> ReduceTaskArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">WorkerNum <span class="keyword">int</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> ReduceTaskReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">Finished <span class="keyword">bool</span>  </span><br><span class="line">ReducerFile []<span class="keyword">string</span>  </span><br><span class="line">JobId <span class="keyword">int</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">// Finish Reduce Task  </span></span><br><span class="line"><span class="keyword">type</span> FinishReduceArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">X <span class="keyword">bool</span>  </span><br><span class="line">WorkerNum <span class="keyword">int</span>  </span><br><span class="line">File <span class="keyword">string</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> FinishReduceReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">Y <span class="keyword">int</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>&emsp;&emsp;å¤§ä½“æ€è·¯å’Œ <code>map</code> ä»»åŠ¡çš„è¯·æ±‚å’Œç»“æŸä¸€ç›´ï¼Œä¸è¿‡å¤šèµ˜è¿°ã€‚</p><ol start="4"><li>map å’Œ reduce ä»»åŠ¡éƒ½å®Œæˆï¼Œè¯·æ±‚å…³æœº<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ask for shutdown  </span></span><br><span class="line"><span class="keyword">type</span> ExitArgs <span class="keyword">struct</span> &#123;  </span><br><span class="line">   X <span class="keyword">bool</span>  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">type</span> ExitReply <span class="keyword">struct</span> &#123;  </span><br><span class="line">   Y <span class="keyword">bool</span>  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="coordinator-è¿›ç¨‹"><a href="#coordinator-è¿›ç¨‹" class="headerlink" title="coordinator è¿›ç¨‹"></a>coordinator è¿›ç¨‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Coordinator <span class="keyword">struct</span> &#123;  </span><br><span class="line">   <span class="comment">// Your definitions here.  </span></span><br><span class="line"> fileName       []<span class="keyword">string</span>  <span class="comment">// åˆå§‹æ–‡ä»¶ååˆ—è¡¨ï¼Œå¾…åˆ†é…é˜Ÿåˆ—</span></span><br><span class="line"> unfinishedFile []<span class="keyword">string</span>  <span class="comment">// mapä»»åŠ¡è¿›è¡Œä¸­çš„æ–‡ä»¶ååˆ—è¡¨ï¼Œå¾…å®Œæˆé˜Ÿåˆ—</span></span><br><span class="line"> nReducer       <span class="keyword">int</span>  </span><br><span class="line"> lock           sync.Mutex  </span><br><span class="line"> jobNum         <span class="keyword">int</span>    <span class="comment">// äº‹åŠ¡ idï¼Œé€’å¢ä¸é‡å¤</span></span><br><span class="line">  </span><br><span class="line"> workerNum    <span class="keyword">int</span>    <span class="comment">// worker ç¼–å·ï¼Œé€’å¢ä¸é‡å¤</span></span><br><span class="line"> workerDone   []<span class="keyword">chan</span> <span class="keyword">int</span>  <span class="comment">// å¯¹åº” worker çš„ä»»åŠ¡æ‰§è¡Œæƒ…å†µ</span></span><br><span class="line"> rejectResult []<span class="keyword">bool</span>    <span class="comment">// worker æˆåŠŸå®Œæˆä»»åŠ¡ï¼Œä½†å› ä¸ºé€šä¿¡åˆ°è¾¾åè¶…æ—¶ï¼Œæ‹’ç»è¯¥ä»»åŠ¡</span></span><br><span class="line">  </span><br><span class="line"> mapFinished          <span class="keyword">bool</span>  <span class="comment">// map å®Œæˆæ‰èƒ½å¼€å¯ reduce</span></span><br><span class="line"> reduceFiles          [][]<span class="keyword">string</span>  <span class="comment">// [nReducer][]stringï¼Œå¾…åˆ†é…é˜Ÿåˆ—</span></span><br><span class="line"> unFinishedReduceFile [][]<span class="keyword">string</span>  <span class="comment">// reduce æ­£åœ¨è¿›è¡Œä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¾…å®Œæˆé˜Ÿåˆ—</span></span><br><span class="line"> finalFiles           []<span class="keyword">string</span>    <span class="comment">// [nReducer]stringï¼Œæœ€ç»ˆæ–‡ä»¶</span></span><br><span class="line">  </span><br><span class="line"> exitValue atomic.Value    <span class="comment">// åŸå­é‡ï¼Œä¿è¯ coordinator æ­£å¸¸å…³æœº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦è´Ÿè´£çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ¥æ”¶ <code>worker</code> çš„å»ºç«‹è¿æ¥è¯·æ±‚å¹¶å‘æ”¾å·¥å·ï¼›</li><li>åˆ†é… <code>map</code> ä»»åŠ¡ï¼š</li></ol><ul><li>å»ºç«‹å¾…åˆ†é…ã€å¾…å®Œæˆæ–‡ä»¶é˜Ÿåˆ—</li><li>ç»™æˆåŠŸâ€œæ¥å•â€ï¼ˆæˆåŠŸä»å¾…åˆ†é…é˜Ÿåˆ—ä¸­è·å–æ–‡ä»¶ï¼‰çš„ <code>worker</code> åˆ†é…å”¯ä¸€çš„ <code>jobId</code>ï¼Œå¹¶åé¦ˆæ˜¯å¦å·²å®Œæˆæ‰€æœ‰çš„ <code>map</code> ä»»åŠ¡</li><li>å¼€å¯è®¡æ—¶ goroutineï¼Œä¸€æ—¦å¯¹åº”çš„ <code>map</code> ä»»åŠ¡è¶…æ—¶ï¼Œåˆ™å°†å¯¹åº”æ–‡ä»¶åä»å¾…å®Œæˆé˜Ÿåˆ—æ”¾å…¥å¾…åˆ†é…é˜Ÿåˆ—</li></ul><ol start="3"><li>åˆ†é… <code>reduce</code> ä»»åŠ¡ï¼š</li></ol><ul><li>åœ¨å®Œæˆæ‰€æœ‰ <code>map</code> ä»»åŠ¡çš„å‰æä¸‹æ‰ä¼šåˆ†é… <code>reduce</code> ä»»åŠ¡</li><li>å…¶ä½™æµç¨‹ä¸ <code>map</code> ä»»åŠ¡ç±»ä¼¼</li></ul><ol start="4"><li>shutdownï¼šå®Œæˆæ‰€æœ‰ <code>reduce</code> ä»»åŠ¡åï¼Œ<code>worker</code> ä¼šæ”¶åˆ°ç»“æŸä¿¡å·ï¼Œç„¶åé€šè¿‡ RPC è¯·æ±‚å…³é—­ï¼Œå½“æ‰€æœ‰ <code>worker</code> éƒ½é€€å‡ºåï¼Œ<code>coordinator</code> æ‰ä¼šå…³é—­ã€‚</li></ol><h3 id="worker-è¿›ç¨‹"><a href="#worker-è¿›ç¨‹" class="headerlink" title="worker è¿›ç¨‹"></a>worker è¿›ç¨‹</h3><ol><li>å»ºç«‹ä¸ <code>coordinator</code> çš„è¿æ¥ï¼Œè·å–å·¥å·ï¼›</li><li>è¯·æ±‚ <code>map</code> ä»»åŠ¡ï¼Œè·å¾—ä»»åŠ¡åå¼€å§‹æ‰§è¡Œï¼Œå“åº”å®Œæˆæƒ…å†µåç»§ç»­è¯·æ±‚ <code>map</code> ä»»åŠ¡ç›´åˆ°å†æ¬¡è·å–æˆ–è€…æ‰€æœ‰ <code>map</code> ä»»åŠ¡éƒ½ç»“æŸï¼›</li><li>æ‰€æœ‰ <code>map</code> ä»»åŠ¡éƒ½ç»“æŸåï¼Œè¯·æ±‚ <code>reduce</code> ä»»åŠ¡ï¼Œè·å¾—ä»»åŠ¡åå¼€å§‹æ‰§è¡Œï¼Œå“åº”å®Œæˆæƒ…å†µåç»§ç»­è¯·æ±‚ <code>reduce</code> ä»»åŠ¡ç›´åˆ°å†æ¬¡è·å– <code>reduce</code> ä»»åŠ¡æˆ–è€…æ‰€æœ‰ <code>reduce</code> ä»»åŠ¡ç»“æŸï¼›</li><li>è¯·æ±‚ç»“æŸè¿æ¥ï¼Œå…³æœºã€‚</li></ol><h2 id="ä¸€äº›ç»†èŠ‚"><a href="#ä¸€äº›ç»†èŠ‚" class="headerlink" title="ä¸€äº›ç»†èŠ‚"></a>ä¸€äº›ç»†èŠ‚</h2><ol><li><p>ç”Ÿæˆçš„ <code>nReducer</code> ä¸ªä¸­é—´ä¸´æ—¶æ–‡ä»¶å¯ä»¥ç¼–ç æˆ <code>json</code> çš„æ ¼å¼ï¼Œæ–¹ä¾¿å¤„ç†ï¼Œå¯ä»¥åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­å†™å…¥ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enc := json.NewEncoder(file)</span><br><span class="line"><span class="keyword">for</span> _, kv := ... &#123;</span><br><span class="line">    err := enc.Encode(&amp;kv)</span><br></pre></td></tr></table></figure><p>åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­è¯»å–ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dec := json.NewDecoder(file)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">var</span> kv KeyValue</span><br><span class="line"><span class="keyword">if</span> err := dec.Decode(&amp;kv); err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">kva = <span class="built_in">append</span>(kva, kv)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>worker</code>æ¯æ¬¡åœ¨ç»“æŸä»»åŠ¡åéƒ½è¦é‡å¤è¯·æ±‚ä»»åŠ¡ï¼ˆå¿ƒè·³ï¼‰ï¼Œç›´åˆ°è·å¾—ä»»åŠ¡å…¨éƒ¨ç»“æŸçš„ä¿¡å·ã€‚</p></li><li><p>é€šè¿‡ç»´æŠ¤<code>å¾…åˆ†é…</code> å’Œ <code>å¾…å®Œæˆ</code> ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œå¯ä»¥æ§åˆ¶ä»»åŠ¡çš„å‘æ”¾ä¸ <code>map</code>ã€<code>reduce</code> ä¸¤ä¸ªå¤§ä»»åŠ¡çš„å®Œæˆæƒ…å†µã€‚</p></li><li><p>å¯ä»¥é€šè¿‡ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ä¿å­˜ä¸´æ—¶ç»“æœçš„æ–¹å¼é¿å…å› ä¸ºè¶…æ—¶å¯¼è‡´çš„ <code>crash</code>ã€‚</p></li><li><p>ä¿å­˜çš„æ–‡ä»¶å¯ä»¥å¸¦ä¸Šå”¯ä¸€çš„ <code>jobId</code> é˜²æ­¢ <code>crash</code>ã€‚</p></li><li><p><code>coordinator</code> å¯¹ä»»åŠ¡çš„è¶…æ—¶æ§åˆ¶ï¼šé‡‡ç”¨äº†ä¸€ä¸ª select çš„ç»“æ„ï¼Œç¬¬ä¸€ä¸ªåˆ†æ”¯æ˜¯è¶…æ—¶ä¸Šä¸‹æ–‡  <code>ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)</code> æ¥æ§åˆ¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œé™¤äº†å¤„ç†å¯¹åº”çš„ä¸¤ä¸ªé˜Ÿåˆ—å¤–ï¼Œè¿˜éœ€è¦å°†å¯¹åº”å·¥å·çš„ <code>rejectResult</code> ç½®ä¸º <code>true</code>ï¼Œé˜²æ­¢ <code>worker</code> åœ¨è§„å®šæ—¶é—´å†…å®Œæˆäº†ä»»åŠ¡ï¼Œä½†æ˜¯å› ä¸º PRC é€šä¿¡çš„å»¶è¿Ÿå¯¼è‡´è¶…æ—¶å‡ºç°çš„   <code>coordinator</code> å’Œ <code>worker</code> å¯¹ä¸´æ—¶æ–‡ä»¶å¤„ç†ä¸ä¸€è‡´çš„æƒ…å†µï¼›ç¬¬äºŒä¸ªåˆ†æ”¯æ˜¯å¯¹åº”å·¥å·çš„ <code>workerDone</code>ï¼Œ <code>coordinator</code> åœ¨è§„å®šæ—¶é—´å†…æ¥æ”¶åˆ°æ­£ç¡®çš„å®Œæˆä¿¡å·åï¼Œå°±ä¼šå‘è¯¥æ— ç¼“å†²é€šé“å†…å‘é€æ•°æ®ï¼Œä»è€Œé€‰æ‹©è¿™ä¸€åˆ†æ”¯ï¼Œè¡¨ç¤ºä»»åŠ¡é¡ºåˆ©å®Œæˆã€‚</p></li><li><p>å¯¹é”å’ŒåŸå­æ•°æ®çš„ä½¿ç”¨ä¸Šè¦æ³¨æ„ï¼Œé¿å… <code>data race</code>ï¼ˆç¼–è¯‘æ—¶é€šè¿‡ <code>-race</code> è¿›è¡Œç«æ€æ£€æµ‹ï¼‰ã€‚</p></li></ol><h1 id="é¡¹ç›®ä»‹ç»"><a href="#é¡¹ç›®ä»‹ç»" class="headerlink" title="é¡¹ç›®ä»‹ç»"></a>é¡¹ç›®ä»‹ç»</h1><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><p><a class="link" href="https://github.com/JiahaoHong1997/MIT6.824">GitHub-MIT6.824<i class="fas fa-external-link-alt"></i></a></p><h2 id="å…³é”®é¡¹ç›®æ–‡ä»¶ç»“æ„"><a href="#å…³é”®é¡¹ç›®æ–‡ä»¶ç»“æ„" class="headerlink" title="å…³é”®é¡¹ç›®æ–‡ä»¶ç»“æ„"></a>å…³é”®é¡¹ç›®æ–‡ä»¶ç»“æ„</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">|- doc</span><br><span class="line">|- src</span><br><span class="line">|- main</span><br><span class="line">|- mrsequential.go</span><br><span class="line">|- mrworker.go</span><br><span class="line">|- mrcoordinator.go</span><br><span class="line">|- test-mr.sh</span><br><span class="line">|- mr</span><br><span class="line">|- coordinator.go&#x2F;&#x2F; coordinator æ§åˆ¶é€»è¾‘</span><br><span class="line">|- rpc.go&#x2F;&#x2F; rpc é€šä¿¡ç»“æ„</span><br><span class="line">|- worker.go&#x2F;&#x2F; worker æ§åˆ¶é€»è¾‘</span><br><span class="line">|- mrapps</span><br><span class="line">|- wc.go</span><br><span class="line">|- indexer.go</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä»»åŠ¡æ¢³ç†&quot;&gt;&lt;a href=&quot;#ä»»åŠ¡æ¢³ç†&quot; class=&quot;headerlink&quot; title=&quot;ä»»åŠ¡æ¢³ç†&quot;&gt;&lt;/a&gt;ä»»åŠ¡æ¢³ç†&lt;/h1&gt;&lt;h2 id=&quot;mapreduce-ä»‹ç»åŠéƒ¨ç½²&quot;&gt;&lt;a href=&quot;#mapreduce-ä»‹ç»åŠéƒ¨ç½²&quot; class=&quot;header</summary>
      
    
    
    
    <category term="åˆ†å¸ƒå¼ç³»ç»Ÿ" scheme="http://jiahaohong1997.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/"/>
    
    
    <category term="mit6.824" scheme="http://jiahaohong1997.github.io/tags/mit6-824/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 6ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/04/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%206%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/04/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%206%EF%BC%89/</id>
    <published>2022-04-04T00:00:00.000Z</published>
    <updated>2022-04-08T00:09:16.517Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡æ˜¯å¯¹ç¬¬ 287 åœºå‘¨èµ›çš„å¤ç›˜æ€»ç»“</p><h2 id="6055-è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°"><a href="#6055-è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°" class="headerlink" title="6055. è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°"></a><a class="link" href="https://leetcode-cn.com/problems/minimum-number-of-operations-to-convert-time/">6055. è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² current å’Œ correct ï¼Œè¡¨ç¤ºä¸¤ä¸ª 24 å°æ—¶åˆ¶æ—¶é—´ ã€‚<br>24 å°æ—¶åˆ¶æ—¶é—´ æŒ‰ â€œHH:MMâ€ è¿›è¡Œæ ¼å¼åŒ–ï¼Œå…¶ä¸­ HH åœ¨ 00 å’Œ 23 ä¹‹é—´ï¼Œè€Œ MM åœ¨ 00 å’Œ 59 ä¹‹é—´ã€‚æœ€æ—©çš„ 24 å°æ—¶åˆ¶æ—¶é—´ä¸º 00:00 ï¼Œæœ€æ™šçš„æ˜¯ 23:59 ã€‚<br>åœ¨ä¸€æ­¥æ“ä½œä¸­ï¼Œä½ å¯ä»¥å°† current è¿™ä¸ªæ—¶é—´å¢åŠ  1ã€5ã€15 æˆ– 60 åˆ†é’Ÿã€‚ä½ å¯ä»¥æ‰§è¡Œè¿™ä¸€æ“ä½œ ä»»æ„ æ¬¡æ•°ã€‚<br>è¿”å›å°†Â current è½¬åŒ–ä¸º correct éœ€è¦çš„ æœ€å°‘æ“ä½œæ•° ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šcurrent &#x3D; &quot;02:30&quot;, correct &#x3D; &quot;04:35&quot;</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">å¯ä»¥æŒ‰ä¸‹è¿° 3 æ­¥æ“ä½œå°† current è½¬æ¢ä¸º correct ï¼š</span><br><span class="line">- ä¸º current åŠ  60 åˆ†é’Ÿï¼Œcurrent å˜ä¸º &quot;03:30&quot; ã€‚</span><br><span class="line">- ä¸º current åŠ  60 åˆ†é’Ÿï¼Œcurrent å˜ä¸º &quot;04:30&quot; ã€‚ </span><br><span class="line">- ä¸º current åŠ  5 åˆ†é’Ÿï¼Œcurrent å˜ä¸º &quot;04:35&quot; ã€‚</span><br><span class="line">å¯ä»¥è¯æ˜ï¼Œæ— æ³•ç”¨å°‘äº 3 æ­¥æ“ä½œå°† current è½¬åŒ–ä¸º correct ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šcurrent &#x3D; &quot;11:00&quot;, correct &#x3D; &quot;11:01&quot;</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šåªéœ€è¦ä¸º current åŠ ä¸€åˆ†é’Ÿï¼Œæ‰€ä»¥æœ€å°æ“ä½œæ•°æ˜¯ 1 ã€‚</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">current å’Œ correct éƒ½ç¬¦åˆ &quot;HH:MM&quot; æ ¼å¼</span><br><span class="line">current &lt;&#x3D; correct</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æœ¬é¢˜å…¶å®æ˜¯å˜ç§çš„é›¶é’±é—®é¢˜ã€‚åˆå§‹çŠ¶æ€æ˜¯ <code>current</code>ï¼Œæœ€ç»ˆçŠ¶æ€æ˜¯ <code>correct</code>ï¼Œå¯ç”¨â€œé›¶é’±â€é¢é¢æœ‰ <code>[1,5,15,60]</code>ï¼›<br>(2). ç°å°†åˆå§‹ã€æœ€ç»ˆä¸¤ç§çŠ¶æ€è½¬æ¢æˆå’Œâ€œé›¶é’±â€é¢é¢ä¸€æ ·çš„è®¡æ•°å•ä½â€”â€”â€œåˆ†é’Ÿâ€ï¼›<br>(3). ä½¿ç”¨åŠ¨æ€è§„åˆ’ï¼Œä»åˆå§‹çŠ¶æ€ä¸€æ­¥æ­¥å‘æœ€ç»ˆçŠ¶æ€é€¼è¿‘ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N).</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convertTime</span><span class="params">(current <span class="keyword">string</span>, correct <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">s1 := strings.Split(current, <span class="string">&quot;:&quot;</span>)</span><br><span class="line">h1, m1 := s1[<span class="number">0</span>], s1[<span class="number">1</span>]</span><br><span class="line">s2 := strings.Split(correct, <span class="string">&quot;:&quot;</span>)</span><br><span class="line">h2, m2 := s2[<span class="number">0</span>], s2[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åˆ†é’Ÿä»£è¡¨åˆå§‹çŠ¶æ€</span></span><br><span class="line">nowh, _ := strconv.Atoi(h1)</span><br><span class="line">nowm, _ := strconv.Atoi(m1)</span><br><span class="line">now := nowh*<span class="number">60</span>+nowm</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨åˆ†é’Ÿä»£è¡¨æœ€ç»ˆçŠ¶æ€</span></span><br><span class="line">th, _ := strconv.Atoi(h2)</span><br><span class="line">tm, _ := strconv.Atoi(m2)</span><br><span class="line">t := th*<span class="number">60</span>+tm</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†çŠ¶æ€å½’ä¸€åŒ–åˆ° (0,diff) åŒºé—´</span></span><br><span class="line">diff := abs(now, t)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ç”¨é›¶é’±é¢é¢</span></span><br><span class="line">choose := []<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">60</span>&#125;</span><br><span class="line"></span><br><span class="line">dp := <span class="built_in">make</span>([]<span class="keyword">int</span>, diff+<span class="number">1</span>)</span><br><span class="line">dp[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;=diff; i++ &#123;</span><br><span class="line">dp[i] = math.MaxInt32</span><br><span class="line"><span class="keyword">for</span> j:=<span class="built_in">len</span>(choose)<span class="number">-1</span>; j&gt;=<span class="number">0</span>; j-- &#123;</span><br><span class="line"><span class="keyword">if</span> choose[j] &gt; i &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">dp[i] = min(dp[i], dp[i-choose[j]]+<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dp[diff]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">abs</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &gt; b &#123;</span><br><span class="line"><span class="keyword">return</span> a-b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> b-a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5235-æ‰¾å‡ºè¾“æ‰é›¶åœºæˆ–ä¸€åœºæ¯”èµ›çš„ç©å®¶"><a href="#5235-æ‰¾å‡ºè¾“æ‰é›¶åœºæˆ–ä¸€åœºæ¯”èµ›çš„ç©å®¶" class="headerlink" title="5235. æ‰¾å‡ºè¾“æ‰é›¶åœºæˆ–ä¸€åœºæ¯”èµ›çš„ç©å®¶"></a><a class="link" href="https://leetcode-cn.com/problems/find-players-with-zero-or-one-losses/">5235. æ‰¾å‡ºè¾“æ‰é›¶åœºæˆ–ä¸€åœºæ¯”èµ›çš„ç©å®¶<i class="fas fa-external-link-alt"></i></a></h2><p>#map</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ matches å…¶ä¸­ matches[i] = [winneri, loseri] è¡¨ç¤ºåœ¨ä¸€åœºæ¯”èµ›ä¸­ winneri å‡»è´¥äº† loseri ã€‚<br>è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º 2 çš„åˆ—è¡¨ answer ï¼š<br>answer[0] æ˜¯æ‰€æœ‰ æ²¡æœ‰ è¾“æ‰ä»»ä½•æ¯”èµ›çš„ç©å®¶åˆ—è¡¨ã€‚<br>answer[1] æ˜¯æ‰€æœ‰æ°å¥½è¾“æ‰ ä¸€åœº æ¯”èµ›çš„ç©å®¶åˆ—è¡¨ã€‚<br>ä¸¤ä¸ªåˆ—è¡¨ä¸­çš„å€¼éƒ½åº”è¯¥æŒ‰ é€’å¢ é¡ºåºè¿”å›ã€‚</p></blockquote><blockquote><p>æ³¨æ„ï¼š<br>åªè€ƒè™‘é‚£äº›å‚ä¸ è‡³å°‘ä¸€åœº æ¯”èµ›çš„ç©å®¶ã€‚<br>ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ä¿è¯ ä¸å­˜åœ¨ ä¸¤åœºæ¯”èµ›ç»“æœ ç›¸åŒ ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šmatches &#x3D; [[1,3],[2,3],[3,6],[5,6],[5,7],[4,5],[4,8],[4,9],[10,4],[10,9]]</span><br><span class="line">è¾“å‡ºï¼š[[1,2,10],[4,5,7,8]]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç©å®¶ 1ã€2 å’Œ 10 éƒ½æ²¡æœ‰è¾“æ‰ä»»ä½•æ¯”èµ›ã€‚</span><br><span class="line">ç©å®¶ 4ã€5ã€7 å’Œ 8 æ¯ä¸ªéƒ½è¾“æ‰ä¸€åœºæ¯”èµ›ã€‚</span><br><span class="line">ç©å®¶ 3ã€6 å’Œ 9 æ¯ä¸ªéƒ½è¾“æ‰ä¸¤åœºæ¯”èµ›ã€‚</span><br><span class="line">å› æ­¤ï¼Œanswer[0] &#x3D; [1,2,10] å’Œ answer[1] &#x3D; [4,5,7,8] ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šmatches &#x3D; [[2,3],[1,3],[5,4],[6,4]]</span><br><span class="line">è¾“å‡ºï¼š[[1,2,5,6],[]]</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç©å®¶ 1ã€2ã€5 å’Œ 6 éƒ½æ²¡æœ‰è¾“æ‰ä»»ä½•æ¯”èµ›ã€‚</span><br><span class="line">ç©å®¶ 3 å’Œ 4 æ¯ä¸ªéƒ½è¾“æ‰ä¸¤åœºæ¯”èµ›ã€‚</span><br><span class="line">å› æ­¤ï¼Œanswer[0] &#x3D; [1,2,5,6] å’Œ answer[1] &#x3D; [] ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; matches.length &lt;&#x3D; 105</span><br><span class="line">matches[i].length &#x3D;&#x3D; 2</span><br><span class="line">1 &lt;&#x3D; winneri, loseri &lt;&#x3D; 105</span><br><span class="line">winneri !&#x3D; loseri</span><br><span class="line">æ‰€æœ‰ matches[i] äº’ä¸ç›¸åŒ</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æœ¬é¢˜éœ€è¦è¾“å‡ºä¸¤ä¸ªåˆ—è¡¨ï¼šå…¶ä¸€æ˜¯ <strong>å…¥åº¦</strong> ä¸º $0$ ä¸” <strong>å‡ºåº¦</strong> å¤§äº $0$ çš„ç¼–å·ï¼Œå…¶äºŒæ˜¯ <strong>å…¥åº¦</strong> æ°å¥½ä¸º $1$ çš„ç¼–å·ï¼›<br>(2). ä½¿ç”¨ä¸¤ä¸ª <code>map</code> åˆ†åˆ«ä¿å­˜æ¯ä¸ªç¼–å·çš„å‡ºåº¦å’Œå…¥åº¦ï¼›<br>(3). é¦–å…ˆéå† <strong>å…¥åº¦</strong> <code>map</code>ï¼Œåªè¦å‘ç°å…¶é•¿åº¦ä¸º $1$ï¼Œé‚£å°±åŠ å…¥è¾“å‡ºä¸­ï¼›<br>(4). ç„¶åéå† <strong>å‡ºåº¦</strong> <code>map</code>ï¼Œæ£€æŸ¥å¯¹åº”ç¼–å·çš„ <strong>å…¥åº¦</strong> åˆ—è¡¨å¦‚æœä¸º $0$ï¼Œé‚£ä¹ˆä¹ŸåŠ å…¥è¾“å‡ºä¸­ï¼›<br>(5). æ’åºä¸¤ä¸ªåˆ—è¡¨ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findWinners</span><span class="params">(matches [][]<span class="keyword">int</span>)</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">m1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>][]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">m2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">bool</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå† matchesï¼Œæ„å»º å‡ºåº¦ å’Œ å…¥åº¦ map</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(matches); i++ &#123;</span><br><span class="line">win, lose := matches[i][<span class="number">0</span>], matches[i][<span class="number">1</span>]</span><br><span class="line">m1[lose] = <span class="built_in">append</span>(m1[lose], win)</span><br><span class="line">m2[win] = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret := <span class="built_in">make</span>([][]<span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> m1 &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(v) == <span class="number">1</span> &#123;</span><br><span class="line">ret[<span class="number">1</span>] = <span class="built_in">append</span>(ret[<span class="number">1</span>], k)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, _ := <span class="keyword">range</span> m2 &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(m1[k]) == <span class="number">0</span> &#123;</span><br><span class="line">ret[<span class="number">0</span>] = <span class="built_in">append</span>(ret[<span class="number">0</span>], k)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sort.Ints(ret[<span class="number">0</span>])</span><br><span class="line">sort.Ints(ret[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5219-æ¯ä¸ªå°å­©æœ€å¤šèƒ½åˆ†åˆ°å¤šå°‘ç³–æœ"><a href="#5219-æ¯ä¸ªå°å­©æœ€å¤šèƒ½åˆ†åˆ°å¤šå°‘ç³–æœ" class="headerlink" title="5219. æ¯ä¸ªå°å­©æœ€å¤šèƒ½åˆ†åˆ°å¤šå°‘ç³–æœ"></a><a class="link" href="https://leetcode-cn.com/problems/maximum-candies-allocated-to-k-children/">5219. æ¯ä¸ªå°å­©æœ€å¤šèƒ½åˆ†åˆ°å¤šå°‘ç³–æœ<i class="fas fa-external-link-alt"></i></a></h2><p>#äºŒåˆ†æŸ¥æ‰¾</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ª ä¸‹æ ‡ä» 0 å¼€å§‹ çš„æ•´æ•°æ•°ç»„ candies ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ è¡¨ç¤ºå¤§å°ä¸º candies[i] çš„ä¸€å †ç³–æœã€‚ä½ å¯ä»¥å°†æ¯å †ç³–æœåˆ†æˆä»»æ„æ•°é‡çš„ å­å † ï¼Œä½† æ— æ³• å†å°†ä¸¤å †åˆå¹¶åˆ°ä¸€èµ·ã€‚<br>å¦ç»™ä½ ä¸€ä¸ªæ•´æ•° k ã€‚ä½ éœ€è¦å°†è¿™äº›ç³–æœåˆ†é…ç»™ k ä¸ªå°å­©ï¼Œä½¿æ¯ä¸ªå°å­©åˆ†åˆ° ç›¸åŒ æ•°é‡çš„ç³–æœã€‚æ¯ä¸ªå°å­©å¯ä»¥æ‹¿èµ° è‡³å¤šä¸€å † ç³–æœï¼Œæœ‰äº›ç³–æœå¯èƒ½ä¼šä¸è¢«åˆ†é…ã€‚<br>è¿”å›æ¯ä¸ªå°å­©å¯ä»¥æ‹¿èµ°çš„ æœ€å¤§ç³–æœæ•°ç›® ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šcandies &#x3D; [5,8,6], k &#x3D; 3</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼šå¯ä»¥å°† candies[1] åˆ†æˆå¤§å°åˆ†åˆ«ä¸º 5 å’Œ 3 çš„ä¸¤å †ï¼Œç„¶åæŠŠ candies[2] åˆ†æˆå¤§å°åˆ†åˆ«ä¸º 5 å’Œ 1 çš„ä¸¤å †ã€‚ç°åœ¨å°±æœ‰äº”å †å¤§å°åˆ†åˆ«ä¸º 5ã€5ã€3ã€5 å’Œ 1 çš„ç³–æœã€‚å¯ä»¥æŠŠ 3 å †å¤§å°ä¸º 5 çš„ç³–æœåˆ†ç»™ 3 ä¸ªå°å­©ã€‚å¯ä»¥è¯æ˜æ— æ³•è®©æ¯ä¸ªå°å­©å¾—åˆ°è¶…è¿‡ 5 é¢—ç³–æœã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šcandies &#x3D; [2,5], k &#x3D; 11</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šæ€»å…±æœ‰ 11 ä¸ªå°å­©ï¼Œä½†åªæœ‰ 7 é¢—ç³–æœï¼Œä½†å¦‚æœè¦åˆ†é…ç³–æœçš„è¯ï¼Œå¿…é¡»ä¿è¯æ¯ä¸ªå°å­©è‡³å°‘èƒ½å¾—åˆ° 1 é¢—ç³–æœã€‚å› æ­¤ï¼Œæœ€åæ¯ä¸ªå°å­©éƒ½æ²¡æœ‰å¾—åˆ°ç³–æœï¼Œç­”æ¡ˆæ˜¯ 0 ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; candies.length &lt;&#x3D; 10^5</span><br><span class="line">1 &lt;&#x3D; candies[i] &lt;&#x3D; 10^7</span><br><span class="line">1 &lt;&#x3D; k &lt;&#x3D; 10^12</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆçœ‹ä¸€çœ‹æ•°æ®é‡ï¼Œæ˜æ˜¾æš´åŠ›ç»å¯¹ä¼šè¶…æ—¶ï¼Œé‚£ä¹ˆåˆ«æ— é€‰æ‹©ï¼ŒäºŒåˆ†æ³•æèµ·æ¥ï¼›<br>(2). é¦–å…ˆåˆ¤æ–­ä¸€ä¸‹è¾¹ç•Œæƒ…å†µï¼Œå½“ ğŸ¬æ€»æ•° &lt; ğŸ§’æ€»æ•° æ—¶ï¼Œæ˜¾ç„¶å¤§å®¶éƒ½æ²¡å¾—åˆ†ï¼Œreturn 0ï¼›å¦‚æœ ğŸ¬æ€»æ•° == ğŸ§’æ€»æ•° ï¼Œreturn 1<br>(3) äºŒåˆ†æŸ¥æ‰¾çš„å·¦è¾¹ç•Œæ˜¯ $1$ï¼Œå³è¾¹ç•Œæ˜¯ ğŸ¬æ€»æ•°/ğŸ§’æ€»æ•° ï¼›<br>(4) è¦æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„å³è¾¹ç•Œï¼ŒäºŒåˆ†è¶…æ‰¾æ¨¡æ¿å¥—èµ·æ¥ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(Nlog(N))</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maximumCandies</span><span class="params">(candies []<span class="keyword">int</span>, k <span class="keyword">int64</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> total <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(candies); i++ &#123;</span><br><span class="line">total += <span class="keyword">int64</span>(candies[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> total &lt; k &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> total == k &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> satisified <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">bool</span></span></span><br><span class="line">satisified = <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> count <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(candies); i++ &#123;</span><br><span class="line">count += <span class="keyword">int64</span>(candies[i]/n)</span><br><span class="line"><span class="keyword">if</span> count &gt;= k &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">l, r := <span class="number">1</span>, <span class="keyword">int</span>(total/k)</span><br><span class="line"><span class="keyword">if</span> satisified(r) &#123;</span><br><span class="line"><span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l &lt; r &#123;</span><br><span class="line">m := l+(r-l)&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> satisified(m) &#123;</span><br><span class="line">l = m+<span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> !satisified(m) &#123;</span><br><span class="line">r = m</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> l<span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5302-åŠ å¯†è§£å¯†å­—ç¬¦ä¸²"><a href="#5302-åŠ å¯†è§£å¯†å­—ç¬¦ä¸²" class="headerlink" title="5302. åŠ å¯†è§£å¯†å­—ç¬¦ä¸²"></a><a class="link" href="https://leetcode-cn.com/problems/encrypt-and-decrypt-strings/">5302. åŠ å¯†è§£å¯†å­—ç¬¦ä¸²<i class="fas fa-external-link-alt"></i></a></h2><p>#è®¾è®¡é¢˜</p><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦æ•°ç»„ keys ï¼Œç”±è‹¥å¹² äº’ä¸ç›¸åŒ çš„å­—ç¬¦ç»„æˆã€‚è¿˜æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ values ï¼Œå†…å«è‹¥å¹²é•¿åº¦ä¸º 2 çš„å­—ç¬¦ä¸²ã€‚å¦ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ dictionary ï¼ŒåŒ…å«è§£å¯†åæ‰€æœ‰å…è®¸çš„åŸå­—ç¬¦ä¸²ã€‚è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ”¯æŒåŠ å¯†åŠè§£å¯†ä¸‹æ ‡ä» 0 å¼€å§‹å­—ç¬¦ä¸²çš„æ•°æ®ç»“æ„ã€‚<br>å­—ç¬¦ä¸² åŠ å¯† æŒ‰ä¸‹è¿°æ­¥éª¤è¿›è¡Œï¼š<br>1.å¯¹å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ c ï¼Œå…ˆä» keys ä¸­æ‰¾å‡ºæ»¡è¶³ keys[i] == c çš„ä¸‹æ ‡ i ã€‚<br>2.åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œç”¨Â values[i] æ›¿æ¢å­—ç¬¦ c ã€‚<br>å­—ç¬¦ä¸² è§£å¯† æŒ‰ä¸‹è¿°æ­¥éª¤è¿›è¡Œï¼š<br>1.å°†å­—ç¬¦ä¸²æ¯ç›¸é‚» 2 ä¸ªå­—ç¬¦åˆ’åˆ†ä¸ºä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œå¯¹äºæ¯ä¸ªå­å­—ç¬¦ä¸² s ï¼Œæ‰¾å‡ºæ»¡è¶³ values[i] == s çš„ä¸€ä¸ªä¸‹æ ‡ i ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªæœ‰æ•ˆçš„ i ï¼Œä»ä¸­é€‰æ‹© ä»»æ„ ä¸€ä¸ªã€‚è¿™æ„å‘³ç€ä¸€ä¸ªå­—ç¬¦ä¸²è§£å¯†å¯èƒ½å¾—åˆ°å¤šä¸ªè§£å¯†å­—ç¬¦ä¸²ã€‚<br>2.åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œç”¨ keys[i] æ›¿æ¢ s ã€‚<br>å®ç° Encrypter ç±»ï¼š<br>1.Encrypter(char[] keys, String[] values, String[] dictionary) ç”¨ keysã€values å’Œ dictionary åˆå§‹åŒ– Encrypter ç±»ã€‚<br>2.String encrypt(String word1) æŒ‰ä¸Šè¿°åŠ å¯†è¿‡ç¨‹å®Œæˆå¯¹ word1 çš„åŠ å¯†ï¼Œå¹¶è¿”å›åŠ å¯†åçš„å­—ç¬¦ä¸²ã€‚<br>3.int decrypt(String word2) ç»Ÿè®¡å¹¶è¿”å›å¯ä»¥ç”± word2 è§£å¯†å¾—åˆ°ä¸”å‡ºç°åœ¨ dictionary ä¸­çš„å­—ç¬¦ä¸²æ•°ç›®ã€‚</p></blockquote><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æ³¨æ„åˆ° <code>values</code> ä¸­æœ‰ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå› æ­¤ä¸åŒçš„å­—ç¬¦ä¸²åŠ å¯†åå¯èƒ½æ˜¯ä¸€æ ·çš„ï¼Œä»è€Œä¸€ä¸ªå­—ç¬¦ä¸²è§£å¯†å‡ºçš„ç»“æœå¯èƒ½ä¸æ˜¯å”¯ä¸€çš„ï¼›<br>(2). æ ¹æ®æç¤º 1ï¼Œç›´æ¥è§£å¯†è¾ƒä¸ºå¤æ‚ï¼Œä¸å¦¨é€†å‘æ€è€ƒï¼Œå³åŠ å¯† <code>dictionary</code> ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²ã€‚ç”¨å“ˆå¸Œè¡¨è®°å½•æ¯ä¸ªåŠ å¯†åçš„å­—ç¬¦ä¸²çš„å‡ºç°æ¬¡æ•°ã€‚è¿™æ ·æ¯æ¬¡è°ƒç”¨ <code>decrypt</code> æ—¶ï¼Œè¿”å›å“ˆå¸Œè¡¨ä¸­ <code>word2</code> çš„å‡ºç°æ¬¡æ•°å³å¯ã€‚</p><h3 id="è§£é¢˜ä»£ç -3"><a href="#è§£é¢˜ä»£ç -3" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Encrypter <span class="keyword">struct</span> &#123;</span><br><span class="line">mp  [<span class="number">26</span>]<span class="keyword">string</span></span><br><span class="line">cnt <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Constructor</span><span class="params">(keys []<span class="keyword">byte</span>, values, dictionary []<span class="keyword">string</span>)</span> <span class="title">Encrypter</span></span> &#123;</span><br><span class="line">mp := [<span class="number">26</span>]<span class="keyword">string</span>&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i, key := <span class="keyword">range</span> keys &#123;</span><br><span class="line">mp[key-<span class="string">&#x27;a&#x27;</span>] = values[i]</span><br><span class="line">&#125;</span><br><span class="line">e := Encrypter&#123;mp, <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;&#125;&#125;</span><br><span class="line"><span class="keyword">for</span> _, s := <span class="keyword">range</span> dictionary &#123;</span><br><span class="line">e.cnt[e.Encrypt(s)]++</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> e</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Encrypter)</span> <span class="title">Encrypt</span><span class="params">(word1 <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">res := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">0</span>, <span class="built_in">len</span>(word1)*<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> _, ch := <span class="keyword">range</span> word1 &#123;</span><br><span class="line">s := e.mp[ch-<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"><span class="keyword">if</span> s == <span class="string">&quot;&quot;</span> &#123; <span class="keyword">return</span> <span class="string">&quot;&quot;</span> &#125;</span><br><span class="line">res = <span class="built_in">append</span>(res, s...)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(res)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Encrypter)</span> <span class="title">Decrypt</span><span class="params">(word2 <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> e.cnt[word2] &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ç¬¬ 287 åœºå‘¨èµ›çš„å¤ç›˜æ€»ç»“&lt;/p&gt;
&lt;h2 id=&quot;6055-è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°&quot;&gt;&lt;a href=&quot;#6055-è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°&quot; class=&quot;headerlink&quot; title=&quot;6055. è½¬åŒ–æ—¶é—´éœ€è¦çš„æœ€å°‘æ“ä½œæ•°&quot;&gt;&lt;/a&gt;&lt;a class</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 5ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/03/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%205%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/03/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%205%EF%BC%89/</id>
    <published>2022-04-02T22:00:00.000Z</published>
    <updated>2022-04-08T00:11:31.121Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ—©ä¸Šå¤ç›˜ä¸€ä¸‹æ˜¨å¤©æ™šä¸Šçš„åŒå‘¨èµ›</p><h2 id="LeetCode6033-è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°"><a href="#LeetCode6033-è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°" class="headerlink" title="LeetCode6033. è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°"></a><a class="link" href="https://leetcode-cn.com/problems/minimum-bit-flips-to-convert-number/">LeetCode6033. è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#ä½è¿ç®—</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ä¸€æ¬¡ ä½ç¿»è½¬Â å®šä¹‰ä¸ºå°†æ•°å­—Â xÂ äºŒè¿›åˆ¶ä¸­çš„ä¸€ä¸ªä½è¿›è¡Œ ç¿»è½¬Â æ“ä½œï¼Œå³å°†Â 0Â å˜æˆÂ 1Â ï¼Œæˆ–è€…å°†Â 1Â å˜æˆÂ 0Â ã€‚<br>æ¯”æ–¹è¯´ï¼Œx = 7Â ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºä¸ºÂ 111Â ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªä½ï¼ˆåŒ…å«æ²¡æœ‰æ˜¾ç¤ºçš„å‰å¯¼ 0 ï¼‰å¹¶è¿›è¡Œç¿»è½¬ã€‚æ¯”æ–¹è¯´æˆ‘ä»¬å¯ä»¥ç¿»è½¬æœ€å³è¾¹ä¸€ä½å¾—åˆ°Â 110Â ï¼Œæˆ–è€…ç¿»è½¬å³è¾¹èµ·ç¬¬äºŒä½å¾—åˆ°Â 101Â ï¼Œæˆ–è€…ç¿»è½¬å³è¾¹èµ·ç¬¬äº”ä½ï¼ˆè¿™ä¸€ä½æ˜¯å‰å¯¼ 0 ï¼‰å¾—åˆ°Â 10111Â ç­‰ç­‰ã€‚<br>ç»™ä½ ä¸¤ä¸ªæ•´æ•°Â start å’ŒÂ goalÂ ï¼Œè¯·ä½ è¿”å›å°†Â startÂ è½¬å˜æˆÂ goalÂ çš„Â æœ€å°‘ä½ç¿»è½¬Â æ¬¡æ•°ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šstart &#x3D; 10, goal &#x3D; 7</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š10 å’Œ 7 çš„äºŒè¿›åˆ¶è¡¨ç¤ºåˆ†åˆ«ä¸º 1010 å’Œ 0111 ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ 3 æ­¥å°† 10 è½¬å˜æˆ 7 ï¼š</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬ä¸€ä½å¾—åˆ°ï¼š1010 -&gt; 1011 ã€‚</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬ä¸‰ä½ï¼š1011 -&gt; 1111 ã€‚</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬å››ä½ï¼š1111 -&gt; 0111 ã€‚</span><br><span class="line">æˆ‘ä»¬æ— æ³•åœ¨ 3 æ­¥å†…å°† 10 è½¬å˜æˆ 7 ã€‚æ‰€ä»¥æˆ‘ä»¬è¿”å› 3 ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šstart &#x3D; 3, goal &#x3D; 4</span><br><span class="line">è¾“å‡ºï¼š3</span><br><span class="line">è§£é‡Šï¼š3 å’Œ 4 çš„äºŒè¿›åˆ¶è¡¨ç¤ºåˆ†åˆ«ä¸º 011 å’Œ 100 ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ 3 æ­¥å°† 3 è½¬å˜æˆ 4 ï¼š</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬ä¸€ä½ï¼š011 -&gt; 010 ã€‚</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬äºŒä½ï¼š010 -&gt; 000 ã€‚</span><br><span class="line">- ç¿»è½¬å³è¾¹èµ·ç¬¬ä¸‰ä½ï¼š000 -&gt; 100 ã€‚</span><br><span class="line">æˆ‘ä»¬æ— æ³•åœ¨ 3 æ­¥å†…å°† 3 å˜æˆ 4 ã€‚æ‰€ä»¥æˆ‘ä»¬è¿”å› 3 ã€‚</span><br><span class="line">Â </span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">0 &lt;&#x3D; start, goal &lt;&#x3D; 109</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æœ¬è´¨ä¸Šæ˜¯åˆ¤æ–­ä¸¤ä¸ªæ•°æœ‰å¤šå°‘ä¸ªæ¯”ç‰¹ä½å€¼æ˜¯ä¸ä¸€æ ·çš„ï¼ˆåŒ…å«å‰å¯¼é›¶ï¼‰ï¼›<br>(2). é‚£å°±ä»æœ€åä¸€ä¸ªæ¯”ç‰¹ä½å¼€å§‹å¾€å‰æ¯”è¾ƒå°±å¥½äº†ã€‚</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minBitFlips</span><span class="params">(start <span class="keyword">int</span>, goal <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">count := <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> judgeLastBit <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">int</span>)</span> <span class="title">bool</span></span></span><br><span class="line">judgeLastBit = <span class="function"><span class="keyword">func</span><span class="params">(x <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> x == <span class="number">0</span> || x^(x<span class="number">-1</span>) != <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> start &gt; <span class="number">0</span> || goal &gt; <span class="number">0</span> &#123;</span><br><span class="line">x1 := judgeLastBit(start)</span><br><span class="line">x2 := judgeLastBit(goal)</span><br><span class="line"><span class="keyword">if</span> (x1 &amp;&amp; !x2) || (!x1 &amp;&amp; x2) &#123;</span><br><span class="line">count++</span><br><span class="line">&#125;</span><br><span class="line">start &gt;&gt;= <span class="number">1</span></span><br><span class="line">goal &gt;&gt;= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode6034-æ•°ç»„çš„ä¸‰è§’å’Œ"><a href="#LeetCode6034-æ•°ç»„çš„ä¸‰è§’å’Œ" class="headerlink" title="LeetCode6034. æ•°ç»„çš„ä¸‰è§’å’Œ"></a><a class="link" href="https://leetcode-cn.com/problems/find-triangular-sum-of-an-array/">LeetCode6034. æ•°ç»„çš„ä¸‰è§’å’Œ<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0Â å¼€å§‹çš„æ•´æ•°æ•°ç»„Â numsÂ ï¼Œå…¶ä¸­Â nums[i]Â æ˜¯ 0Â åˆ° 9Â ä¹‹é—´ï¼ˆä¸¤è€…éƒ½åŒ…å«ï¼‰çš„ä¸€ä¸ªæ•°å­—ã€‚<br>numsÂ çš„ ä¸‰è§’å’ŒÂ æ˜¯æ‰§è¡Œä»¥ä¸‹æ“ä½œä»¥åæœ€åå‰©ä¸‹å…ƒç´ çš„å€¼ï¼š<br>1.numsÂ åˆå§‹åŒ…å«Â nÂ ä¸ªå…ƒç´ ã€‚å¦‚æœÂ n == 1Â ï¼Œç»ˆæ­¢Â æ“ä½œã€‚å¦åˆ™ï¼Œåˆ›å»ºÂ ä¸€ä¸ªæ–°çš„ä¸‹æ ‡ä»Â 0Â å¼€å§‹çš„é•¿åº¦ä¸º n - 1Â çš„æ•´æ•°æ•°ç»„Â newNumsÂ ã€‚<br>2.å¯¹äºæ»¡è¶³Â 0 &lt;= i &lt;Â n - 1Â çš„ä¸‹æ ‡Â iÂ ï¼ŒnewNums[i] èµ‹å€¼Â ä¸ºÂ (nums[i] + nums[i+1]) % 10Â ï¼Œ%Â è¡¨ç¤ºå–ä½™è¿ç®—ã€‚<br>3.å°†Â newNumsÂ æ›¿æ¢ æ•°ç»„Â numsÂ ã€‚<br>4.ä»æ­¥éª¤ 1 å¼€å§‹Â é‡å¤Â æ•´ä¸ªè¿‡ç¨‹ã€‚<br>5.è¯·ä½ è¿”å›Â numsÂ çš„ä¸‰è§’å’Œã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="ex1drawio.png" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4,5]</span><br><span class="line">è¾“å‡ºï¼š8</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ä¸Šå›¾å±•ç¤ºäº†å¾—åˆ°æ•°ç»„ä¸‰è§’å’Œçš„è¿‡ç¨‹ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [5]</span><br><span class="line">è¾“å‡ºï¼š5</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç”±äº nums ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ•°ç»„çš„ä¸‰è§’å’Œä¸ºè¿™ä¸ªå…ƒç´ è‡ªå·±ã€‚</span><br><span class="line">Â </span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;&#x3D; nums.length &lt;&#x3D; 1000</span><br><span class="line">0 &lt;&#x3D; nums[i] &lt;&#x3D; 9</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å¤ªç®€å•äº†ã€‚ã€‚æ²¡å•¥å¥½è¯´çš„</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">triangularSum</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(nums) &gt; <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums)<span class="number">-1</span>; i++ &#123;</span><br><span class="line">nums[i] += nums[i+<span class="number">1</span>]</span><br><span class="line">nums[i] %= <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line">nums = nums[:<span class="built_in">len</span>(nums)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> nums[<span class="number">0</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode6035-é€‰æ‹©å»ºç­‘çš„æ–¹æ¡ˆæ•°"><a href="#LeetCode6035-é€‰æ‹©å»ºç­‘çš„æ–¹æ¡ˆæ•°" class="headerlink" title="LeetCode6035. é€‰æ‹©å»ºç­‘çš„æ–¹æ¡ˆæ•°"></a><a class="link" href="https://leetcode-cn.com/problems/number-of-ways-to-select-buildings/">LeetCode6035. é€‰æ‹©å»ºç­‘çš„æ–¹æ¡ˆæ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#åŠ¨æ€è§„åˆ’</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» 0Â å¼€å§‹çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²Â sÂ ï¼Œå®ƒè¡¨ç¤ºä¸€æ¡è¡—æ²¿é€”çš„å»ºç­‘ç±»å‹ï¼Œå…¶ä¸­ï¼š<br>s[i] = â€˜0â€™Â è¡¨ç¤ºç¬¬Â iÂ æ ‹å»ºç­‘æ˜¯ä¸€æ ‹åŠå…¬æ¥¼ï¼Œ<br>s[i] = â€˜1â€™Â è¡¨ç¤ºç¬¬Â iÂ æ ‹å»ºç­‘æ˜¯ä¸€é—´é¤å…ã€‚<br>ä½œä¸ºå¸‚æ”¿å…çš„å®˜å‘˜ï¼Œä½ éœ€è¦éšæœºÂ é€‰æ‹©Â 3 æ ‹å»ºç­‘ã€‚ç„¶è€Œï¼Œä¸ºäº†ç¡®ä¿å¤šæ ·æ€§ï¼Œé€‰å‡ºæ¥çš„ 3 æ ‹å»ºç­‘ ç›¸é‚»Â çš„ä¸¤æ ‹ä¸èƒ½æ˜¯åŒä¸€ç±»å‹ã€‚<br>æ¯”æ–¹è¯´ï¼Œç»™ä½ Â s = â€œ001101â€Â ï¼Œæˆ‘ä»¬ä¸èƒ½é€‰æ‹©ç¬¬Â 1Â ï¼Œ3Â å’ŒÂ 5Â æ ‹å»ºç­‘ï¼Œå› ä¸ºå¾—åˆ°çš„å­åºåˆ—æ˜¯Â â€œ011â€Â ï¼Œæœ‰ç›¸é‚»ä¸¤æ ‹å»ºç­‘æ˜¯åŒä¸€ç±»å‹ï¼Œæ‰€ä»¥ ä¸åˆÂ é¢˜æ„ã€‚<br>è¯·ä½ è¿”å›å¯ä»¥é€‰æ‹© 3 æ ‹å»ºç­‘çš„ æœ‰æ•ˆæ–¹æ¡ˆæ•°Â ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;001101&quot;</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ä»¥ä¸‹ä¸‹æ ‡é›†åˆæ˜¯åˆæ³•çš„ï¼š</span><br><span class="line">- [0,2,4] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;010&quot;</span><br><span class="line">- [0,3,4] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;010&quot;</span><br><span class="line">- [1,2,4] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;010&quot;</span><br><span class="line">- [1,3,4] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;010&quot;</span><br><span class="line">- [2,4,5] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;101&quot;</span><br><span class="line">- [3,4,5] ï¼Œä» &quot;001101&quot; å¾—åˆ° &quot;101&quot;</span><br><span class="line">æ²¡æœ‰åˆ«çš„åˆæ³•é€‰æ‹©ï¼Œæ‰€ä»¥æ€»å…±æœ‰ 6 ç§æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;11100&quot;</span><br><span class="line">è¾“å‡ºï¼š0</span><br><span class="line">è§£é‡Šï¼šæ²¡æœ‰ä»»ä½•ç¬¦åˆé¢˜æ„çš„é€‰æ‹©ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">3 &lt;&#x3D; s.length &lt;&#x3D; 105</span><br><span class="line">s[i]Â è¦ä¹ˆæ˜¯Â &#39;0&#39;Â ï¼Œè¦ä¹ˆæ˜¯Â &#39;1&#39;Â ã€‚</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>æ–¹æ³•ä¸€ï¼šæš´åŠ›é€’å½’æœç´¢ï¼ˆè¶…æ—¶ï¼‰<br>(1). ç±»ä¼¼ç»„åˆæ•°è¿™ç§ç±»å‹çš„é¢˜ç›®ï¼Œä¸è¿‡è¦åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ç¬¦åˆæœ€ç»ˆåˆæ³•çš„çº¦å®šï¼›<br>(2). å½“å­—ç¬¦ä¸²å‰©ä¸‹çš„é•¿åº¦ä¸è¶³ä»¥æ»¡è¶³è¦æ±‚ï¼Œå‰ªæã€‚ï¼ˆå®é™…ä¸Šè¿™ä¸ªä¼˜åŒ–å¹¶æ²¡ä»€ä¹ˆç”¨ï¼Œå› ä¸ºå‰ªæçš„é•¿åº¦æœ€å¤§ä¹Ÿå°± 3ï¼Œæ ¹æœ¬ä¸å½±å“æœ€ç»ˆçš„å¤æ‚åº¦ï¼‰</p><p>æ–¹æ³•äºŒï¼šç»Ÿè®¡å‰ç¼€æ•°é‡ï¼ˆO(N)ï¼‰<br>åˆ†åˆ«å®šä¹‰ 5 ä¸ªå˜é‡ï¼Œ<code>n1</code> ä»£è¡¨å‰ç¼€ä¸º 1 çš„å­åºåˆ—æ•°é‡ï¼Œ<code>n0</code> ä»£è¡¨å‰ç¼€ä¸º 0 çš„å­åºåˆ—æ•°é‡ï¼Œ<code>n01</code> ä»£è¡¨å‰ç¼€ä¸º 01 çš„å­åºåˆ—æ•°é‡,<code>n10</code> ä»£è¡¨å‰ç¼€ä¸º 10 çš„å­åºåˆ—æ•°é‡ï¼Œ<code>count</code>åˆ™æ˜¯ç»Ÿè®¡åˆæ³•çš„å­åºåˆ—æ•°é‡ï¼ˆ<code>010</code> + <code>101</code>ï¼‰</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberOfWays</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count <span class="keyword">int64</span></span><br><span class="line">path := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> backTracking <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span>, rest <span class="keyword">int</span>)</span></span></span><br><span class="line">backTracking = <span class="function"><span class="keyword">func</span><span class="params">(start <span class="keyword">int</span> ,rest <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rest == <span class="number">0</span> &#123;</span><br><span class="line">count++</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=start; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> rest &gt; <span class="built_in">len</span>(s[start:]) &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(path) == <span class="number">0</span> &#123;</span><br><span class="line">path = <span class="built_in">append</span>(path, s[i])</span><br><span class="line">backTracking(i+<span class="number">1</span>, rest<span class="number">-1</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] != path[<span class="built_in">len</span>(path)<span class="number">-1</span>] &#123;</span><br><span class="line">path = <span class="built_in">append</span>(path, s[i])</span><br><span class="line">backTracking(i+<span class="number">1</span>, rest<span class="number">-1</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(path) &gt; <span class="number">0</span> &#123;</span><br><span class="line">path = path[:<span class="built_in">len</span>(path)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">backTracking(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">numberOfWays</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int64</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count <span class="keyword">int64</span></span><br><span class="line"><span class="keyword">var</span> n0, n1, n01, n10 <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> s[i] == <span class="string">&#x27;1&#x27;</span> &#123;</span><br><span class="line">n01 += n0</span><br><span class="line">n1++</span><br><span class="line">count += n10</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">n10 += n1</span><br><span class="line">n0++</span><br><span class="line">count += n01</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»Šå¤©æ—©ä¸Šå¤ç›˜ä¸€ä¸‹æ˜¨å¤©æ™šä¸Šçš„åŒå‘¨èµ›&lt;/p&gt;
&lt;h2 id=&quot;LeetCode6033-è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°&quot;&gt;&lt;a href=&quot;#LeetCode6033-è½¬æ¢æ•°å­—çš„æœ€å°‘ä½ç¿»è½¬æ¬¡æ•°&quot; class=&quot;headerlink&quot; title=&quot;LeetCode6033. è½¬æ¢æ•°å­—</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 4ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/02/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%204%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/02/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%204%EF%BC%89/</id>
    <published>2022-04-01T22:00:00.000Z</published>
    <updated>2022-04-08T00:12:46.406Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode856-æ‹¬å·çš„åˆ†æ•°"><a href="#LeetCode856-æ‹¬å·çš„åˆ†æ•°" class="headerlink" title="LeetCode856. æ‹¬å·çš„åˆ†æ•°"></a><a class="link" href="https://leetcode-cn.com/problems/score-of-parentheses/">LeetCode856. æ‹¬å·çš„åˆ†æ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#é€’å½’ #æ ˆ</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªå¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²Â Sï¼ŒæŒ‰ä¸‹è¿°è§„åˆ™è®¡ç®—è¯¥å­—ç¬¦ä¸²çš„åˆ†æ•°ï¼š<br>() å¾— 1 åˆ†ã€‚<br>AB å¾—Â A + BÂ åˆ†ï¼Œå…¶ä¸­ A å’Œ B æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚<br>(A) å¾—Â 2 * AÂ åˆ†ï¼Œå…¶ä¸­ A æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼š&quot;()&quot;</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼š&quot;(())&quot;</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹Â 3ï¼š</span><br><span class="line">è¾“å…¥ï¼š&quot;()()&quot;</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹Â 4ï¼š</span><br><span class="line">è¾“å…¥ï¼š&quot;(()(()))&quot;</span><br><span class="line">è¾“å‡ºï¼š6</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1. SÂ æ˜¯å¹³è¡¡æ‹¬å·å­—ç¬¦ä¸²ï¼Œä¸”åªå«æœ‰Â (Â å’ŒÂ )Â ã€‚</span><br><span class="line">2. 2 &lt;&#x3D; S.length &lt;&#x3D; 50</span><br></pre></td></tr></table></figure><p>Â </p><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p> (1). è€ƒè™‘é‡‡ç”¨é€’å½’ + æ ˆæ¥è§£é¢˜ã€‚æ‹¬å·é—®é¢˜é¦–å…ˆå¤©ç„¶å°±ä¼šæƒ³åˆ°ä½¿ç”¨æ ˆï¼Œç”±äºæœ¬é¢˜ä¸éœ€è¦è€ƒè™‘æ‹¬å·å­—ç¬¦ä¸²çš„åˆæ³•æ€§ï¼Œæ‰€ä»¥æ ˆå¯ä»¥å½“ä½œä¸€ä¸ªçŠ¶æ€çš„ä¿å­˜ï¼Œåœ¨æ ˆå†…éƒ¨è¿›è¡Œé€’å½’ï¼›<br> (2). å¯¹äºåµŒå¥—çš„æ‹¬å·ï¼Œé‡‡ç”¨é€’å½’çš„ç­–ç•¥ï¼Œå‡ºé€’å½’å‰å°†é€’å½’æ ˆä¸­åˆ†æ•°*2 å³å¯ï¼›<br> (3). æ³¨æ„éå†å­—ç¬¦ä¸²è¦ä½¿ç”¨æŒ‡é’ˆä»¥åŠå‡ºé€’å½’çš„æ¡ä»¶ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p> O(N).</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">scoreOfParentheses</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> scoreCount <span class="function"><span class="keyword">func</span><span class="params">(start *<span class="keyword">int</span>)</span> <span class="title">int</span></span></span><br><span class="line">scoreCount = <span class="function"><span class="keyword">func</span><span class="params">(start *<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">ss := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line">sc := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ; *start&lt;<span class="built_in">len</span>(s); (*start)++ &#123;</span><br><span class="line">i := *start</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(ss) == <span class="number">0</span> &amp;&amp; s[i] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">ss = <span class="built_in">append</span>(ss, <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &amp;&amp; <span class="built_in">len</span>(ss) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &amp;&amp; ss[<span class="built_in">len</span>(ss)<span class="number">-1</span>] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">sc++</span><br><span class="line">ss = ss[:<span class="built_in">len</span>(ss)<span class="number">-1</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;(&#x27;</span> &amp;&amp; <span class="built_in">len</span>(ss) != <span class="number">0</span> &#123;</span><br><span class="line">sc += <span class="number">2</span>*scoreCount(start)</span><br><span class="line">ss = ss[:<span class="built_in">len</span>(ss)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">score := <span class="number">0</span></span><br><span class="line">stack := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(stack) == <span class="number">0</span> &#123;</span><br><span class="line">stack = <span class="built_in">append</span>(stack, <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> s[i] == <span class="string">&#x27;)&#x27;</span> &amp;&amp; stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>] == <span class="string">&#x27;(&#x27;</span> &#123;</span><br><span class="line">stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">score++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">score += <span class="number">2</span>*scoreCount(&amp;i)</span><br><span class="line">stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> score</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="23-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨"><a href="#23-åˆå¹¶Kä¸ªå‡åºé“¾è¡¨" class="headerlink" title="23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨"></a><a class="link" href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">23. åˆå¹¶Kä¸ªå‡åºé“¾è¡¨<i class="fas fa-external-link-alt"></i></a></h2><p>#ä¼˜å…ˆé˜Ÿåˆ—</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨æ•°ç»„ï¼Œæ¯ä¸ªé“¾è¡¨éƒ½å·²ç»æŒ‰å‡åºæ’åˆ—ã€‚<br>è¯·ä½ å°†æ‰€æœ‰é“¾è¡¨åˆå¹¶åˆ°ä¸€ä¸ªå‡åºé“¾è¡¨ä¸­ï¼Œè¿”å›åˆå¹¶åçš„é“¾è¡¨ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šlists &#x3D; [[1,4,5],[1,3,4],[2,6]]</span><br><span class="line">è¾“å‡ºï¼š[1,1,2,3,4,4,5,6]</span><br><span class="line">è§£é‡Šï¼šé“¾è¡¨æ•°ç»„å¦‚ä¸‹ï¼š</span><br><span class="line">[</span><br><span class="line">  1-&gt;4-&gt;5,</span><br><span class="line">  1-&gt;3-&gt;4,</span><br><span class="line">  2-&gt;6</span><br><span class="line">]</span><br><span class="line">å°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ªæœ‰åºé“¾è¡¨ä¸­å¾—åˆ°ã€‚</span><br><span class="line">1-&gt;1-&gt;2-&gt;3-&gt;4-&gt;4-&gt;5-&gt;6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šlists &#x3D; []</span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line">è¾“å…¥ï¼šlists &#x3D; [[]]</span><br><span class="line">è¾“å‡ºï¼š[]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">k &#x3D;&#x3D; lists.length</span><br><span class="line">0 &lt;&#x3D; k &lt;&#x3D; 10^4</span><br><span class="line">0 &lt;&#x3D; lists[i].length &lt;&#x3D; 500</span><br><span class="line">-10^4 &lt;&#x3D; lists[i][j] &lt;&#x3D; 10^4</span><br><span class="line">lists[i] æŒ‰ å‡åº æ’åˆ—</span><br><span class="line">lists[i].length çš„æ€»å’Œä¸è¶…è¿‡ 10^4</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>ä¼˜å…ˆé˜Ÿåˆ—ï¼Œç›´æ¥çœ‹ä»£ç å§</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(Nlog(N))ï¼Œå–å†³äºå †æ’åºçš„æ—¶é—´å¤æ‚åº¦</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Val int</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Next *ListNode</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;container/heap&quot;</span></span><br><span class="line"><span class="keyword">type</span> IntHeap []<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> a []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">len</span>(h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Less</span><span class="params">(i,j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a[h[i]]&lt;a[h[j]]</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h IntHeap)</span> <span class="title">Swap</span><span class="params">(i,j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">h[i], h[j] = h[j], h[i]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *IntHeap)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">*h = <span class="built_in">append</span>(*h, x.(<span class="keyword">int</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *IntHeap)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">old := *h</span><br><span class="line">n := <span class="built_in">len</span>(*h)</span><br><span class="line">x := old[n<span class="number">-1</span>]</span><br><span class="line">*h = old[:n<span class="number">-1</span>]</span><br><span class="line"><span class="keyword">return</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mergeKLists</span><span class="params">(lists []*ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">l := <span class="built_in">len</span>(lists)</span><br><span class="line"><span class="keyword">if</span> l == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> h IntHeap</span><br><span class="line">a = <span class="built_in">make</span>([]<span class="keyword">int</span>, l)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;l; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> lists[i] == <span class="literal">nil</span> &#123;</span><br><span class="line">a[i] = <span class="number">-1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">a[i] = lists[i].Val</span><br><span class="line">heap.Push(&amp;h, i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(h) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">first := heap.Pop(&amp;h).(<span class="keyword">int</span>)</span><br><span class="line">head := lists[first]</span><br><span class="line">a[first] = math.MaxInt32</span><br><span class="line">p := head</span><br><span class="line">lists[first] = head.Next</span><br><span class="line">p.Next = <span class="literal">nil</span></span><br><span class="line"><span class="keyword">if</span> lists[first] != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸¤è¡Œæ³¨æ„é¡ºåºä¸èƒ½åäº†ï¼Œå…ˆæ›´æ”¹ aï¼Œæ‰èƒ½æ’åº</span></span><br><span class="line">a[first] = lists[first].Val</span><br><span class="line">heap.Push(&amp;h, first)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(h) &gt; <span class="number">0</span> &#123;</span><br><span class="line">i := heap.Pop(&amp;h).(<span class="keyword">int</span>)</span><br><span class="line">a[i] = math.MaxInt32</span><br><span class="line">p.Next = lists[i]</span><br><span class="line">p = p.Next</span><br><span class="line">lists[i] = lists[i].Next</span><br><span class="line"><span class="keyword">if</span> lists[i] != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸¤è¡Œæ³¨æ„é¡ºåºä¸èƒ½åäº†ï¼Œå…ˆæ›´æ”¹ aï¼Œæ‰èƒ½æ’åº</span></span><br><span class="line">a[i] = lists[i].Val</span><br><span class="line">heap.Push(&amp;h, i)</span><br><span class="line">&#125;</span><br><span class="line">p.Next = <span class="literal">nil</span></span><br><span class="line"><span class="comment">// fmt.Println(a,h,x,i)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode856-æ‹¬å·çš„åˆ†æ•°&quot;&gt;&lt;a href=&quot;#LeetCode856-æ‹¬å·çš„åˆ†æ•°&quot; class=&quot;headerlink&quot; title=&quot;LeetCode856. æ‹¬å·çš„åˆ†æ•°&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;https://leet</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 3ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/04/01/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%203%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/04/01/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%203%EF%BC%89/</id>
    <published>2022-03-31T21:30:00.000Z</published>
    <updated>2022-04-08T00:14:45.094Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode269-ç«æ˜Ÿè¯å…¸"><a href="#LeetCode269-ç«æ˜Ÿè¯å…¸" class="headerlink" title="LeetCode269. ç«æ˜Ÿè¯å…¸"></a><a class="link" href="https://leetcode-cn.com/problems/alien-dictionary/">LeetCode269. ç«æ˜Ÿè¯å…¸<i class="fas fa-external-link-alt"></i></a></h2><p>#æ‹“æ‰‘æ’åº</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç°æœ‰ä¸€ç§ä½¿ç”¨è‹±è¯­å­—æ¯çš„ç«æ˜Ÿè¯­è¨€ï¼Œè¿™é—¨è¯­è¨€çš„å­—æ¯é¡ºåºä¸è‹±è¯­é¡ºåºä¸åŒã€‚ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ words ï¼Œä½œä¸ºè¿™é—¨è¯­è¨€çš„è¯å…¸ï¼Œwords ä¸­çš„å­—ç¬¦ä¸²å·²ç» æŒ‰è¿™é—¨æ–°è¯­è¨€çš„å­—æ¯é¡ºåºè¿›è¡Œäº†æ’åº ã€‚è¯·ä½ æ ¹æ®è¯¥è¯å…¸è¿˜åŸå‡ºæ­¤è¯­è¨€ä¸­å·²çŸ¥çš„å­—æ¯é¡ºåºï¼Œå¹¶ æŒ‰å­—æ¯é€’å¢é¡ºåº æ’åˆ—ã€‚è‹¥ä¸å­˜åœ¨åˆæ³•å­—æ¯é¡ºåºï¼Œè¿”å› â€œâ€ ã€‚è‹¥å­˜åœ¨å¤šç§å¯èƒ½çš„åˆæ³•å­—æ¯é¡ºåºï¼Œè¿”å›å…¶ä¸­ ä»»æ„ä¸€ç§ é¡ºåºå³å¯ã€‚<br>å­—ç¬¦ä¸² s å­—å…¸é¡ºåºå°äº å­—ç¬¦ä¸² t æœ‰ä¸¤ç§æƒ…å†µï¼š<br>1.åœ¨ç¬¬ä¸€ä¸ªä¸åŒå­—æ¯å¤„ï¼Œå¦‚æœ s ä¸­çš„å­—æ¯åœ¨è¿™é—¨å¤–æ˜Ÿè¯­è¨€çš„å­—æ¯é¡ºåºä¸­ä½äº t ä¸­å­—æ¯ä¹‹å‰ï¼Œé‚£ä¹ˆÂ s çš„å­—å…¸é¡ºåºå°äº t ã€‚<br>2.å¦‚æœå‰é¢ min(s.length, t.length) å­—æ¯éƒ½ç›¸åŒï¼Œé‚£ä¹ˆ s.length &lt; t.length æ—¶ï¼Œs çš„å­—å…¸é¡ºåºä¹Ÿå°äº t ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼šwords &#x3D; [&quot;wrt&quot;,&quot;wrf&quot;,&quot;er&quot;,&quot;ett&quot;,&quot;rftt&quot;]</span><br><span class="line">è¾“å‡ºï¼š&quot;wertf&quot;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šwords &#x3D; [&quot;z&quot;,&quot;x&quot;]</span><br><span class="line">è¾“å‡ºï¼š&quot;zx&quot;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3:</span><br><span class="line">è¾“å…¥ï¼šwords &#x3D; [&quot;z&quot;,&quot;x&quot;,&quot;z&quot;]</span><br><span class="line">è¾“å‡ºï¼š&quot;&quot;</span><br><span class="line">è§£é‡Šï¼šä¸å­˜åœ¨åˆæ³•å­—æ¯é¡ºåºï¼Œå› æ­¤è¿”å› &quot;&quot; ã€‚</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆè€ƒè™‘ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°ä¸åˆæ³•çš„æƒ…å†µï¼šå¦‚æœåœ¨ä¹‹å‰åˆ¤æ–­å­—æ¯ â€˜xâ€™ çš„å­—å…¸åºåº”è¯¥å¤§äº â€˜yâ€™ï¼Œå¯æ˜¯åœ¨åé¢åˆå‡ºç°äº† â€˜yâ€™ çš„å­—å…¸åºåº”è¯¥å¤§äº â€˜xâ€™ çš„æƒ…å†µï¼Œé‚£ä¹ˆæ­¤æ—¶å°±å‡ºç°äº†çŸ›ç›¾ï¼Œå› æ­¤æ˜¯ä¸åˆæ³•çš„ï¼›<br>(2). å¯¹äºè¿™ç§åªå…è®¸å•å‘ä¾èµ–çš„æƒ…å†µï¼Œè€ƒè™‘ä½¿ç”¨æ‹“æ‰‘æ’åºã€‚é¦–å…ˆå°±è¦æ„å»ºé‚»æ¥è¡¨å’Œå…¥åº¦ç»Ÿè®¡ã€‚åœ¨å»ºç«‹é‚»æ¥è¡¨çš„æ—¶å€™è¦è€ƒè™‘ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯å¦‚æœå‡ºç°åœ¨åé¢çš„å­—ç¬¦ä¸²æ˜¯å‰é¢å­—ç¬¦ä¸²çš„å‰ç¼€å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥ç«‹å³åˆ¤å®šæ˜¯ä¸åˆæ³•çš„ï¼›<br>(3). åœ¨æ„å»ºå¥½ä¸¤ä¸ªæ•°æ®ç»“æ„åï¼Œä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢æŸ¥æ‰¾ã€‚å°†å…¥åº¦ä¸º 0 çš„å­—æ¯æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†å°†å…¶å¯¹åº”çš„é‚»æ¥è¡¨ä¸­çš„å­—æ¯å…¥åº¦å‡ä¸€ï¼Œæ­¤æ—¶ç›¸å½“äºåœ¨æ‹“æ‰‘æ’åºä¸­æ¶ˆé™¤äº†å¯¹è¯¥å­—æ¯çš„ä¾èµ–ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œè®¿é—®æ•° <code>visited</code> åŠ  1ï¼›<br>(4). æœ€ååˆ¤æ–­ä¸€ä¸‹ <code>visited</code> æ˜¯å¦æ˜¯å…¨ä½“å‡ºç°è¿‡çš„å­—æ¯æ•°ï¼Œç›¸ç­‰åˆ™è¯´æ˜æ˜¯ä¸€ä¸ªæ‹“æ‰‘æ’åºï¼Œä¸å­˜åœ¨å¾ªç¯ä¾èµ–ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(words.length*words[i].length)</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">alienOrder</span><span class="params">(words []<span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">adjacency := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">byte</span>][]<span class="keyword">byte</span>) <span class="comment">// é‚»æ¥è¡¨</span></span><br><span class="line">inDegree := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">byte</span>]<span class="keyword">int</span>)<span class="comment">// å…¥åº¦ç»Ÿè®¡</span></span><br><span class="line">ret := <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buildGraph <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">bool</span></span></span><br><span class="line">buildGraph = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(words); i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>; j&lt;<span class="built_in">len</span>(words[i]); j++ &#123;</span><br><span class="line">adjacency[words[i][j]] = []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(words); i++ &#123;</span><br><span class="line">w1, w2 := words[i<span class="number">-1</span>], words[i]</span><br><span class="line">j := <span class="number">0</span></span><br><span class="line">minLength := min(<span class="built_in">len</span>(w1),<span class="built_in">len</span>(w2))</span><br><span class="line"><span class="keyword">for</span> ; j&lt;minLength; j++ &#123;</span><br><span class="line"><span class="keyword">if</span> w1[j] != w2[j] &#123;</span><br><span class="line">adjacency[w1[j]] = <span class="built_in">append</span>(adjacency[w1[j]], w2[j])</span><br><span class="line">inDegree[w2[j]]++</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> j == minLength &amp;&amp; <span class="built_in">len</span>(w1) &gt; <span class="built_in">len</span>(w2) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> visitedCount <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span></span><br><span class="line">visitedCount = <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">visited := <span class="number">0</span></span><br><span class="line">q := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,_ := <span class="keyword">range</span> adjacency &#123;</span><br><span class="line"><span class="keyword">if</span> inDegree[k] == <span class="number">0</span> &#123;</span><br><span class="line">q = <span class="built_in">append</span>(q, k)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(q) &gt; <span class="number">0</span> &#123;</span><br><span class="line">p := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(q); i++ &#123;</span><br><span class="line">w := q[i]</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>; j&lt;<span class="built_in">len</span>(adjacency[w]); j++ &#123;</span><br><span class="line">x := adjacency[w][j]</span><br><span class="line">inDegree[x]--</span><br><span class="line"><span class="keyword">if</span> inDegree[x] == <span class="number">0</span> &#123;</span><br><span class="line">p = <span class="built_in">append</span>(p, x)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">visited++</span><br><span class="line">&#125;</span><br><span class="line">ret += <span class="keyword">string</span>(q)</span><br><span class="line">q = p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> visited</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !buildGraph() || visitedCount() != <span class="built_in">len</span>(adjacency) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a,b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &lt; b &#123;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°-atoi"><a href="#LeetCode8-å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°-atoi" class="headerlink" title="LeetCode8. å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)"></a><a class="link" href="https://leetcode-cn.com/problems/string-to-integer-atoi/">LeetCode8. å­—ç¬¦ä¸²è½¬æ¢æ•´æ•° (atoi)<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>è¯·ä½ æ¥å®ç°ä¸€ä¸ªÂ myAtoi(string s)Â å‡½æ•°ï¼Œä½¿å…¶èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ª 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆç±»ä¼¼ C/C++ ä¸­çš„ atoi å‡½æ•°ï¼‰ã€‚<br>å‡½æ•°Â myAtoi(string s) çš„ç®—æ³•å¦‚ä¸‹ï¼š<br>1.è¯»å…¥å­—ç¬¦ä¸²å¹¶ä¸¢å¼ƒæ— ç”¨çš„å‰å¯¼ç©ºæ ¼<br>2.æ£€æŸ¥ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼ˆå‡è®¾è¿˜æœªåˆ°å­—ç¬¦æœ«å°¾ï¼‰ä¸ºæ­£è¿˜æ˜¯è´Ÿå·ï¼Œè¯»å–è¯¥å­—ç¬¦ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚ ç¡®å®šæœ€ç»ˆç»“æœæ˜¯è´Ÿæ•°è¿˜æ˜¯æ­£æ•°ã€‚ å¦‚æœä¸¤è€…éƒ½ä¸å­˜åœ¨ï¼Œåˆ™å‡å®šç»“æœä¸ºæ­£ã€‚<br>3.è¯»å…¥ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œç›´åˆ°åˆ°è¾¾ä¸‹ä¸€ä¸ªéæ•°å­—å­—ç¬¦æˆ–åˆ°è¾¾è¾“å…¥çš„ç»“å°¾ã€‚å­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†å°†è¢«å¿½ç•¥ã€‚<br>4.å°†å‰é¢æ­¥éª¤è¯»å…¥çš„è¿™äº›æ•°å­—è½¬æ¢ä¸ºæ•´æ•°ï¼ˆå³ï¼Œâ€123â€ -&gt; 123ï¼Œ â€œ0032â€ -&gt; 32ï¼‰ã€‚å¦‚æœæ²¡æœ‰è¯»å…¥æ•°å­—ï¼Œåˆ™æ•´æ•°ä¸º 0 ã€‚å¿…è¦æ—¶æ›´æ”¹ç¬¦å·ï¼ˆä»æ­¥éª¤ 2 å¼€å§‹ï¼‰ã€‚<br>5.å¦‚æœæ•´æ•°æ•°è¶…è¿‡ 32 ä½æœ‰ç¬¦å·æ•´æ•°èŒƒå›´ [âˆ’231,Â  231Â âˆ’ 1] ï¼Œéœ€è¦æˆªæ–­è¿™ä¸ªæ•´æ•°ï¼Œä½¿å…¶ä¿æŒåœ¨è¿™ä¸ªèŒƒå›´å†…ã€‚å…·ä½“æ¥è¯´ï¼Œå°äº âˆ’231 çš„æ•´æ•°åº”è¯¥è¢«å›ºå®šä¸º âˆ’231 ï¼Œå¤§äº 231Â âˆ’ 1 çš„æ•´æ•°åº”è¯¥è¢«å›ºå®šä¸º 231Â âˆ’ 1 ã€‚<br>6.è¿”å›æ•´æ•°ä½œä¸ºæœ€ç»ˆç»“æœã€‚</p></blockquote><blockquote><p>æ³¨æ„ï¼š<br>æœ¬é¢˜ä¸­çš„ç©ºç™½å­—ç¬¦åªåŒ…æ‹¬ç©ºæ ¼å­—ç¬¦ â€˜ â€˜ ã€‚<br>é™¤å‰å¯¼ç©ºæ ¼æˆ–æ•°å­—åçš„å…¶ä½™å­—ç¬¦ä¸²å¤–ï¼Œ<strong>è¯·å‹¿å¿½ç•¥</strong> ä»»ä½•å…¶ä»–å­—ç¬¦ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;42&quot;</span><br><span class="line">è¾“å‡ºï¼š42</span><br><span class="line">è§£é‡Šï¼šåŠ ç²—çš„å­—ç¬¦ä¸²ä¸ºå·²ç»è¯»å…¥çš„å­—ç¬¦ï¼Œæ’å…¥ç¬¦å·æ˜¯å½“å‰è¯»å–çš„å­—ç¬¦ã€‚</span><br><span class="line">ç¬¬ 1 æ­¥ï¼š&quot;42&quot;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºæ²¡æœ‰å‰å¯¼ç©ºæ ¼ï¼‰</span><br><span class="line">         ^</span><br><span class="line">ç¬¬ 2 æ­¥ï¼š&quot;42&quot;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºè¿™é‡Œä¸å­˜åœ¨ &#39;-&#39; æˆ–è€… &#39;+&#39;ï¼‰</span><br><span class="line">         ^</span><br><span class="line">ç¬¬ 3 æ­¥ï¼š&quot;42&quot;ï¼ˆè¯»å…¥ &quot;42&quot;ï¼‰</span><br><span class="line">           ^</span><br><span class="line">è§£æå¾—åˆ°æ•´æ•° 42 ã€‚</span><br><span class="line">ç”±äº &quot;42&quot; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º 42 ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;   -42&quot;</span><br><span class="line">è¾“å‡ºï¼š-42</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç¬¬ 1 æ­¥ï¼š&quot;   -42&quot;ï¼ˆè¯»å…¥å‰å¯¼ç©ºæ ¼ï¼Œä½†å¿½è§†æ‰ï¼‰</span><br><span class="line">            ^</span><br><span class="line">ç¬¬ 2 æ­¥ï¼š&quot;   -42&quot;ï¼ˆè¯»å…¥ &#39;-&#39; å­—ç¬¦ï¼Œæ‰€ä»¥ç»“æœåº”è¯¥æ˜¯è´Ÿæ•°ï¼‰</span><br><span class="line">             ^</span><br><span class="line">ç¬¬ 3 æ­¥ï¼š&quot;   -42&quot;ï¼ˆè¯»å…¥ &quot;42&quot;ï¼‰</span><br><span class="line">               ^</span><br><span class="line">è§£æå¾—åˆ°æ•´æ•° -42 ã€‚</span><br><span class="line">ç”±äº &quot;-42&quot; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º -42 ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3:</span><br><span class="line">è¾“å…¥ï¼šs &#x3D; &quot;4193 with words&quot;</span><br><span class="line">è¾“å‡ºï¼š4193</span><br><span class="line">è§£é‡Šï¼š</span><br><span class="line">ç¬¬ 1 æ­¥ï¼š&quot;4193 with words&quot;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºæ²¡æœ‰å‰å¯¼ç©ºæ ¼ï¼‰</span><br><span class="line">         ^</span><br><span class="line">ç¬¬ 2 æ­¥ï¼š&quot;4193 with words&quot;ï¼ˆå½“å‰æ²¡æœ‰è¯»å…¥å­—ç¬¦ï¼Œå› ä¸ºè¿™é‡Œä¸å­˜åœ¨ &#39;-&#39; æˆ–è€… &#39;+&#39;ï¼‰</span><br><span class="line">         ^</span><br><span class="line">ç¬¬ 3 æ­¥ï¼š&quot;4193 with words&quot;ï¼ˆè¯»å…¥ &quot;4193&quot;ï¼›ç”±äºä¸‹ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ‰€ä»¥è¯»å…¥åœæ­¢ï¼‰</span><br><span class="line">             ^</span><br><span class="line">è§£æå¾—åˆ°æ•´æ•° 4193 ã€‚</span><br><span class="line">ç”±äº &quot;4193&quot; åœ¨èŒƒå›´ [-231, 231 - 1] å†…ï¼Œæœ€ç»ˆç»“æœä¸º 4193 ã€‚</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">0 &lt;&#x3D; s.length &lt;&#x3D; 200</span><br><span class="line">s ç”±è‹±æ–‡å­—æ¯ï¼ˆå¤§å†™å’Œå°å†™ï¼‰ã€æ•°å­—ï¼ˆ0-9ï¼‰ã€&#39; &#39;ã€&#39;+&#39;ã€&#39;-&#39; å’Œ &#39;.&#39; ç»„æˆ</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). è¿™æ˜¯ä¸€é“å¾ˆå…¸å‹çš„æ¨¡æ‹Ÿé¢˜ï¼Œå¯¹äºæ¨¡æ‹Ÿé¢˜ï¼Œå°‘ä¸äº†æ¡ä»¶åˆ¤æ–­ï¼Œå»ºè®®é‡‡ç”¨ switch æ¥ä»£æ›¿å¤§é‡çš„ ifâ€¦elseï¼Œè¿™æ ·ä»£ç çš„é€»è¾‘ä¼šæ¸…æ™°å¾ˆå¤šï¼›<br>(2). è¿™é“é¢˜å”¯ä¸€å€¼å¾—å…³å¿ƒçš„ç‚¹å°±æ˜¯è¶Šç•Œé—®é¢˜ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†åˆæ³•æ•°å­—å­—ç¬¦ä¸²å–å‡ºåå…ˆå»é™¤å‰å¯¼é›¶ï¼Œç„¶åå†æ ¹æ®ç¬¦å·åˆ†åˆ«åˆ¤æ–­æ˜¯å¦è¶Šç•Œã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myAtoi</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(s) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isNeg := <span class="literal">false</span></span><br><span class="line">prefixLetter := <span class="literal">true</span></span><br><span class="line">str := []<span class="keyword">byte</span>&#123;&#125;</span><br><span class="line">maxNum, minNum := math.MaxInt32, <span class="number">-1</span>*math.MinInt32</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(s); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> prefixLetter &#123;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> s[i] == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">isNeg = <span class="literal">true</span></span><br><span class="line">prefixLetter = <span class="literal">false</span></span><br><span class="line"><span class="keyword">case</span> s[i] == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">prefixLetter = <span class="literal">false</span></span><br><span class="line"><span class="keyword">case</span> s[i] == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line"><span class="keyword">case</span> s[i] == <span class="string">&#x27;.&#x27;</span> || (s[i] &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;z&#x27;</span>):</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">case</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">prefixLetter = <span class="literal">false</span></span><br><span class="line">str = <span class="built_in">append</span>(str, s[i])</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">switch</span> &#123;</span><br><span class="line"><span class="keyword">case</span> s[i] &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; s[i] &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">str = <span class="built_in">append</span>(str, s[i])</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">i = <span class="built_in">len</span>(s)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(str) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> str[i] != <span class="string">&#x27;0&#x27;</span> &#123;</span><br><span class="line">x = i</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret := <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> !isNeg &#123;</span><br><span class="line"><span class="keyword">for</span> i:=x; i&lt;<span class="built_in">len</span>(str) ;i++ &#123;</span><br><span class="line">ret *= <span class="number">10</span></span><br><span class="line">ret += <span class="keyword">int</span>(str[i])-<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">if</span> ret &gt; maxNum &#123;</span><br><span class="line"><span class="keyword">return</span> maxNum</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=x; i&lt;<span class="built_in">len</span>(str); i++ &#123;</span><br><span class="line">ret *= <span class="number">10</span></span><br><span class="line">ret += <span class="keyword">int</span>(str[i])-<span class="string">&#x27;0&#x27;</span></span><br><span class="line"><span class="keyword">if</span> ret &gt; minNum &#123;</span><br><span class="line"><span class="keyword">return</span> math.MinInt32</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ret *= <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode269-ç«æ˜Ÿè¯å…¸&quot;&gt;&lt;a href=&quot;#LeetCode269-ç«æ˜Ÿè¯å…¸&quot; class=&quot;headerlink&quot; title=&quot;LeetCode269. ç«æ˜Ÿè¯å…¸&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;https://leetcod</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 2ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/03/31/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%202%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/03/31/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%202%EF%BC%89/</id>
    <published>2022-03-30T22:00:00.000Z</published>
    <updated>2022-04-08T00:16:10.592Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode63-ä¸åŒè·¯å¾„-II"><a href="#LeetCode63-ä¸åŒè·¯å¾„-II" class="headerlink" title="LeetCode63. ä¸åŒè·¯å¾„ II"></a><a class="link" href="https://leetcode-cn.com/problems/unique-paths-ii/">LeetCode63. ä¸åŒè·¯å¾„ II<i class="fas fa-external-link-alt"></i></a></h2><p>#åŠ¨æ€è§„åˆ’</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ªÂ m x nÂ ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œStartâ€ ï¼‰ã€‚<br>æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œFinishâ€ï¼‰ã€‚<br>ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ<br>ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="robot1.jpg" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šobstacleGrid &#x3D; [[0,0,0],[0,1,0],[0,0,0]]</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼š3x3 ç½‘æ ¼çš„æ­£ä¸­é—´æœ‰ä¸€ä¸ªéšœç¢ç‰©ã€‚</span><br><span class="line">ä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ä¸€å…±æœ‰ 2 æ¡ä¸åŒçš„è·¯å¾„ï¼š</span><br><span class="line">1. å‘å³ -&gt; å‘å³ -&gt; å‘ä¸‹ -&gt; å‘ä¸‹</span><br><span class="line">2. å‘ä¸‹ -&gt; å‘ä¸‹ -&gt; å‘å³ -&gt; å‘å³</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="robot2.jpg" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šobstacleGrid &#x3D; [[0,1],[0,0]]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">m &#x3D;&#x3D;Â obstacleGrid.length</span><br><span class="line">n &#x3D;&#x3D;Â obstacleGrid[i].length</span><br><span class="line">1 &lt;&#x3D; m, n &lt;&#x3D; 100</span><br><span class="line">obstacleGrid[i][j] ä¸º 0 æˆ– 1</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é‡‡ç”¨äºŒç»´é€’å½’çš„æ€è·¯ï¼Œæœ¬é¢˜æ˜¯<a class="link" href="https://leetcode-cn.com/problems/unique-paths/">LeetCode62. ä¸åŒè·¯å¾„<i class="fas fa-external-link-alt"></i></a>çš„å˜ç§ï¼Œå®é™…ä¸Šæ˜¯ä¸€é“é¢˜ï¼›<br>(2). åœ¨å¤„ç†åˆå§‹æ¡ä»¶ï¼ˆç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—ï¼‰é‡åˆ°éšœç¢ç‰©æ—¶ï¼Œéšœç¢ç‰©æ‰€åœ¨çš„æ ¼å­å³ä¹‹åçš„æ ¼å­éƒ½å±äºä¸å¯åˆ°è¾¾çš„åæ ‡ï¼Œé€€å‡ºå¾ªç¯ï¼›<br>(3). åœ¨é€’å½’è¿‡ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°éšœç¢ç‰©ï¼Œç›´æ¥åˆ¤æ–­ä¸ºä¸å¯åˆ°è¾¾ <code>dp[i][j]=0</code>ï¼Œå¦åˆ™å½“å‰æ ¼å­çš„è·¯å¾„æ•°ç­‰äºä¸Šé¢ã€å·¦é¢çš„è·¯å¾„æ•°ä¹‹å’Œã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O($N^2$).</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">uniquePathsWithObstacles</span><span class="params">(obstacleGrid [][]<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][<span class="number">0</span>] == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m, n := <span class="built_in">len</span>(obstacleGrid), <span class="built_in">len</span>(obstacleGrid[<span class="number">0</span>])</span><br><span class="line">dp := <span class="built_in">make</span>([][]<span class="keyword">int</span>, m)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;m; i++ &#123;</span><br><span class="line">dp[i] = <span class="built_in">make</span>([]<span class="keyword">int</span>, n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;m; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> obstacleGrid[i][<span class="number">0</span>] != <span class="number">1</span> &#123;</span><br><span class="line">dp[i][<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;n; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> obstacleGrid[<span class="number">0</span>][i] != <span class="number">1</span> &#123;</span><br><span class="line">dp[<span class="number">0</span>][i] = <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;m; i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">1</span>; j&lt;n; j++ &#123;</span><br><span class="line"><span class="keyword">if</span> obstacleGrid[i][j] == <span class="number">1</span> &#123;</span><br><span class="line">dp[i][j] = <span class="number">0</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">dp[i][j] = dp[i<span class="number">-1</span>][j]+dp[i][j<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> dp[m<span class="number">-1</span>][n<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode498-å¯¹è§’çº¿éå†"><a href="#LeetCode498-å¯¹è§’çº¿éå†" class="headerlink" title="LeetCode498. å¯¹è§’çº¿éå†"></a><a class="link" href="https://leetcode-cn.com/problems/diagonal-traverse/">LeetCode498. å¯¹è§’çº¿éå†<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™ä½ ä¸€ä¸ªå¤§å°ä¸º <code>m x n</code> çš„çŸ©é˜µ <code>mat</code> ï¼Œè¯·ä»¥å¯¹è§’çº¿éå†çš„é¡ºåºï¼Œç”¨ä¸€ä¸ªæ•°ç»„è¿”å›è¿™ä¸ªçŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br></pre></td></tr></table></figure><p><img lazyload src="/images/loading.svg" data-src="diag1-grid.jpg" alt="avatar"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥ï¼šmat &#x3D; [[1,2,3],[4,5,6],[7,8,9]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,4,7,5,3,6,8,9]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šmat &#x3D; [[1,2],[3,4]]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3,4]</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). æœ¬é¢˜è¦å¤„ç†çš„ç»†èŠ‚æ¯”è¾ƒå¤šã€‚é¦–å…ˆè§£å†³è¾¹ç•Œé—®é¢˜ï¼Œå½“ <code>mat</code> åªæœ‰ä¸€è¡Œæˆ–ä¸€åˆ—çš„æ—¶å€™ï¼Œç›´æ¥è¾“å‡ºè¿™ä¸€è¡Œæˆ–ä¸€åˆ—ï¼›<br>(2). è¦å…³æ³¨ä¸‰ä¸ªå’Œè½¬å‘æœ‰å…³çš„æƒ…å†µï¼š<code>direction</code> ç”¨äºæè¿°å½“å‰å‰è¿›çš„æ–¹å‘ï¼Œå‘å³ä¸Šæ˜¯ä¸º <code>true</code>ï¼Œå‘å·¦ä¸‹æ—¶ä¸º <code>false</code>ï¼›<code>rowHalf</code> ç”¨äºæè¿°åœ¨å³ä¸Šæ–¹å‘å‰è¿›åˆ°é¡¶æ ¼æ—¶ï¼Œæ¥ä¸‹æ¥æ˜¯è¦å‘å³è¿˜æ˜¯å‘ä¸‹ç§»åŠ¨ä¸€æ ¼ï¼›<code>columnHalf</code> ç”¨äºæè¿°åœ¨å·¦ä¸‹æ–¹å‘å‰è¿›åˆ°é¡¶æ ¼æ—¶æ¥ä¸‹æ¥æ˜¯è¦å‘ä¸‹è¿˜æ˜¯å‘å³å‰è¿›ä¸€æ ¼ã€‚å®é™…ä¸Šå°±æ˜¯åˆ¤æ–­æœ‰æ²¡æœ‰åˆ†åˆ«åœ¨è¡Œå’Œåˆ—ä¸Šèµ°è¿‡ <code>mat</code> çš„ä¸€åŠä½ç½®ã€‚<br>(3). å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œå½“å‰ä½ç½®çš„åæ ‡å’Œ <code>i+j</code> åœ¨å¤§äºç­‰äºè¡Œå·æˆ–åˆ—å·çš„æ—¶å€™ï¼Œèµ°åˆ°é¡¶æ ¼åè½¬å‘çš„æ–¹å‘éœ€è¦å‘ç”Ÿæ”¹å˜ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O($M*N$)</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findDiagonalOrder</span><span class="params">(mat [][]<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">ret := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">m, n := <span class="built_in">len</span>(mat), <span class="built_in">len</span>(mat[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">if</span> m == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> mat[<span class="number">0</span>]</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> n == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;m; i++ &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, mat[i][<span class="number">0</span>])</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">direction := <span class="literal">true</span></span><br><span class="line">rowHalf := <span class="literal">true</span></span><br><span class="line">columnHalf := <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i&lt;m &amp;&amp; j&lt;n &#123;</span><br><span class="line">ret = <span class="built_in">append</span>(ret, mat[i][j])</span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; direction &amp;&amp; rowHalf) || (j == n<span class="number">-1</span> &amp;&amp; direction &amp;&amp; !rowHalf) &#123;</span><br><span class="line"><span class="keyword">if</span> rowHalf &#123;</span><br><span class="line"><span class="keyword">if</span> j &lt; n<span class="number">-1</span> &#123;</span><br><span class="line">j++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">i++</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">i++</span><br><span class="line">&#125;</span><br><span class="line">direction = <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="number">0</span> &amp;&amp; !direction) || (i == m<span class="number">-1</span> &amp;&amp; !direction &amp;&amp; !columnHalf) &#123;</span><br><span class="line"><span class="keyword">if</span> columnHalf &#123;</span><br><span class="line"><span class="keyword">if</span> i &lt; m<span class="number">-1</span> &#123;</span><br><span class="line">i++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">j++</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">j++</span><br><span class="line">&#125;</span><br><span class="line">direction = <span class="literal">true</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> direction &#123;</span><br><span class="line">i--</span><br><span class="line">j++</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">i++</span><br><span class="line">j--</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> i+j &gt;= m<span class="number">-1</span> &#123;</span><br><span class="line">columnHalf = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> i+j &gt;= n<span class="number">-1</span> &#123;</span><br><span class="line">rowHalf = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="LeetCode83-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "><a href="#LeetCode83-åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ " class="headerlink" title="LeetCode83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ "></a><a class="link" href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-list/">LeetCode83. åˆ é™¤æ’åºé“¾è¡¨ä¸­çš„é‡å¤å…ƒç´ <i class="fas fa-external-link-alt"></i></a></h2><p>#é“¾è¡¨</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ä¸ªå·²æ’åºçš„é“¾è¡¨çš„å¤´Â <code>head</code>Â ï¼ŒÂ åˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ã€‚è¿”å›å·²æ’åºçš„é“¾è¡¨Â ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼šhead &#x3D; [1,1,2]</span><br><span class="line">è¾“å‡ºï¼š[1,2]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šhead &#x3D; [1,1,2,3,3]</span><br><span class="line">è¾“å‡ºï¼š[1,2,3]</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">é“¾è¡¨ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 300] å†…</span><br><span class="line">100 &lt;&#x3D; Node.val &lt;&#x3D; 100</span><br><span class="line">é¢˜ç›®æ•°æ®ä¿è¯é“¾è¡¨å·²ç»æŒ‰å‡åºæ’åˆ—</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). è¦åˆ é™¤é‡å¤çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå°±è¦å®æ—¶ç»´æŠ¤ä¸‰ä¸ªä½ç½®çš„èŠ‚ç‚¹ <code>pre</code>ã€<code>cur</code>ã€<code>next</code>ï¼Œå‡è®¾è¦åˆ é™¤ <code>cur</code>ï¼Œé‚£ä¹ˆåˆ é™¤ä¹‹åè¿˜è¦å°† <code>cur</code> é‡æ–°æŒ‡å‘ <code>next</code>ï¼›<br>(2). å¦‚æœ <code>pre</code> å’Œ <code>cur</code> çš„å€¼ä¸ç›¸ç­‰ï¼Œé‚£ä¹ˆåŒæ—¶å‘åç§»åŠ¨ä¸€ä½ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N).</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* type ListNode struct &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Val int</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* Next *ListNode</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">* &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteDuplicates</span><span class="params">(head *ListNode)</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> head == <span class="literal">nil</span> || head.Next == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pre, cur := head, head.Next</span><br><span class="line"><span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">next := cur.Next</span><br><span class="line"><span class="keyword">if</span> cur.Val == pre.Val &#123;</span><br><span class="line">pre.Next = next</span><br><span class="line">cur = next</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">pre = cur</span><br><span class="line">cur = next</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode63-ä¸åŒè·¯å¾„-II&quot;&gt;&lt;a href=&quot;#LeetCode63-ä¸åŒè·¯å¾„-II&quot; class=&quot;headerlink&quot; title=&quot;LeetCode63. ä¸åŒè·¯å¾„ II&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;https://l</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>æ—©èµ·åˆ·é¢˜ï¼ˆDay 1ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/03/30/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%201%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/03/30/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98%EF%BC%88Day%201%EF%BC%89/</id>
    <published>2022-03-29T22:00:00.000Z</published>
    <updated>2022-04-08T00:17:59.560Z</updated>
    
    <content type="html"><![CDATA[<h2 id="LeetCode179-æœ€å¤§æ•°"><a href="#LeetCode179-æœ€å¤§æ•°" class="headerlink" title="LeetCode179. æœ€å¤§æ•°"></a><a class="link" href="https://leetcode-cn.com/problems/largest-number/">LeetCode179. æœ€å¤§æ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#å­—å…¸åº</p><h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ç»™å®šä¸€ç»„éè´Ÿæ•´æ•° <code>nums</code>ï¼Œé‡æ–°æ’åˆ—æ¯ä¸ªæ•°çš„é¡ºåºï¼ˆæ¯ä¸ªæ•°ä¸å¯æ‹†åˆ†ï¼‰ä½¿ä¹‹ç»„æˆä¸€ä¸ªæœ€å¤§çš„æ•´æ•°ã€‚<br>æ³¨æ„ï¼šè¾“å‡ºç»“æœå¯èƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥ä½ éœ€è¦è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²è€Œä¸æ˜¯æ•´æ•°ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [10,2]</span><br><span class="line">è¾“å‡ºï¼š&quot;210&quot;</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹Â 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [3,30,34,5,9]</span><br><span class="line">è¾“å‡ºï¼š&quot;9534330&quot;</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1).  æœ¬é¢˜éœ€è¦æŒ‰ç…§å­—å…¸åºæ’åºæ¥ç”Ÿæˆæœ€ç»ˆçš„å­—ç¬¦ä¸²ï¼›<br>(2). å½“ç»™å®šçš„æ•°ç»„ä¸­å…ƒç´ çš„æœ€é«˜ä½éƒ½ä¸ç›¸ç­‰æ—¶ï¼Œæƒ…å†µæœ€ç®€å•ï¼Œç›´æ¥è¾“å‡ºå­—å…¸åºå³å¯ï¼›<br>(3). å½“å‡ºç° $4$ å’Œ $42$ è¿™ç§ç±»å‹çš„å­åºåˆ—æ—¶ï¼Œå¦‚æœæŒ‰ç…§å­—å…¸åºæ¥æ’åºåªèƒ½å¾—åˆ° $424$ï¼Œä½†å®é™…ä¸Šæœ€å¤§å€¼æ˜¯ $442$ï¼Œå› æ­¤å¯çŸ¥æ ¹æ®å­—å…¸åºæ’åºåªèƒ½å¾—åˆ°å±€éƒ¨æœ€å¤§å€¼ <code>ans</code>ï¼Œæˆ‘ä»¬è¦æ±‚çš„æ˜¯å…¨å±€æœ€å¤§å€¼ <code>max</code>ï¼›<br>(4). å¯ä»¥åœ¨æ’åºçš„æ—¶å€™æ›´æ”¹ä¸€ä¸‹æ’åºæ¡ä»¶ï¼Œä¸ä»¥å­—å…¸åºä¸ºæ’åºæ¡ä»¶ï¼Œè€Œæ˜¯ä»¥ä¸¤æ•°æ‹¼æ¥åçš„å®é™…å¤§å°æ¥æ’åºã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(Nlog(N))ã€‚å› ä¸ºæœ‰æ’åºç®—æ³•ã€‚</p><h3 id="è§£é¢˜ä»£ç "><a href="#è§£é¢˜ä»£ç " class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">sort.Slice(nums, <span class="function"><span class="keyword">func</span><span class="params">(i,j <span class="keyword">int</span>)</span><span class="title">bool</span></span> &#123;</span><br><span class="line">x, y := nums[i], nums[j]</span><br><span class="line">sx, sy := <span class="number">10</span>, <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> sx &lt;= x &#123;</span><br><span class="line">sx *= <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sy &lt;= y &#123;</span><br><span class="line">sy *= <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> sy*x+y &gt; sx*y+x</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> nums[<span class="number">0</span>] == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret := <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">ret += strconv.Itoa(nums[i])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç ç»†èŠ‚"><a href="#ä»£ç ç»†èŠ‚" class="headerlink" title="ä»£ç ç»†èŠ‚"></a>ä»£ç ç»†èŠ‚</h3><p>&emsp;&emsp;åœ¨æ’åºæ¡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç»´æŠ¤äº†ä¸¤ä¸ªå˜é‡ <code>sx</code> å’Œ <code>sy</code>ï¼Œè¿™ä¸¤ä¸ªå˜é‡ä¼šåœ¨æ‹¼æ¥æ“ä½œä¸­ä¸ºä¸¤ä¸ªæ•°ç•™å‡ºå¯¹åº”çš„ä½ç½®ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„æ‹¼æ¥æ“ä½œï¼Œé¿å…äº†è½¬æ¢æˆå­—ç¬¦ä¸²åå†è¿›è¡Œæ‹¼æ¥ã€‚</p><h2 id="LeetCode36-æœ‰æ•ˆçš„æ•°ç‹¬"><a href="#LeetCode36-æœ‰æ•ˆçš„æ•°ç‹¬" class="headerlink" title="LeetCode36. æœ‰æ•ˆçš„æ•°ç‹¬"></a><a class="link" href="https://leetcode-cn.com/problems/valid-sudoku/">LeetCode36. æœ‰æ•ˆçš„æ•°ç‹¬<i class="fas fa-external-link-alt"></i></a></h2><p>#æ¨¡æ‹Ÿé¢˜</p><h3 id="é¢˜ç›®æè¿°-1"><a href="#é¢˜ç›®æè¿°-1" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>è¯·ä½ åˆ¤æ–­ä¸€ä¸ª <code>9 x 9</code> çš„æ•°ç‹¬æ˜¯å¦æœ‰æ•ˆã€‚åªéœ€è¦ <strong>æ ¹æ®ä»¥ä¸‹è§„åˆ™</strong> ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚</p><ol><li> æ•°å­—Â <code>1-9</code>Â åœ¨æ¯ä¸€è¡Œåªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li><li> æ•°å­—Â <code>1-9</code>Â åœ¨æ¯ä¸€åˆ—åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚</li><li>æ•°å­—Â <code>1-9</code>Â åœ¨æ¯ä¸€ä¸ªä»¥ç²—å®çº¿åˆ†éš”çš„Â <code>3x3</code>Â å®«å†…åªèƒ½å‡ºç°ä¸€æ¬¡ã€‚ï¼ˆè¯·å‚è€ƒç¤ºä¾‹å›¾ï¼‰<br>æ³¨æ„ï¼š<br>ä¸€ä¸ªæœ‰æ•ˆçš„æ•°ç‹¬ï¼ˆéƒ¨åˆ†å·²è¢«å¡«å……ï¼‰ä¸ä¸€å®šæ˜¯å¯è§£çš„ã€‚<br>åªéœ€è¦æ ¹æ®ä»¥ä¸Šè§„åˆ™ï¼ŒéªŒè¯å·²ç»å¡«å…¥çš„æ•°å­—æ˜¯å¦æœ‰æ•ˆå³å¯ã€‚<br>ç©ºç™½æ ¼ç”¨Â <code>&#39;.&#39;</code>Â è¡¨ç¤ºã€‚</li></ol></blockquote> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br></pre></td></tr></table></figure><p> <img lazyload src="/images/loading.svg" data-src="shudu.png" alt="avatar"><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> è¾“å…¥ï¼šboard &#x3D; </span><br><span class="line">[[&quot;5&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;,&quot;9&quot;,&quot;5&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;9&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;3&quot;]</span><br><span class="line">,[&quot;4&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;]</span><br><span class="line">,[&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;8&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;4&quot;,&quot;1&quot;,&quot;9&quot;,&quot;.&quot;,&quot;.&quot;,&quot;5&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;9&quot;]]</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šboard &#x3D; </span><br><span class="line">[[&quot;8&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;,&quot;9&quot;,&quot;5&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;9&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;3&quot;]</span><br><span class="line">,[&quot;4&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;3&quot;,&quot;.&quot;,&quot;.&quot;,&quot;1&quot;]</span><br><span class="line">,[&quot;7&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;6&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;6&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;2&quot;,&quot;8&quot;,&quot;.&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;4&quot;,&quot;1&quot;,&quot;9&quot;,&quot;.&quot;,&quot;.&quot;,&quot;5&quot;]</span><br><span class="line">,[&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;.&quot;,&quot;8&quot;,&quot;.&quot;,&quot;.&quot;,&quot;7&quot;,&quot;9&quot;]]</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line">è§£é‡Šï¼šé™¤äº†ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ•°å­—ä» 5 æ”¹ä¸º 8 ä»¥å¤–ï¼Œç©ºæ ¼å†…å…¶ä»–æ•°å­—å‡ä¸ ç¤ºä¾‹1 ç›¸åŒã€‚ ä½†ç”±äºä½äºå·¦ä¸Šè§’çš„ 3x3 å®«å†…æœ‰ä¸¤ä¸ª 8 å­˜åœ¨, å› æ­¤è¿™ä¸ªæ•°ç‹¬æ˜¯æ— æ•ˆçš„ã€‚</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">board.length &#x3D;&#x3D; 9</span><br><span class="line">board[i].length &#x3D;&#x3D; 9</span><br><span class="line">board[i][j] æ˜¯ä¸€ä½æ•°å­—ï¼ˆ1-9ï¼‰æˆ–è€… &#39;.&#39;</span><br></pre></td></tr></table></figure></p><h3 id="è§£é¢˜æ€è·¯-1"><a href="#è§£é¢˜æ€è·¯-1" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p> (1). å…ˆåˆ¤æ–­è¡Œä¸Šæ˜¯å¦ç¬¦åˆæ ‡å‡†ï¼›<br> (2). å†åˆ¤æ–­åˆ—ä¸Šæ˜¯å¦ç¬¦åˆæ ‡å‡†ï¼›<br> (3). æœ€åä¼ é€’æ¯ä¸ªä¹å®«æ ¼çš„å·¦ä¸Šè§’åæ ‡æ¥åˆ¤æ–­æ¯ä¸ªä¹å®«æ ¼æ˜¯å¦ç¬¦åˆæ ‡å‡†ã€‚</p><h3 id="è§£é¢˜ä»£ç -1"><a href="#è§£é¢˜ä»£ç -1" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3> <figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isValidSudoku</span><span class="params">(board [][]<span class="keyword">byte</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkRow <span class="function"><span class="keyword">func</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">bool</span></span></span><br><span class="line">checkRow = <span class="function"><span class="keyword">func</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">check := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">row := board[index]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(row); i++ &#123;</span><br><span class="line"><span class="keyword">if</span> row[i] == <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> check[<span class="keyword">int</span>(row[i])-<span class="string">&#x27;0&#x27;</span>] == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">check[<span class="keyword">int</span>(row[i])-<span class="string">&#x27;0&#x27;</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkColumn <span class="function"><span class="keyword">func</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">bool</span></span></span><br><span class="line">checkColumn = <span class="function"><span class="keyword">func</span><span class="params">(index <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">check := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">9</span>; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> board[i][index] == <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> check[<span class="keyword">int</span>(board[i][index])-<span class="string">&#x27;0&#x27;</span>] == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">check[<span class="keyword">int</span>(board[i][index])-<span class="string">&#x27;0&#x27;</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> checkGrid <span class="function"><span class="keyword">func</span><span class="params">(r,c <span class="keyword">int</span>)</span> <span class="title">bool</span></span></span><br><span class="line">checkGrid = <span class="function"><span class="keyword">func</span><span class="params">(r,c <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">check := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i:=r; i&lt;r+<span class="number">3</span>; i++ &#123;</span><br><span class="line"><span class="keyword">for</span> j:=c; j&lt;c+<span class="number">3</span>; j++ &#123;</span><br><span class="line"><span class="keyword">if</span> board[i][j] == <span class="string">&#x27;.&#x27;</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> check[<span class="keyword">int</span>(board[i][j])-<span class="string">&#x27;0&#x27;</span>] == <span class="number">1</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">check[<span class="keyword">int</span>(board[i][j])-<span class="string">&#x27;0&#x27;</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="number">9</span>; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> !checkRow(i) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> !checkColumn(i) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;=<span class="number">6</span>; i=i+<span class="number">3</span> &#123;</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span>; j&lt;=<span class="number">6</span>; j=j+<span class="number">3</span> &#123;</span><br><span class="line"><span class="keyword">if</span> !checkGrid(i,j) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"><a href="#å‰‘æŒ‡-Offer-56-I-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="å‰‘æŒ‡ Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°"></a><a class="link" href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-lcof/">å‰‘æŒ‡ Offer 56 - I. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°<i class="fas fa-external-link-alt"></i></a></h2><p>#ä½è¿ç®—</p><h3 id="é¢˜ç›®æè¿°-2"><a href="#é¢˜ç›®æè¿°-2" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>ä¸€ä¸ªæ•´å‹æ•°ç»„ <code>nums</code> é‡Œé™¤ä¸¤ä¸ªæ•°å­—ä¹‹å¤–ï¼Œå…¶ä»–æ•°å­—éƒ½å‡ºç°äº†ä¸¤æ¬¡ã€‚è¯·å†™ç¨‹åºæ‰¾å‡ºè¿™ä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚è¦æ±‚æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼Œç©ºé—´å¤æ‚åº¦æ˜¯O(1)ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [4,1,4,6]</span><br><span class="line">è¾“å‡ºï¼š[1,6] æˆ– [6,1]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [1,2,10,4,1,4,3,3]</span><br><span class="line">è¾“å‡ºï¼š[2,10] æˆ– [10,2]</span><br><span class="line"></span><br><span class="line">é™åˆ¶ï¼š</span><br><span class="line">2 &lt;&#x3D; nums.length &lt;&#x3D; 10000</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-2"><a href="#è§£é¢˜æ€è·¯-2" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼šç›¸åŒçš„æ•°å­—å¼‚æˆ–ç­‰äº 0ï¼Œå¹¶ä¸”å¼‚æˆ–æ“ä½œå…·å¤‡äº¤æ¢æ€§ã€‚æ‰€ä»¥æ•´ä¸ªæ•°ç»„çš„å¼‚æˆ–ç»“æœç­‰äºä¸¤ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°çš„å¼‚æˆ–ï¼›<br>(2). ä¸¤ä¸ªæ•°çš„å¼‚æˆ–ç»“æœåœ¨æŸä¸€ä¸ªäºŒè¿›åˆ¶ä½ä¸Šæ˜¯ $1$ï¼Œè¯´æ˜è¿™ä¸¤ä¸ªæ•°åœ¨è¯¥ä½ä¸Šä¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€æ€§è´¨ï¼Œå°†æ•°ç»„ä¸­æ‰€æœ‰çš„æ•°å­—æ ¹æ®è¯¥äºŒè¿›åˆ¶ä½ä¸Šæ˜¯ $1$  æˆ– $0$ åˆ†ç±»ä¸ºä¸¤ç»„ï¼›<br>(3). ç»„å†…çš„å…ƒç´ å†è‡ªè¡Œè¿›è¡Œå¼‚æˆ–ï¼Œé‚£ä¹ˆæœ€ç»ˆä¸¤ç»„çš„ç»“æœå°±æ˜¯ä¸¤ä¸ªåªå‡ºç°è¿‡ä¸€æ¬¡çš„æ•°ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-1"><a href="#æ—¶é—´å¤æ‚åº¦-1" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N).</p><h3 id="è§£é¢˜ä»£ç -2"><a href="#è§£é¢˜ä»£ç -2" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumbers</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">2</span> &#123;</span><br><span class="line"><span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x := nums[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">x ^= nums[i]</span><br><span class="line">&#125;</span><br><span class="line">c := x&amp;(-x)</span><br><span class="line"></span><br><span class="line">a, b := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">x = nums[i]</span><br><span class="line"><span class="keyword">if</span> x&amp;c == c &#123;</span><br><span class="line">a ^= nums[i]</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">b ^= nums[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> []<span class="keyword">int</span>&#123;a,b&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç ç»†èŠ‚-1"><a href="#ä»£ç ç»†èŠ‚-1" class="headerlink" title="ä»£ç ç»†èŠ‚"></a>ä»£ç ç»†èŠ‚</h3><p>&emsp;&amp;emspåœ¨æ‰¾ç¬¬ä¸€ä¸ªä¸åŒçš„äºŒè¿›åˆ¶ä½çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>x&amp;(-x)</code> çš„å½¢å¼ã€‚é¦–å…ˆæ˜ç¡®ä¸€ä¸‹ï¼Œè®¡ç®—ä¸€ä¸ªæ­£æ•°çš„ç›¸åæ•°ç­‰äºå°†å…¶äºŒè¿›åˆ¶è¡¨ç¤ºå…¨éƒ¨<strong>å–åå†åŠ  1</strong>ï¼Œä¾‹å¦‚ $12 = 01100$ï¼Œé‚£ä¹ˆ $-12 = 10100$ï¼Œå†è¿›è¡Œ <code>&amp;</code> è¿ç®—å¯å¾— $12 &amp; -12 = 00100$ï¼Œè¿™æ ·å°±å°†æœ€ä½ä½ä¸º $1$ çš„äºŒè¿›åˆ¶æ•°è¡¨ç¤ºäº†å‡ºæ¥ã€‚ä¹‹ååªè¦å°†æ•°ç»„ä¸­æ‰€æœ‰çš„æ•°ä¸è¯¥æ•°è¿›è¡Œ <code>&amp;</code> æ“ä½œå°±èƒ½å®Œæˆåˆ†ç±»ã€‚</p><h2 id="å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II"><a href="#å‰‘æŒ‡-Offer-56-II-æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•°-II" class="headerlink" title="å‰‘æŒ‡ Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II"></a><a class="link" href="https://leetcode-cn.com/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof/">å‰‘æŒ‡ Offer 56 - II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II<i class="fas fa-external-link-alt"></i></a></h2><h3 id="é¢˜ç›®æè¿°-3"><a href="#é¢˜ç›®æè¿°-3" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><blockquote><p>åœ¨ä¸€ä¸ªæ•°ç»„ <code>nums</code> ä¸­é™¤ä¸€ä¸ªæ•°å­—åªå‡ºç°ä¸€æ¬¡ä¹‹å¤–ï¼Œå…¶ä»–æ•°å­—éƒ½å‡ºç°äº†ä¸‰æ¬¡ã€‚è¯·æ‰¾å‡ºé‚£ä¸ªåªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [3,4,3,3]</span><br><span class="line">è¾“å‡ºï¼š4</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥ï¼šnums &#x3D; [9,1,7,9,7,9,7]</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line"></span><br><span class="line">é™åˆ¶ï¼š</span><br><span class="line">1 &lt;&#x3D; nums.length &lt;&#x3D; 10000</span><br><span class="line">1 &lt;&#x3D; nums[i] &lt; 2^31</span><br></pre></td></tr></table></figure><h3 id="è§£é¢˜æ€è·¯-3"><a href="#è§£é¢˜æ€è·¯-3" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h3><p>(1). å› ä¸ºçº¦å®šäº†é™¤äº†ä¸€ä¸ªæ•°å­—å¤–ï¼Œåˆ«çš„æ•°å­—éƒ½ä¼šå‡ºç° 3 æ¬¡ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æ¯ä¸€ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½ä¼šå‡ºç° 3 çš„å€æ•°ï¼›<br>(2). å½“æŸä¸€ä¸ªäºŒè¿›åˆ¶ä½ä¸Šä¸æ˜¯ 3 çš„å€æ•°ï¼Œé‚£ä¹ˆä¹Ÿå°±æ„å‘³ç€æ˜¯é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°å­—è‚¯å®šå æ®äº†ä¸€æ¬¡è¯¥äºŒè¿›åˆ¶ä½ï¼›<br>(3). åˆ©ç”¨ (2) ä¸­æ‰¾åˆ°çš„äºŒè¿›åˆ¶ä½ç»„æˆè¿™ä¸ªæ•°ã€‚</p><h3 id="æ—¶é—´å¤æ‚åº¦-2"><a href="#æ—¶é—´å¤æ‚åº¦-2" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h3><p>O(N).</p><h3 id="è§£é¢˜ä»£ç -3"><a href="#è§£é¢˜ä»£ç -3" class="headerlink" title="è§£é¢˜ä»£ç "></a>è§£é¢˜ä»£ç </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">singleNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">bitCount := [<span class="number">32</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">x := nums[i]</span><br><span class="line">j := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x != <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">if</span> x ^ (x<span class="number">-1</span>) == <span class="number">1</span> &#123;</span><br><span class="line">bitCount[j]++</span><br><span class="line">&#125;</span><br><span class="line">j++</span><br><span class="line">x &gt;&gt;= <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret := <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(bitCount); i++ &#123;</span><br><span class="line">x := bitCount[i]%<span class="number">3</span></span><br><span class="line">ret += x*<span class="keyword">int</span>(math.Pow(<span class="number">2</span>,<span class="keyword">float64</span>(i)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»£ç ç»†èŠ‚-2"><a href="#ä»£ç ç»†èŠ‚-2" class="headerlink" title="ä»£ç ç»†èŠ‚"></a>ä»£ç ç»†èŠ‚</h3><p>&emsp;&emsp;æ ¹æ®æœ¬é¢˜çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å°±èƒ½æ¨å¹¿ï¼Œå¯¹äºæŸä¸ªæ•°ç»„ï¼Œé™¤äº†ä¸€ä¸ªæ•°åªå‡ºç°ä¸€æ¬¡å¤–ï¼Œå…¶ä½™çš„æ•°éƒ½å‡ºç°äº† $m$ æ¬¡ï¼Œé‚£ä¹ˆåˆ©ç”¨è¿™ç§ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¾ˆè½»æ˜“åœ°æ‰¾åˆ°è¿™ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„æ•°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;LeetCode179-æœ€å¤§æ•°&quot;&gt;&lt;a href=&quot;#LeetCode179-æœ€å¤§æ•°&quot; class=&quot;headerlink&quot; title=&quot;LeetCode179. æœ€å¤§æ•°&quot;&gt;&lt;/a&gt;&lt;a class=&quot;link&quot; href=&quot;https://leetcode-c</summary>
      
    
    
    
    <category term="ç®—æ³•å’Œæ•°æ®ç»“æ„" scheme="http://jiahaohong1997.github.io/categories/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    
    <category term="æ—©èµ·åˆ·é¢˜" scheme="http://jiahaohong1997.github.io/tags/%E6%97%A9%E8%B5%B7%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>channel çš„ range å’Œ select æ¯”è¾ƒ</title>
    <link href="http://jiahaohong1997.github.io/2022/03/19/channel%20%E7%9A%84%20range%20%E5%92%8C%20select%20%E6%AF%94%E8%BE%83/"/>
    <id>http://jiahaohong1997.github.io/2022/03/19/channel%20%E7%9A%84%20range%20%E5%92%8C%20select%20%E6%AF%94%E8%BE%83/</id>
    <published>2022-03-19T10:14:00.000Z</published>
    <updated>2022-03-21T16:47:55.751Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ˜¯å¯¹ <a class="link" href="http://golangtutorials.blogspot.com/2011/06/channels-in-go-range-and-select.html">Channels in Go - range and select<i class="fas fa-external-link-alt"></i></a> çš„å­¦ä¹ </p></blockquote><h1 id="range"><a href="#range" class="headerlink" title="range"></a>range</h1><p>&emsp;&emsp;åœ¨ goroutine ä¹‹é—´ä½¿ç”¨ channel é€šä¿¡æ—¶ï¼Œæ•°æ®æ¥æ”¶æ–¹æ€»æ˜¯é¢ä¸´è¿™æ ·çš„é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™åœæ­¢ç­‰å¾…æ•°æ®ï¼Ÿè¿˜ä¼šæœ‰æ›´å¤šçš„æ•°æ®ä¹ˆï¼Œè¿˜æ˜¯æ‰€æœ‰å†…å®¹éƒ½å®Œæˆäº†ï¼Ÿæˆ‘åº”è¯¥ç»§ç»­ç­‰å¾…è¿˜æ˜¯è¯¥åšåˆ«çš„äº†ï¼Ÿå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªå¯é€‰çš„æ–¹å¼æ˜¯ï¼ŒæŒç»­çš„è®¿é—®æ•°æ®æºå¹¶æ£€æŸ¥channelæ˜¯å¦å·²ç»å…³é—­ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯é«˜æ•ˆçš„è§£å†³æ–¹å¼ã€‚Goæä¾›äº†<code>range</code>å…³é”®å­—ï¼Œå°†å…¶ä½¿ç”¨åœ¨channelä¸Šæ—¶ï¼Œä¼šè‡ªåŠ¨ç­‰å¾…channelçš„åŠ¨ä½œä¸€ç›´åˆ°channelè¢«å…³é—­ã€‚</p><p>ä¸‹é¢é€šè¿‡ä¸€æ®µç¤ºä¾‹ä»£ç æ¥è¯´æ˜ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> (  </span><br><span class="line">   <span class="string">&quot;fmt&quot;</span>  </span><br><span class="line">)  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">a</span><span class="params">(send <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>, num <span class="keyword">int</span>)</span></span> &#123;  </span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">1</span>; i&lt;=num; i++ &#123;  </span><br><span class="line">      send &lt;- i  </span><br><span class="line">   &#125;  </span><br><span class="line">   <span class="built_in">close</span>(send)  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b</span><span class="params">(recieve &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;  </span><br><span class="line">   <span class="keyword">for</span> num := <span class="keyword">range</span> recieve &#123;  </span><br><span class="line">      fmt.Printf(<span class="string">&quot;Now we recieve the number %v\n&quot;</span>, num)  </span><br><span class="line">   &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">   c := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)  </span><br><span class="line">   <span class="keyword">go</span> a(c, <span class="number">8</span>)  </span><br><span class="line">   b(c)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºç»“æœ</span><br><span class="line">Now we recieve the number 1</span><br><span class="line">Now we recieve the number 2</span><br><span class="line">Now we recieve the number 3</span><br><span class="line">Now we recieve the number 4</span><br><span class="line">Now we recieve the number 5</span><br><span class="line">Now we recieve the number 6</span><br><span class="line">Now we recieve the number 7</span><br><span class="line">Now we recieve the number 8</span><br></pre></td></tr></table></figure><p>a è¿™ä¸ª goroutine ä¸€ç›´å‘ channel å†…ä¼ é€’æ•°æ®ï¼Œç›´åˆ°è¿™ä¸ª channel è¢«å…³é—­å‰ï¼Œb è¿™ä¸ª goroutine éƒ½ä¼šé€šè¿‡ <code>range</code>  è¿™ä¸ªå…³é”®å­—é˜»å¡åœ¨å¾ªç¯ä¸­ä¸€ç›´ç­‰å¾… channel ä¸­çš„æ•°æ®ã€‚é€šè¿‡è¿™ä¸ªä¾‹å­è¿˜å¯ä»¥çœ‹å‡ºï¼Œ<code>for range</code> å¯ä»¥æ¥æ”¶ channel ä¸­çš„æ•°æ®ï¼Œä¸ç„¶ c ä½œä¸ºä¸€ä¸ªæ— ç¼“å†² channelï¼Œa ä¸å¯èƒ½å‘å…¶ä¸­ä¸€ç›´å‘é€æ•°æ®ã€‚</p><h1 id="select"><a href="#select" class="headerlink" title="select"></a>select</h1><p><code>select</code>å…³é”®å­—ç”¨äºå¤šä¸ªchannelçš„ç»“åˆï¼Œè¿™äº›channelä¼šé€šè¿‡ç±»ä¼¼äº <strong>are-you-ready polling</strong> çš„æœºåˆ¶æ¥å·¥ä½œã€‚<code>select</code>ä¸­ä¼šæœ‰<code>case</code>ä»£ç å—ï¼Œç”¨äºå‘é€æˆ–æ¥æ”¶æ•°æ®â€”â€”ä¸è®ºé€šè¿‡<code>&lt;-</code>æ“ä½œç¬¦æŒ‡å®šçš„å‘é€è¿˜æ˜¯æ¥æ”¶æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œchannelä¹Ÿå°±å‡†å¤‡å¥½äº†ã€‚åœ¨<code>select</code>ä¸­ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ª<code>default</code>ä»£ç å—ï¼Œå…¶ä¸€ç›´æ˜¯å‡†å¤‡å¥½çš„ã€‚é‚£ä¹ˆï¼Œåœ¨<code>select</code>ä¸­ï¼Œå“ªä¸€ä¸ªä»£ç å—è¢«æ‰§è¡Œçš„ç®—æ³•å¤§è‡´å¦‚ä¸‹ï¼š</p><ul><li>æ£€æŸ¥æ¯ä¸ª<code>case</code>ä»£ç å—</li><li>å¦‚æœä»»æ„ä¸€ä¸ª<code>case</code>ä»£ç å—å‡†å¤‡å¥½å‘é€æˆ–æ¥æ”¶ï¼Œæ‰§è¡Œå¯¹åº”å†…å®¹</li><li>å¦‚æœå¤šäºä¸€ä¸ª<code>case</code>ä»£ç å—å‡†å¤‡å¥½å‘é€æˆ–æ¥æ”¶ï¼Œ<strong>éšæœº</strong>é€‰å–ä¸€ä¸ªå¹¶æ‰§è¡Œå¯¹åº”å†…å®¹</li><li>å¦‚æœä»»ä½•ä¸€ä¸ª<code>case</code>ä»£ç å—éƒ½æ²¡æœ‰å‡†å¤‡å¥½ï¼Œç­‰å¾…</li><li>å¦‚æœæœ‰<code>default</code>ä»£ç å—ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•<code>case</code>ä»£ç å—å‡†å¤‡å¥½ï¼Œæ‰§è¡Œ<code>default</code>ä»£ç å—å¯¹åº”å†…å®¹</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯å¯¹ &lt;a class=&quot;link&quot; href=&quot;http://golangtutorials.blogspot.com/2011/06/channels-in-go-range-and-select.html&quot;&gt;Channels in Go </summary>
      
    
    
    
    <category term="goè¯­è¨€" scheme="http://jiahaohong1997.github.io/categories/go%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="golang" scheme="http://jiahaohong1997.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Golang é‡ç‚¹é—®é¢˜</title>
    <link href="http://jiahaohong1997.github.io/2022/02/09/Golang%20%E9%87%8D%E7%82%B9%E9%97%AE%E9%A2%98/"/>
    <id>http://jiahaohong1997.github.io/2022/02/09/Golang%20%E9%87%8D%E7%82%B9%E9%97%AE%E9%A2%98/</id>
    <published>2022-02-09T15:50:00.000Z</published>
    <updated>2022-03-04T09:05:12.174Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Golang-Map-çš„åº•å±‚å®ç°"><a href="#Golang-Map-çš„åº•å±‚å®ç°" class="headerlink" title="Golang Map çš„åº•å±‚å®ç°"></a>Golang Map çš„åº•å±‚å®ç°</h1><h2 id="ä¸€èˆ¬çš„-map-çš„å®ç°"><a href="#ä¸€èˆ¬çš„-map-çš„å®ç°" class="headerlink" title="ä¸€èˆ¬çš„ map çš„å®ç°"></a>ä¸€èˆ¬çš„ map çš„å®ç°</h2><p>&emsp;&emsp;ä¸€èˆ¬çš„Mapä¼šåŒ…å«ä¸¤ä¸ªä¸»è¦ç»“æ„ï¼š</p><ul><li>æ•°ç»„ï¼šæ•°ç»„é‡Œçš„å€¼æŒ‡å‘ä¸€ä¸ªé“¾è¡¨ï¼Œä¸€èˆ¬ç§°ä¸ºæ¡¶ğŸª£ä½</li><li>é“¾è¡¨ï¼šç›®çš„è§£å†³hashå†²çªçš„é—®é¢˜ï¼Œå¹¶å­˜æ”¾é”®å€¼</li></ul><p>å¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="origin_map.jpg" alt="avatar"><br>è¯»å–ä¸€ä¸ªkeyå€¼çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   key</span><br><span class="line">   |</span><br><span class="line">   v                 </span><br><span class="line">+------------------------------------+</span><br><span class="line">|      keyé€šè¿‡<span class="built_in">hash</span>å‡½æ•°å¾—åˆ°keyçš„<span class="built_in">hash</span>    |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">   |</span><br><span class="line">   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|       keyçš„<span class="built_in">hash</span>é€šè¿‡å–æ¨¡æˆ–è€…ä½æ“ä½œ     |</span><br><span class="line">|          å¾—åˆ°keyåœ¨æ•°ç»„ä¸Šçš„ç´¢å¼•        |</span><br><span class="line">+------------------------------------+</span><br><span class="line">   |</span><br><span class="line">   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|         é€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„é“¾è¡¨         |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">   |</span><br><span class="line">   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|       éå†é“¾è¡¨å¯¹æ¯”keyå’Œç›®æ ‡key        |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">   |</span><br><span class="line">   v</span><br><span class="line">+------------------------------------+</span><br><span class="line">|              ç›¸ç­‰åˆ™è¿”å›value         |</span><br><span class="line">+------------------+-----------------+</span><br><span class="line">                   |</span><br><span class="line">                   v </span><br><span class="line">                 value</span><br></pre></td></tr></table></figure><h2 id="Go-è¯­è¨€ä¸­-Map-çš„å®ç°æ€è·¯"><a href="#Go-è¯­è¨€ä¸­-Map-çš„å®ç°æ€è·¯" class="headerlink" title="Go è¯­è¨€ä¸­ Map çš„å®ç°æ€è·¯"></a>Go è¯­è¨€ä¸­ Map çš„å®ç°æ€è·¯</h2><p>&emsp;&emsp;Goè¯­è¨€è§£å†³hashå†²çªä¸æ˜¯é“¾è¡¨ï¼Œå®é™…<strong>ä¸»è¦</strong>ç”¨çš„æ•°ç»„(å†…å­˜ä¸Šçš„è¿ç»­ç©ºé—´)ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img lazyload src="/images/loading.svg" data-src="go_map.png" alt="avatar"></p><p>&emsp;&emsp;ä½†æ˜¯å¹¶ä¸æ˜¯åªä½¿ç”¨ä¸€ä¸ªæ•°ç»„(è¿ç»­å†…å­˜ç©ºé—´)å­˜æ”¾é”®å’Œå€¼ï¼Œè€Œæ˜¯ä½¿ç”¨äº†ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜å‚¨é”®å’Œå€¼ï¼Œå›¾ç¤ºå¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="origin_map1.png" alt="avatar"><br>&emsp;&emsp;ä¸Šå›¾ä¸­ï¼š-   åˆ†åˆ«å¯¹åº”çš„æ˜¯ä¸¤ä¸ªæ ¸å¿ƒçš„ç»“æ„ä½“<code>hmap</code>å’Œ<code>bmap</code>ï¼Œ <code>bmap</code>é‡Œæœ‰ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«å­˜æ”¾keyå’Œvalue</p><p>&emsp;&emsp;æˆ‘ä»¬é€šè¿‡ä¸€æ¬¡<code>è¯»æ“ä½œ</code>ä¸ºä¾‹ï¼Œçœ‹çœ‹è¯»å–æŸä¸ªkeyçš„å€¼çš„ä¸€ä¸ª<strong>å¤§è‡´è¿‡ç¨‹</strong>ï¼š</p><ol><li>é€šè¿‡hashå‡½æ•°è·å–ç›®æ ‡keyçš„<strong>å“ˆå¸Œ</strong>ï¼Œå“ˆå¸Œå’Œæ•°ç»„çš„é•¿åº¦é€šè¿‡ä½æ“ä½œè·å–æ•°ç»„ä½ç½®çš„<strong>ç´¢å¼•</strong>(å¤‡æ³¨ï¼šè·å–ç´¢å¼•å€¼çš„æ–¹å¼ä¸€èˆ¬æœ‰å–æ¨¡æˆ–ä½æ“ä½œï¼Œä½æ“ä½œçš„æ€§èƒ½å¥½äº›)</li><li>éå†bmapé‡Œçš„é”®ï¼Œå’Œç›®æ ‡keyå¯¹æ¯”è·å–<strong>keyçš„ç´¢å¼•</strong>(æ‰¾ä¸åˆ°åˆ™è¿”å›ç©ºå€¼)</li><li>æ ¹æ®<strong>keyçš„ç´¢å¼•</strong>é€šè¿‡è®¡ç®—åç§»é‡ï¼Œè·å–åˆ°å¯¹åº”value<br><img lazyload src="/images/loading.svg" data-src="origin_map2.png" alt="avatar"></li></ol><h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><h3 id="æ ¸å¿ƒç»“æ„ä½“-hmap"><a href="#æ ¸å¿ƒç»“æ„ä½“-hmap" class="headerlink" title="æ ¸å¿ƒç»“æ„ä½“ hmap"></a>æ ¸å¿ƒç»“æ„ä½“ hmap</h3><p>&emsp;&emsp;<code>hmap</code>çš„ç»“æ„å…¶å®åˆšå¼€å§‹çœ‹èµ·æ¥å…¶å®è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæœ‰ä¸å°‘çš„å­—æ®µï¼Œå…·ä½“å­—æ®µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="hmap.png" alt="avatar"><br>å­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š</p><ol><li>countï¼šé”®å€¼å¯¹çš„æ•°é‡</li><li>Bï¼š2^B=len(buckets)</li><li>hash0ï¼šhashå› å­</li><li>bucketsï¼šæŒ‡å‘ä¸€ä¸ªæ•°ç»„(è¿ç»­å†…å­˜ç©ºé—´)ï¼Œæ•°ç»„çš„ç±»å‹ä¸º[]bmapï¼Œbmapç±»å‹å°±æ˜¯å­˜åœ¨é”®å€¼å¯¹çš„ç»“æ„ä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼Œè¿™ä¸ªå­—æ®µæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºæ­£å¸¸æ¡¶ã€‚</li><li>oldbucketsï¼šæ‰©å®¹æ—¶ï¼Œå­˜æ”¾ä¹‹å‰çš„buckets(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</li><li>extraï¼šæº¢å‡ºæ¡¶ç»“æ„ï¼Œæ­£å¸¸æ¡¶é‡Œé¢æŸä¸ªbmapå­˜æ»¡äº†ï¼Œä¼šä½¿ç”¨è¿™é‡Œé¢çš„å†…å­˜ç©ºé—´å­˜æ”¾é”®å€¼å¯¹</li><li>noverflowï¼šæº¢å‡ºæ¡¶é‡Œbmapå¤§è‡´çš„æ•°é‡</li><li>nevacuateï¼šåˆ†æµæ¬¡æ•°ï¼Œæˆå€æ‰©å®¹åˆ†æµæ“ä½œè®¡æ•°çš„å­—æ®µ(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</li><li>flagsï¼šçŠ¶æ€æ ‡è¯†ï¼Œæ¯”å¦‚æ­£åœ¨è¢«å†™ã€bucketså’Œoldbucketsåœ¨è¢«éå†ã€ç­‰é‡æ‰©å®¹(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</li></ol><p><img lazyload src="/images/loading.svg" data-src="bmap.png" alt="avatar"><br>&emsp;&emsp;<code>buckets</code>æŒ‡å‘äº†ä¸€ä¸ªæ•°ç»„(è¿ç»­çš„å†…å­˜ç©ºé—´)ï¼Œæ•°ç»„çš„å…ƒç´ æ˜¯<code>bmap</code>ç±»å‹ï¼Œè¿™ä¸ªå­—æ®µæˆ‘ä»¬ç§°ä¹‹ä¸ºæ­£å¸¸æ¡¶ã€‚</p><h3 id="æ ¸å¿ƒç»“æ„ä½“-bmap"><a href="#æ ¸å¿ƒç»“æ„ä½“-bmap" class="headerlink" title="æ ¸å¿ƒç»“æ„ä½“ bmap"></a>æ ¸å¿ƒç»“æ„ä½“ bmap</h3><p>&emsp;&emsp;æ­£å¸¸æ¡¶<code>hmap.buckets</code>çš„å…ƒç´ æ˜¯ä¸€ä¸ª<code>bmap</code>ç»“æ„ã€‚<code>bmap</code>çš„å…·ä½“å­—æ®µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="bmap1.png" alt="avatar"><br>å­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š</p><ol><li>topbitsï¼šé•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]uint8ï¼Œå…ƒç´ ä¸ºï¼škeyè·å–çš„hashçš„é«˜8ä½ï¼Œéå†æ—¶å¯¹æ¯”ä½¿ç”¨ï¼Œæé«˜æ€§èƒ½ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></li><li>keysï¼šé•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]keytypeï¼Œå…ƒç´ ä¸ºï¼šå…·ä½“çš„keyå€¼ã€‚<strong>å¦‚ä¸‹å›¾æ‰€ç¤º</strong></li><li>elemsï¼šé•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œ[]elemtypeï¼Œå…ƒç´ ä¸ºï¼šé”®å€¼å¯¹çš„keyå¯¹åº”çš„å€¼ã€‚</li><li>overflowï¼šæŒ‡å‘çš„<code>hmap.extra.overflow</code>æº¢å‡ºæ¡¶é‡Œçš„<code>bmap</code>ï¼Œä¸Šé¢çš„å­—æ®µ<code>topbits</code>ã€<code>keys</code>ã€<code>elems</code>é•¿åº¦ä¸º8ï¼Œæœ€å¤šå­˜8ç»„é”®å€¼å¯¹ï¼Œå­˜æ»¡äº†å°±å¾€æŒ‡å‘çš„è¿™ä¸ª<code>bmap</code>é‡Œå­˜</li><li>padï¼šå¯¹é½å†…å­˜ä½¿ç”¨çš„ï¼Œä¸æ˜¯æ¯ä¸ªbmapéƒ½æœ‰ä¼šè¿™ä¸ªå­—æ®µï¼Œéœ€è¦æ»¡è¶³ä¸€å®šæ¡ä»¶<br><img lazyload src="/images/loading.svg" data-src="bmap2.png" alt="avatar"></li></ol><p>&emsp;&emsp;<strong>ç»“è®ºï¼šæ¯ä¸ª<code>bmap</code>ç»“æ„æœ€å¤šå­˜æ”¾8ç»„é”®å€¼å¯¹ã€‚</strong></p><h3 id="hmap-å’Œ-bmap-çš„åŸºæœ¬ç»“æ„åˆèµ·æ¥"><a href="#hmap-å’Œ-bmap-çš„åŸºæœ¬ç»“æ„åˆèµ·æ¥" class="headerlink" title="hmap å’Œ bmap çš„åŸºæœ¬ç»“æ„åˆèµ·æ¥"></a>hmap å’Œ bmap çš„åŸºæœ¬ç»“æ„åˆèµ·æ¥</h3><p>&emsp;&emsp;åˆ†åˆ«äº†è§£äº†<code>hmap</code>å’Œ<code>bmap</code>çš„åŸºæœ¬ç»“æ„åï¼Œæˆ‘ä»¬æŠŠä¸Šé¢çš„å†…å®¹åˆå¹¶èµ·æ¥ï¼Œå°±å¾—åˆ°å¦‚ä¸‹çš„Mapç»“æ„å›¾ï¼š<br><img lazyload src="/images/loading.svg" data-src="combine_map.png" alt="avatar"></p><h3 id="æº¢å‡ºæ¡¶"><a href="#æº¢å‡ºæ¡¶" class="headerlink" title="æº¢å‡ºæ¡¶"></a>æº¢å‡ºæ¡¶</h3><p>&emsp;&emsp;ä¸Šé¢è®²<code>bmap</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸æ˜¯å¾—åˆ°äº†ä¸ªç»“è®ºä¹ˆâ€œæ¯ä¸ª<code>bmap</code>ç»“æ„æœ€å¤šå­˜æ”¾8ç»„é”®å€¼å¯¹ã€‚â€ï¼Œæ‰€ä»¥é—®é¢˜æ¥äº†ï¼š</p><blockquote><p>æ­£å¸¸æ¡¶é‡Œçš„<code>bmap</code>å­˜æ»¡äº†æ€ä¹ˆåŠ?</p></blockquote><p>&emsp;&emsp;è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å°±è¦è¯´åˆ°<code>hmap.extra</code>ç»“æ„äº†ï¼Œ<code>hmap.extra</code>æ˜¯ä¸ªç»“æ„ä½“ï¼Œç»“æ„å›¾ç¤ºå’Œå­—æ®µé‡Šä¹‰å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="overflow.png" alt="avatar"></p><ol><li>overflowï¼šç§°ä¹‹ä¸º<strong>æº¢å‡ºæ¡¶</strong>ã€‚å’Œ<code>hmap.buckets</code>çš„ç±»å‹ä¸€æ ·ä¹Ÿæ˜¯æ•°ç»„<code>[]bmap</code>ï¼Œå½“æ­£å¸¸æ¡¶<code>bmap</code>å­˜æ»¡äº†çš„æ—¶å€™å°±ä½¿ç”¨<code>hmap.extra.overflow</code>çš„<code>bmap</code>ã€‚</li><li>oldoverflowï¼šæ‰©å®¹æ—¶å­˜æ”¾ä¹‹å‰çš„overflow(Mapæ‰©å®¹ç›¸å…³å­—æ®µ)</li><li>nextoverflowï¼šæŒ‡å‘æº¢å‡ºæ¡¶é‡Œä¸‹ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„<code>bmap</code></li></ol><blockquote><p>é—®é¢˜ï¼šæ­£å¸¸æ¡¶<code>hmap.buckets</code>é‡Œçš„<code>bmap</code>æ˜¯<strong>æ€ä¹ˆå…³è”ä¸Š</strong>æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>çš„<code>bmap</code>å‘¢ï¼Ÿ</p></blockquote><p>ç­”ï¼šå°±æ˜¯æˆ‘ä»¬ä»‹ç»<code>bmap</code>ç»“æ„æ—¶é‡Œçš„<code>bmap.overflow</code>å­—æ®µ(å¦‚ä¸‹å›¾æ‰€ç¤º)ã€‚<code>bmap.overflow</code>æ˜¯ä¸ªæŒ‡é’ˆç±»å‹ï¼Œå­˜æ”¾äº†å¯¹åº”ä½¿ç”¨çš„æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>é‡Œçš„<code>bmap</code>çš„åœ°å€ã€‚</p><p><strong>é—®é¢˜åˆæ¥äº†</strong>ï¼š</p><blockquote><p>æ­£å¸¸æ¡¶<code>hmap.buckets</code>é‡Œçš„<code>bmap</code>æ˜¯<strong>ä»€ä¹ˆæ—¶å€™å…³è”ä¸Š</strong>æº¢å‡ºæ¡¶<code>hmap.extra.overflow</code>çš„<code>bmap</code>å‘¢ï¼Ÿ</p></blockquote><p>ç­”ï¼šMapå†™æ“ä½œçš„æ—¶å€™ã€‚</p><p>&emsp;&emsp;<strong>å½“<code>hmap</code>å­˜åœ¨æº¢å‡ºæ¡¶æ—¶ï¼Œä¸”å½“å‰æº¢å‡ºæ¡¶åªè¢«ä½¿ç”¨äº†ä¸€ä¸ªbmap</strong>æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å…³ç³»å›¾ï¼š<br><img lazyload src="/images/loading.svg" data-src="overflow1.png" alt="avatar"><br>&emsp;&emsp;åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ­£å¸¸æ¡¶çš„<code>bmap</code>å’Œæº¢å‡ºæ¡¶çš„<code>bmap</code>å®é™…æ„æˆäº†é“¾è¡¨å…³ç³»ï¼Œæ‰€ä»¥è¿™ä¹Ÿè§£é‡Šäº†å¼€ç¯‡æˆ‘ä»¬è¯´åˆ°çš„â€œGoé‡Œé¢Mapçš„å®ç°<strong>ä¸»è¦</strong>ç”¨åˆ°äº†æ•°ç»„â€ï¼Œå…¶æ¬¡è¿˜ç”¨åˆ°äº†é“¾è¡¨ã€‚</p><h2 id="å†æ¬¡åˆ†æMapçš„è¯»"><a href="#å†æ¬¡åˆ†æMapçš„è¯»" class="headerlink" title="å†æ¬¡åˆ†æMapçš„è¯»"></a>å†æ¬¡åˆ†æMapçš„è¯»</h2><p>&emsp;&emsp;æˆ‘ä»¬å†æ¬¡é€šè¿‡ä¸€æ¬¡è¯»æ“ä½œä¸ºä¾‹ï¼Œçœ‹çœ‹è¯»å–æŸä¸ªkeyçš„å€¼çš„ä¸€ä¸ªå¤§è‡´è¿‡ç¨‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="readmap.png" alt="avatar"><br>&emsp;&emsp;Go è¯­è¨€ä¸­ map é‡‡ç”¨çš„æ˜¯å“ˆå¸ŒæŸ¥æ‰¾è¡¨ï¼Œç”±ä¸€ä¸ª key é€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°å“ˆå¸Œå€¼ï¼Œ64 ä½ç³»ç»Ÿä¸­å°±ç”Ÿæˆä¸€ä¸ª 64bit çš„å“ˆå¸Œå€¼ï¼Œç”±è¿™ä¸ªå“ˆå¸Œå€¼å°† key å¯¹åº”åˆ°ä¸åŒçš„æ¡¶ ï¼ˆbucketï¼‰ä¸­ï¼Œå½“æœ‰å¤šä¸ªå“ˆå¸Œæ˜ å°„åˆ°ç›¸åŒçš„çš„æ¡¶ä¸­æ—¶ï¼Œä½¿ç”¨é“¾è¡¨è§£å†³å“ˆå¸Œå†² çªã€‚key ç»è¿‡ hash åå…± 64 ä½ï¼Œæ ¹æ® hmap ä¸­ B çš„å€¼ï¼Œè®¡ç®—å®ƒåˆ°åº•è¦è½åœ¨å“ªä¸ªæ¡¶ æ—¶ï¼Œæ¡¶çš„æ•°é‡ä¸º 2^Bï¼Œå¦‚ B=5ï¼Œé‚£ä¹ˆç”¨ 64 ä½æœ€å 5 ä½è¡¨ç¤ºç¬¬å‡ å·æ¡¶ï¼Œåœ¨ç”¨ hash å€¼çš„é«˜ 8 ä½ç¡®å®šåœ¨ bucket ä¸­çš„å­˜å‚¨ä½ç½®ï¼Œå½“å‰ bmap ä¸­çš„ bucket æœªæ‰¾åˆ°ï¼Œåˆ™æŸ¥ è¯¢å¯¹åº”çš„ overflow bucketï¼Œå¯¹åº”ä½ç½®æœ‰æ•°æ®åˆ™å¯¹æ¯”å®Œæ•´çš„å“ˆå¸Œå€¼ï¼Œç¡®å®šæ˜¯å¦ æ˜¯è¦æŸ¥æ‰¾çš„æ•°æ®ã€‚ å¦‚æœä¸¤ä¸ªä¸åŒçš„ key è½åœ¨çš„åŒä¸€ä¸ªæ¡¶ä¸Šï¼Œhash å†²çªä½¿ç”¨é“¾è¡¨æ³•æ¥è¿‘ï¼Œéå† bucket ä¸­çš„ key å¦‚æœå½“å‰å¤„äº map è¿›è¡Œäº†æ‰©å®¹ï¼Œå¤„äºæ•°æ®æ¬ç§»çŠ¶æ€ï¼Œåˆ™ä¼˜å…ˆä» oldbuckets æŸ¥æ‰¾ã€‚</p><h2 id="Golang-Map-å¦‚ä½•æ‰©å®¹"><a href="#Golang-Map-å¦‚ä½•æ‰©å®¹" class="headerlink" title="Golang Map å¦‚ä½•æ‰©å®¹"></a>Golang Map å¦‚ä½•æ‰©å®¹</h2><p>è£…è½½å› å­ï¼šcount/2^B<br>è§¦å‘æ¡ä»¶ï¼š</p><ol><li>è£…å¡«å› å­æ˜¯å¦å¤§äº 6.5</li><li>overflow bucket æ˜¯å¦å¤ªå¤š</li></ol><p>è§£å†³æ–¹æ³•ï¼š</p><ol><li>åŒå€æ‰©å®¹ï¼šæ‰©å®¹é‡‡å–äº†ä¸€ç§ç§°ä¸ºâ€œæ¸è¿›å¼â€åœ°æ–¹å¼ï¼ŒåŸæœ‰çš„ key å¹¶ä¸ä¼šä¸€ æ¬¡æ€§æ¬è¿å®Œæ¯•ï¼Œæ¯æ¬¡æœ€å¤šåªä¼šæ¬è¿ 2 ä¸ª bucket</li><li>ç­‰é‡æ‰©å®¹ï¼šé‡æ–°æ’åˆ—ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œé‡æ–°æ’åˆ—ä¹Ÿè§£å†³ä¸äº†ï¼Œmap æˆäº†é“¾è¡¨ï¼Œæ€§èƒ½å¤§å¤§é™ä½ï¼Œæ­¤æ—¶å“ˆå¸Œç§å­ hash0 çš„è®¾ç½®ï¼Œå¯ä»¥é™ä½æ­¤ç±»æç«¯åœºæ™¯çš„å‘ç”Ÿã€‚</li></ol><h1 id="Channel"><a href="#Channel" class="headerlink" title="Channel"></a>Channel</h1><p>&emsp;&emsp;åœ¨ Go è¯­è¨€ä¸­ï¼Œä¸è¦é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ï¼Œè€Œè¦é€šè¿‡é€šä¿¡æ¥å®ç°å†…å­˜å…±äº«ã€‚Go çš„ CSPï¼ˆCommunicating Sequential Processï¼‰å¹¶å‘æ¨¡å‹ï¼Œä¸­æ–‡å«åšé€šä¿¡é¡ºåºè¿›ç¨‹ï¼Œæ˜¯é€šè¿‡ goroutine å’Œ channel æ¥å®ç°çš„ã€‚æ‰€ä»¥ channel æ”¶å‘éµå¾ªå…ˆè¿›å…ˆå‡º FIFOï¼Œåˆ†ä¸ºæœ‰ç¼“å­˜å’Œæ— ç¼“å­˜ï¼Œchannel ä¸­å¤§è‡´æœ‰ buffer(å½“ç¼“å†²åŒºå¤§å°ä¸ä¸º 0 æ—¶ï¼Œæ˜¯ä¸ª ring buffer)ã€sendqã€recvq å½“å‰ channel å› ä¸ºç¼“å†²åŒºä¸è¶³è€Œé˜»å¡çš„é˜Ÿåˆ—ã€ä½¿ç”¨åŒå‘é“¾è¡¨å­˜å‚¨ã€è¿˜æœ‰ä¸€ä¸ª mutex é”æ§åˆ¶å¹¶å‘ã€å…¶ä»–åŸå±ç­‰ã€‚</p><h2 id="channel-çš„åº•å±‚å®ç°"><a href="#channel-çš„åº•å±‚å®ç°" class="headerlink" title="channel çš„åº•å±‚å®ç°"></a>channel çš„åº•å±‚å®ç°</h2><p><img lazyload src="/images/loading.svg" data-src="hchan.png" alt="avatar"><br>ç®€å•è¯´æ˜ï¼š<br><code>buf</code>æ˜¯æœ‰ç¼“å†²çš„channelæ‰€ç‰¹æœ‰çš„ç»“æ„ï¼Œç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ã€‚æ˜¯ä¸ªå¾ªç¯é“¾è¡¨<br><code>sendx</code>å’Œ<code>recvx</code>ç”¨äºè®°å½•<code>buf</code>è¿™ä¸ªå¾ªç¯é“¾è¡¨ä¸­çš„ index<br><code>lock</code>æ˜¯ä¸ªäº’æ–¥é”<br><code>recvq</code>å’Œ<code>sendq</code>åˆ†åˆ«æ˜¯æ¥æ”¶(&lt;-channel)æˆ–è€…å‘é€(channel &lt;- xxx)çš„goroutineæŠ½è±¡å‡ºæ¥çš„ç»“æ„ä½“(sudog)çš„é˜Ÿåˆ—ã€‚æ˜¯ä¸ªåŒå‘é“¾è¡¨</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†ä»‹ç»<code>hchan</code>ä¸­å„éƒ¨åˆ†æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><ol><li><p>å…ˆä»åˆ›å»ºå¼€å§‹<br>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªchannelï¼šch := make(chan int, 3)<br><img lazyload src="/images/loading.svg" data-src="hchan1.png" alt="avatar"><br>åˆ›å»ºchannelå®é™…ä¸Šå°±æ˜¯åœ¨å†…å­˜ä¸­å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>hchan</code>çš„ç»“æ„ä½“ï¼Œå¹¶è¿”å›ä¸€ä¸ªchæŒ‡é’ˆï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡ç¨‹ä¸­channelåœ¨å‡½æ•°ä¹‹é—´çš„ä¼ é€’éƒ½æ˜¯ç”¨çš„è¿™ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°ä¼ é€’ä¸­æ— éœ€ä½¿ç”¨channelçš„æŒ‡é’ˆï¼Œè€Œç›´æ¥ç”¨channelå°±è¡Œäº†ï¼Œå› ä¸ºchannelæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚</p></li><li><p>channelä¸­å‘é€send(ch &lt;- xxx)å’Œrecv(&lt;- ch)æ¥æ”¶<br>å…ˆè€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä½ æƒ³è®©goroutineä»¥å…ˆè¿›å…ˆå‡º(FIFO)çš„æ–¹å¼è¿›å…¥ä¸€ä¸ªç»“æ„ä½“ä¸­ï¼Œä½ ä¼šæ€ä¹ˆæ“ä½œï¼Ÿ  åŠ é”ï¼å¯¹çš„ï¼channelå°±æ˜¯ç”¨äº†ä¸€ä¸ªé”ã€‚hchanæœ¬èº«åŒ…å«ä¸€ä¸ªäº’æ–¥é”<code>mutex</code></p></li></ol><ul><li>channelä¸­é˜Ÿåˆ—æ˜¯å¦‚ä½•å®ç°çš„<br>channelä¸­æœ‰ä¸ªç¼“å­˜bufï¼Œæ˜¯ç”¨æ¥ç¼“å­˜æ•°æ®çš„(å‡å¦‚å®ä¾‹åŒ–äº†å¸¦ç¼“å­˜çš„channelçš„è¯)é˜Ÿåˆ—ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ˜¯å¦‚ä½•å®ç°â€œé˜Ÿåˆ—â€çš„ã€‚å½“ä½¿ç”¨<code>send (ch &lt;- xx)</code>æˆ–è€…<code>recv ( &lt;-ch)</code>çš„æ—¶å€™ï¼Œé¦–å…ˆè¦é”ä½<code>hchan</code>è¿™ä¸ªç»“æ„ä½“ã€‚<br>æ‰€ä»¥ä¸éš¾çœ‹å‡ºï¼ŒGoä¸­é‚£å¥ç»å…¸çš„è¯ï¼š<code>Do not communicate by sharing memory; instead, share memory by communicating.</code>çš„å…·ä½“å®ç°å°±æ˜¯åˆ©ç”¨channelæŠŠæ•°æ®ä»ä¸€ç«¯copyåˆ°äº†å¦ä¸€ç«¯ï¼<br>è¿˜çœŸæ˜¯ç¬¦åˆ<code>channel</code>çš„è‹±æ–‡å«ä¹‰ï¼š<br><img lazyload src="/images/loading.svg" data-src="hchan_channl.gif" alt="avatar"></li></ul><ol start="3"><li>å½“channelç¼“å­˜æ»¡äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¿™å…¶ä¸­çš„åŸç†æ˜¯æ€æ ·çš„ï¼Ÿ<br>ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå½“channelç¼“å­˜æ»¡äº†ï¼Œæˆ–è€…æ²¡æœ‰ç¼“å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»§ç»­send(ch &lt;- xxx)æˆ–è€…recv(&lt;- ch)ä¼šé˜»å¡å½“å‰goroutineï¼Œä½†æ˜¯ï¼Œæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼ŒGoçš„goroutineæ˜¯ç”¨æˆ·æ€çš„çº¿ç¨‹(<code>user-space threads</code>)ï¼Œç”¨æˆ·æ€çš„çº¿ç¨‹æ˜¯éœ€è¦è‡ªå·±å»è°ƒåº¦çš„ï¼ŒGoæœ‰è¿è¡Œæ—¶çš„schedulerå»å¸®æˆ‘ä»¬å®Œæˆè°ƒåº¦è¿™ä»¶äº‹æƒ…ã€‚goroutineçš„é˜»å¡æ“ä½œï¼Œå®é™…ä¸Šæ˜¯è°ƒç”¨<code>send (ch &lt;- xx)</code>æˆ–è€…<code>recv ( &lt;-ch)</code>çš„æ—¶å€™ä¸»åŠ¨è§¦å‘çš„ï¼Œå…·ä½“è¯·çœ‹ä»¥ä¸‹å†…å®¹ï¼š<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">3</span>)  </span><br><span class="line">  </span><br><span class="line">ch &lt;- <span class="number">1</span>  </span><br><span class="line">ch &lt;- <span class="number">1</span>  </span><br><span class="line">ch &lt;- <span class="number">1</span></span><br></pre></td></tr></table></figure><img lazyload src="/images/loading.svg" data-src="hchan_block.png" alt="avatar"><br><img lazyload src="/images/loading.svg" data-src="hchan_block1.png" alt="avatar"><br>è¿™ä¸ªæ—¶å€™G1æ­£åœ¨æ­£å¸¸è¿è¡Œ,å½“å†æ¬¡è¿›è¡Œsendæ“ä½œ(ch&lt;-1)çš„æ—¶å€™ï¼Œä¼šä¸»åŠ¨è°ƒç”¨Goçš„è°ƒåº¦å™¨(G0)ï¼Œé€šè¿‡ runtime.gopark å‡½æ•°è®©G1ç­‰å¾…ï¼Œå¹¶ä»è®©å‡ºMï¼Œè®©å…¶ä»–Gå»ä½¿ç”¨<br><img lazyload src="/images/loading.svg" data-src="hchan_block2.png" alt="avatar"><br>åŒæ—¶G1ä¹Ÿä¼šè¢«æŠ½è±¡æˆå«æœ‰G1æŒ‡é’ˆå’Œsendå…ƒç´ çš„<code>sudog</code>ç»“æ„ä½“ä¿å­˜åˆ°hchançš„<code>sendq</code>ä¸­ç­‰å¾…è¢«å”¤é†’ã€‚<br><img lazyload src="/images/loading.svg" data-src="hchan_blok3.gif" alt="avatar"><br>é‚£ä¹ˆï¼ŒG1ä»€ä¹ˆæ—¶å€™è¢«å”¤é†’å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™G2éš†é‡ç™»åœºã€‚<br><img lazyload src="/images/loading.svg" data-src="hchan_block4.png" alt="avatar"><br>G2æ‰§è¡Œäº†recvæ“ä½œ<code>p := &lt;-ch</code>ï¼Œäºæ˜¯ä¼šå‘ç”Ÿä»¥ä¸‹çš„æ“ä½œï¼š<br><img lazyload src="/images/loading.svg" data-src="hchan_block5.gif" alt="avatar"><br>G2ä»ç¼“å­˜é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®ï¼Œchannelä¼šå°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„G1æ¨å‡ºï¼Œå°†G1å½“æ—¶sendçš„æ•°æ®æ¨åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åè°ƒç”¨Goçš„schedulerï¼Œå”¤é†’G1(runtime.goready)ï¼Œå¹¶æŠŠG1æ”¾åˆ°å¯è¿è¡Œçš„Goroutineé˜Ÿåˆ—ä¸­ã€‚é€šè¿‡è¿™ç§åä½œå¼çš„è°ƒåº¦æ¥å®ç° goroutine çš„è°ƒåº¦ã€‚<br><img lazyload src="/images/loading.svg" data-src="hchan_block6.gif" alt="avatar"></li></ol><ul><li>å‡å¦‚æ˜¯å…ˆè¿›è¡Œæ‰§è¡Œrecvæ“ä½œçš„G2ä¼šæ€ä¹ˆæ ·ï¼Ÿ<br><img lazyload src="/images/loading.svg" data-src="hchan_block7_1.png" alt="avatar"><br>è¿™ä¸ªæ—¶å€™G2ä¼šä¸»åŠ¨è°ƒç”¨Goçš„è°ƒåº¦å™¨,è®©G2ç­‰å¾…ï¼Œå¹¶ä»è®©å‡ºMï¼Œè®©å…¶ä»–Gå»ä½¿ç”¨ã€‚<br>G2è¿˜ä¼šè¢«æŠ½è±¡æˆå«æœ‰G2æŒ‡é’ˆå’Œrecvç©ºå…ƒç´ çš„<code>sudog</code>ç»“æ„ä½“ä¿å­˜åˆ°hchançš„<code>recvq</code>ä¸­ç­‰å¾…è¢«å”¤é†’<br><img lazyload src="/images/loading.svg" data-src="hchan_block7.gif" alt="avatar"><br>æ­¤æ—¶æ°å¥½æœ‰ä¸ªgoroutine G1å¼€å§‹å‘channelä¸­æ¨é€æ•°æ® <code>ch &lt;- 1</code>ã€‚<br>æ­¤æ—¶ï¼Œéå¸¸æœ‰æ„æ€çš„äº‹æƒ…å‘ç”Ÿäº†ï¼š<br><img lazyload src="/images/loading.svg" data-src="hchan_block8.gif" alt="avatar"><br>G1å¹¶æ²¡æœ‰é”ä½channelï¼Œç„¶åå°†æ•°æ®æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯ç›´æ¥æŠŠæ•°æ®ä»G1ç›´æ¥copyåˆ°äº†G2çš„æ ˆä¸­ã€‚è¿™ç§æ–¹å¼éå¸¸çš„èµï¼åœ¨å”¤é†’è¿‡ç¨‹ä¸­ï¼ŒG2æ— éœ€å†è·å¾—channelçš„é”ï¼Œç„¶åä»ç¼“å­˜ä¸­å–æ•°æ®ã€‚å‡å°‘äº†å†…å­˜çš„copyï¼Œæé«˜äº†æ•ˆç‡ã€‚<strong>å½“ç„¶è¿™ç§æ–¹æ³•åªèƒ½åœ¨ runtime ä¸‹è‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è¦ runtime è°ƒåº¦ G2 çš„æ ˆä¸Šçš„å˜é‡ç›´æ¥å» G1 çš„æ ˆä¸Šè·å–æ•°æ®</strong>ã€‚<br><img lazyload src="/images/loading.svg" data-src="hchan_block9.gif" alt="avatar"><br>ä¹‹åå’Œä¹‹å‰ä¸€æ ·ï¼ŒG2 å˜æˆ runnable çš„çŠ¶æ€ï¼Œè¢«æŒ‚åˆ°åŸå§‹çš„ P é˜Ÿåˆ—ä¸­ã€‚æ–°ç‰ˆæœ¬è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸ºäº†é¿å… G2 è¢«æ”¾åˆ° P  é˜Ÿåˆ—æœ«å°¾ä¼šè¢«å…¶ä»–çš„ P çªƒå–ï¼ˆwork-stealingï¼‰ï¼ŒG2 ä¼šè¢«ä¼˜å…ˆæŒ‚è½½åˆ°å½“å‰é˜Ÿåˆ—æ­£åœ¨æ‰§è¡Œçš„ goroutine åé¢ï¼Œå¾ˆå¿«å°±èƒ½å¾—åˆ°æ‰§è¡Œã€‚</li></ul><h2 id="channel-çš„ç‰¹æ€§"><a href="#channel-çš„ç‰¹æ€§" class="headerlink" title="channel çš„ç‰¹æ€§"></a>channel çš„ç‰¹æ€§</h2><ol><li>ç»™ä¸€ä¸ª nil channel å‘é€æ•°æ®ï¼Œé€ æˆæ°¸è¿œé˜»å¡</li><li>ä»ä¸€ä¸ª nil channel æ¥æ”¶æ•°æ®ï¼Œé€ æˆæ°¸è¿œé˜»å¡</li><li>ç»™ä¸€ä¸ªå·²ç»å…³é—­çš„ channel å‘é€æ•°æ®ï¼Œå¼•èµ· panic</li><li>ä»ä¸€ä¸ªå·²ç»å…³é—­çš„ channel æ¥æ”¶æ•°æ®ï¼Œå¦‚æœç¼“å†²åŒºä¸­ä¸ºç©ºï¼Œåˆ™è¿”å›ä¸€ä¸ªé›¶å€¼</li><li>æ— ç¼“å†²çš„ channel æ˜¯åŒæ­¥çš„ï¼Œè€Œæœ‰ç¼“å†²çš„ channel æ˜¯éåŒæ­¥çš„</li><li>å…³é—­ä¸€ä¸ª nil channel å°†ä¼šå‘ç”Ÿ panic<br><img lazyload src="/images/loading.svg" data-src="channel.jpg" alt="avatar"></li></ol><h2 id="Channel-çš„-ring-buffer-å®ç°"><a href="#Channel-çš„-ring-buffer-å®ç°" class="headerlink" title="Channel çš„ ring buffer å®ç°"></a>Channel çš„ ring buffer å®ç°</h2><p>&emsp;&emsp;channel ä¸­ä½¿ç”¨äº† ring buffer(ç¯å½¢ç¼“å†²åŒº) æ¥ç¼“å­˜å†™å…¥çš„æ•°æ®ã€‚ring buffer æœ‰å¾ˆå¤šå¥½å¤„ï¼Œè€Œä¸”éå¸¸é€‚åˆç”¨æ¥å®ç° FIFO å¼çš„å›ºå®šé•¿åº¦é˜Ÿåˆ—ã€‚åœ¨ channel ä¸­ï¼Œring buffer çš„å®ç°å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="ring_buffer.jpg" alt="avatar"><br>&emsp;&emsp;æœ‰ä¸¤ä¸ªä¸ buffer ç›¸å…³çš„å˜é‡:recvx å’Œ sendxã€‚å…¶ä¸­ sendx è¡¨ç¤º buffer ä¸­å¯å†™çš„ indexï¼Œrecvx è¡¨ç¤º buffer ä¸­å¯è¯»çš„ indexã€‚ ä» recvx åˆ° sendx ä¹‹é—´çš„å…ƒç´ ï¼Œè¡¨ç¤ºå·²æ­£å¸¸å­˜æ”¾å…¥ buffer ä¸­çš„æ•°æ®ã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ buf[recvx]æ¥è¯»å–åˆ°é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½¿ç”¨ buf[sendx] = x æ¥å°†å…ƒç´ æ”¾åˆ°é˜Ÿå°¾ã€‚</p><h1 id="Go-å¹¶å‘ç¼–ç¨‹"><a href="#Go-å¹¶å‘ç¼–ç¨‹" class="headerlink" title="Go å¹¶å‘ç¼–ç¨‹"></a>Go å¹¶å‘ç¼–ç¨‹</h1><h2 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h2><h3 id="Mutex-çš„å‡ ç§çŠ¶æ€"><a href="#Mutex-çš„å‡ ç§çŠ¶æ€" class="headerlink" title="Mutex çš„å‡ ç§çŠ¶æ€"></a>Mutex çš„å‡ ç§çŠ¶æ€</h3><ol><li>mutexLocked â€” è¡¨ç¤ºäº’æ–¥é”çš„é”å®šçŠ¶æ€ï¼›</li><li>mutexWoken â€” è¡¨ç¤ºä»æ­£å¸¸æ¨¡å¼è¢«ä»å”¤é†’ï¼›</li><li>mutexStarving â€” å½“å‰çš„äº’æ–¥é”è¿›å…¥é¥¥é¥¿çŠ¶æ€ï¼›</li><li>waitersCount â€” å½“å‰äº’æ–¥é”ä¸Šç­‰å¾…çš„ Goroutine ä¸ªæ•°ï¼›</li></ol><h3 id="Mutex-æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼"><a href="#Mutex-æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼" class="headerlink" title="Mutex æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼"></a>Mutex æ­£å¸¸æ¨¡å¼å’Œé¥¥é¥¿æ¨¡å¼</h3><ul><li><p><strong>æ­£å¸¸æ¨¡å¼(éå…¬å¹³é”)</strong><br>&emsp;&emsp;æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ç­‰å¾…é”çš„ goroutine æŒ‰ç…§ FIFO(å…ˆè¿›å…ˆå‡º)é¡ºåºç­‰å¾…ã€‚å”¤é†’çš„ goroutine ä¸ä¼šç›´æ¥æ‹¥æœ‰é”ï¼Œè€Œæ˜¯ä¼šå’Œæ–°è¯·æ±‚é”çš„ goroutine ç«äº‰é”çš„æ‹¥æœ‰ã€‚æ–°è¯·æ±‚é”çš„ goroutine å…·æœ‰ä¼˜åŠ¿ï¼šå®ƒæ­£åœ¨ CPU ä¸Šæ‰§è¡Œï¼Œè€Œä¸”å¯èƒ½æœ‰å¥½å‡ ä¸ªï¼Œæ‰€ä»¥åˆšåˆšå”¤é†’çš„ goroutine æœ‰å¾ˆå¤§å¯èƒ½åœ¨é”ç«äº‰ä¸­å¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¢« å”¤é†’çš„ goroutine ä¼šåŠ å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—çš„å‰é¢ã€‚ å¦‚æœä¸€ä¸ªç­‰å¾…çš„ goroutine è¶…è¿‡ 1ms æ²¡æœ‰è·å–é”ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šæŠŠé”è½¬å˜ä¸ºé¥¥é¥¿æ¨¡å¼ã€‚</p></li><li><p><strong>é¥¥é¥¿æ¨¡å¼(å…¬å¹³é”)</strong><br>&emsp;&emsp;ä¸ºäº†è§£å†³äº†ç­‰å¾… G é˜Ÿåˆ—çš„é•¿å°¾é—®é¢˜ã€‚é¥¥é¥¿æ¨¡å¼ä¸‹ï¼Œç›´æ¥ç”± unlock æŠŠé”äº¤ç»™ç­‰å¾…é˜Ÿåˆ—ä¸­æ’åœ¨ç¬¬ä¸€ä½çš„ G(é˜Ÿå¤´)ï¼ŒåŒæ—¶ï¼Œé¥¥é¥¿æ¨¡å¼ä¸‹ï¼Œæ–°è¿›æ¥çš„ G ä¸ä¼šå‚ä¸æŠ¢é”ä¹Ÿä¸ä¼šè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼Œä¼šç›´æ¥è¿›å…¥ç­‰å¾…é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œè¿™æ ·å¾ˆå¥½çš„è§£å†³äº†è€çš„ G ä¸€ç›´æŠ¢ä¸åˆ°é”çš„åœºæ™¯ã€‚ é¥¥é¥¿æ¨¡å¼çš„è§¦å‘æ¡ä»¶ï¼Œå½“ä¸€ä¸ª G ç­‰å¾…é”æ—¶é—´è¶…è¿‡ 1 æ¯«ç§’æ—¶ï¼Œæˆ–è€…å½“å‰é˜Ÿåˆ—åªå‰© ä¸‹ä¸€ä¸ª G çš„æ—¶å€™ï¼ŒMutex åˆ‡æ¢åˆ°é¥¥é¥¿æ¨¡å¼ã€‚</p></li></ul><blockquote><p>æ€»ç»“ï¼šå¯¹äºä¸¤ç§æ¨¡å¼ï¼Œæ­£å¸¸æ¨¡å¼ä¸‹çš„æ€§èƒ½æ˜¯æœ€å¥½çš„ï¼Œgoroutine å¯ä»¥è¿ç»­å¤šæ¬¡è·å– é”ï¼Œé¥¥é¥¿æ¨¡å¼è§£å†³äº†å–é”å…¬å¹³çš„é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½ä¼šä¸‹é™ï¼Œå…¶å®æ˜¯æ€§èƒ½å’Œå…¬å¹³çš„ ä¸€ä¸ªå¹³è¡¡æ¨¡å¼ã€‚</p></blockquote><h3 id="Mutex-å…è®¸è‡ªæ—‹çš„æ¡ä»¶"><a href="#Mutex-å…è®¸è‡ªæ—‹çš„æ¡ä»¶" class="headerlink" title="Mutex å…è®¸è‡ªæ—‹çš„æ¡ä»¶"></a>Mutex å…è®¸è‡ªæ—‹çš„æ¡ä»¶</h3><p>&emsp;&emsp;åœ¨1ä¸ªåç¨‹è·å–é”æ—¶ï¼Œå¦ä¸€ä¸ªåç¨‹ä¸€ç›´å°è¯•ï¼Œç›´åˆ°èƒ½å¤Ÿè·å–é”ï¼ˆä¸æ–­å¾ªç¯ï¼‰ï¼Œè¿™å°±æ˜¯è‡ªæ—‹é”ã€‚</p><ol><li>é”å·²è¢«å ç”¨ï¼Œå¹¶ä¸”é”ä¸å¤„äºé¥¥é¥¿æ¨¡å¼ã€‚</li><li>ç§¯ç´¯çš„è‡ªæ—‹æ¬¡æ•°å°äºæœ€å¤§è‡ªæ—‹æ¬¡æ•°ï¼ˆactive_spin=4ï¼‰ã€‚</li><li>cpu æ ¸æ•°å¤§äº 1ã€‚</li><li>æœ‰ç©ºé—²çš„ Pã€‚</li><li>å½“å‰ goroutine æ‰€æŒ‚è½½çš„ P ä¸‹ï¼Œæœ¬åœ°å¾…è¿è¡Œé˜Ÿåˆ—ä¸ºç©ºã€‚</li></ol><h3 id="RWMutex"><a href="#RWMutex" class="headerlink" title="RWMutex"></a>RWMutex</h3><ul><li><p>å®ç°åŸç†<br>&emsp;&emsp;é€šè¿‡è®°å½• readerCount è¯»é”çš„æ•°é‡æ¥è¿›è¡Œæ§åˆ¶ï¼Œå½“æœ‰ä¸€ä¸ªå†™é”çš„æ—¶å€™ï¼Œä¼šå°†è¯»é”æ•°é‡è®¾ç½®ä¸ºè´Ÿæ•° 1&lt;&lt;30ã€‚ç›®çš„æ˜¯è®©æ–°è¿›å…¥çš„è¯»é”ç­‰å¾…å†™é”ä¹‹åé‡Šæ”¾é€šçŸ¥è¯»é”ã€‚åŒæ ·çš„å†™é”ä¹Ÿä¼šç­‰ç­‰å¾…ä¹‹å‰çš„è¯»é”éƒ½é‡Šæ”¾å®Œæ¯•ï¼Œæ‰ä¼šå¼€å§‹è¿›è¡Œåç»­çš„æ“ä½œã€‚ è€Œç­‰å†™é”é‡Šæ”¾å®Œä¹‹åï¼Œä¼šå°†å€¼é‡æ–°åŠ ä¸Š 1&lt;&lt;30, å¹¶é€šçŸ¥åˆšæ‰æ–°è¿›å…¥çš„è¯»é” (rw.readerSem)ï¼Œä¸¤è€…äº’ç›¸é™åˆ¶ã€‚</p></li><li><p>æ³¨æ„äº‹é¡¹</p></li></ul><ol><li>RWMutex æ˜¯å•å†™å¤šè¯»é”ï¼Œè¯¥é”å¯ä»¥åŠ å¤šä¸ªè¯»é”æˆ–è€…ä¸€ä¸ªå†™é”</li><li>è¯»é”å ç”¨çš„æƒ…å†µä¸‹ä¼šé˜»æ­¢å†™ï¼Œä¸ä¼šé˜»æ­¢è¯»ï¼Œå¤šä¸ª goroutine å¯ä»¥åŒæ—¶è·å–è¯»é”</li><li>å†™é”ä¼šé˜»æ­¢å…¶ä»– goroutineï¼ˆæ— è®ºè¯»å’Œå†™ï¼‰è¿›æ¥ï¼Œæ•´ä¸ªé”ç”±è¯¥ goroutine ç‹¬å </li><li>é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯</li><li>RWMutex çš„ä¸€ä¸ªå†™é” Lock å»é”å®šä¸´ç•ŒåŒºçš„å…±äº«èµ„æºï¼Œå¦‚æœä¸´ç•ŒåŒºçš„å…±äº«èµ„æºå·²è¢«ï¼ˆè¯»é”æˆ–å†™é”ï¼‰é”å®šï¼Œè¿™ä¸ªå†™é”æ“ä½œçš„ goroutine å°†è¢«é˜»å¡ç›´åˆ° è§£é”ã€‚</li><li>RWMutex çš„è¯»é”æˆ–å†™é”åœ¨æœªé”å®šçŠ¶æ€ï¼Œè§£é”æ“ä½œéƒ½ä¼šå¼•å‘ panic</li><li>RWMutex åœ¨é¦–æ¬¡è¢«ä½¿ç”¨ä¹‹åå°±ä¸èƒ½å†è¢«æ‹·è´</li><li>å†™é”è¢«è§£é”åï¼Œæ‰€æœ‰å› æ“ä½œé”å®šè¯»é”è€Œè¢«é˜»å¡çš„ goroutine ä¼šè¢«å”¤é†’ï¼Œå¹¶éƒ½å¯ä»¥æˆåŠŸé”å®šè¯»é”ã€‚</li><li>è¯»é”è¢«è§£é”åï¼Œåœ¨æ²¡æœ‰è¢«å…¶ä»–è¯»é”é”å®šçš„å‰æä¸‹ï¼Œæ‰€æœ‰å› æ“ä½œé”å®šå†™é”è€Œè¢«é˜»å¡çš„ goroutineï¼Œå…¶ä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„ä¸€ä¸ª goroutine ä¼šè¢«å”¤é†’ã€‚</li></ol><h2 id="sync-åŒ…ä¸­çš„ä¸¤ä¸ªå¯¹è±¡"><a href="#sync-åŒ…ä¸­çš„ä¸¤ä¸ªå¯¹è±¡" class="headerlink" title="sync åŒ…ä¸­çš„ä¸¤ä¸ªå¯¹è±¡"></a>sync åŒ…ä¸­çš„ä¸¤ä¸ªå¯¹è±¡</h2><h3 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h3><ol><li>Once å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸”ä»…ä»…æ‰§è¡Œä¸€æ¬¡åŠ¨ä½œï¼Œå¸¸å¸¸ç”¨äºå•ä¾‹å¯¹è±¡çš„åˆå§‹åŒ–åœºæ™¯ã€‚</li><li>Once å¸¸å¸¸ç”¨æ¥åˆå§‹åŒ–å•ä¾‹èµ„æºï¼Œæˆ–è€…å¹¶å‘è®¿é—®åªéœ€åˆå§‹åŒ–ä¸€æ¬¡çš„å…±äº«èµ„æºï¼Œæˆ–è€…åœ¨æµ‹è¯•çš„æ—¶å€™åˆå§‹åŒ–ä¸€æ¬¡æµ‹è¯•èµ„æºã€‚</li><li>sync.Once åªæš´éœ²äº†ä¸€ä¸ªæ–¹æ³• Doï¼Œä½ å¯ä»¥å¤šæ¬¡è°ƒç”¨ Do æ–¹æ³•ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ Do æ–¹æ³•æ—¶ f å‚æ•°æ‰ä¼šæ‰§è¡Œï¼Œè¿™é‡Œçš„ f æ˜¯ä¸€ä¸ªæ— å‚æ•°æ— è¿”å›å€¼çš„å‡½æ•°ã€‚</li></ol><h3 id="sync-Pool"><a href="#sync-Pool" class="headerlink" title="sync.Pool"></a>sync.Pool</h3><p>&emsp;&emsp;å¯¹äºå¾ˆå¤šéœ€è¦é‡å¤åˆ†é…ã€å›æ”¶å†…å­˜çš„åœ°æ–¹ï¼Œsync.Pool æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚é¢‘ç¹åœ°åˆ†é…ã€å›æ”¶å†…å­˜ä¼šç»™ GC å¸¦æ¥ä¸€å®šçš„è´Ÿæ‹…ï¼Œä¸¥é‡çš„æ—¶å€™ä¼šå¼•èµ· CPU çš„æ¯›åˆºï¼Œè€Œ sync.Pool å¯ä»¥å°†æš‚æ—¶ä¸ç”¨çš„å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œå¾…ä¸‹æ¬¡éœ€è¦çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨å†æ¬¡ç»è¿‡å†…å­˜åˆ†é…ï¼Œå¤ç”¨å¯¹è±¡çš„å†…å­˜ï¼Œå‡è½» GC çš„å‹åŠ›ï¼Œæå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><h1 id="Switch-å’Œ-Select-çš„åŒºåˆ«"><a href="#Switch-å’Œ-Select-çš„åŒºåˆ«" class="headerlink" title="Switch å’Œ Select çš„åŒºåˆ«"></a>Switch å’Œ Select çš„åŒºåˆ«</h1><h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><p><code>select</code>åªèƒ½åº”ç”¨äºchannelçš„æ“ä½œï¼Œæ—¢å¯ä»¥ç”¨äºchannelçš„æ•°æ®æ¥æ”¶ï¼Œä¹Ÿå¯ä»¥ç”¨äºchannelçš„æ•°æ®å‘é€ã€‚å¦‚æœ<code>select</code>çš„å¤šä¸ªåˆ†æ”¯éƒ½æ»¡è¶³æ¡ä»¶ï¼Œåˆ™ä¼šéšæœºçš„é€‰å–å…¶ä¸­ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„åˆ†æ”¯ã€‚<br><code>default</code>: selectä¸­çš„defaultæ˜¯å½“selectå‘ç°æ²¡æœ‰caseæ»¡è¶³,è¦blockæ—¶çš„é€‰æ‹©</p><h2 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h2><p><code>switch</code>å¯ä»¥ä¸ºå„ç§ç±»å‹è¿›è¡Œåˆ†æ”¯æ“ä½œï¼Œ è®¾ç½®å¯ä»¥ä¸ºæ¥å£ç±»å‹è¿›è¡Œåˆ†æ”¯åˆ¤æ–­(é€šè¿‡i.(type))ã€‚<code>switch</code> åˆ†æ”¯æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œè¿™å’Œ<code>select</code>ä¸åŒã€‚<br><code>default</code>:  switchä¸­çš„defaultæ˜¯é»˜è®¤çš„æ„æ€,å½“æ‰€æœ‰caseä¸æ»¡è¶³çš„æ—¶å€™,å°±ä¼šæ‰§è¡Œdefault</p><h1 id="Go-runtime"><a href="#Go-runtime" class="headerlink" title="Go runtime"></a>Go runtime</h1><h2 id="åç¨‹è°ƒåº¦"><a href="#åç¨‹è°ƒåº¦" class="headerlink" title="åç¨‹è°ƒåº¦"></a>åç¨‹è°ƒåº¦</h2><h3 id="Gorutine"><a href="#Gorutine" class="headerlink" title="Gorutine"></a>Gorutine</h3><p>&emsp;&emsp;Goroutine â€œGoroutine æ˜¯ä¸€ä¸ªä¸å…¶ä»– goroutines å¹¶è¡Œè¿è¡Œåœ¨åŒä¸€åœ°å€ç©ºé—´çš„ Go å‡½æ•°æˆ–æ–¹æ³•ã€‚ä¸€ä¸ªè¿è¡Œçš„ç¨‹åºç”±ä¸€ä¸ªæˆ–æ›´å¤šä¸ª goroutine ç»„æˆã€‚å®ƒä¸çº¿ç¨‹ã€åç¨‹ã€è¿› ç¨‹ç­‰ä¸åŒã€‚å®ƒæ˜¯ä¸€ä¸ª goroutineâ€ â€”â€” Rob Pike<br>&emsp;&emsp;Goroutines åœ¨åŒä¸€ä¸ªç”¨æˆ·åœ°å€ç©ºé—´é‡Œå¹¶è¡Œç‹¬ç«‹æ‰§è¡Œ functionsï¼Œchannels åˆ™ç”¨äº goroutines é—´çš„é€šä¿¡å’ŒåŒæ­¥è®¿é—®æ§åˆ¶ã€‚</p><h3 id="GMP-æ¨¡å‹"><a href="#GMP-æ¨¡å‹" class="headerlink" title="GMP æ¨¡å‹"></a>GMP æ¨¡å‹</h3><ol><li>Gï¼ˆGoroutineï¼‰ï¼šæˆ‘ä»¬æ‰€è¯´çš„åç¨‹ï¼Œä¸ºç”¨æˆ·çº§çš„è½»é‡çº§çº¿ç¨‹ï¼Œæ¯ä¸ª Goroutine å¯¹è±¡ä¸­çš„ sched ä¿å­˜ç€å…¶ä¸Šä¸‹æ–‡ä¿¡æ¯.</li><li>Mï¼ˆMachineï¼‰ï¼šå¯¹å†…æ ¸çº§çº¿ç¨‹çš„å°è£…ï¼Œæ•°é‡å¯¹åº”çœŸå®çš„ CPU æ•°ï¼ˆçœŸæ­£å¹²æ´»çš„å¯¹è±¡ï¼‰</li><li>Pï¼ˆProcessorï¼‰ï¼šå³ä¸º G å’Œ M çš„è°ƒåº¦å¯¹è±¡ï¼Œç”¨æ¥è°ƒåº¦ G å’Œ M ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œ å…¶æ•°é‡å¯é€šè¿‡ GOMAXPROCS()æ¥è®¾ç½®ï¼Œé»˜è®¤ä¸ºæ ¸å¿ƒæ•°ã€‚</li></ol><p>&emsp;&emsp;è°ƒåº¦å™¨æŠŠ G éƒ½åˆ†é…åˆ° M ä¸Šï¼Œä¸åŒçš„ G åœ¨ä¸åŒçš„ M å¹¶å‘è¿è¡Œæ—¶ï¼Œéƒ½éœ€è¦å‘ç³»ç»Ÿç”³è¯·èµ„æºï¼Œæ¯”å¦‚å †æ ˆå†…å­˜ç­‰ï¼Œå› ä¸ºèµ„æºæ˜¯å…¨å±€çš„ï¼Œå°±ä¼šå› ä¸ºèµ„æºç«äº‰ç…§æˆå¾ˆå¤šæ€§èƒ½æŸè€—ã€‚ä¸ºäº†è§£å†³è¿™ä¸€çš„é—®é¢˜ go ä» 1.1 ç‰ˆæœ¬å¼•å…¥ï¼Œåœ¨è¿è¡Œæ—¶ç³»ç»Ÿçš„æ—¶å€™åŠ å…¥ p å¯¹è±¡ï¼Œè®© P å»ç®¡ç†è¿™ä¸ª G å¯¹è±¡ï¼ŒM æƒ³è¦è¿è¡Œ Gï¼Œå¿…é¡»ç»‘å®š Pï¼Œæ‰èƒ½è¿è¡Œ P æ‰€ç®¡ç†çš„ Gã€‚å•çº¯çš„ GM æ¨¡å‹ä¼šå¼•èµ·ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>å•ä¸€å…¨å±€äº’æ–¥é”(Sched.Lock)å’Œé›†ä¸­çŠ¶æ€å­˜å‚¨ï¼›</li><li>Goroutine ä¼ é€’é—®é¢˜ï¼ˆM ç»å¸¸åœ¨ M ä¹‹é—´ä¼ é€’â€å¯è¿è¡Œâ€çš„ goroutineï¼‰</li><li>æ¯ä¸ª M åšå†…å­˜ç¼“å­˜ï¼Œå¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ï¼Œæ•°æ®å±€éƒ¨æ€§è¾ƒå·®</li><li>é¢‘ç¹ syscall è°ƒç”¨ï¼Œå¯¼è‡´ä¸¥é‡çš„çº¿ç¨‹é˜»å¡/è§£é”ï¼ŒåŠ å‰§é¢å¤–çš„æ€§èƒ½æŸè€—ã€‚</li></ol><h4 id="GMP-è°ƒåº¦æµç¨‹"><a href="#GMP-è°ƒåº¦æµç¨‹" class="headerlink" title="GMP è°ƒåº¦æµç¨‹"></a>GMP è°ƒåº¦æµç¨‹</h4><p>&emsp;&emsp;åœ¨ Go ä¸­ï¼Œ<strong>çº¿ç¨‹æ˜¯è¿è¡Œ goroutine çš„å®ä½“ï¼Œè°ƒåº¦å™¨çš„åŠŸèƒ½æ˜¯æŠŠå¯è¿è¡Œçš„ goroutine åˆ†é…åˆ°å·¥ä½œçº¿ç¨‹ä¸Š</strong>ã€‚<br><img lazyload src="/images/loading.svg" data-src="goroutine.jpg" alt="avatar"></p><ol><li>å…¨å±€é˜Ÿåˆ—ï¼ˆGlobal Queueï¼‰ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„ Gã€‚</li><li>P çš„æœ¬åœ°é˜Ÿåˆ—ï¼šåŒå…¨å±€é˜Ÿåˆ—ç±»ä¼¼ï¼Œå­˜æ”¾çš„ä¹Ÿæ˜¯ç­‰å¾…è¿è¡Œçš„ Gï¼Œå­˜çš„æ•°é‡æœ‰é™ï¼Œä¸è¶…è¿‡ 256 ä¸ªã€‚æ–°å»º Gâ€™æ—¶ï¼ŒGâ€™ä¼˜å…ˆåŠ å…¥åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„ G ç§»åŠ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚</li><li>P åˆ—è¡¨ï¼šæ‰€æœ‰çš„ P éƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€å¤šæœ‰ GOMAXPROCS(å¯é…ç½®) ä¸ªã€‚</li><li>Mï¼šçº¿ç¨‹æƒ³è¿è¡Œä»»åŠ¡å°±å¾—è·å– Pï¼Œä» P çš„æœ¬åœ°é˜Ÿåˆ—è·å– Gï¼ŒP é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒM ä¹Ÿä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—æ‹¿ä¸€æ‰¹ G æ”¾åˆ° P çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œæˆ–ä»å…¶ä»– P çš„æœ¬åœ°é˜Ÿåˆ—å·ä¸€åŠæ”¾åˆ°è‡ªå·± P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚M è¿è¡Œ Gï¼ŒG æ‰§è¡Œä¹‹åï¼ŒM ä¼šä» P è·å–ä¸‹ä¸€ä¸ª Gï¼Œä¸æ–­é‡å¤ä¸‹å»ã€‚</li></ol><p><strong>Goroutine è°ƒåº¦å™¨å’Œ OS è°ƒåº¦å™¨æ˜¯é€šè¿‡ M ç»“åˆèµ·æ¥çš„ï¼Œæ¯ä¸ª M éƒ½ä»£è¡¨äº† 1 ä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒOS è°ƒåº¦å™¨è´Ÿè´£æŠŠå†…æ ¸çº¿ç¨‹åˆ†é…åˆ° CPU çš„æ ¸ä¸Šæ‰§è¡Œ</strong>ã€‚</p><blockquote><p>æœ‰å…³ P å’Œ M çš„ä¸ªæ•°é—®é¢˜</p><ol><li>P çš„æ•°é‡ï¼šç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡ $GOMAXPROCS æˆ–è€…æ˜¯ç”± runtime çš„æ–¹æ³• GOMAXPROCS() å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„<strong>ä»»æ„æ—¶åˆ»éƒ½åªæœ‰ $GOMAXPROCS ä¸ª goroutine åœ¨åŒæ—¶è¿è¡Œ</strong>ã€‚</li><li>M çš„æ•°é‡ï¼šï¼ˆ1ï¼‰ go è¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgo ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½® M çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ 10000. ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚<br>ï¼ˆ2ï¼‰ runtime/debug ä¸­çš„ SetMaxThreads å‡½æ•°ï¼Œè®¾ç½® M çš„æœ€å¤§æ•°é‡<br>ï¼ˆ3ï¼‰ä¸€ä¸ª M é˜»å¡äº†ï¼Œä¼šåˆ›å»ºæ–°çš„ M</li></ol><p> <strong>M ä¸ P çš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ª M é˜»å¡ï¼ŒP å°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ª Mï¼Œæ‰€ä»¥ï¼Œå³ä½¿ P çš„é»˜è®¤æ•°é‡æ˜¯ 1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ª M å‡ºæ¥ã€‚</strong></p></blockquote><blockquote><p>P å’Œ M ä½•æ—¶è¢«åˆ›å»º</p><ol><li>P ä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº† P çš„æœ€å¤§æ•°é‡ n åï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»º n ä¸ª Pã€‚</li><li>M ä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„ M æ¥å…³è” P å¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„ Gã€‚æ¯”å¦‚æ‰€æœ‰çš„ M æ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€Œ P ä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„ Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„ Mã€‚</li></ol></blockquote><h5 id="è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥"><a href="#è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥" class="headerlink" title="è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥"></a>è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥</h5><ol><li>work stealing æœºåˆ¶ï¼šå½“æœ¬çº¿ç¨‹æ— å¯è¿è¡Œçš„ G æ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹ç»‘å®šçš„ P å·å– Gï¼Œè€Œä¸æ˜¯é”€æ¯çº¿ç¨‹ã€‚</li><li>hand off æœºåˆ¶ï¼šå½“æœ¬çº¿ç¨‹å› ä¸º G è¿›è¡Œç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹é‡Šæ”¾ç»‘å®šçš„ Pï¼ŒæŠŠ P è½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œã€‚</li></ol><p><img lazyload src="/images/loading.svg" data-src="gmp.jpg" alt="avatar"></p><ol><li>æ¯ä¸ª P æœ‰ä¸ªå±€éƒ¨é˜Ÿåˆ—ï¼Œå±€éƒ¨é˜Ÿåˆ—ä¿å­˜å¾…æ‰§è¡Œçš„ goroutine(æµç¨‹ 2)ï¼Œå½“ M ç»‘å®šçš„ P çš„çš„å±€éƒ¨é˜Ÿåˆ—å·²ç»æ»¡äº†ä¹‹åå°±ä¼šæŠŠ goroutine æ”¾åˆ°å…¨å±€é˜Ÿåˆ—(æµç¨‹ 2-1)</li><li>æ¯ä¸ª P å’Œä¸€ä¸ª M ç»‘å®šï¼ŒM æ˜¯çœŸæ­£çš„æ‰§è¡Œ P ä¸­ goroutine çš„å®ä½“(æµç¨‹ 3)ï¼ŒM ä»ç»‘å®šçš„ P ä¸­çš„å±€éƒ¨é˜Ÿåˆ—è·å– G æ¥æ‰§è¡Œ</li><li>å½“ M ç»‘å®šçš„ P çš„å±€éƒ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒM ä¼šä»å…¨å±€é˜Ÿåˆ—è·å–åˆ°æœ¬åœ°é˜Ÿåˆ—æ¥æ‰§è¡Œ G(æµç¨‹ 3.1)ï¼Œå½“ä»å…¨å±€é˜Ÿåˆ—ä¸­æ²¡æœ‰è·å–åˆ°å¯æ‰§è¡Œçš„ G æ—¶å€™ï¼ŒM ä¼šä»å…¶ä»– P çš„å±€éƒ¨é˜Ÿåˆ—ä¸­å·å– G æ¥æ‰§è¡Œ(æµç¨‹ 3.2)ï¼Œè¿™ç§ä»å…¶ä»– P å·çš„æ–¹å¼ç§°ä¸º work stealing</li><li>å½“ G å› ç³»ç»Ÿè°ƒç”¨(syscall)é˜»å¡æ—¶ä¼šé˜»å¡ Mï¼Œæ­¤æ—¶ P ä¼šå’Œ M è§£ç»‘å³ hand offï¼Œå¹¶å¯»æ‰¾æ–°çš„ idle çš„ Mï¼Œè‹¥æ²¡æœ‰ idle çš„ M å°±ä¼šæ–°å»ºä¸€ä¸ª M(æµç¨‹ 5.1)ã€‚</li><li>å½“ G å›  channel æˆ–è€… network I/O é˜»å¡æ—¶ï¼Œä¸ä¼šé˜»å¡ Mï¼ŒM ä¼šå¯»æ‰¾å…¶ä»– runnable çš„ Gï¼›å½“é˜»å¡çš„ G æ¢å¤åä¼šé‡æ–°è¿›å…¥ runnable è¿›å…¥ P é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ(æµç¨‹ 5.3)</li><li>å½“ M ç³»ç»Ÿè°ƒç”¨ç»“æŸæ—¶å€™ï¼Œè¿™ä¸ª G ä¼šå°è¯•è·å–ä¸€ä¸ªç©ºé—²çš„ P æ‰§è¡Œï¼Œå¹¶æ”¾å…¥åˆ°è¿™ä¸ª P çš„æœ¬åœ°é˜Ÿåˆ—ã€‚å¦‚æœè·å–ä¸åˆ° Pï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ M å˜æˆä¼‘çœ çŠ¶æ€ï¼Œ åŠ å…¥åˆ°ç©ºé—²çº¿ç¨‹ä¸­ï¼Œç„¶åè¿™ä¸ª G ä¼šè¢«æ”¾å…¥å…¨å±€é˜Ÿåˆ—ä¸­ã€‚</li></ol><h5 id="ç‰¹æ®Šçš„-M0-å’Œ-G0"><a href="#ç‰¹æ®Šçš„-M0-å’Œ-G0" class="headerlink" title="ç‰¹æ®Šçš„ M0 å’Œ G0"></a>ç‰¹æ®Šçš„ M0 å’Œ G0</h5><p>M0ï¼šå¯åŠ¨ç¨‹åºåçš„ç¼–å·ä¸º 0 çš„ä¸»çº¿ç¨‹ï¼Œè¿™ä¸ª M å¯¹åº”çš„å®ä¾‹ä¼šåœ¨å…¨å±€å˜é‡ runtime.m0 ä¸­ï¼Œä¸éœ€è¦åœ¨ heap ä¸Šåˆ†é…ï¼ŒM0 è´Ÿè´£æ‰§è¡Œåˆå§‹åŒ–æ“ä½œå’Œå¯åŠ¨ç¬¬ä¸€ä¸ª Gï¼Œ åœ¨ä¹‹å M0 å°±å’Œå…¶ä»–çš„ M ä¸€æ ·äº†ã€‚<br>G0ï¼šæ˜¯æ¯æ¬¡å¯åŠ¨ä¸€ä¸ª M éƒ½ä¼šç¬¬ä¸€ä¸ªåˆ›å»ºçš„ goroutineï¼ŒG0 ä»…ç”¨äºè´Ÿè´£è°ƒåº¦çš„ Gï¼ŒG0 ä¸æŒ‡å‘ä»»ä½•å¯æ‰§è¡Œçš„å‡½æ•°ï¼Œæ¯ä¸ª M éƒ½ä¼šæœ‰ä¸€ä¸ªè‡ªå·±çš„ G0ã€‚åœ¨è°ƒåº¦æˆ–ç³»ç»Ÿè°ƒç”¨æ—¶ä¼šä½¿ç”¨ G0 çš„æ ˆç©ºé—´ï¼Œå…¨å±€å˜é‡çš„ G0 æ˜¯ M0 çš„ G0ã€‚</p><h3 id="Go-è°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ"><a href="#Go-è°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ" class="headerlink" title="Go è°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ"></a>Go è°ƒåº¦å™¨è°ƒåº¦åœºæ™¯è¿‡ç¨‹å…¨è§£æ</h3><ol><li><p>åœºæ™¯ 1<br>P æ‹¥æœ‰ G1ï¼ŒM1 è·å– P åå¼€å§‹è¿è¡Œ G1ï¼ŒG1 ä½¿ç”¨ <code>go func()</code> åˆ›å»ºäº† G2ï¼Œä¸ºäº†å±€éƒ¨æ€§ G2 ä¼˜å…ˆåŠ å…¥åˆ° P1 çš„æœ¬åœ°é˜Ÿåˆ—ã€‚<br><img lazyload src="/images/loading.svg" data-src="q1.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 2<br>G1 è¿è¡Œå®Œæˆå (å‡½æ•°ï¼šgoexit)ï¼ŒM ä¸Šè¿è¡Œçš„ goroutine åˆ‡æ¢ä¸º G0ï¼ŒG0 è´Ÿè´£è°ƒåº¦æ—¶åç¨‹çš„åˆ‡æ¢ï¼ˆå‡½æ•°ï¼šscheduleï¼‰ã€‚ä» P çš„æœ¬åœ°é˜Ÿåˆ—å– G2ï¼Œä» G0 åˆ‡æ¢åˆ° G2ï¼Œå¹¶å¼€å§‹è¿è¡Œ G2 (å‡½æ•°ï¼šexecute)ã€‚å®ç°äº†çº¿ç¨‹ M1 çš„å¤ç”¨ã€‚<br><img lazyload src="/images/loading.svg" data-src="q2.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 3<br>å‡è®¾æ¯ä¸ª P çš„æœ¬åœ°é˜Ÿåˆ—åªèƒ½å­˜ 3 ä¸ª Gã€‚G2 è¦åˆ›å»ºäº† 6 ä¸ª Gï¼Œå‰ 3 ä¸ª Gï¼ˆG3, G4, G5ï¼‰å·²ç»åŠ å…¥ p1 çš„æœ¬åœ°é˜Ÿåˆ—ï¼Œp1 æœ¬åœ°é˜Ÿåˆ—æ»¡äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="q3.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 4<br>G2 åœ¨åˆ›å»º G7 çš„æ—¶å€™ï¼Œå‘ç° P1 çš„æœ¬åœ°é˜Ÿåˆ—å·²æ»¡ï¼Œéœ€è¦æ‰§è¡Œ<strong>è´Ÿè½½å‡è¡¡</strong> (æŠŠ P1 ä¸­æœ¬åœ°é˜Ÿåˆ—ä¸­å‰ä¸€åŠçš„ Gï¼Œè¿˜æœ‰æ–°åˆ›å»º G <strong>è½¬ç§»</strong>åˆ°å…¨å±€é˜Ÿåˆ—)<br><img lazyload src="/images/loading.svg" data-src="q4.jpg" alt="avatar"></p></li><li><p>G2 åˆ›å»º G8 æ—¶ï¼ŒP1 çš„æœ¬åœ°é˜Ÿåˆ—æœªæ»¡ï¼Œæ‰€ä»¥ G8 ä¼šè¢«åŠ å…¥åˆ° P1 çš„æœ¬åœ°é˜Ÿåˆ—ã€‚G8 åŠ å…¥åˆ° P1 ç‚¹æœ¬åœ°é˜Ÿåˆ—çš„åŸå› è¿˜æ˜¯å› ä¸º P1 æ­¤æ—¶åœ¨ä¸ M1 ç»‘å®šï¼Œè€Œ G2 æ­¤æ—¶æ˜¯ M1 åœ¨æ‰§è¡Œã€‚æ‰€ä»¥ G2 åˆ›å»ºçš„æ–°çš„ G ä¼šä¼˜å…ˆæ”¾ç½®åˆ°è‡ªå·±çš„ M ç»‘å®šçš„ P ä¸Šã€‚<br><img lazyload src="/images/loading.svg" data-src="q5.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 6<br>è§„å®šï¼šåœ¨åˆ›å»º G æ—¶ï¼Œè¿è¡Œçš„ G ä¼šå°è¯•å”¤é†’å…¶ä»–ç©ºé—²çš„ P å’Œ M ç»„åˆå»æ‰§è¡Œã€‚<br><img lazyload src="/images/loading.svg" data-src="q6.jpg" alt="avatar"><br>å‡å®š G2 å”¤é†’äº† M2ï¼ŒM2 ç»‘å®šäº† P2ï¼Œå¹¶è¿è¡Œ G0ï¼Œä½† P2 æœ¬åœ°é˜Ÿåˆ—æ²¡æœ‰ Gï¼ŒM2 æ­¤æ—¶ä¸ºè‡ªæ—‹çº¿ç¨‹<strong>ï¼ˆæ²¡æœ‰ G ä½†ä¸ºè¿è¡ŒçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¸æ–­å¯»æ‰¾ Gï¼‰</strong>ã€‚</p></li><li><p>åœºæ™¯ 7<br>M2 å°è¯•ä»å…¨å±€é˜Ÿåˆ— (ç®€ç§° â€œGQâ€) å–ä¸€æ‰¹ G æ”¾åˆ° P2 çš„æœ¬åœ°é˜Ÿåˆ—ï¼ˆå‡½æ•°ï¼š<code>findrunnable()</code>ï¼‰ã€‚è‡³å°‘ä»å…¨å±€é˜Ÿåˆ—å– 1 ä¸ª gï¼Œä½†æ¯æ¬¡ä¸è¦ä»å…¨å±€é˜Ÿåˆ—ç§»åŠ¨å¤ªå¤šçš„ g åˆ° p æœ¬åœ°é˜Ÿåˆ—ï¼Œç»™å…¶ä»– p ç•™ç‚¹ã€‚è¿™æ˜¯<strong>ä»å…¨å±€é˜Ÿåˆ—åˆ° P æœ¬åœ°é˜Ÿåˆ—çš„è´Ÿè½½å‡è¡¡</strong>ã€‚<br><img lazyload src="/images/loading.svg" data-src="q7.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 8<br>å‡è®¾ G2 ä¸€ç›´åœ¨ M1 ä¸Šè¿è¡Œï¼Œç»è¿‡ 2 è½®åï¼ŒM2 å·²ç»æŠŠ G7ã€G4 ä»å…¨å±€é˜Ÿåˆ—è·å–åˆ°äº† P2 çš„æœ¬åœ°é˜Ÿåˆ—å¹¶å®Œæˆè¿è¡Œï¼Œå…¨å±€é˜Ÿåˆ—å’Œ P2 çš„æœ¬åœ°é˜Ÿåˆ—éƒ½ç©ºäº†ï¼Œå¦‚åœºæ™¯ 8 å›¾çš„å·¦åŠéƒ¨åˆ†ã€‚<br><img lazyload src="/images/loading.svg" data-src="q8.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 9<br>G1 æœ¬åœ°é˜Ÿåˆ— G5ã€G6 å·²ç»è¢«å…¶ä»– M å·èµ°å¹¶è¿è¡Œå®Œæˆï¼Œå½“å‰ M1 å’Œ M2 åˆ†åˆ«åœ¨è¿è¡Œ G2 å’Œ G8ï¼ŒM3 å’Œ M4 æ²¡æœ‰ goroutine å¯ä»¥è¿è¡Œï¼ŒM3 å’Œ M4 å¤„äºè‡ªæ—‹çŠ¶æ€ï¼Œå®ƒä»¬ä¸æ–­å¯»æ‰¾ goroutineã€‚<br><img lazyload src="/images/loading.svg" data-src="q9.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 10<br>å‡å®šå½“å‰é™¤äº† M3 å’Œ M4 ä¸ºè‡ªæ—‹çº¿ç¨‹ï¼Œè¿˜æœ‰ M5 å’Œ M6 ä¸ºç©ºé—²çš„çº¿ç¨‹ (æ²¡æœ‰å¾—åˆ° P çš„ç»‘å®šï¼Œæ³¨æ„æˆ‘ä»¬è¿™é‡Œæœ€å¤šå°±åªèƒ½å¤Ÿå­˜åœ¨ 4 ä¸ª Pï¼Œæ‰€ä»¥ P çš„æ•°é‡åº”è¯¥æ°¸è¿œæ˜¯ M&gt;=P, å¤§éƒ¨åˆ†éƒ½æ˜¯ M åœ¨æŠ¢å éœ€è¦è¿è¡Œçš„ P)ï¼ŒG8 åˆ›å»ºäº† G9ï¼ŒG8 è¿›è¡Œäº†é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒM2 å’Œ P2 ç«‹å³è§£ç»‘ï¼ŒP2 ä¼šæ‰§è¡Œä»¥ä¸‹åˆ¤æ–­ï¼šå¦‚æœ P2 æœ¬åœ°é˜Ÿåˆ—æœ‰ Gã€å…¨å±€é˜Ÿåˆ—æœ‰ G æˆ–æœ‰ç©ºé—²çš„ Mï¼ŒP2 éƒ½ä¼šç«‹é©¬å”¤é†’ 1 ä¸ª M å’Œå®ƒç»‘å®šï¼Œå¦åˆ™ P2 åˆ™ä¼šåŠ å…¥åˆ°ç©ºé—² P åˆ—è¡¨ï¼Œç­‰å¾… M æ¥è·å–å¯ç”¨çš„ pã€‚æœ¬åœºæ™¯ä¸­ï¼ŒP2 æœ¬åœ°é˜Ÿåˆ—æœ‰ G9ï¼Œå¯ä»¥å’Œå…¶ä»–ç©ºé—²çš„çº¿ç¨‹ M5 ç»‘å®šã€‚<br><img lazyload src="/images/loading.svg" data-src="q10.jpg" alt="avatar"></p></li><li><p>åœºæ™¯ 11<br>G8 åˆ›å»ºäº† G9ï¼Œå‡å¦‚ G8 è¿›è¡Œäº†<strong>éé˜»å¡ç³»ç»Ÿè°ƒç”¨</strong>ã€‚<br><img lazyload src="/images/loading.svg" data-src="q11.jpg" alt="avatar"><br>M2 å’Œ P2 ä¼šè§£ç»‘ï¼Œä½† M2 ä¼šè®°ä½ P2ï¼Œç„¶å G8 å’Œ M2 è¿›å…¥ç³»ç»Ÿè°ƒç”¨çŠ¶æ€ã€‚å½“ G8 å’Œ M2 é€€å‡ºç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¼šå°è¯•è·å– P2ï¼Œå¦‚æœæ— æ³•è·å–ï¼Œåˆ™è·å–ç©ºé—²çš„ Pï¼Œå¦‚æœä¾ç„¶æ²¡æœ‰ï¼ŒG8 ä¼šè¢«è®°ä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œå¹¶åŠ å…¥åˆ°å…¨å±€é˜Ÿåˆ—ï¼ŒM2 å› ä¸ºæ²¡æœ‰ P çš„ç»‘å®šè€Œå˜æˆä¼‘çœ çŠ¶æ€ (é•¿æ—¶é—´ä¼‘çœ ç­‰å¾… GC å›æ”¶é”€æ¯)ã€‚</p></li></ol><h3 id="è°ƒåº¦"><a href="#è°ƒåº¦" class="headerlink" title="è°ƒåº¦"></a>è°ƒåº¦</h3><h4 id="åä½œå¼çš„è°ƒåº¦"><a href="#åä½œå¼çš„è°ƒåº¦" class="headerlink" title="åä½œå¼çš„è°ƒåº¦"></a>åä½œå¼çš„è°ƒåº¦</h4><p>&emsp;&emsp;åœ¨ 1.14 ç‰ˆæœ¬ä¹‹å‰ï¼Œç¨‹åºåªèƒ½ä¾é  Goroutine ä¸»åŠ¨è®©å‡º CPU èµ„æºæ‰èƒ½è§¦å‘è°ƒåº¦ï¼Œå­˜åœ¨é—®é¢˜:</p><ol><li>æŸäº› Goroutine å¯ä»¥é•¿æ—¶é—´å ç”¨çº¿ç¨‹ï¼Œé€ æˆå…¶å®ƒ Goroutine çš„é¥¥é¥¿</li><li>åƒåœ¾å›æ”¶éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºï¼ˆStop-the-worldï¼ŒSTWï¼‰ï¼Œæœ€é•¿å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºæ— æ³•å·¥ä½œã€‚</li></ol><h4 id="åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦"><a href="#åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦" class="headerlink" title="åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦"></a>åŸºäºä¿¡å·çš„æŠ¢å å¼è°ƒåº¦</h4><p>&emsp;&emsp;GO çš„è°ƒåº¦å™¨æ˜¯è¿Ÿé’çš„ï¼Œå®ƒå¾ˆå¯èƒ½ä»€ä¹ˆéƒ½æ²¡åšï¼Œç›´åˆ° M é˜»å¡äº†ç›¸å½“é•¿æ—¶é—´ä»¥åï¼Œæ‰ä¼šå‘ç°æœ‰ä¸€ä¸ª P/M è¢« syscall é˜»å¡äº†ã€‚ç„¶åï¼Œæ‰ä¼šç”¨ç©ºé—²çš„ M æ¥å¼ºè¿™ä¸ª Pã€‚é€šè¿‡ sysmon ç›‘æ§å®ç°çš„æŠ¢å å¼è°ƒåº¦ï¼Œæœ€å¿«åœ¨ 20usï¼Œæœ€æ…¢åœ¨ 10-20ms æ‰ ä¼šå‘ç°æœ‰ä¸€ä¸ª M æŒæœ‰ P å¹¶é˜»å¡äº†ã€‚æ“ä½œç³»ç»Ÿåœ¨ 1ms å†…å¯ä»¥å®Œæˆå¾ˆå¤šæ¬¡çº¿ç¨‹è°ƒåº¦ï¼ˆä¸€èˆ¬æƒ…å†µ 1ms å¯ä»¥å®Œæˆå‡ åæ¬¡çº¿ç¨‹è°ƒåº¦ï¼‰ï¼ŒGo å‘èµ· IO/syscall çš„æ—¶å€™æ‰§ è¡Œè¯¥ G çš„ M ä¼šé˜»å¡ç„¶åè¢« OS è°ƒåº¦èµ°ï¼ŒP ä»€ä¹ˆä¹Ÿä¸å¹²ï¼Œsysmon æœ€æ…¢è¦ 10-20ms æ‰èƒ½å‘ç°è¿™ä¸ªé˜»å¡ï¼Œè¯´ä¸å®šé‚£æ—¶å€™é˜»å¡å·²ç»ç»“æŸäº†ï¼Œå®è´µçš„ P èµ„æºå°±è¿™ä¹ˆè¢«é˜»å¡çš„ M æµªè´¹äº†ã€‚</p><h3 id="GMP-è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›é˜»å¡"><a href="#GMP-è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›é˜»å¡" class="headerlink" title="GMP è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›é˜»å¡"></a>GMP è°ƒåº¦è¿‡ç¨‹ä¸­å­˜åœ¨å“ªäº›é˜»å¡</h3><ol><li>I/Oï¼Œselect</li><li>block on syscall</li><li>channel</li><li>ç­‰å¾…é”</li><li>runtime.Gosched() (G0 è°ƒåº¦ goroutine)</li></ol><h2 id="å†…å­˜åˆ†é…"><a href="#å†…å­˜åˆ†é…" class="headerlink" title="å†…å­˜åˆ†é…"></a>å†…å­˜åˆ†é…</h2><h3 id="Golang-ç®€è¦å†…å­˜åˆ’åˆ†"><a href="#Golang-ç®€è¦å†…å­˜åˆ’åˆ†" class="headerlink" title="Golang ç®€è¦å†…å­˜åˆ’åˆ†"></a>Golang ç®€è¦å†…å­˜åˆ’åˆ†</h3><p><img lazyload src="/images/loading.svg" data-src="mem.jpg" alt="avatar"><br>&emsp;&emsp;å¯ä»¥ç®€å•çš„è®¤ä¸º Golang ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å®šåŒºåŸŸçš„å†…å­˜ï¼Œåˆ†ä¸ºæ ˆï¼ˆStackï¼‰å’Œå †ï¼ˆHeapï¼‰ã€‚æ ˆå†…å­˜ä¼šéšç€å‡½æ•°çš„è°ƒç”¨åˆ†é…å’Œå›æ”¶ï¼›å †å†…å­˜ç”±ç¨‹åºç”³è¯·åˆ†é…ï¼Œç”±åƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰è´Ÿè´£å›æ”¶ã€‚æ€§èƒ½ä¸Šï¼Œæ ˆå†…å­˜çš„ä½¿ç”¨å’Œå›æ”¶æ›´è¿…é€Ÿä¸€äº›ï¼›å°½ç®¡Golang çš„ GC å¾ˆé«˜æ•ˆï¼Œä½†ä¹Ÿä¸å¯é¿å…çš„ä¼šå¸¦æ¥ä¸€äº›æ€§èƒ½æŸè€—ã€‚å› æ­¤ï¼ŒGo ä¼˜å…ˆä½¿ç”¨æ ˆå†…å­˜è¿›è¡Œå†…å­˜åˆ†é…ã€‚åœ¨ä¸å¾—ä¸å°†å¯¹è±¡åˆ†é…åˆ°å †ä¸Šæ—¶ï¼Œæ‰å°†ç‰¹å®šçš„å¯¹è±¡æ”¾åˆ°å †ä¸­ã€‚</p><h3 id="æ ˆå’Œå †"><a href="#æ ˆå’Œå †" class="headerlink" title="æ ˆå’Œå †"></a>æ ˆå’Œå †</h3><p><img lazyload src="/images/loading.svg" data-src="stackHeap.png" alt="avatar"><br>&emsp;&emnsp;ä¸Šå›¾å±•ç¤ºäº†ä¸€ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜åˆ’åˆ†ï¼Œä»£ç ä¸­ä½¿ç”¨çš„å†…å­˜åœ°å€éƒ½æ˜¯è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯å®é™…çš„ç‰©ç†å†…å­˜åœ°å€ã€‚æ ˆå’Œå †åªæ˜¯è™šæ‹Ÿå†…å­˜ä¸Š2å—ä¸åŒåŠŸèƒ½çš„å†…å­˜åŒºåŸŸï¼š</p><ul><li>æ ˆåœ¨é«˜åœ°å€ï¼Œä»é«˜åœ°å€å‘ä½åœ°å€å¢é•¿ã€‚</li><li>å †åœ¨ä½åœ°å€ï¼Œä»ä½åœ°å€å‘é«˜åœ°å€å¢é•¿ã€‚</li></ul><blockquote><p><strong>æ ˆå’Œå †ç›¸æ¯”æœ‰è¿™ä¹ˆå‡ ä¸ªå¥½å¤„</strong>ï¼š</p><ol><li> æ ˆçš„å†…å­˜ç®¡ç†ç®€å•ï¼Œåˆ†é…æ¯”å †ä¸Šå¿«ã€‚</li><li>æ ˆçš„å†…å­˜ä¸éœ€è¦å›æ”¶ï¼Œè€Œå †éœ€è¦ï¼Œæ— è®ºæ˜¯ä¸»åŠ¨freeï¼Œè¿˜æ˜¯è¢«åŠ¨çš„åƒåœ¾å›æ”¶ï¼Œè¿™éƒ½éœ€è¦èŠ±è´¹é¢å¤–çš„CPUã€‚ </li><li>æ ˆä¸Šçš„å†…å­˜æœ‰æ›´å¥½çš„å±€éƒ¨æ€§ï¼Œå †ä¸Šå†…å­˜è®¿é—®å°±ä¸é‚£ä¹ˆå‹å¥½äº†ï¼ŒCPUè®¿é—®çš„2å—æ•°æ®å¯èƒ½åœ¨ä¸åŒçš„é¡µä¸Šï¼ŒCPUè®¿é—®æ•°æ®çš„æ—¶é—´å¯èƒ½å°±ä¸Šå»äº†ã€‚</li></ol></blockquote><h3 id="æ ˆå†…å­˜åˆ†é…"><a href="#æ ˆå†…å­˜åˆ†é…" class="headerlink" title="æ ˆå†…å­˜åˆ†é…"></a>æ ˆå†…å­˜åˆ†é…</h3><ol><li>ä»¥ä¸€æ®µç®€å•çš„ä»£ç ä½œä¸ºç¤ºä¾‹ï¼Œåˆ†æè¿™æ®µä»£ç çš„å†…å­˜åˆ†é…è¿‡ç¨‹ã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">n := <span class="number">4</span>  </span><br><span class="line">n2 := square(n)  </span><br><span class="line">fmt.Println(n2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">square</span><span class="params">(n <span class="keyword">int</span>)</span> <span class="title">int</span></span>&#123;  </span><br><span class="line"><span class="keyword">return</span> n * n</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>&emsp;&emsp;ä»£ç çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œä¸€ä¸ª main å‡½æ•°ä½œä¸ºç¨‹åºå…¥å£ï¼Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡nï¼Œå®šä¹‰äº†å¦ä¸€ä¸ªå‡½æ•° squire ï¼Œè¿”å›ä¹˜æ–¹æ“ä½œåçš„ int å€¼ã€‚æœ€åï¼Œå°†è¿”å›çš„å€¼æ‰“å°åˆ°æ§åˆ¶å°ã€‚ç¨‹åºè¾“å‡ºä¸º16ã€‚ä¸‹é¢å¼€å§‹é€è¡Œè¿›è¡Œåˆ†æï¼Œè§£æè°ƒç”¨æ—¶ï¼Œgo è¿è¡Œæ—¶æ˜¯å¦‚ä½•å¯¹å†…å­˜è¿›è¡Œåˆ†é…çš„ã€‚<br><img lazyload src="/images/loading.svg" data-src="code1.jpg" alt="avatar"><br>&emsp;&emsp;å½“ä»£ç è¿è¡Œåˆ°ç¬¬6è¡Œï¼Œè¿›å…¥ main å‡½æ•°æ—¶ï¼Œä¼šåœ¨æ ˆä¸Šåˆ›å»ºä¸€ä¸ª Stack frameï¼Œå­˜æ”¾æœ¬å‡½æ•°ä¸­çš„å˜é‡ä¿¡æ¯ã€‚åŒ…æ‹¬å‡½æ•°åç§°ï¼Œå˜é‡ç­‰ã€‚</li></ol><p><img lazyload src="/images/loading.svg" data-src="code2.jpg" alt="avatar"><br>&emsp;&emsp;å½“ä»£ç è¿è¡Œåˆ°ç¬¬7è¡Œæ—¶ï¼Œgo ä¼šåœ¨æ ˆä¸­å‹å…¥ä¸€ä¸ªæ–°çš„ Stack Frameï¼Œç”¨äºå­˜æ”¾è°ƒç”¨ square å‡½æ•°çš„ä¿¡æ¯ï¼›åŒ…æ‹¬å‡½æ•°åã€å˜é‡ n çš„å€¼ç­‰ã€‚æ­¤æ—¶ï¼Œè®¡ç®—4 * 4 çš„å€¼ï¼Œå¹¶è¿”å›ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code3.jpg" alt="avatar"><br>&emsp;&emsp;å½“ square å‡½æ•°è°ƒç”¨å®Œæˆï¼Œè¿”å›16åˆ° main å‡½æ•°åï¼Œå°†16èµ‹å€¼ç»™ n2å˜é‡ã€‚æ³¨æ„ï¼ŒåŸæ¥çš„ stack frame å¹¶ä¸ä¼šè¢« go æ¸…ç†æ‰ï¼Œè€Œæ˜¯å¦‚æ ˆå·¦ä¾§çš„ç®­å¤´æ‰€ç¤ºï¼Œè¢«æ ‡è®°ä¸ºä¸åˆæ³•ã€‚ä¸Šå›¾å¤¹åœ¨çº¢è‰²ç®­å¤´å’Œç»¿è‰²ç®­å¤´ä¹‹é—´çš„æ¨ªçº¿å¯ä»¥ç†è§£ä¸º go æ±‡ç¼–ä»£ç ä¸­çš„ SP æ ˆå¯„å­˜å™¨çš„å€¼ï¼Œå½“ç¨‹åºç”³è¯·æˆ–é‡Šæ”¾æ ˆå†…å­˜æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹ SP å¯„å­˜å™¨çš„å€¼ï¼Œè¿™ç§æ ˆå†…å­˜åˆ†é…æ–¹å¼çœæ‰äº†æ¸…ç†æ ˆå†…å­˜ç©ºé—´çš„è€—æ—¶ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code4.jpg" alt="avatar"><br>&emsp;&emsp;æ¥ä¸‹æ¥ï¼Œè°ƒç”¨ fmt.Println æ—¶ï¼ŒSP å¯„å­˜å™¨çš„å€¼ä¼šè¿›ä¸€æ­¥å¢åŠ ï¼Œè¦†ç›–æ‰åŸæ¥ square å‡½æ•°çš„ stack frameï¼Œå®Œæˆ print åï¼Œç¨‹åºæ­£å¸¸é€€å‡ºã€‚</p><ol start="2"><li>æŒ‡é’ˆä½œä¸ºå‚æ•°æƒ…å†µä¸‹çš„æ ˆå†…å­˜åˆ†é…<br>è¿˜æ˜¯åŒæ ·çš„è¿‡ç¨‹ï¼Œçœ‹å¦‚ä¸‹è¿™æ®µä»£ç ã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">n := <span class="number">4</span>  </span><br><span class="line">increase(&amp;n)  </span><br><span class="line">fmt.Println(n)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increase</span><span class="params">(i *<span class="keyword">int</span>)</span></span> &#123;  </span><br><span class="line">*i++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>&emsp;&emsp;main ä½œä¸ºç¨‹åºå…¥å£ï¼Œå£°æ˜äº†ä¸€ä¸ªå˜é‡ nï¼Œèµ‹å€¼ä¸º4ã€‚å£°æ˜äº†ä¸€ä¸ªå‡½æ•°Â  Â increaseï¼Œä½¿ç”¨ä¸€ä¸ª int ç±»å‹çš„æŒ‡é’ˆ i ä½œä¸ºå‚æ•°ï¼Œincrease å‡½æ•°å†…ï¼Œå¯¹æŒ‡é’ˆ i å¯¹åº”çš„å€¼è¿›è¡Œè‡ªå¢æ“ä½œã€‚æœ€å main å‡½æ•°ä¸­æ‰“å°äº† n çš„å€¼ã€‚ç¨‹åºè¾“å‡ºä¸º5ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code5.jpg" alt="avatar"><br>&emsp;&emsp;å½“ç¨‹åºè¿è¡Œåˆ° main å‡½æ•°çš„ç¬¬6è¡Œæ—¶ï¼Œgo åœ¨æ ˆä¸Šåˆ†é…äº†ä¸€ä¸ª stack frame ï¼Œå¯¹å˜é‡ n è¿›è¡Œäº†èµ‹å€¼ï¼Œn åœ¨å†…å­˜ä¸­å¯¹åº”çš„åœ°å€ä¸º0xc0008771ï¼Œæ­¤æ—¶ç¨‹åºå°†ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè°ƒç”¨ increase å‡½æ•°ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code6.jpg" alt="avatar"><br>&emsp;&emsp;è¿™æ—¶ï¼Œincrease å‡½æ•°å¯¹åº”çš„ stack fream è¢«åˆ›å»ºï¼Œi è¢«èµ‹å€¼ä¸ºå˜é‡ nå¯¹åº”çš„åœ°å€å€¼0xc0008771ï¼Œç„¶åè¿›è¡Œè‡ªå¢æ“ä½œã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code7.jpg" alt="avatar"><br>&emsp;&emsp;å½“ increase å‡½æ•°è¿è¡Œç»“æŸåï¼ŒSP å¯„å­˜å™¨ä¼šä¸Šç§»ï¼Œå°†ä¹‹å‰åˆ†é…çš„ stack freme æ ‡è®°ä¸ºä¸åˆæ³•ã€‚æ­¤æ—¶ï¼Œç¨‹åºè¿è¡Œæ­£å¸¸ï¼Œå¹¶æ²¡æœ‰å› ä¸º SP å¯„å­˜å™¨çš„æ”¹åŠ¨è€Œå½±å“ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œå†…å­˜ä¸­çš„å€¼ä¹Ÿè¢«æ­£ç¡®çš„ä¿®æ”¹äº†ã€‚</p><ol start="3"><li>æŒ‡é’ˆä½œä¸ºè¿”å›å€¼æƒ…å†µä¸‹çš„æ ˆå†…å­˜åˆ†é…<br>&emsp;&emsp;ä¹‹å‰çš„éƒ¨åˆ†åˆ†åˆ«ä»‹ç»äº†æ™®é€šå˜é‡ä½œä¸ºå‚æ•°å’Œå°†æŒ‡é’ˆä½œä¸ºå‚æ•°æƒ…å†µä¸‹çš„æ ˆå†…å­˜ä½¿ç”¨ï¼Œæœ¬éƒ¨åˆ†æ¥ä»‹ç»å°†æŒ‡é’ˆä½œä¸ºè¿”å›å€¼ï¼Œè¿”å›ç»™è°ƒç”¨æ–¹çš„æƒ…å†µä¸‹ï¼Œå†…å­˜æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Œå¹¶å¼•å‡ºå†…å­˜é€ƒé€¸ç›¸å…³å†…å®¹ã€‚æ¥çœ‹è¿™æ®µä»£ç ï¼š<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;  </span><br><span class="line">n := initValue()  </span><br><span class="line">fmt.Println(*n/<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initValue</span><span class="params">()</span> *<span class="title">int</span></span> &#123;  </span><br><span class="line">i := <span class="number">4</span>  </span><br><span class="line"><span class="keyword">return</span> &amp;i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>&emsp;&emsp;main å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº† initValue å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª int æŒ‡é’ˆå¹¶èµ‹å€¼ç»™ nï¼ŒæŒ‡é’ˆå¯¹åº”çš„å€¼ä¸º4ã€‚éšåï¼Œmain å‡½æ•°è°ƒç”¨ fmt.Println æ‰“å°äº†æŒ‡é’ˆ n / 2å¯¹åº”çš„å€¼ã€‚ç¨‹åºè¾“å‡ºä¸º2ã€‚</li></ol><p><img lazyload src="/images/loading.svg" data-src="code8.jpg" alt="avatar"><br>&emsp;&emsp;ç¨‹åºè°ƒç”¨ initValue åï¼Œå°† i çš„åœ°å€èµ‹å€¼ç»™å˜é‡ n ã€‚æ³¨æ„ï¼Œå¦‚æœè¿™æ—¶ï¼Œå˜é‡ i çš„ä½ç½®åœ¨æ ˆä¸Šï¼Œåˆ™å¯èƒ½ä¼šéšæ—¶è¢«è¦†ç›–æ‰ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="code9.jpg" alt="avatar"><br>åœ¨è°ƒç”¨ fmt.Println æ—¶ï¼ŒStack Frame ä¼šè¢«é‡æ–°åˆ›å»ºï¼Œå˜é‡ i è¢«èµ‹å€¼ä¸º*n/2ä¹Ÿå°±æ˜¯2ï¼Œä¼šè¦†ç›–æ‰åŸæ¥ n æ‰€æŒ‡å‘çš„å˜é‡å€¼ã€‚è¿™ä¼šå¯¼è‡´åŠå…¶ä¸¥é‡çš„é—®é¢˜ã€‚åœ¨é¢å¯¹ sharing up åœºæ™¯æ—¶ï¼Œgo é€šå¸¸ä¼šå°†å˜é‡åˆ†é…åˆ°å †ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img lazyload src="/images/loading.svg" data-src="code10.jpg" alt="avatar"><br>&emsp;&emsp;é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çœ‹åˆ°åœ¨é¢å¯¹è¢«è°ƒç”¨çš„å‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡é’ˆç±»å‹æ—¶å°†å¯¹è±¡åˆ†é…åˆ°æ ˆä¸Šä¼šå¸¦æ¥ä¸¥é‡çš„é—®é¢˜ï¼Œå› æ­¤ Go å°†å˜é‡åˆ†é…åˆ°äº†å †ä¸Šã€‚è¿™ç§åˆ†é…æ–¹å¼ä¿è¯äº†ç¨‹åºçš„å®‰å…¨æ€§ï¼Œä½†ä¹Ÿä¸å¯é¿å…çš„å¢åŠ äº†å †å†…å­˜åˆ›å»ºï¼Œå¹¶éœ€è¦åœ¨å°†æ¥çš„æŸä¸ªæ—¶å€™ï¼Œéœ€è¦ GC å°†ä¸å†ä½¿ç”¨çš„å†…å­˜æ¸…ç†æ‰ã€‚</p><blockquote><p>æ ˆä¸Šå†…å­˜åˆ†é…åŸåˆ™</p><ul><li>åœ¨è°ƒç”¨æ–¹åˆ›å»ºçš„å˜é‡æˆ–å¯¹è±¡ï¼Œé€šè¿‡å‚æ•°çš„å½¢å¼ä¼ é€’ç»™è¢«è°ƒç”¨å‡½æ•°ï¼Œè¿™æ—¶ï¼Œåœ¨è°ƒç”¨æ–¹åˆ›å»ºçš„å†…å­˜ç©ºé—´é€šå¸¸åœ¨æ ˆä¸Šã€‚è¿™ç§åœ¨è°ƒç”¨æ–¹åˆ›å»ºå†…å­˜ï¼Œåœ¨è¢«è°ƒç”¨æ–¹ä½¿ç”¨è¯¥å†…å­˜çš„â€œå†…å­˜å…±äº«â€æ–¹å¼ï¼Œç§°ä¹‹ä¸º Sharing down</li><li>åœ¨è¢«è°ƒç”¨å‡½æ•°å†…åˆ›å»ºçš„å¯¹è±¡ï¼Œä»¥æŒ‡é’ˆçš„å½¢å¼è¿”å›ç»™è°ƒç”¨æ–¹çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ï¼Œåˆ›å»ºçš„å†…å­˜ç©ºé—´åœ¨å †ä¸Šã€‚è¿™ç§åœ¨è¢«è°ƒç”¨æ–¹åˆ›å»ºï¼Œåœ¨è°ƒç”¨æ–¹ä½¿ç”¨çš„â€œå†…å­˜å…±äº«â€æ–¹å¼ï¼Œç§°ä¹‹ä¸º Sharing upã€‚</li><li>æ€»ç»“ï¼š1. å› ä¸ºæ ˆæ¯”å †æ›´é«˜æ•ˆï¼Œä¸éœ€è¦ GCï¼Œå› æ­¤ Go ä¼šå°½å¯èƒ½çš„å°†å†…å­˜åˆ†é…åˆ°æ ˆä¸Šã€‚<ol start="2"><li>å½“åˆ†é…åˆ°æ ˆä¸Šå¯èƒ½å¼•èµ·éæ³•å†…å­˜è®¿é—®ç­‰é—®é¢˜åï¼Œä¼šä½¿ç”¨å †ï¼Œä¸»è¦åœºæ™¯æœ‰ï¼š<br>ï¼ˆ1ï¼‰å½“ä¸€ä¸ªå€¼å¯èƒ½åœ¨å‡½æ•°è¢«è°ƒç”¨åè®¿é—®ï¼Œè¿™ä¸ªå€¼ææœ‰å¯èƒ½è¢«åˆ†é…åˆ°å †ä¸Š<br>ï¼ˆ2ï¼‰å½“ç¼–è¯‘å™¨æ£€æµ‹åˆ°æŸä¸ªå€¼è¿‡å¤§ï¼Œè¿™ä¸ªå€¼ä¼šè¢«åˆ†é…åˆ°å †ä¸Š<br>ï¼ˆ3ï¼‰<strong>å½“ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“è¿™ä¸ªå€¼çš„å¤§å°ï¼ˆsliceã€mapâ€¦ï¼‰è¿™ä¸ªå€¼ä¼šè¢«åˆ†é…åˆ°å †ä¸Š</strong></li></ol></li></ul></blockquote><h3 id="å †å†…å­˜ç®¡ç†"><a href="#å †å†…å­˜ç®¡ç†" class="headerlink" title="å †å†…å­˜ç®¡ç†"></a>å †å†…å­˜ç®¡ç†</h3><p><img lazyload src="/images/loading.svg" data-src="heapmacllo.png" alt="avatar"><br>&emsp;&emsp;å½“æˆ‘ä»¬è¯´å†…å­˜ç®¡ç†çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯æŒ‡å †å†…å­˜çš„ç®¡ç†ï¼Œå› ä¸ºæ ˆçš„å†…å­˜ç®¡ç†ä¸éœ€è¦ç¨‹åºå»æ“å¿ƒã€‚è¿™å°èŠ‚çœ‹ä¸‹å †å†…å­˜ç®¡ç†å¹²çš„æ˜¯å•¥ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºä¸»è¦æ˜¯3éƒ¨åˆ†ï¼š<strong>åˆ†é…å†…å­˜å—ï¼Œå›æ”¶å†…å­˜å—å’Œç»„ç»‡å†…å­˜å—</strong>ã€‚<br>&emsp;&emsp;åœ¨ä¸€ä¸ªæœ€ç®€å•çš„å†…å­˜ç®¡ç†ä¸­ï¼Œå †å†…å­˜æœ€åˆä¼šæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¤§å—ï¼Œå³æœªåˆ†é…å†…å­˜ï¼Œå½“æ¥ç”³è¯·çš„æ—¶å€™ï¼Œå°±ä¼šä»æœªåˆ†é…å†…å­˜ï¼Œåˆ†å‰²å‡ºä¸€ä¸ªå°å†…å­˜å—(block)ï¼Œç„¶åç”¨é“¾è¡¨æŠŠæ‰€æœ‰å†…å­˜å—è¿æ¥èµ·æ¥ã€‚éœ€è¦ä¸€äº›ä¿¡æ¯æè¿°æ¯ä¸ªå†…å­˜å—çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚å¤§å°(size)ã€æ˜¯å¦ä½¿ç”¨ä¸­(used)å’Œä¸‹ä¸€ä¸ªå†…å­˜å—çš„åœ°å€(next)ï¼Œå†…å­˜å—å®é™…æ•°æ®å­˜å‚¨åœ¨dataä¸­ã€‚<br><img lazyload src="/images/loading.svg" data-src="usemem.png" alt="avatar"><br>&emsp;&emsp;ä¸€ä¸ªå†…å­˜å—åŒ…å«äº†3ç±»ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…ƒæ•°æ®ã€ç”¨æˆ·æ•°æ®å’Œå¯¹é½å­—æ®µï¼Œå†…å­˜å¯¹é½æ˜¯ä¸ºäº†æé«˜è®¿é—®æ•ˆç‡ã€‚ä¸‹å›¾ç”³è¯·5Byteå†…å­˜çš„æ—¶å€™ï¼Œå°±éœ€è¦è¿›è¡Œå†…å­˜å¯¹é½ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="malloc.png" alt="avatar"><br>&emsp;&emsp;é‡Šæ”¾å†…å­˜å®è´¨æ˜¯æŠŠä½¿ç”¨çš„å†…å­˜å—ä»é“¾è¡¨ä¸­å–å‡ºæ¥ï¼Œç„¶åæ ‡è®°ä¸ºæœªä½¿ç”¨ï¼Œå½“åˆ†é…å†…å­˜å—çš„æ—¶å€™ï¼Œå¯ä»¥ä»æœªä½¿ç”¨å†…å­˜å—ä¸­æœ‰å…ˆæŸ¥æ‰¾å¤§å°ç›¸è¿‘çš„å†…å­˜å—ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå†ä»æœªåˆ†é…çš„å†…å­˜ä¸­åˆ†é…å†…å­˜ã€‚ä¸Šé¢è¿™ä¸ªç®€å•çš„è®¾è®¡ä¸­è¿˜æ²¡è€ƒè™‘å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œå› ä¸ºéšç€å†…å­˜ä¸æ–­çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œå†…å­˜ä¸Šä¼šå­˜åœ¨å¤§é‡çš„ç¢ç‰‡ï¼Œé™ä½å†…å­˜çš„ä½¿ç”¨ç‡ã€‚ä¸ºäº†è§£å†³å†…å­˜ç¢ç‰‡ï¼Œå¯ä»¥å°†2ä¸ªè¿ç»­çš„æœªä½¿ç”¨çš„å†…å­˜å—åˆå¹¶ï¼Œå‡å°‘ç¢ç‰‡ã€‚</p><h4 id="TCMalloc"><a href="#TCMalloc" class="headerlink" title="TCMalloc"></a>TCMalloc</h4><p>&emsp;&emsp;TCMalloc æ˜¯ Thread Cache Malloc çš„ç®€ç§°ï¼Œæ˜¯ Go å†…å­˜ç®¡ç†çš„èµ·æºã€‚å¼•å…¥è™šæ‹Ÿå†…å­˜åï¼Œè®©å†…å­˜çš„å¹¶å‘è®¿é—®é—®é¢˜çš„ç²’åº¦ä»å¤šè¿›ç¨‹çº§åˆ«ï¼Œé™ä½åˆ°å¤šçº¿ç¨‹çº§åˆ«ã€‚åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹å…±äº«ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä»–ä»¬ç”³è¯·å†…å­˜æ—¶éœ€è¦åŠ é”ï¼Œå¦‚æœä¸åŠ é”å°±å­˜åœ¨åŒä¸€å—å†…å­˜è¢«2ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®çš„é—®é¢˜ã€‚TCMallocçš„åšæ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<strong>ä¸ºæ¯ä¸ªçº¿ç¨‹é¢„åˆ†é…ä¸€å—ç¼“å­˜ï¼Œçº¿ç¨‹ç”³è¯·å°å†…å­˜æ—¶ï¼Œå¯ä»¥ä»ç¼“å­˜åˆ†é…å†…å­˜</strong>ï¼Œè¿™æ ·æœ‰2ä¸ªå¥½å¤„ï¼š</p><ol><li>ä¸ºçº¿ç¨‹é¢„åˆ†é…ç¼“å­˜éœ€è¦è¿›è¡Œ1æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œåç»­çº¿ç¨‹ç”³è¯·å°å†…å­˜æ—¶ï¼Œä»ç¼“å­˜åˆ†é…ï¼Œéƒ½æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œæ²¡æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>ç¼©çŸ­äº†å†…å­˜æ€»ä½“çš„åˆ†é…å’Œé‡Šæ”¾æ—¶é—´ï¼Œè¿™æ˜¯å¿«é€Ÿåˆ†é…å†…å­˜çš„ç¬¬äºŒä¸ªå±‚æ¬¡</strong>ã€‚</li><li>å¤šä¸ªçº¿ç¨‹åŒæ—¶ç”³è¯·å°å†…å­˜æ—¶ï¼Œä»å„è‡ªçš„ç¼“å­˜åˆ†é…ï¼Œè®¿é—®çš„æ˜¯ä¸åŒçš„åœ°å€ç©ºé—´ï¼Œæ— éœ€åŠ é”ï¼Œ<strong>æŠŠå†…å­˜å¹¶å‘è®¿é—®çš„ç²’åº¦è¿›ä¸€æ­¥é™ä½äº†ï¼Œè¿™æ˜¯å¿«é€Ÿåˆ†é…å†…å­˜çš„ç¬¬ä¸‰ä¸ªå±‚æ¬¡</strong>ã€‚</li></ol><h2 id="Go-GCï¼ˆåƒåœ¾å›æ”¶ï¼‰"><a href="#Go-GCï¼ˆåƒåœ¾å›æ”¶ï¼‰" class="headerlink" title="Go GCï¼ˆåƒåœ¾å›æ”¶ï¼‰"></a>Go GCï¼ˆåƒåœ¾å›æ”¶ï¼‰</h2><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><p>&emsp;&emsp;ç¨‹åºåœ¨åˆ›å»ºå¼•ç”¨ç±»å‹å®ä½“æ—¶ä¼šåœ¨è™šæ‹Ÿå†…å­˜ä¸­åˆ†é…ç»™ä»–ä»¬ä¸€å—ç©ºé—´ï¼ˆå †ï¼‰ï¼Œå¦‚æœè¯¥å†…å­˜ç©ºé—´ä¸å†è¢«ä»»ä½•å¼•ç”¨å˜é‡å¼•ç”¨å°±ç§°ä¸ºéœ€è¦è¢«å›æ”¶çš„åƒåœ¾ã€‚æ“ä½œç³»ç»Ÿä¼šè®°å½•ä¸€ä¸ªè¿›ç¨‹è¿è¡Œæ—¶çš„æ‰€å ç”¨çš„å†…å­˜ã€CPUå’Œå¯„å­˜å™¨ç­‰èµ„æºï¼Œå½“è¿›ç¨‹ç»“æŸåä¾¿ç”±æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨å›æ”¶èµ„æºã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªè¿è¡Œè¾ƒé•¿æ—¶é—´çš„ç¨‹åºï¼Œå¦‚æœä½¿ç”¨å®Œå†…å­˜èµ„æºåæ²¡æœ‰åŠæ—¶é‡Šæ”¾å°±ä¼šé€ æˆå†…å­˜æ³„æ¼ç”šè‡³ç³»ç»Ÿé”™è¯¯ã€‚<br>&emsp;&emsp;ä»¥ä¸æ”¯æŒè‡ªåŠ¨åƒåœ¾å›æ”¶çš„ C++ ä¸ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *p = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">128</span>];</span><br><span class="line">  <span class="comment">// å¯¹æŒ‡é’ˆçš„ä½¿ç”¨</span></span><br><span class="line">  <span class="keyword">delete</span>[] p; <span class="comment">// deleteè¯­å¥é‡Šæ”¾å¯¹è±¡æ•°ç»„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¦‚æœç”±äºä¸€åœºæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´ delete è¯­å¥æ²¡æœ‰æ­£å¸¸æ‰§è¡Œï¼Œä¸”è¯¥å‡½æ•°è¢«é¢‘ç¹è°ƒç”¨ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å ç”¨æ‰€æœ‰çš„å†…å­˜ä»è€Œå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¦‚æœæ³„æ¼çš„æ—¶ç³»ç»Ÿèµ„æºè¿˜ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚å¦ä¸€æ–¹é¢å¦‚æœæˆ‘ä»¬åœ¨ä¸è¯¥é‡Šæ”¾å†…å­˜çš„æ—¶å€™é‡Šæ”¾å†…å­˜ï¼Œé‚£ä¹ˆä»ç„¶åœ¨ä½¿ç”¨è¿™å—å†…å­˜çš„æŒ‡é’ˆå°±ä¼šå˜æˆé‡æŒ‡é’ˆ <code>wild pointer</code>ï¼Œä½¿ç”¨è¯¥æŒ‡é’ˆå¯¹å†…å­˜è¿›è¡Œè¯»å†™æ˜¯æœªå®šä¹‰çš„è¡Œä¸ºã€‚</p><ol><li><p>åƒåœ¾å›æ”¶è¿‡ç¨‹<br>&emsp;&emsp;ç”¨æˆ·ç¨‹åº<code>Mutator</code>é€šè¿‡å†…å­˜åˆ†é…å™¨<code>Allocator</code>åœ¨å †<code>Heap</code>ä¸Šç”³è¯·å†…å­˜ï¼Œåƒåœ¾å›æ”¶å™¨<code>Collector</code>ä¼šå®šæ—¶æ¸…ç†å †ä¸Šçš„å†…å­˜ã€‚<br><img lazyload src="/images/loading.svg" data-src="collector.jpg" alt="avatar"></p></li><li><p>è‡ªåŠ¨åƒåœ¾å›æ”¶ä¸æ‰‹åŠ¨åƒåœ¾å›æ”¶<br>&emsp;&emsp;<code>C</code>è¯­è¨€è¿™ç§è¾ƒä¸ºä¼ ç»Ÿçš„è¯­è¨€é€šè¿‡<code>malloc</code>å’Œ<code>free</code>æ‰‹åŠ¨å‘æ“ä½œç³»ç»Ÿç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œè¿™ç§è‡ªç”±ç®¡ç†å†…å­˜çš„æ–¹å¼ç»™äºˆç¨‹åºå‘˜æå¤§çš„è‡ªç”±åº¦ï¼Œä½†æ˜¯ä¹Ÿç›¸åº”åœ°æé«˜äº†å¯¹ç¨‹åºå‘˜çš„è¦æ±‚ã€‚<code>C</code>è¯­è¨€çš„å†…å­˜åˆ†é…å’Œå›æ”¶æ–¹å¼ä¸»è¦åŒ…æ‹¬ä¸‰ç§ï¼š</p></li></ol><ul><li>å‡½æ•°ä½“å†…çš„å±€éƒ¨å˜é‡ï¼šåœ¨æ ˆä¸Šåˆ›å»ºï¼Œå‡½æ•°ä½œç”¨åŸŸç»“æŸåè‡ªåŠ¨é‡Šæ”¾å†…å­˜</li><li>é™æ€å˜é‡ï¼šåœ¨é™æ€å­˜å‚¨åŒºåŸŸä¸Šåˆ†é…å†…å­˜ï¼Œæ•´ä¸ªç¨‹åºè¿è¡Œç»“æŸåé‡Šæ”¾ï¼ˆå…¨å±€ç”Ÿå‘½å‘¨æœŸï¼‰</li><li>åŠ¨æ€åˆ†é…å†…å­˜çš„å˜é‡ï¼šåœ¨å †ä¸Šåˆ†é…ï¼Œé€šè¿‡<code>malloc</code>ç”³è¯·ï¼Œ<code>free</code>é‡Šæ”¾</li></ul><p>&emsp;&emsp;<code>C</code>ã€<code>C++</code>ç­‰è¾ƒæ—©çš„è¯­è¨€é‡‡ç”¨çš„æ˜¯æ‰‹åŠ¨åƒåœ¾å›æ”¶ï¼Œéœ€è¦ç¨‹åºå‘˜é€šè¿‡å‘æ“ä½œç³»ç»Ÿç”³è¯·å’Œé‡Šæ”¾å†…å­˜æ¥æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œç¨‹åºå‘˜æå®¹æ˜“å¿˜è®°é‡Šæ”¾è‡ªå·±ç”³è¯·çš„å†…å­˜ï¼Œå¯¹äºä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ç¨‹åºå¾€å¾€æ˜¯ä¸€ä¸ªè‡´å‘½çš„ç¼ºç‚¹ã€‚<code>Python</code>ã€<code>Java</code>å’Œ<code>Golang</code>ç­‰è¾ƒæ–°çš„è¯­è¨€é‡‡å–çš„éƒ½æ˜¯è‡ªåŠ¨åƒåœ¾å›æ”¶æ–¹å¼ï¼Œç¨‹åºå‘˜åªéœ€è¦è´Ÿè´£ç”³è¯·å†…å­˜ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå‘¨æœŸæ€§é‡Šæ”¾ç»“æŸç”Ÿå‘½å‘¨æœŸçš„å˜é‡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p><ol start="3"><li>åƒåœ¾å›æ”¶ç›®æ ‡<br>åƒåœ¾å›æ”¶å™¨ä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªç›®æ ‡ï¼š</li></ol><ul><li><strong>æ— å†…å­˜æ³„æ¼</strong>ï¼šåƒåœ¾å›æ”¶å™¨æœ€åŸºæœ¬çš„ç›®æ ‡å°±æ˜¯å‡å°‘é˜²æ­¢ç¨‹åºå‘˜æœªåŠæ—¶é‡Šæ”¾å¯¼è‡´çš„å†…å­˜æ³„æ¼ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šè¯†åˆ«å¹¶æ¸…ç†å†…å­˜ä¸­çš„åƒåœ¾</li><li>è‡ªåŠ¨<strong>å›æ”¶æ— ç”¨å†…å­˜</strong>ï¼šåƒåœ¾å›æ”¶å™¨ä½œä¸ºç‹¬ç«‹çš„å­ä»»åŠ¡ï¼Œä¸éœ€è¦ç¨‹åºå‘˜æ˜¾å¼è°ƒç”¨å³å¯è‡ªåŠ¨æ¸…ç†å†…å­˜åƒåœ¾</li><li>å†…å­˜æ•´ç†ï¼šå¦‚æœåªæ˜¯ç®€å•å›æ”¶æ— ç”¨å†…å­˜ï¼Œé‚£ä¹ˆå †ä¸Šçš„å†…å­˜ç©ºé—´ä¼šå­˜åœ¨è¾ƒå¤š<strong>å†…å­˜ç¢ç‰‡</strong>è€Œæ— æ³•æ»¡è¶³åˆ†é…è¾ƒå¤§å¯¹è±¡çš„éœ€æ±‚ï¼Œå› æ­¤åƒåœ¾å›æ”¶å™¨éœ€è¦é‡æ•´å†…å­˜ç©ºé—´ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li></ul><h3 id="å¸¸è§çš„åƒåœ¾å›æ”¶æ–¹æ³•"><a href="#å¸¸è§çš„åƒåœ¾å›æ”¶æ–¹æ³•" class="headerlink" title="å¸¸è§çš„åƒåœ¾å›æ”¶æ–¹æ³•"></a>å¸¸è§çš„åƒåœ¾å›æ”¶æ–¹æ³•</h3><p>&emsp;&emsp;æ ¹æ®åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»çš„æ–¹æ³•ï¼Œå¯ä»¥ç®€å•å°†<code>GC</code>ç®—æ³•åˆ†ä¸ºâ€œ<strong>å¼•ç”¨è®¡æ•°å¼</strong>â€åƒåœ¾å›æ”¶å’Œâ€œ<strong>è¿½è¸ªå›æ”¶å¼</strong>â€åƒåœ¾å›æ”¶ã€‚å‰è€…æ ¹æ®æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨æ˜¯å¦ä¸º<code>0</code>æ¥åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦ä¸ºæœªå¼•ç”¨çš„åƒåœ¾å¯¹è±¡ï¼Œåè€…å…ˆåˆ¤æ–­å“ªäº›å¯¹è±¡å­˜æ´»ï¼Œç„¶åå°†å…¶ä½™çš„æ‰€æœ‰å¯¹è±¡ä½œä¸ºåƒåœ¾è¿›è¡Œå›æ”¶ã€‚è¿½è¸ªå›æ”¶æœ¬èº«åŒ…æ‹¬æ ‡è®°-æ¸…é™¤<code>Mark-Sweep</code>ã€æ ‡è®°-å¤åˆ¶<code>Mark-Copy</code>å’Œæ ‡è®°-æ•´ç†<code>Mark-Compact</code>ä¸‰ç§å›æ”¶ç®—æ³•ã€‚</p><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>&emsp;&emsp;å¼•ç”¨è®¡æ•°<code>Reference counting</code>ä¼šä¸ºæ¯ä¸ªå¯¹è±¡ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è¯¥å¯¹è±¡è¢«å…¶ä»–å¯¹è±¡å¼•ç”¨æ—¶åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶å‡ä¸€ï¼Œå½“å¼•ç”¨æ¬¡æ•°å½’é›¶åå³å¯å›æ”¶å¯¹è±¡ã€‚ä½¿ç”¨è¿™ç±»<code>GC</code>æ–¹æ³•çš„è¯­è¨€åŒ…æ‹¬<code>python</code>ã€<code>php</code>ã€<code>objective-C</code>å’Œ<code>C++</code>æ ‡å‡†åº“ä¸­çš„<code>std::shared_ptr</code>ç­‰ã€‚<br>ä¼˜ç‚¹ï¼š</p><ul><li>åŸç†å’Œå®ç°éƒ½æ¯”è¾ƒç®€å•</li><li>å›æ”¶çš„å³æ—¶æ€§ï¼šå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º<code>0</code>æ—¶ç«‹å³å›æ”¶ï¼Œä¸åƒå…¶ä»–<code>GC</code>æœºåˆ¶éœ€è¦ç­‰å¾…ç‰¹å®šæ—¶æœºå†å›æ”¶ï¼Œæé«˜äº†å†…å­˜çš„åˆ©ç”¨ç‡</li><li>ä¸éœ€è¦æš‚åœåº”ç”¨å³å¯å®Œæˆå›æ”¶</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„å›æ”¶é—®é¢˜ï¼šå½“<code>ObjA</code>å¼•ç”¨äº†<code>ObjB</code>ï¼Œ<code>ObjB</code>ä¹Ÿå¼•ç”¨<code>ObjA</code>æ—¶ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ä½¿ç”¨å¤§äº<code>0</code>ï¼Œä»è€Œå ç”¨çš„å†…å­˜æ— æ³•è¢«å›æ”¶</li><li>æ—¶é—´å’Œç©ºé—´æˆæœ¬è¾ƒé«˜ï¼šä¸€æ–¹é¢æ˜¯å› ä¸ºæ¯ä¸ªå¯¹è±¡éœ€è¦é¢å¤–çš„ç©ºé—´å­˜å‚¨å¼•ç”¨è®¡æ•°å™¨å˜é‡ï¼Œå¦ä¸€æ–¹é¢æ˜¯åœ¨æ ˆä¸Šçš„èµ‹å€¼æ—¶ä¿®æ”¹å¼•ç”¨æ¬¡æ•°æ—¶é—´æˆæœ¬è¾ƒé«˜ï¼ˆåŸæœ¬åªéœ€è¦ä¿®æ”¹å¯„å­˜å™¨ä¸­çš„å€¼ï¼Œç°åœ¨è®¡æ•°å™¨éœ€è¦ä¸æ–­æ›´æ–°å› æ­¤ä¸æ˜¯åªè¯»çš„ï¼Œéœ€è¦é¢å¤–çš„åŸå­æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼‰</li><li>å¼•ç”¨è®¡æ•°æ˜¯ä¸€ç§æ‘Šé”€ç®—æ³•ï¼Œä¼šå°†å†…å­˜çš„å›æ”¶åˆ†æ‘Šåˆ°æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ï¼Œä½†æ˜¯å½“é”€æ¯ä¸€ä¸ªå¾ˆå¤§çš„æ ‘å½¢ç»“æ„æ—¶æ— æ³•ä¿è¯å“åº”æ—¶é—´</li></ul><h4 id="è¿½è¸ªå›æ”¶å¼"><a href="#è¿½è¸ªå›æ”¶å¼" class="headerlink" title="è¿½è¸ªå›æ”¶å¼"></a>è¿½è¸ªå›æ”¶å¼</h4><p>è¿½è¸ªåŸºç¡€ï¼šå¯è¾¾æ€§åˆ†æç®—æ³•<br>&emsp;&emsp;å°½ç®¡å‰é¢æåˆ°çš„ä¸‰ç§è¿½è¸ªå¼åƒåœ¾å›æ”¶ç®—æ³•å®ç°èµ·æ¥å„ä¸ç›¸åŒï¼Œä½†æ˜¯ç¬¬ä¸€æ­¥éƒ½æ˜¯é€šè¿‡å¯è¾¾æ€§åˆ†æç®—æ³•æ ‡è®°<code>Mark</code>å¯¹è±¡æ˜¯å¦â€œå¯è¾¾â€ã€‚ä¸€èˆ¬å¯åˆ°è¾¾çš„å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä¸¤ç±»ï¼š</p><ul><li><code>GC Root</code>å¯¹è±¡ï¼šåŒ…æ‹¬å…¨å±€å¯¹è±¡ã€æ ˆä¸Šçš„å¯¹è±¡ï¼ˆå‡½æ•°å‚æ•°ä¸å†…éƒ¨å˜é‡ï¼‰</li><li>ä¸<code>GC Root</code>å¯¹è±¡é€šè¿‡å¼•ç”¨é“¾<code>Reference Chain</code>ç›¸è¿çš„å¯¹è±¡</li></ul><p>å¯¹äºâ€œä¸å¯è¾¾â€çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¯¥å¯¹è±¡ä¸ºåƒåœ¾å¯¹è±¡å¹¶å›æ”¶å¯¹åº”çš„å†…å­˜ç©ºé—´ã€‚<br><img lazyload src="/images/loading.svg" data-src="reachable.jpg" alt="avatar"></p><p>åŒå¼•ç”¨è®¡æ•°æ³•ç›¸æ¯”ï¼Œè¿½è¸ªå¼ç®—æ³•å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>è§£å†³äº†å¾ªç¯å¼•ç”¨å¯¹è±¡çš„å›æ”¶é—®é¢˜</li><li>å ç”¨ç©ºé—´æ›´å°‘</li></ul><p>ç¼ºç‚¹åŒ…æ‹¬ï¼š</p><ul><li>åŒå¼•ç”¨è®¡æ•°ç›¸æ¯”æ— æ³•ç«‹åˆ»è¯†åˆ«å‡ºåƒåœ¾å¯¹è±¡ï¼Œéœ€è¦ä¾èµ–<code>GC</code>çº¿ç¨‹(ä¸‹æ–‡çš„ç®—æ³•)</li><li>ç®—æ³•åœ¨æ ‡è®°æ—¶å¿…é¡»æš‚åœæ•´ä¸ªç¨‹åºï¼Œå³<code>Stop The World, STW</code>ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹çš„ä»£ç ä¼šä¿®æ”¹å¯¹è±¡çŠ¶æ€ä»è€Œå›æ”¶ä¸è¯¥å›æ”¶çš„å¯¹è±¡</li></ul><ol><li>æ ‡è®°-æ¸…é™¤ç®—æ³•<br>æ ‡è®°-æ¸…é™¤<code>Mark-Sweep</code>ç®—æ³•æ˜¯æœ€åŸºç¡€çš„è¿½è¸ªå¼ç®—æ³•ï¼Œåˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªæ­¥éª¤ï¼š</li></ol><ul><li>æ ‡è®°ï¼šè®°å½•éœ€è¦å›æ”¶çš„åƒåœ¾å¯¹è±¡</li><li>æ¸…é™¤ï¼šåœ¨æ ‡è®°å®Œæˆåå›æ”¶åƒåœ¾å¯¹è±¡çš„å†…å­˜ç©ºé—´</li></ul><p><img lazyload src="/images/loading.svg" data-src="mark-sweep.jpg" alt="avatar"><br>ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>ç®—æ³•ååé‡è¾ƒé«˜ï¼Œå³è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + è¿è¡Œåƒåœ¾æ”¶é›†æ—¶é—´ï¼‰è¾ƒé«˜</li><li>ç©ºé—´åˆ©ç”¨ç‡é«˜ï¼šåŒæ ‡è®°-å¤åˆ¶ç›¸æ¯”ä¸éœ€è¦é¢å¤–ç©ºé—´å¤åˆ¶å¯¹è±¡ï¼Œä¹Ÿä¸éœ€è¦åƒå¼•ç”¨è®¡æ•°ç®—æ³•ä¸ºæ¯ä¸ªå¯¹è±¡è®¾ç½®å¼•ç”¨è®¡æ•°å™¨</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¸…é™¤åä¼š<strong>äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ç©ºé—´ï¼Œå¯¼è‡´ç¨‹åºåœ¨è¿è¡Œæ—¶å¯èƒ½æ²¡æ³•ä¸ºè¾ƒå¤§çš„å¯¹è±¡åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¯¼è‡´æå‰è¿›è¡Œä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶</li></ul><ol start="2"><li>æ ‡è®°-å¤åˆ¶ç®—æ³•<br>æ ‡è®°-å¤åˆ¶<code>Mark-Copy</code>ç®—æ³•å°†å†…å­˜åˆ†æˆå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œå½“æŸä¸€å—çš„å†…å­˜ä½¿ç”¨å®Œäº†ä¹‹åå°±å°†ä½¿ç”¨ä¸­çš„å¯¹è±¡æŒ¨ä¸ªå¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ä¸­ï¼Œæœ€åå°†å½“å‰å†…å­˜æ¢å¤æœªä½¿ç”¨çš„çŠ¶æ€ã€‚<br><img lazyload src="/images/loading.svg" data-src="mark-copy.jpg" alt="avatar"></li></ol><p>ä¼˜ç‚¹ï¼š</p><ul><li>æ ‡è®°-æ¸…é™¤æ³•éœ€è¦åœ¨æ¸…é™¤é˜¶æ®µå¯¹å¤§é‡åƒåœ¾å¯¹è±¡è¿›è¡Œæ‰«æï¼Œæ ‡è®°-å¤åˆ¶åˆ™åªéœ€è¦ä»<code>GC Root</code>å¯¹è±¡å‡ºå‘ï¼Œå°†â€œå¯åˆ°è¾¾â€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜åç›´æ¥æ¸…ç†å½“å‰è¿™å—çš„å†…å­˜ï¼Œå› æ­¤æå‡äº†åƒåœ¾å›æ”¶çš„æ•ˆç‡</li><li>è§£å†³äº†å†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œé˜²æ­¢åˆ†é…è¾ƒå¤§è¿ç»­ç©ºé—´æ—¶çš„æå‰<code>GC</code>é—®é¢˜</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>åŒæ ‡è®°-æ¸…é™¤æ³•ç›¸æ¯”ï¼Œåœ¨â€œå¯è¾¾â€å¯¹è±¡å æ¯”è¾ƒé«˜çš„æƒ…å†µä¸‹æœ‰å¤åˆ¶å¯¹è±¡çš„å¼€é”€</li><li>å†…å­˜åˆ©ç”¨ç‡è¾ƒä½ï¼Œç›¸å½“äºå¯åˆ©ç”¨çš„å†…å­˜ä»…æœ‰ä¸€åŠ</li></ul><ol start="3"><li>æ ‡è®°-æ•´ç†ç®—æ³•<br>&emsp;&emsp;æ ‡è®°-æ•´ç†<code>Mark-Compact</code>ç®—æ³•ç»¼åˆäº†æ ‡è®°-æ¸…é™¤æ³•å’Œæ ‡è®°-å¤åˆ¶æ³•çš„ä¼˜åŠ¿ï¼Œæ—¢ä¸ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œä¹Ÿä¸ä¼šæœ‰ä¸€åŠå†…å­˜ç©ºé—´æµªè´¹çš„é—®é¢˜ã€‚è¯¥æ–¹æ³•é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰â€œå¯è¾¾â€çš„å¯¹è±¡ï¼Œç„¶åå°†å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°å†…å­˜ç©ºé—´çš„ä¸€ç«¯ï¼Œæœ€åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚<br><img lazyload src="/images/loading.svg" data-src="mark-compact.jpg" alt="avatar"><br>ä¼˜ç‚¹åŒ…æ‹¬ï¼š</li></ol><ul><li>é¿å…äº†å†…å­˜ç¢ç‰‡åŒ–çš„é—®é¢˜</li><li>åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜çš„æƒ…å†µä¸‹ï¼Œæ ‡è®°-æ•´ç†ç®—æ³•ç”±äºä¸éœ€è¦å¤åˆ¶å¯¹è±¡æ•ˆç‡æ›´é«˜ï¼Œå› æ­¤æ›´åŠ é€‚åˆè€å¹´ä»£ç®—æ³•</li></ul><p>ç¼ºç‚¹åŒ…æ‹¬ï¼š</p><ul><li>æ•´ç†è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦å¤šæ¬¡éå†å†…å­˜å¯¼è‡´<code>STW</code>æ—¶é—´æ¯”æ ‡è®°-æ¸…é™¤ç®—æ³•æ›´é•¿</li></ul><h3 id="Golang-çš„-GC-ç®—æ³•"><a href="#Golang-çš„-GC-ç®—æ³•" class="headerlink" title="Golang çš„ GC ç®—æ³•"></a>Golang çš„ GC ç®—æ³•</h3><h4 id="ä¸‰è‰²æ ‡è®°æ³•ï¼ˆgo-1-3ï¼‰"><a href="#ä¸‰è‰²æ ‡è®°æ³•ï¼ˆgo-1-3ï¼‰" class="headerlink" title="ä¸‰è‰²æ ‡è®°æ³•ï¼ˆgo 1.3ï¼‰"></a>ä¸‰è‰²æ ‡è®°æ³•ï¼ˆgo 1.3ï¼‰</h4><p>&emsp;&emsp;å‰é¢æåˆ°çš„â€œæ ‡è®°â€ç±»ç®—æ³•éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‘•ç–µï¼Œå³åœ¨è¿›è¡Œåƒåœ¾å›æ”¶çš„æ—¶å€™ä¼šæš‚åœæ•´ä¸ªç¨‹åºï¼ˆ<code>STW</code>é—®é¢˜ï¼‰ã€‚ä¸‰è‰²æ ‡è®°æ³•æ˜¯å¯¹â€œæ ‡è®°â€é˜¶æ®µçš„æ”¹è¿›ï¼Œåœ¨ä¸æš‚åœç¨‹åºçš„æƒ…å†µä¸‹å³å¯å®Œæˆå¯¹è±¡çš„å¯è¾¾æ€§åˆ†æã€‚<code>GC</code>çº¿ç¨‹å°†æ‰€æœ‰å¯¹è±¡åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>ç™½è‰²ï¼šæœªæœç´¢çš„å¯¹è±¡ï¼Œåœ¨å›æ”¶å‘¨æœŸå¼€å§‹æ—¶æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²ï¼Œåœ¨å›æ”¶å‘¨æœŸç»“æŸæ—¶æ‰€æœ‰çš„ç™½è‰²éƒ½æ˜¯åƒåœ¾å¯¹è±¡</li><li>ç°è‰²ï¼šæ­£åœ¨æœç´¢çš„å¯¹è±¡ï¼Œä½†æ˜¯å¯¹è±¡èº«ä¸Šè¿˜æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¼•ç”¨æ²¡æœ‰æ‰«æ</li><li>é»‘è‰²ï¼šå·²æœç´¢å®Œçš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„å¼•ç”¨å·²ç»è¢«æ‰«æå®Œ</li></ul><p>&emsp;&emsp;ä¸‰è‰²æ ‡è®°æ³•å±äºå¢é‡å¼<code>GC</code>ç®—æ³•ï¼Œå›æ”¶å™¨é¦–å…ˆå°†æ‰€æœ‰çš„å¯¹è±¡ç€è‰²æˆç™½è‰²ï¼Œç„¶åä»<code>GC Root</code>å‡ºå‘ï¼Œé€æ­¥æŠŠæ‰€æœ‰â€œå¯è¾¾â€çš„å¯¹è±¡å˜æˆç°è‰²å†åˆ°é»‘è‰²ï¼Œæœ€ç»ˆæ‰€æœ‰çš„ç™½è‰²å¯¹è±¡å³æ˜¯â€œä¸å¯è¾¾â€å¯¹è±¡ã€‚</p><blockquote><p><code>GC Root</code> å¯¹è±¡åŒ…æ‹¬ï¼š</p><ol><li>å…¨å±€å˜é‡ï¼šç¨‹åºåœ¨ç¼–è¯‘æœŸå°±èƒ½ç¡®å®šçš„é‚£äº›å­˜åœ¨äºç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„å˜é‡ã€‚</li><li>æ‰§è¡Œæ ˆï¼šæ¯ä¸ª goroutine éƒ½åŒ…å«è‡ªå·±çš„æ‰§è¡Œæ ˆï¼Œè¿™äº›æ‰§è¡Œæ ˆä¸ŠåŒ…å«æ ˆä¸Šçš„å˜é‡åŠæŒ‡å‘åˆ†é…çš„å †å†…å­˜åŒºå—çš„æŒ‡é’ˆã€‚</li><li> å¯„å­˜å™¨ï¼šå¯„å­˜å™¨çš„å€¼å¯èƒ½è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆï¼Œå‚ä¸è®¡ç®—çš„è¿™äº›æŒ‡é’ˆå¯èƒ½æŒ‡å‘æŸäº›èµ‹å€¼å™¨åˆ†é…çš„å †å†…å­˜åŒºå—ã€‚</li></ol></blockquote><p>å…·ä½“çš„å®ç°å¦‚ä¸‹ï¼š</p><ol><li>åˆå§‹æ—¶æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²å¯¹è±¡</li><li>ä»<code>GC Root</code>å¯¹è±¡å‡ºå‘ï¼Œæ‰«ææ‰€æœ‰å¯è¾¾å¯¹è±¡å¹¶æ ‡è®°ä¸ºç°è‰²ï¼Œæ”¾å…¥å¾…å¤„ç†é˜Ÿåˆ—</li><li>ä»é˜Ÿåˆ—å–å‡ºä¸€ä¸ªç°è‰²å¯¹è±¡å¹¶æ ‡è®°ä¸ºé»‘è‰²ï¼Œå°†å…¶å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²æ”¾å…¥é˜Ÿåˆ—</li><li>é‡å¤ä¸Šä¸€æ­¥éª¤ï¼Œç›´åˆ°ç°è‰²å¯¹è±¡é˜Ÿåˆ—ä¸ºç©º</li><li>æ­¤æ—¶æ‰€æœ‰å‰©ä¸‹çš„ç™½è‰²å¯¹è±¡å°±æ˜¯åƒåœ¾å¯¹è±¡</li></ol><p><img lazyload src="/images/loading.svg" data-src="three_color.gif" alt="gif"></p><p>ä¼˜ç‚¹ï¼šä¸éœ€è¦æš‚åœæ•´ä¸ªç¨‹åºè¿›è¡Œåƒåœ¾å›æ”¶<br>ç¼ºç‚¹ï¼š</p><ul><li>å¦‚æœç¨‹åºåƒåœ¾å¯¹è±¡çš„äº§ç”Ÿé€Ÿåº¦å¤§äºåƒåœ¾å¯¹è±¡çš„å›æ”¶é€Ÿåº¦æ—¶ï¼Œå¯èƒ½å¯¼è‡´ç¨‹åºä¸­çš„åƒåœ¾å¯¹è±¡è¶Šæ¥è¶Šå¤šè€Œæ— æ³•åŠæ—¶æ”¶é›†</li><li>çº¿ç¨‹åˆ‡æ¢å’Œä¸Šä¸‹æ–‡è½¬æ¢çš„æ¶ˆè€—ä¼šä½¿å¾—åƒåœ¾å›æ”¶çš„æ€»ä½“æˆæœ¬ä¸Šå‡ï¼Œä»è€Œé™ä½ç³»ç»Ÿååé‡</li></ul><h4 id="å±éšœæœºåˆ¶"><a href="#å±éšœæœºåˆ¶" class="headerlink" title="å±éšœæœºåˆ¶"></a>å±éšœæœºåˆ¶</h4><ol><li><p>STW<br>&emsp;&emsp;STW å¯ä»¥æ˜¯Stop The Worldçš„ç¼©å†™ï¼Œä¹Ÿå¯ä»¥æ˜¯Start The Worldçš„ç¼©å†™ã€‚é€šå¸¸æ„ä¹‰ä¸ŠæŒ‡çš„æ˜¯ä»Stop The Worldåˆ°Start The Worldè¿™ä¸€æ®µæ—¶é—´é—´éš”ã€‚åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ä¸ºäº†ä¿è¯å‡†ç¡®æ€§ã€é˜²æ­¢æ— æ­¢å¢ƒçš„å†…å­˜å¢é•¿ç­‰é—®é¢˜è€Œä¸å¯é¿å…çš„éœ€è¦åœæ­¢èµ‹å€¼å™¨è¿›ä¸€æ­¥æ“ä½œå¯¹è±¡å›¾ä»¥å®Œæˆåƒåœ¾å›æ”¶ã€‚STWæ—¶é—´è¶Šé•¿ï¼Œå¯¹ç”¨æˆ·ä»£ç é€ æˆçš„å½±å“è¶Šå¤§ã€‚</p></li><li><p>No STW å­˜åœ¨çš„é—®é¢˜<br>&emsp;&emsp;å‡è®¾ä¸‹é¢çš„åœºæ™¯ï¼Œå·²ç»è¢«æ ‡è®°ä¸ºç°è‰²çš„å¯¹è±¡2ï¼Œæœªè¢«æ ‡è®°çš„å¯¹è±¡3è¢«å¯¹è±¡2ç”¨æŒ‡é’ˆpå¼•ç”¨ï¼›æ­¤æ—¶å·²ç»è¢«æ ‡è®°ä¸ºé»‘è‰²çš„å¯¹è±¡4åˆ›å»ºæŒ‡é’ˆq æŒ‡å‘æœªè¢«æ ‡è®°çš„å¯¹è±¡3ï¼ŒåŒæ—¶å¯¹è±¡2å°†æŒ‡é’ˆpç§»é™¤ï¼›å¯¹è±¡4å·²ç»è¢«æ ‡è®°ä¸ºé»‘è‰²ï¼Œå¯¹è±¡3æœªè¢«å¼•ç”¨ï¼Œå¯¹è±¡2åˆ é™¤ä¸å¯¹è±¡3çš„å¼•ç”¨ï¼Œå¯¼è‡´æœ€åå¯¹è±¡3è¢«è¯¯æ¸…é™¤ï¼›<br><img lazyload src="/images/loading.svg" data-src="stw.png" alt="avatar"></p></li></ol><ul><li>åƒåœ¾å›æ”¶çš„åŸåˆ™æ˜¯ä¸åº”å‡ºç°å¯¹è±¡çš„ä¸¢å¤±ï¼Œä¹Ÿä¸åº”é”™è¯¯çš„å›æ”¶è¿˜ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ã€‚å¦‚æœåŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ä¼šç ´åå›æ”¶å™¨çš„æ­£ç¡®æ€§ï¼š<ul><li>æ¡ä»¶ 1: èµ‹å€¼å™¨ä¿®æ”¹å¯¹è±¡å›¾ï¼Œå¯¼è‡´æŸä¸€é»‘è‰²å¯¹è±¡å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼›ï¼ˆé€šä¿—çš„è¯´å°±æ˜¯Açªç„¶æŒæœ‰äº†Bçš„æŒ‡é’ˆï¼Œè€ŒBåœ¨å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­å·²ç»è¢«åˆ¤å®šä¸ºç™½è‰²å¯¹è±¡è¦è¢«æ¸…ç†æ‰çš„ï¼‰</li><li>æ¡ä»¶ 2: ä»ç°è‰²å¯¹è±¡å‡ºå‘ï¼Œåˆ°è¾¾ç™½è‰²å¯¹è±¡ä¸”æœªç»è®¿é—®è¿‡çš„è·¯å¾„è¢«èµ‹å€¼å™¨ç ´åï¼›ï¼ˆé€šä¿—çš„è¯´å°±æ˜¯AæŒæœ‰Bçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒæœ‰å…³ç³»è¢«é‡Šæ”¾ï¼‰</li></ul></li></ul><blockquote><p>åªè¦èƒ½å¤Ÿé¿å…å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ¡ä»¶ï¼Œåˆ™ä¸ä¼šå‡ºç°å¯¹è±¡ä¸¢å¤±çš„æƒ…å†µï¼Œå› ä¸ºï¼š</p><ul><li>  å¦‚æœæ¡ä»¶ 1è¢«é¿å…ï¼Œåˆ™æ‰€æœ‰ç™½è‰²å¯¹è±¡å‡è¢«ç°è‰²å¯¹è±¡å¼•ç”¨ï¼Œæ²¡æœ‰ç™½è‰²å¯¹è±¡ä¼šè¢«é—æ¼ï¼›<strong>å¼ºä¸‰è‰²ä¸å˜æ€§</strong></li><li>  å¦‚æœæ¡ä»¶ 2 è¢«é¿å…ï¼Œå³ä¾¿ç™½è‰²å¯¹è±¡çš„æŒ‡é’ˆè¢«å†™å…¥åˆ°é»‘è‰²å¯¹è±¡ä¸­ï¼Œä½†ä»ç°è‰²å¯¹è±¡å‡ºå‘ï¼Œæ€»å­˜åœ¨ä¸€æ¡æ²¡æœ‰è®¿é—®è¿‡çš„è·¯å¾„ï¼Œä»è€Œæ‰¾åˆ°åˆ°è¾¾ç™½è‰²å¯¹è±¡çš„è·¯å¾„ï¼Œç™½è‰²å¯¹è±¡æœ€ç»ˆä¸ä¼šè¢«é—æ¼ã€‚<strong>å¼±ä¸‰è‰²ä¸å˜æ€§</strong></li></ul></blockquote><p><strong>å¯èƒ½çš„è§£å†³æ–¹æ³•ï¼š</strong> æ•´ä¸ªè¿‡ç¨‹STWï¼Œæµªè´¹èµ„æºï¼Œä¸”å¯¹ç”¨æˆ·ç¨‹åºå½±å“è¾ƒå¤§ï¼Œç”±æ­¤å¼•å…¥äº†<strong>å±éšœæœºåˆ¶</strong>ï¼›</p><ol start="3"><li>å±éšœæœºåˆ¶<br>&emsp;&emsp;æŠŠå›æ”¶å™¨è§†ä¸ºå¯¹è±¡ï¼ŒæŠŠèµ‹å€¼å™¨è§†ä¸ºå½±å“å›æ”¶å™¨è¿™ä¸€å¯¹è±¡çš„å®é™…è¡Œä¸ºï¼ˆå³å½±å“ GC å‘¨æœŸçš„é•¿çŸ­ï¼‰ï¼Œä»è€Œå¼•å…¥èµ‹å€¼å™¨çš„é¢œè‰²ï¼š</li></ol><ul><li>é»‘è‰²èµ‹å€¼å™¨ï¼šå·²ç»ç”±å›æ”¶å™¨æ‰«æè¿‡ï¼Œä¸ä¼šå†æ¬¡å¯¹å…¶è¿›è¡Œæ‰«æã€‚</li><li>ç°è‰²èµ‹å€¼å™¨ï¼šå°šæœªè¢«å›æ”¶å™¨æ‰«æè¿‡æˆ–å°½ç®¡å·²ç»æ‰«æè¿‡ï¼Œä½†ä»éœ€è¦é‡æ–°æ‰«æã€‚</li></ul><h5 id="Dijkstraæ’å…¥å†™å±éšœï¼ˆgo-1-5ï¼‰"><a href="#Dijkstraæ’å…¥å†™å±éšœï¼ˆgo-1-5ï¼‰" class="headerlink" title="Dijkstraæ’å…¥å†™å±éšœï¼ˆgo 1.5ï¼‰"></a>Dijkstraæ’å…¥å†™å±éšœï¼ˆgo 1.5ï¼‰</h5><p>&emsp;&emsp;<code>Dijkstra</code>æ’å…¥å†™å±éšœé¿å…äº†å‰é¢æåˆ°çš„æ¡ä»¶1ï¼Œå³é˜²æ­¢é»‘è‰²å¯¹è±¡æŒ‡å‘ç™½è‰²å¯¹è±¡ã€‚ä¸€ä¸ªå¯¹è±¡å¯ä»¥å­˜å‚¨åœ¨å†…å­˜ä¸­çš„â€œæ ˆâ€æˆ–è€…â€œå †â€ï¼Œ<strong>ç”±äºâ€œæ ˆâ€ç©ºé—´å®¹é‡å°ä¸”è¦æ±‚ç›¸åº”é€Ÿåº¦è¾ƒé«˜ï¼Œå› æ­¤â€œæ’å…¥å†™å±éšœâ€ä¸é€‚åˆç”¨äºâ€œæ ˆâ€ç©ºé—´</strong>ã€‚åœ¨â€œæ’å…¥å†™å±éšœâ€ä¿æŠ¤ä¸‹çš„ä¸‰è‰²æ ‡è®°æ³•æ‰§è¡Œä¾‹å­å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="step1.jpeg" alt="avatar"><br><img lazyload src="/images/loading.svg" data-src="step2.jpeg" alt="avatar"><br><img lazyload src="/images/loading.svg" data-src="step3.jpeg" alt="avatar"></p><p>&emsp;&emsp;å°½ç®¡<code>Dijkstra</code>æ’å…¥å†™å±éšœå¯ä»¥<strong>å®ç°åƒåœ¾å›æ”¶å’Œç”¨æˆ·ç¨‹åºçš„å¹¶å‘æ‰§è¡Œ</strong>ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸¤ä¸ªç¼ºç‚¹ã€‚ä¸€æ–¹é¢å®ƒæ˜¯ä¸€ç§æ¯”è¾ƒä¿å®ˆçš„åƒåœ¾å›æ”¶æ–¹æ³•ï¼Œ<strong>æŠŠæœ‰å¯èƒ½å­˜æ´»çš„å¯¹è±¡éƒ½æ ‡è®°æˆç°è‰²äº†ä»¥æ»¡è¶³â€œå¼ºä¸‰è‰²ä¸å˜æ€§â€</strong>ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œç”¨æˆ·ç¨‹åº<code>Mutator</code>å°†å¯¹è±¡AåŸæœ¬æŒ‡å‘Bå¯¹è±¡çš„æŒ‡é’ˆæ”¹æˆæŒ‡å‘Cå¯¹è±¡ï¼Œå°½ç®¡åœ¨ä¿®æ”¹åBå¯¹è±¡å·²ç»æ˜¯ä¸€ä¸ªåƒåœ¾å¯¹è±¡ï¼Œä½†æ˜¯å®ƒåœ¨æœ¬è½®åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ä¸ä¼šè¢«å›æ”¶ã€‚<br><img lazyload src="/images/loading.svg" data-src="dj.jpeg" alt="avatra"></p><h5 id="Yuasaåˆ é™¤å±éšœ"><a href="#Yuasaåˆ é™¤å±éšœ" class="headerlink" title="Yuasaåˆ é™¤å±éšœ"></a>Yuasaåˆ é™¤å±éšœ</h5><p>&emsp;&emsp;<code>Yuasa</code>åˆ é™¤å†™å±éšœé¿å…äº†å‰é¢æåˆ°çš„æ¡ä»¶2ï¼Œé˜²æ­¢ä¸¢å¤±ç°è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„å¯è¾¾è·¯å¾„ã€‚<strong>æ»¡è¶³äº†å¼±ä¸‰è‰²ä¸å˜æ€§</strong><br><img lazyload src="/images/loading.svg" data-src="yuasa.jpeg" alt="avatar"></p><p>ä¸‹å›¾ç®€å•ç»˜åˆ¶äº†<code>Yuasa</code>åˆ é™¤å†™å±éšœæ˜¯å¦‚ä½•ä¿è¯ç”¨æˆ·ç¨‹åº<code>Mutator</code>å’Œåƒåœ¾å›æ”¶å™¨<code>Collector</code>çš„å¹¶å‘æ‰§è¡Œçš„ï¼š</p><ul><li>  ç¬¬äºŒæ­¥ä¸­<code>Mutator</code>å°†å¯¹è±¡<code>A</code>åŸæœ¬æŒ‡å‘å¯¹è±¡<code>B</code>çš„æŒ‡é’ˆæŒ‡å‘<code>C</code>ï¼Œç”±äºå¯¹è±¡<code>B</code>æœ¬èº«å°±æ˜¯ç°è‰²çš„ï¼Œå› æ­¤ä¸éœ€è¦å¯¹å®ƒé‡æ–°ç€è‰²</li><li>  ç¬¬ä¸‰æ­¥ä¸­<code>Mutator</code>åˆ é™¤äº†å¯¹è±¡<code>B</code>æŒ‡å‘å¯¹è±¡<code>C</code>çš„æŒ‡é’ˆï¼Œåˆ é™¤å†™å±éšœå°†ä¸‹æ¸¸å¯¹è±¡<code>C</code>æ ‡è®°ä¸ºç°è‰²<br><img lazyload src="/images/loading.svg" data-src="yuasa1.jpeg" alt="avatar"><br>&emsp;&emsp;<code>Yuasa</code>åˆ é™¤å†™å±éšœå’Œ<code>Dijkstra</code>æ’å…¥å†™å±éšœç›¸æ¯”ä¼˜ç‚¹åœ¨äºä¸éœ€è¦åœ¨ä¸€è½®ä¸‰è‰²æ ‡è®°åå¯¹æ ˆç©ºé—´ä¸Šçš„å¯¹è±¡è¿›è¡Œé‡æ–°æ‰«æï¼Œç¼ºç‚¹åœ¨äº<code>Collector</code>ä¼šæ‚²è§‚åœ°è®¤ä¸ºæ‰€æœ‰è¢«åˆ é™¤çš„å¯¹è±¡éƒ½å¯èƒ½è¢«é»‘è‰²å¯¹è±¡å¼•ç”¨ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­ç¬¬ä¸‰æ­¥<code>Mutator</code>åˆ é™¤äº†å¯¹è±¡<code>B</code>æŒ‡å‘å¯¹è±¡<code>C</code>çš„æŒ‡é’ˆï¼Œå¦‚æœæ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡<code>E</code>æŒ‡å‘<code>C</code>ï¼Œé‚£ä¹ˆæœ¬è¯¥è¢«åˆ é™¤çš„å¯¹è±¡<code>E</code>å´å¯ä»¥åœ¨æœ¬è½®åƒåœ¾å›æ”¶ä¸­å­˜æ´»ã€‚</li></ul><h5 id="æ··åˆå†™å±éšœï¼ˆgo-1-8ï¼‰"><a href="#æ··åˆå†™å±éšœï¼ˆgo-1-8ï¼‰" class="headerlink" title="æ··åˆå†™å±éšœï¼ˆgo 1.8ï¼‰"></a>æ··åˆå†™å±éšœï¼ˆgo 1.8ï¼‰</h5><blockquote><p><strong>æ··åˆå†™å±éšœä¹Ÿæ˜¯ä»…åœ¨å †ç©ºé—´å¯åŠ¨çš„ï¼Œé˜²æ­¢é™ä½æ ˆç©ºé—´çš„è¿è¡Œæ•ˆç‡</strong></p></blockquote><p>å›é¡¾ä¸€ä¸‹ä¹‹å‰æåˆ°çš„ä¸¤ç§å†™å±éšœçš„åŠ£åŠ¿ï¼š</p><ul><li><code>Dijkstra</code>æ’å…¥å†™å±éšœï¼šä¸€è½®æ ‡è®°ç»“æŸåéœ€è¦<code>STW</code>é‡æ–°æ‰«ææ ˆä¸Šå¯¹è±¡</li><li><code>Yuasa</code>åˆ é™¤å†™å±éšœï¼šå›æ”¶ç²¾åº¦ä½ï¼Œåœ¨åƒåœ¾å›æ”¶å¼€å§‹å‰ä½¿ç”¨<code>STW</code>æ‰«ææ‰€æœ‰<code>GC Root</code>å¯¹è±¡å½¢æˆåˆå§‹å¿«ç…§ï¼Œç”¨æˆ·ç¨‹åº<code>Mutator</code>ä»ç°è‰²/ç™½è‰²å¯¹è±¡ä¸­åˆ é™¤ç™½è‰²æŒ‡é’ˆæ—¶ä¼šå°†ä¸‹æ¸¸å¯¹è±¡æ ‡è®°ä¸ºç°è‰²ï¼Œç›¸å½“äºä¿æŠ¤äº†æ‰€æœ‰åˆå§‹å¿«ç…§ä¸­çš„ç™½è‰²å¯¹è±¡ä¸è¢«åˆ é™¤</li></ul><h6 id="å…·ä½“åœºæ™¯çš„å®ç°"><a href="#å…·ä½“åœºæ™¯çš„å®ç°" class="headerlink" title="å…·ä½“åœºæ™¯çš„å®ç°"></a><strong>å…·ä½“åœºæ™¯çš„å®ç°</strong></h6><p><code>GC</code>å¼€å§‹é˜¶æ®µä¼šå°†æ‰€æœ‰æ ˆç©ºé—´å¯è¾¾å¯¹è±¡éƒ½æ ‡è®°ä¸ºé»‘è‰²ï¼š<br><img lazyload src="/images/loading.svg" data-src="s11.jpeg" alt="avatar"></p><p>åœºæ™¯ä¸€ï¼šæŸä¸ªå¯¹è±¡ä»å †å¯¹è±¡çš„ä¸‹æ¸¸å˜æˆæ ˆå¯¹è±¡çš„ä¸‹æ¸¸ï¼Œè¿™ç§æƒ…å†µä¸‹æ ‡è®°è¯¥å¯¹è±¡ä¸ºç°è‰²ï¼Œè¯¥å¯¹è±¡å°±ä¸ä¼šè¢«é”™è¯¯åœ°å›æ”¶<br><img lazyload src="/images/loading.svg" data-src="s12.jpeg" alt="avatar"></p><p>åœºæ™¯äºŒï¼šæŸä¸ªå¯¹è±¡ä»ä¸€ä¸ªæ ˆå¯¹è±¡çš„ä¸‹æ¸¸å˜æˆå¦ä¸€ä¸ªå¯¹è±¡çš„ä¸‹æ¸¸ï¼Œç”±äºå¯¹è±¡å…¨éƒ½åœ¨æ ˆç©ºé—´å¯¹è±¡çš„å¯è¾¾å¯¹è±¡ä¸­ï¼Œå› æ­¤æ··åˆå†™å±éšœä¸ä¼šå¯¹è¿™äº›å¯¹è±¡ç€è‰²ã€‚<br><img lazyload src="/images/loading.svg" data-src="s13.jpeg" alt="avatar"></p><p>åœºæ™¯ä¸‰ï¼šæŸä¸ªå¯¹è±¡ä»ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸å˜æˆå¦ä¸€ä¸ªå †å¯¹è±¡çš„ä¸‹æ¸¸ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­å¯¹è±¡Gä»Fçš„ä¸‹æ¸¸ç§»åŠ¨åˆ°Yçš„ä¸‹æ¸¸ï¼Œä¸ºäº†é¿å…å¯¹è±¡<code>G</code>è¢«é”™è¯¯å›æ”¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ ‡è®°ä¸ºç°è‰²<br><img lazyload src="/images/loading.svg" data-src="s14.jpeg" alt="avatar"></p><p>åœºæ™¯å››ï¼šæŸä¸ªå¯¹è±¡ä»æ ˆå¯¹è±¡çš„ä¸‹æ¸¸å˜æˆå †å¯¹è±¡çš„ä¸‹æ¸¸ï¼Œå¯¹äºæ ˆç©ºé—´å¯¹è±¡ä¸è§¦å‘å†™å±éšœï¼Œä½†æ˜¯å¯¹äºè¢«åˆ é™¤çš„å †ç©ºé—´å¯¹è±¡<code>G</code>éœ€è¦æ ‡è®°æˆç°è‰²ä»¥ä¿æŠ¤å®ƒå’Œå®ƒçš„ä¸‹æ¸¸å¯¹è±¡ä¸è¢«é”™è¯¯åˆ é™¤<br><img lazyload src="/images/loading.svg" data-src="s15.jpeg" alt="avatar"></p><ul><li>æ··åˆå†™å±éšœç»§æ‰¿äº†æ’å…¥å†™å±éšœçš„ä¼˜ç‚¹ï¼Œèµ·å§‹æ— éœ€ STW æ‰“å¿«ç…§ï¼Œç›´æ¥å¹¶å‘æ‰«æåƒåœ¾å³å¯ï¼›</li><li>æ··åˆå†™å±éšœç»§æ‰¿äº†åˆ é™¤å†™å±éšœçš„ä¼˜ç‚¹ï¼Œèµ‹å€¼å™¨æ˜¯é»‘è‰²èµ‹å€¼å™¨ï¼ŒGC æœŸé—´ï¼Œä»»ä½•åœ¨æ ˆä¸Šåˆ›å»ºçš„æ–°å¯¹è±¡ï¼Œå‡ä¸ºé»‘è‰²ã€‚æ‰«æè¿‡ä¸€æ¬¡å°±ä¸éœ€è¦æ‰«æäº†ï¼Œè¿™æ ·å°±æ¶ˆé™¤äº†æ’å…¥å†™å±éšœæ—¶æœŸæœ€å STW çš„é‡æ–°æ‰«ææ ˆï¼›</li><li>æ··åˆå†™å±éšœæ‰«æç²¾åº¦ç»§æ‰¿äº†åˆ é™¤å†™å±éšœï¼Œæ¯”æ’å…¥å†™å±éšœæ›´ä½ï¼Œéšç€å¸¦æ¥çš„ æ˜¯ GC è¿‡ç¨‹å…¨ç¨‹æ—  STWï¼›</li><li>æ··åˆå†™å±éšœæ‰«ææ ˆè™½ç„¶æ²¡æœ‰ STWï¼Œä½†æ˜¯æ‰«ææŸä¸€ä¸ªå…·ä½“çš„æ ˆçš„æ—¶å€™ï¼Œè¿˜æ˜¯ è¦åœæ­¢è¿™ä¸ª goroutine èµ‹å€¼å™¨çš„å·¥ä½œçš„</li></ul><h4 id="GC-è§¦å‘æ—¶æœº"><a href="#GC-è§¦å‘æ—¶æœº" class="headerlink" title="GC è§¦å‘æ—¶æœº"></a>GC è§¦å‘æ—¶æœº</h4><p>ä¸»åŠ¨è§¦å‘ï¼šè°ƒç”¨ runtime.GC<br>è¢«åŠ¨è§¦å‘ï¼š ä½¿ç”¨ç³»ç»Ÿç›‘æ§ï¼Œè¯¥è§¦å‘æ¡ä»¶ç”± runtime.forcegcperiod å˜é‡æ§åˆ¶ï¼Œé»˜è®¤ä¸º 2 åˆ†é’Ÿã€‚å½“è¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰äº§ç”Ÿä»»ä½• GC æ—¶ï¼Œå¼ºåˆ¶è§¦å‘ GCã€‚ ä½¿ç”¨æ­¥è°ƒï¼ˆPacingï¼‰ç®—æ³•ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯æ§åˆ¶å†…å­˜å¢é•¿çš„æ¯”ä¾‹ã€‚å¦‚ Go çš„ GC æ˜¯ä¸€ç§æ¯”ä¾‹ GC, ä¸‹ä¸€æ¬¡ GC ç»“æŸæ—¶çš„å †å¤§å°å’Œä¸Šä¸€æ¬¡ GC å­˜æ´»å †å¤§å°æˆæ¯”ä¾‹. ç”± GOGC æ§åˆ¶, é»˜è®¤ 100, å³ 2 å€çš„å…³ç³», 200 å°±æ˜¯ 3 å€, å½“ Go æ–°åˆ›å»ºçš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜å¤§å°ï¼Œé™¤ä»¥ä¸Šæ¬¡ GC ç»“æŸåä¿ç•™ä¸‹æ¥çš„å¯¹è±¡å ç”¨å†…å­˜å¤§å°ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Golang-Map-çš„åº•å±‚å®ç°&quot;&gt;&lt;a href=&quot;#Golang-Map-çš„åº•å±‚å®ç°&quot; class=&quot;headerlink&quot; title=&quot;Golang Map çš„åº•å±‚å®ç°&quot;&gt;&lt;/a&gt;Golang Map çš„åº•å±‚å®ç°&lt;/h1&gt;&lt;h2 id=&quot;ä¸€èˆ¬çš„-map-çš„</summary>
      
    
    
    
    <category term="goè¯­è¨€" scheme="http://jiahaohong1997.github.io/categories/go%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="golang" scheme="http://jiahaohong1997.github.io/tags/golang/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®°ï¼ˆä¸‰ï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/01/18/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/01/18/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</id>
    <published>2022-01-18T07:35:00.000Z</published>
    <updated>2022-02-14T09:19:03.892Z</updated>
    
    <content type="html"><![CDATA[<h1 id="String-ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„"><a href="#String-ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="String ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„"></a>String ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„</h1><h2 id="ä¸ºä»€ä¹ˆ-String-ç±»å‹å†…å­˜å¼€é”€å¤§"><a href="#ä¸ºä»€ä¹ˆ-String-ç±»å‹å†…å­˜å¼€é”€å¤§" class="headerlink" title="ä¸ºä»€ä¹ˆ String ç±»å‹å†…å­˜å¼€é”€å¤§"></a>ä¸ºä»€ä¹ˆ String ç±»å‹å†…å­˜å¼€é”€å¤§</h2><p>&emsp;&emsp;é™¤äº†è®°å½•å®é™…æ•°æ®ï¼Œstring ç±»å‹è¿˜éœ€è¦é¢å¤–çš„å†…å­˜ç©ºé—´è®°å½•æ•°æ®é•¿åº¦ã€ç©ºé—´ä½¿ç”¨ç­‰ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿå«ä½œå…ƒæ•°æ®ã€‚å½“å®é™…ä¿å­˜çš„æ•°æ®è¾ƒå°æ—¶ï¼Œå…ƒæ•°æ®çš„ç©ºé—´å¼€é”€å°±æ˜¾å¾—æ¯”è¾ƒå¤§äº†ã€‚<br>&emsp;&emsp;string ç±»å‹æ˜¯å¦‚ä½•ä¿å­˜æ•°æ®çš„å‘¢ï¼Ÿ</p><ol><li>å½“ä¿å­˜ 64 ä½æœ‰ç¬¦å·æ•´æ•°æ—¶ï¼Œstring ç±»å‹ä¼šæŠŠå®ƒä¿å­˜ä¸ºä¸€ä¸ª 8 å­—èŠ‚çš„ Long ç±»å‹æ•´æ•°ï¼Œè¿™ç§ä¿å­˜æ–¹å¼é€šå¸¸ä¹Ÿå«ä½œ int ç¼–ç æ–¹å¼ã€‚</li><li>å½“ä¿å­˜çš„æ•°æ®ä¸­åŒ…å«å­—ç¬¦æ—¶ï¼ŒString ç±»å‹å°±ä¼šç”¨ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆSimple Dynamic Stringï¼ŒSDSï¼‰ç»“æ„ä½“æ¥ä¿å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ol><p><img lazyload src="/images/loading.svg" data-src="redis43.jpg" alt="avatar"><br><strong>è¿™é‡Œå…¶å®ç±»ä¼¼ Go çš„ slice ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„</strong><br>bufï¼šå­—èŠ‚æ•°ç»„ï¼Œä¿å­˜å®é™…æ•°æ®ã€‚ä¸ºäº†è¡¨ç¤ºå­—èŠ‚æ•°ç»„çš„ç»“æŸï¼ŒRedis ä¼šè‡ªåŠ¨åœ¨æ•°ç»„æœ€ååŠ ä¸€ä¸ªâ€œ\0â€ï¼Œè¿™å°±ä¼šé¢å¤–å ç”¨ 1 ä¸ªå­—èŠ‚çš„å¼€é”€ã€‚<br>lenï¼šå  4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤º buf çš„å·²ç”¨é•¿åº¦ã€‚<br>allocï¼šä¹Ÿå ä¸ª 4 å­—èŠ‚ï¼Œè¡¨ç¤º buf çš„å®é™…åˆ†é…é•¿åº¦ï¼Œä¸€èˆ¬å¤§äº lenã€‚</p><p>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ SDS ä¸­ï¼Œbuf ä¿å­˜å®é™…æ•°æ®ï¼Œè€Œ len å’Œ alloc æœ¬èº«å…¶å®æ˜¯ SDS ç»“æ„ä½“çš„é¢å¤–å¼€é”€ã€‚å¦å¤–ï¼Œå¯¹äº String ç±»å‹æ¥è¯´ï¼Œé™¤äº† SDS çš„é¢å¤–å¼€é”€ï¼Œè¿˜æœ‰ä¸€ä¸ªæ¥è‡ªäº RedisObject ç»“æ„ä½“çš„å¼€é”€ã€‚å› ä¸º Redis çš„æ•°æ®ç±»å‹æœ‰å¾ˆå¤šï¼Œè€Œä¸”ï¼Œä¸åŒæ•°æ®ç±»å‹éƒ½æœ‰äº›ç›¸åŒçš„å…ƒæ•°æ®è¦è®°å½•ï¼ˆæ¯”å¦‚æœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´ã€è¢«å¼•ç”¨çš„æ¬¡æ•°ç­‰ï¼‰ï¼Œæ‰€ä»¥ï¼ŒRedis ä¼šç”¨ä¸€ä¸ª RedisObject ç»“æ„ä½“æ¥ç»Ÿä¸€è®°å½•è¿™äº›å…ƒæ•°æ®ï¼ŒåŒæ—¶æŒ‡å‘å®é™…æ•°æ®ã€‚<br>&emsp;&emsp;ä¸€ä¸ª RedisObject åŒ…å«äº† 8 å­—èŠ‚çš„å…ƒæ•°æ®å’Œä¸€ä¸ª 8 å­—èŠ‚æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå†è¿›ä¸€æ­¥æŒ‡å‘å…·ä½“æ•°æ®ç±»å‹çš„å®é™…æ•°æ®æ‰€åœ¨ï¼Œä¾‹å¦‚æŒ‡å‘ String ç±»å‹çš„ SDS ç»“æ„æ‰€åœ¨çš„å†…å­˜åœ°å€ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ç¤ºæ„å›¾ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis44.jpg" alt="avatar"><br>&emsp;&emsp;ä¸ºäº†èŠ‚çœå†…å­˜ç©ºé—´ï¼ŒRedis è¿˜å¯¹ Long ç±»å‹æ•´æ•°å’Œ SDS çš„å†…å­˜å¸ƒå±€åšäº†ä¸“é—¨çš„è®¾è®¡ã€‚</p><ul><li>ä¸€æ–¹é¢ï¼Œå½“ä¿å­˜çš„æ˜¯ Long ç±»å‹æ•´æ•°æ—¶ï¼ŒRedisObject ä¸­çš„æŒ‡é’ˆå°±ç›´æ¥èµ‹å€¼ä¸ºæ•´æ•°æ•°æ®äº†ï¼Œè¿™æ ·å°±ä¸ç”¨é¢å¤–çš„æŒ‡é’ˆå†æŒ‡å‘æ•´æ•°äº†ï¼ŒèŠ‚çœäº†æŒ‡é’ˆçš„ç©ºé—´å¼€é”€ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œå½“ä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²å°äºç­‰äº 44 å­—èŠ‚æ—¶ï¼ŒRedisObject ä¸­çš„å…ƒ æ•°æ®ã€æŒ‡é’ˆå’Œ SDS æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å†…å­˜ç¢ç‰‡ã€‚è¿™ç§å¸ƒå±€æ–¹å¼ä¹Ÿè¢« ç§°ä¸º embstr ç¼–ç æ–¹å¼ã€‚</li><li>å½“å­—ç¬¦ä¸²å¤§äº 44 å­—èŠ‚æ—¶ï¼ŒSDS çš„æ•°æ®é‡å°±å¼€å§‹å˜å¤šäº†ï¼ŒRedis å°±ä¸å†æŠŠ SDS å’ŒRedisObject å¸ƒå±€åœ¨ä¸€èµ·äº†ï¼Œè€Œæ˜¯ä¼šç»™ SDS åˆ†é…ç‹¬ç«‹çš„ç©ºé—´ï¼Œå¹¶ç”¨æŒ‡é’ˆæŒ‡å‘ SDS ç»“æ„ã€‚è¿™ç§å¸ƒå±€æ–¹å¼è¢«ç§°ä¸º raw ç¼–ç æ¨¡å¼ã€‚</li></ul><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis45.jpg" alt="avatar"></p><p>ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ï¼šæˆ‘ä»¬ç”¨ 10 ä½æ•°æ¥è¡¨ç¤ºå›¾ç‰‡ ID å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ IDï¼Œä¾‹å¦‚ï¼Œå›¾ç‰‡ ID ä¸º 1101000051ï¼Œå®ƒåœ¨å­˜å‚¨ç³»ç»Ÿä¸­å¯¹åº”çš„ ID å·æ˜¯ 3301000051ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå›¾ç‰‡ ID å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID æ­£å¥½ä¸€ä¸€å¯¹åº”ï¼Œæ˜¯å…¸å‹çš„â€œé”® - å•å€¼â€æ¨¡å¼ã€‚å› ä¸º 10 ä½æ•°çš„å›¾ç‰‡ ID å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID æ˜¯ Long ç±»å‹æ•´æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ç”¨ int ç¼–ç çš„ RedisObject ä¿å­˜ã€‚æ¯ä¸ª int ç¼–ç çš„ RedisObject å…ƒæ•°æ®éƒ¨åˆ†å  8 å­—èŠ‚ï¼ŒæŒ‡é’ˆéƒ¨åˆ†è¢«ç›´æ¥èµ‹å€¼ä¸º 8 å­—èŠ‚çš„æ•´æ•°äº†ã€‚æ­¤æ—¶ï¼Œæ¯ä¸ª ID ä¼šä½¿ç”¨ 16 å­—èŠ‚ï¼ŒåŠ èµ·æ¥ä¸€å…±æ˜¯ 32 å­—èŠ‚ã€‚åŒæ—¶ï¼ŒRedis ä¼šä½¿ç”¨ä¸€ä¸ªå…¨å±€å“ˆå¸Œè¡¨ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹ï¼Œå“ˆå¸Œè¡¨çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ª dictEntry çš„ç»“æ„ä½“ï¼Œç”¨æ¥æŒ‡å‘ä¸€ä¸ªé”®å€¼å¯¹ã€‚dictEntry ç»“æ„ä¸­æœ‰ä¸‰ä¸ª 8 å­—èŠ‚çš„æŒ‡é’ˆï¼Œ åˆ†åˆ«æŒ‡å‘ keyã€value ä»¥åŠä¸‹ä¸€ä¸ª dictEntryï¼Œä¸‰ä¸ªæŒ‡é’ˆå…± 24 å­—èŠ‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis46.jpg" alt="avatar"><br>&emsp;&emsp;æ­¤æ—¶ï¼Œè¿™ä¸‰ä¸ªæŒ‡é’ˆå æ®äº† 24 å­—èŠ‚ï¼Œä½†æ˜¯å®é™…ä¸Šä¼šå ç”¨ 32 å­—èŠ‚ï¼Œè¿™å°±è¦æåˆ° Redis ä½¿ç”¨çš„å†…å­˜åˆ†é…åº“ jemalloc äº†ã€‚jemalloc åœ¨åˆ†é…å†…å­˜æ—¶ï¼Œä¼šæ ¹æ®æˆ‘ä»¬ç”³è¯·çš„å­—èŠ‚æ•° Nï¼Œæ‰¾ä¸€ä¸ªæ¯” N å¤§ï¼Œä½†æ˜¯æœ€æ¥è¿‘ N çš„ 2 çš„å¹‚æ¬¡æ•°ä½œä¸ºåˆ†é…çš„ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥å‡å°‘é¢‘ç¹åˆ†é…çš„æ¬¡æ•°ã€‚å¦‚æœä½ ç”³è¯· 24 å­—èŠ‚ç©ºé—´ï¼Œjemalloc åˆ™ä¼šåˆ†é… 32 å­—èŠ‚ã€‚æ‰€ä»¥å­˜å‚¨è¿™æ ·ä¸€ä¸ª â€œé”® - å€¼â€å¯¹è¦ä½¿ç”¨ 64 ä¸ªå­—èŠ‚ã€‚<br>&emsp;&emsp;æ˜æ˜æœ‰æ•ˆä¿¡æ¯åªæœ‰ 16 å­—èŠ‚ï¼Œä½¿ç”¨ String ç±»å‹ä¿å­˜æ—¶ï¼Œå´éœ€è¦ 64 å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œæœ‰ 48 å­—èŠ‚éƒ½æ²¡æœ‰ç”¨äºä¿å­˜å®é™…çš„æ•°æ®ã€‚</p><h2 id="ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å¯ä»¥èŠ‚çœå†…å­˜ï¼Ÿ"><a href="#ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å¯ä»¥èŠ‚çœå†…å­˜ï¼Ÿ" class="headerlink" title="ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å¯ä»¥èŠ‚çœå†…å­˜ï¼Ÿ"></a>ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„å¯ä»¥èŠ‚çœå†…å­˜ï¼Ÿ</h2><p>&emsp;&emsp;Redis æœ‰ä¸€ç§åº•å±‚æ•°æ®ç»“æ„ï¼Œå«å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸èŠ‚çœå†…å­˜çš„ç»“æ„ã€‚æˆ‘ä»¬å…ˆå›é¡¾ä¸‹å‹ç¼©åˆ—è¡¨çš„æ„æˆã€‚è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µ zlbytesã€zltail å’Œ zllenï¼Œåˆ†åˆ«è¡¨ç¤ºåˆ—è¡¨é•¿åº¦ã€åˆ—è¡¨å°¾çš„åç§»é‡ï¼Œä»¥åŠåˆ—è¡¨ä¸­çš„ entry ä¸ªæ•°ã€‚å‹ç¼©åˆ—è¡¨å°¾è¿˜æœ‰ä¸€ä¸ª zlendï¼Œè¡¨ç¤ºåˆ—è¡¨ç»“æŸã€‚<br><img lazyload src="/images/loading.svg" data-src="redis47.jpg" alt="avatar"><br>&emsp;&emsp;å‹ç¼©åˆ—è¡¨ä¹‹æ‰€ä»¥èƒ½å¤ŸèŠ‚çœå†…å­˜ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ç”¨ä¸€ç³»åˆ—è¿ç»­çš„ entry ä¿å­˜æ•°æ®ã€‚æ¯ä¸ª entry çš„å…ƒæ•°æ®åŒ…æ‹¬ä¸‹é¢å‡ éƒ¨åˆ†ã€‚</p><ul><li>prev_lenï¼šè¡¨ç¤ºå‰ä¸€ä¸ª entry çš„é•¿åº¦ã€‚prev_len æœ‰ä¸¤ç§å–å€¼æƒ…å†µï¼š1 å­—èŠ‚æˆ– 5 å­—èŠ‚ã€‚å–å€¼ 1 å­—èŠ‚æ—¶ï¼Œè¡¨ç¤ºä¸Šä¸€ä¸ª entry çš„é•¿åº¦å°äº 254 å­—èŠ‚ã€‚è™½ç„¶ 1 å­—èŠ‚çš„å€¼èƒ½è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ˜¯ 0 åˆ° 255ï¼Œä½†æ˜¯å‹ç¼©åˆ—è¡¨ä¸­ zlend çš„å–å€¼é»˜è®¤æ˜¯ 255ï¼Œå› æ­¤ï¼Œå°±é»˜è®¤ç”¨ 255 è¡¨ç¤ºæ•´ä¸ªå‹ç¼©åˆ—è¡¨çš„ç»“æŸï¼Œå…¶ä»–è¡¨ç¤ºé•¿åº¦çš„åœ°æ–¹å°±ä¸èƒ½å†ç”¨ 255 è¿™ä¸ªå€¼äº†ã€‚æ‰€ä»¥ï¼Œå½“ä¸Šä¸€ä¸ª entry é•¿åº¦å°äº 254 å­—èŠ‚æ—¶ï¼Œprev_len å–å€¼ä¸º 1 å­—èŠ‚ï¼Œå¦åˆ™ï¼Œå°±å–å€¼ä¸º 5 å­—èŠ‚ï¼›</li><li>lenï¼šè¡¨ç¤ºè‡ªèº«é•¿åº¦ï¼Œ4 å­—èŠ‚ï¼›</li><li>encodingï¼šè¡¨ç¤ºç¼–ç æ–¹å¼ï¼Œ1 å­—èŠ‚ï¼›</li><li>contentï¼šä¿å­˜å®é™…æ•°æ®ã€‚</li></ul><p>&emsp;&emsp;è¿™äº› entry ä¼šæŒ¨ä¸ªå„¿æ”¾ç½®åœ¨å†…å­˜ä¸­ï¼Œä¸éœ€è¦å†ç”¨é¢å¤–çš„æŒ‡é’ˆè¿›è¡Œè¿æ¥ï¼Œè¿™æ ·å°±å¯ä»¥èŠ‚çœæŒ‡é’ˆæ‰€å ç”¨çš„ç©ºé—´ã€‚æˆ‘ä»¬ä»¥ä¿å­˜å›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID ä¸ºä¾‹ï¼Œæ¥åˆ†æä¸€ä¸‹å‹ç¼©åˆ—è¡¨æ˜¯å¦‚ä½•èŠ‚çœå†…å­˜ç©ºé—´çš„ã€‚æ¯ä¸ª entry ä¿å­˜ä¸€ä¸ªå›¾ç‰‡å­˜å‚¨å¯¹è±¡ IDï¼ˆ8 å­—èŠ‚ï¼‰ï¼Œæ­¤æ—¶ï¼Œæ¯ä¸ª entry çš„ prev_len åªéœ€è¦ 1 ä¸ªå­—èŠ‚å°±è¡Œï¼Œå› ä¸ºæ¯ä¸ª entry çš„å‰ä¸€ä¸ª entry é•¿åº¦éƒ½åªæœ‰ 8 å­—èŠ‚ï¼Œå°äº 254 å­—èŠ‚ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªå›¾ç‰‡çš„å­˜å‚¨å¯¹è±¡ ID æ‰€å ç”¨çš„å†…å­˜å¤§å°æ˜¯ 14 å­—èŠ‚ï¼ˆ1+4+1+8=14ï¼‰ï¼Œå®é™…åˆ†é… 16 å­—èŠ‚ã€‚</p><p>&emsp;&emsp;æˆ‘ä»¬ä»¥ä¸€ä¸ªå…¨å±€çš„è§†è§’å»çœ‹ä½¿ç”¨ string ç±»å‹çš„å­˜å‚¨å½¢å¼ï¼Œæ¯å¼ å›¾ç‰‡ ID éƒ½ä¼šå ç”¨ä¸€ä¸ªå“ˆå¸Œæ¡¶ä½ï¼Œè¿™å°±å¢åŠ äº†å“ˆå¸Œå†²çªçš„æ¦‚ç‡ã€‚å¹¶ä¸”ï¼Œå…ƒæ•°æ®å’ŒæŒ‡é’ˆä¼šå ç”¨å¤§é‡çš„ç©ºé—´ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis48.png" alt="avatar"></p><p>&emsp;&emsp;è‹¥ä½¿ç”¨ Hash ç±»å‹æ¥å­˜å‚¨ï¼Œå¯ä»¥é‡‡å–äºŒçº§ç¼–ç æ–¹æ³•ã€‚è¿™é‡Œè¯´çš„äºŒçº§ç¼–ç ï¼Œ å°±æ˜¯æŠŠä¸€ä¸ªå•å€¼çš„æ•°æ®æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†ä½œä¸º Hash é›†åˆçš„ keyï¼Œåä¸€éƒ¨åˆ†ä½œä¸º Hash é›†åˆçš„ valueï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå•å€¼æ•°æ®ä¿å­˜åˆ° Hash é›†åˆä¸­äº†ã€‚<br>&emsp;&emsp;ä»¥å›¾ç‰‡ ID 1101000060 å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID 3302000080 ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå›¾ç‰‡ ID çš„å‰ 7 ä½ï¼ˆ1101000ï¼‰ä½œä¸º Hash ç±»å‹çš„é”®ï¼ŒæŠŠå›¾ç‰‡ ID çš„æœ€å 3 ä½ï¼ˆ060ï¼‰å’Œå›¾ç‰‡å­˜å‚¨å¯¹è±¡ ID åˆ†åˆ«ä½œä¸º Hash ç±»å‹å€¼ä¸­çš„ key å’Œ valueã€‚<br>&emsp;&emsp;æŒ‰ç…§è¿™ç§è®¾è®¡æ–¹æ³•ï¼Œåœ¨å­˜å‚¨äº†å¤§é‡çš„å›¾ç‰‡å’Œå¯¹è±¡çš„æ•°æ®åï¼Œåœ¨ Redis ä¸­æ’å…¥äº†ä¸€ç»„å›¾ç‰‡ ID åŠå…¶å­˜å‚¨å¯¹è±¡ ID çš„è®°å½•ï¼Œå¹¶ä¸”ç”¨ info å‘½ä»¤æŸ¥çœ‹äº†å†…å­˜å¼€é”€ï¼Œå‘ç°ï¼Œå¢åŠ ä¸€æ¡è®°å½•åï¼Œå†…å­˜å ç”¨åªå¢åŠ äº† 16 å­—èŠ‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info memory </span><br><span class="line"><span class="comment"># Memory </span></span><br><span class="line">used_memory:1039120</span><br><span class="line">127.0.0.1:6379&gt; hset 1101000 060 3302000080 </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; info memory </span><br><span class="line"><span class="comment"># Memory </span></span><br><span class="line">used_memory:1039136</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™æ˜¯å› ä¸ºå›¾ç‰‡ ID çš„å‰ 7 ä½ï¼ˆ1101000ï¼‰ä½œä¸º key åœ¨ä¹‹å‰å·²ç»å­˜å‚¨è¿‡äº†ï¼Œé‡‡ç”¨ ä»¥ å‹ç¼©åˆ—è¡¨ä¸ºåº•å±‚æ•°æ®ç»“æ„çš„ hash ç±»å‹ï¼Œå°±å¯ä»¥æ ¹æ® key çš„åä¸‰ä½ ï¼ˆ060ï¼‰å­˜å‚¨åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¢åŠ çš„å†…å­˜ä»…ä»…æ˜¯å‹ç¼©åˆ—è¡¨ä¸­ä¸€ä¸ª entry çš„å¤§å°ã€‚è€Œä»¥ string ç±»å‹æ¥å­˜å‚¨â€œé”® - å€¼â€å¯¹ï¼Œéƒ½è¦æ–°åˆ†é…ä¸€ä¸ªå“ˆå¸Œæ¡¶ï¼Œå¼€è¾Ÿä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸‹çš„æ–° entry èŠ‚ç‚¹æ¥å­˜å‚¨ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis49.png" alt="avatar"></p><p>&emsp;&emsp;æœ€åï¼Œä½ å¯èƒ½ä¹Ÿä¼šæœ‰ç–‘æƒ‘ï¼šâ€œäºŒçº§ç¼–ç ä¸€å®šè¦æŠŠå›¾ç‰‡ ID çš„å‰ 7 ä½ä½œä¸º Hash ç±»å‹çš„é”®ï¼ŒæŠŠæœ€å 3 ä½ä½œä¸º Hash ç±»å‹å€¼ä¸­çš„ key å—ï¼Ÿâ€å…¶å®ï¼ŒäºŒçº§ç¼–ç æ–¹æ³•ä¸­é‡‡ç”¨çš„ ID é•¿åº¦æ˜¯æœ‰è®²ç©¶çš„ã€‚Redis Hash ç±»å‹çš„ä¸¤ç§åº•å±‚å®ç°ç»“æ„ï¼Œåˆ†åˆ«æ˜¯å‹ç¼©åˆ—è¡¨å’Œå“ˆå¸Œè¡¨ã€‚Hash ç±»å‹è®¾ç½®äº†ç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ•°æ®æ—¶çš„ä¸¤ä¸ªé˜ˆå€¼ï¼Œä¸€æ—¦è¶…è¿‡äº†é˜ˆå€¼ï¼ŒHash ç±»å‹å°±ä¼šç”¨å“ˆå¸Œè¡¨æ¥ä¿å­˜æ•°æ®äº†ã€‚è¿™ä¸¤ä¸ªé˜ˆå€¼åˆ†åˆ«å¯¹åº”ä»¥ä¸‹ä¸¤ä¸ªé…ç½®é¡¹ï¼š</p><ol><li>hash-max-ziplist-entriesï¼šè¡¨ç¤ºç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­çš„æœ€å¤§å…ƒç´ ä¸ªæ•°ã€‚</li><li>hash-max-ziplist-valueï¼šè¡¨ç¤ºç”¨å‹ç¼©åˆ—è¡¨ä¿å­˜æ—¶å“ˆå¸Œé›†åˆä¸­å•ä¸ªå…ƒç´ çš„æœ€å¤§é•¿åº¦ã€‚</li></ol><p>&emsp;&emsp;å¦‚æœæˆ‘ä»¬å¾€ Hash é›†åˆä¸­å†™å…¥çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡äº† hash-max-ziplist-entriesï¼Œæˆ–è€…å†™å…¥çš„å•ä¸ªå…ƒç´ å¤§å°è¶…è¿‡äº† hash-max-ziplist-valueï¼ŒRedis å°±ä¼šè‡ªåŠ¨æŠŠ Hash ç±»å‹çš„å®ç°ç»“æ„ç”±å‹ç¼©åˆ—è¡¨è½¬ä¸ºå“ˆå¸Œè¡¨ã€‚ä¸€æ—¦ä»å‹ç¼©åˆ—è¡¨è½¬ä¸ºäº†å“ˆå¸Œè¡¨ï¼ŒHash ç±»å‹å°±ä¼šä¸€ç›´ç”¨å“ˆå¸Œè¡¨è¿›è¡Œä¿å­˜ï¼Œè€Œä¸ä¼šå†è½¬å›å‹ç¼©åˆ—è¡¨äº†ã€‚åœ¨èŠ‚çœå†…å­˜ç©ºé—´æ–¹é¢ï¼Œå“ˆå¸Œè¡¨å°±æ²¡æœ‰å‹ç¼©åˆ—è¡¨é‚£ä¹ˆé«˜æ•ˆäº†ã€‚<strong>ä¸ºäº†èƒ½å……åˆ†ä½¿ç”¨å‹ç¼©åˆ—è¡¨çš„ç²¾ç®€å†…å­˜å¸ƒå±€ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¦æ§åˆ¶ä¿å­˜åœ¨ Hash é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°</strong>ã€‚æ‰€ä»¥ï¼Œåœ¨åˆšæ‰çš„äºŒçº§ç¼–ç ä¸­ï¼Œæˆ‘ä»¬åªç”¨å›¾ç‰‡ ID æœ€å 3 ä½ä½œä¸º Hash é›†åˆçš„ keyï¼Œä¹Ÿå°± ä¿è¯äº† Hash é›†åˆçš„å…ƒç´ ä¸ªæ•°ä¸è¶…è¿‡ 1000ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬æŠŠ hash-max-ziplist-entries è®¾ç½® ä¸º 1000ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒHash é›†åˆå°±å¯ä»¥ä¸€ç›´ä½¿ç”¨å‹ç¼©åˆ—è¡¨æ¥èŠ‚çœå†…å­˜ç©ºé—´äº†ã€‚</p><h1 id="æ•°æ®å­˜å‚¨çš„ä¸šåŠ¡åœºæ™¯"><a href="#æ•°æ®å­˜å‚¨çš„ä¸šåŠ¡åœºæ™¯" class="headerlink" title="æ•°æ®å­˜å‚¨çš„ä¸šåŠ¡åœºæ™¯"></a>æ•°æ®å­˜å‚¨çš„ä¸šåŠ¡åœºæ™¯</h1><h2 id="èšåˆç»Ÿè®¡ï¼ˆSetï¼‰"><a href="#èšåˆç»Ÿè®¡ï¼ˆSetï¼‰" class="headerlink" title="èšåˆç»Ÿè®¡ï¼ˆSetï¼‰"></a>èšåˆç»Ÿè®¡ï¼ˆSetï¼‰</h2><p>&emsp;&emsp;æ‰€è°“çš„èšåˆç»Ÿè®¡ï¼Œå°±æ˜¯æŒ‡ç»Ÿè®¡å¤šä¸ªé›†åˆå…ƒç´ çš„èšåˆç»“æœï¼ŒåŒ…æ‹¬ï¼šç»Ÿè®¡å¤šä¸ªé›†åˆçš„å…±æœ‰å…ƒç´ ï¼ˆäº¤é›†ç»Ÿè®¡ï¼‰ï¼›æŠŠä¸¤ä¸ªé›†åˆç›¸æ¯”ï¼Œç»Ÿè®¡å…¶ä¸­ä¸€ä¸ªé›†åˆç‹¬æœ‰çš„å…ƒç´ ï¼ˆå·®é›†ç»Ÿè®¡ï¼‰ï¼›ç»Ÿè®¡å¤šä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ ï¼ˆå¹¶é›†ç»Ÿè®¡ï¼‰ã€‚</p><h3 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h3><p>&emsp;&emsp;ç»Ÿè®¡æ‰‹æœº App æ¯å¤©çš„æ–°å¢ç”¨æˆ·æ•°å’Œç¬¬äºŒå¤©çš„ç•™å­˜ç”¨æˆ·æ•°ã€‚è¦å®Œæˆè¿™ä¸ªç»Ÿè®¡ä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªé›†åˆè®°å½•æ‰€æœ‰ç™»å½•è¿‡ App çš„ç”¨æˆ· IDï¼ŒåŒæ—¶ï¼Œç”¨å¦ä¸€ä¸ªé›†åˆè®°å½•æ¯ä¸€å¤©ç™»å½•è¿‡ App çš„ç”¨æˆ· IDã€‚ç„¶åï¼Œå†å¯¹è¿™ä¸¤ä¸ªé›†åˆåšèšåˆç»Ÿè®¡ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å…·ä½“çš„æ“ä½œã€‚</p><ol><li><p>è®°å½•æ‰€æœ‰ç™»å½•è¿‡ App çš„ç”¨æˆ· IDï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ Set ç±»å‹ï¼ŒæŠŠ key è®¾ç½®ä¸º user:idï¼Œè¡¨ç¤ºè®°å½•çš„æ˜¯ç”¨æˆ· IDï¼Œvalue å°±æ˜¯ä¸€ä¸ª Set é›†åˆï¼Œé‡Œé¢æ˜¯æ‰€æœ‰ç™»å½•è¿‡ App çš„ç”¨æˆ· IDï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ª Set å«ä½œç´¯è®¡ç”¨æˆ· Setï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis50.jpg" alt="avatar"></p></li><li><p>è¿˜éœ€è¦æŠŠæ¯ä¸€å¤©ç™»å½•çš„ç”¨æˆ· IDï¼Œè®°å½•åˆ°ä¸€ä¸ªæ–°é›†åˆä¸­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé›†åˆå«ä½œæ¯ æ—¥ç”¨æˆ· Setï¼Œå®ƒæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p></li></ol><ul><li>key æ˜¯ user:id ä»¥åŠå½“å¤©æ—¥æœŸï¼Œä¾‹å¦‚ user:id:20200803ï¼›</li><li>value æ˜¯ Set é›†åˆï¼Œè®°å½•å½“å¤©ç™»å½•çš„ç”¨æˆ· IDã€‚<br><img lazyload src="/images/loading.svg" data-src="redis51.jpg" alt="avatar"></li></ul><h3 id="å…·ä½“ä¾‹å­"><a href="#å…·ä½“ä¾‹å­" class="headerlink" title="å…·ä½“ä¾‹å­"></a>å…·ä½“ä¾‹å­</h3><p>&emsp;&emsp;å‡è®¾æˆ‘ä»¬çš„æ‰‹æœº App åœ¨ 2020 å¹´ 8 æœˆ 3 æ—¥ä¸Šçº¿ï¼Œé‚£ä¹ˆï¼Œ8 æœˆ 3 æ—¥å‰æ˜¯æ²¡æœ‰ç”¨æˆ·çš„ã€‚æ­¤æ—¶ï¼Œç´¯è®¡ç”¨æˆ· Set æ˜¯ç©ºé›†ï¼Œå½“å¤©ç™»å½•çš„ç”¨æˆ· ID ä¼šè¢«è®°å½•åˆ° key ä¸º user:id:20200803 çš„ Set ä¸­ã€‚æ‰€ä»¥ï¼Œuser:id:20200803 è¿™ä¸ª Set ä¸­çš„ç”¨æˆ·å°±æ˜¯å½“å¤©çš„æ–°å¢ç”¨æˆ·ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—ç´¯è®¡ç”¨æˆ· Set å’Œ user:id:20200803 Set çš„å¹¶é›†ç»“æœï¼Œç»“æœä¿å­˜åœ¨ user:id è¿™ä¸ªç´¯è®¡ç”¨æˆ· Set ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUNIONSTORE  user:id  user:id  user:id:20200803</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;æ­¤æ—¶ï¼Œuser:id è¿™ä¸ªç´¯è®¡ç”¨æˆ· Set ä¸­å°±æœ‰äº† 8 æœˆ 3 æ—¥çš„ç”¨æˆ· IDã€‚ç­‰åˆ° 8 æœˆ 4 æ—¥å†ç»Ÿè®¡æ—¶ï¼Œæˆ‘ä»¬æŠŠ 8 æœˆ 4 æ—¥ç™»å½•çš„ç”¨æˆ· ID è®°å½•åˆ° user:id:20200804 çš„ Set ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰§è¡Œ SDIFFSTORE å‘½ä»¤è®¡ç®—ç´¯è®¡ç”¨æˆ· Set å’Œ user:id:20200804 Set çš„å·®é›†ï¼Œç»“æœä¿å­˜åœ¨ key ä¸º user:new çš„ Set ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SDIFFSTORE  user:new  user:id:20200804  user:id</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªå·®é›†ä¸­çš„ç”¨æˆ· ID åœ¨ user:id:20200804 çš„ Set ä¸­å­˜åœ¨ï¼Œä½†æ˜¯ä¸åœ¨ç´¯è®¡ç”¨æˆ· Set ä¸­ã€‚æ‰€ä»¥ï¼Œuser:new è¿™ä¸ª Set ä¸­è®°å½•çš„å°±æ˜¯ 8 æœˆ 4 æ—¥çš„æ–°å¢ç”¨æˆ·ã€‚</p><p>&emsp;&emsp;å½“è¦è®¡ç®— 8 æœˆ 4 æ—¥çš„ç•™å­˜ç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å†è®¡ç®— user:id:20200803 å’Œ user:id:20200804 ä¸¤ä¸ª Set çš„äº¤é›†ï¼Œå°±å¯ä»¥å¾—åˆ°åŒæ—¶åœ¨è¿™ä¸¤ä¸ªé›†åˆä¸­çš„ç”¨æˆ· ID äº†ï¼Œè¿™äº›å°±æ˜¯åœ¨ 8 æœˆ 3 æ—¥ç™»å½•ï¼Œå¹¶ä¸”åœ¨ 8 æœˆ 4 æ—¥ç•™å­˜çš„ç”¨æˆ·ã€‚æ‰§è¡Œçš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SINTERSTORE  user:id:rem  user:id:20200803  user:id:20200804</span><br></pre></td></tr></table></figure><h3 id="æ½œåœ¨é£é™©åŠè§£å†³ç­–ç•¥"><a href="#æ½œåœ¨é£é™©åŠè§£å†³ç­–ç•¥" class="headerlink" title="æ½œåœ¨é£é™©åŠè§£å†³ç­–ç•¥"></a>æ½œåœ¨é£é™©åŠè§£å†³ç­–ç•¥</h3><ul><li><p>æ½œåœ¨é£é™©ï¼šSet çš„å·®é›†ã€å¹¶é›†å’Œäº¤é›†çš„è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè¿™äº›è®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡ã€‚</p></li><li><p>è§£å†³ç­–ç•¥ï¼šå¯ä»¥ä»ä¸»ä»é›†ç¾¤ä¸­é€‰æ‹©ä¸€ä¸ªä»åº“ï¼Œè®©å®ƒä¸“é—¨è´Ÿè´£èšåˆè®¡ç®—ï¼Œæˆ–è€…æ˜¯æŠŠæ•°æ®è¯»å–åˆ°å®¢æˆ·ç«¯ï¼Œåœ¨å®¢æˆ·ç«¯æ¥å®Œæˆèšåˆç»Ÿè®¡ï¼Œè¿™æ ·å°±å¯ä»¥è§„é¿é˜»å¡ä¸»åº“å®ä¾‹å’Œå…¶ä»–ä»åº“å®ä¾‹çš„é£é™©äº†ã€‚</p></li></ul><h2 id="æ’åºç»Ÿè®¡ï¼ˆListã€Sorted-Setï¼‰"><a href="#æ’åºç»Ÿè®¡ï¼ˆListã€Sorted-Setï¼‰" class="headerlink" title="æ’åºç»Ÿè®¡ï¼ˆListã€Sorted Setï¼‰"></a>æ’åºç»Ÿè®¡ï¼ˆListã€Sorted Setï¼‰</h2><p>&emsp;&emsp;æœ€æ–°è¯„è®ºåˆ—è¡¨åŒ…å«äº†æ‰€æœ‰è¯„è®ºä¸­çš„æœ€æ–°ç•™è¨€ï¼Œ<strong>è¿™å°±è¦æ±‚é›†åˆç±»å‹èƒ½å¯¹å…ƒç´ ä¿åº</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé›†åˆä¸­çš„å…ƒç´ å¯ä»¥æŒ‰åºæ’åˆ—ï¼Œè¿™ç§å¯¹å…ƒç´ ä¿åºçš„é›†åˆç±»å‹å«ä½œæœ‰åºé›†åˆã€‚åœ¨ Redis å¸¸ç”¨çš„ 4 ä¸ªé›†åˆç±»å‹ä¸­ï¼ˆListã€Hashã€Setã€Sorted Setï¼‰ï¼ŒList å’Œ Sorted Set å°±å±äºæœ‰åºé›†åˆã€‚<br>&emsp;&emsp;List æ˜¯æŒ‰ç…§å…ƒç´ è¿›å…¥ List çš„é¡ºåºè¿›è¡Œæ’åºçš„ï¼Œè€Œ Sorted Set å¯ä»¥æ ¹æ®å…ƒç´ çš„æƒé‡æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å†³å®šæ¯ä¸ªå…ƒç´ çš„æƒé‡å€¼ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…ƒç´ æ’å…¥ Sorted Set çš„æ—¶é—´ç¡®å®šæƒé‡å€¼ï¼Œå…ˆæ’å…¥çš„å…ƒç´ æƒé‡å°ï¼Œåæ’å…¥çš„å…ƒç´ æƒé‡å¤§ã€‚</p><h3 id="ä¸šåŠ¡åœºæ™¯-1"><a href="#ä¸šåŠ¡åœºæ™¯-1" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h3><ol><li>List</li></ol><p>&emsp;&emsp;æ¯ä¸ªå•†å“å¯¹åº”ä¸€ä¸ª Listï¼Œè¿™ä¸ª List åŒ…å«äº†å¯¹è¿™ä¸ªå•†å“çš„æ‰€æœ‰è¯„è®ºï¼Œè€Œä¸”ä¼šæŒ‰ç…§è¯„è®ºæ—¶é—´ä¿å­˜è¿™äº›è¯„è®ºï¼Œæ¯æ¥ä¸€ä¸ªæ–°è¯„è®ºï¼Œå°±ç”¨ LPUSH å‘½ä»¤æŠŠå®ƒæ’å…¥ List çš„é˜Ÿå¤´ã€‚åœ¨åªæœ‰ä¸€é¡µè¯„è®ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ™°åœ°çœ‹åˆ°æœ€æ–°çš„è¯„è®ºï¼Œä½†æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œç½‘ç«™ä¸€èˆ¬ä¼šåˆ†é¡µæ˜¾ç¤ºæœ€æ–°çš„è¯„è®ºåˆ—è¡¨ï¼Œä¸€æ—¦æ¶‰åŠåˆ°åˆ†é¡µæ“ä½œï¼ŒList å°±å¯èƒ½ä¼šå‡ºç°é—®é¢˜äº†ã€‚</p><p>&emsp;&emsp;å‡è®¾å½“å‰çš„è¯„è®º List æ˜¯{A, B, C, D, E, F}ï¼ˆå…¶ä¸­ï¼ŒA æ˜¯æœ€æ–°çš„è¯„è®ºï¼Œä»¥æ­¤ç±»æ¨ï¼ŒF æ˜¯æœ€æ—©çš„è¯„è®ºï¼‰ï¼Œåœ¨å±•ç¤ºç¬¬ä¸€é¡µçš„ 3 ä¸ªè¯„è®ºæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œå¾—åˆ°æœ€æ–°çš„ä¸‰æ¡è¯„è®º Aã€Bã€Cï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LRANGE product1 0 2</span><br><span class="line">1) <span class="string">&quot;A&quot;</span></span><br><span class="line">2) <span class="string">&quot;B&quot;</span></span><br><span class="line">3) <span class="string">&quot;C&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç„¶åï¼Œå†ç”¨ä¸‹é¢çš„å‘½ä»¤è·å–ç¬¬äºŒé¡µçš„ 3 ä¸ªè¯„è®ºï¼Œä¹Ÿå°±æ˜¯ Dã€Eã€Fã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LRANGE product1 3 5</span><br><span class="line">1) <span class="string">&quot;D&quot;</span></span><br><span class="line">2) <span class="string">&quot;E&quot;</span></span><br><span class="line">3) <span class="string">&quot;F&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä½†æ˜¯ï¼Œå¦‚æœåœ¨å±•ç¤ºç¬¬äºŒé¡µå‰ï¼Œåˆäº§ç”Ÿäº†ä¸€ä¸ªæ–°è¯„è®º Gï¼Œè¯„è®º G å°±ä¼šè¢« LPUSH å‘½ä»¤æ’å…¥åˆ°è¯„è®º List çš„é˜Ÿå¤´ï¼Œè¯„è®º List å°±å˜æˆäº†{G, A, B, C, D, E, F}ã€‚æ­¤æ—¶ï¼Œå†ç”¨åˆšæ‰çš„å‘½ä»¤è·å–ç¬¬äºŒé¡µè¯„è®ºæ—¶ï¼Œå°±ä¼šå‘ç°ï¼Œè¯„è®º C åˆè¢«å±•ç¤ºå‡ºæ¥äº†ï¼Œä¹Ÿå°±æ˜¯ Cã€Dã€Eã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LRANGE product1 3 5</span><br><span class="line">1) <span class="string">&quot;C&quot;</span></span><br><span class="line">2) <span class="string">&quot;D&quot;</span></span><br><span class="line">3) <span class="string">&quot;E&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä¹‹æ‰€ä»¥ä¼šè¿™æ ·ï¼Œå…³é”®åŸå› å°±åœ¨äºï¼ŒList æ˜¯é€šè¿‡å…ƒç´ åœ¨ List ä¸­çš„ä½ç½®æ¥æ’åºçš„ï¼Œå½“æœ‰ä¸€ä¸ªæ–°å…ƒç´ æ’å…¥æ—¶ï¼ŒåŸå…ˆçš„å…ƒç´ åœ¨ List ä¸­çš„ä½ç½®éƒ½åç§»äº†ä¸€ä½ï¼Œæ¯”å¦‚è¯´åŸæ¥åœ¨ç¬¬ 1 ä½çš„å…ƒç´ ç°åœ¨æ’åœ¨äº†ç¬¬ 2 ä½ã€‚æ‰€ä»¥ï¼Œå¯¹æ¯”æ–°å…ƒç´ æ’å…¥å‰åï¼ŒList ç›¸åŒä½ç½®ä¸Šçš„å…ƒç´ å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç”¨ LRANGE è¯»å–æ—¶ï¼Œå°±ä¼šè¯»åˆ°æ—§å…ƒç´ ã€‚</p><ol start="2"><li>Sorted Set<br>&emsp;&emsp;å’Œ List ç›¸æ¯”ï¼ŒSorted Set å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒæ˜¯æ ¹æ®å…ƒç´ çš„å®é™…æƒé‡æ¥æ’åºå’Œè·å–æ•°æ®çš„ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰è¯„è®ºæ—¶é—´çš„å…ˆåç»™æ¯æ¡è¯„è®ºè®¾ç½®ä¸€ä¸ªæƒé‡å€¼ï¼Œç„¶åå†æŠŠè¯„è®ºä¿å­˜åˆ° Sorted Set ä¸­ã€‚Sorted Set çš„ ZRANGEBYSCORE å‘½ä»¤å°±å¯ä»¥æŒ‰æƒé‡æ’åºåè¿”å›å…ƒç´ ã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿é›†åˆä¸­çš„å…ƒç´ é¢‘ç¹æ›´æ–°ï¼ŒSorted Set ä¹Ÿèƒ½é€šè¿‡ ZRANGEBYSCORE å‘½ä»¤å‡†ç¡®åœ°è·å–åˆ°æŒ‰åºæ’åˆ—çš„æ•°æ®ã€‚å‡è®¾è¶Šæ–°çš„è¯„è®ºæƒé‡è¶Šå¤§ï¼Œç›®å‰æœ€æ–°è¯„è®ºçš„æƒé‡æ˜¯ Nï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ï¼Œå°±å¯ä»¥è·å¾—æœ€æ–°çš„ 10 æ¡è¯„è®ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZRANGEBYSCORE comments N-9 N</span><br></pre></td></tr></table></figure></li></ol><p>&emsp;&emsp;æ‰€ä»¥ï¼Œåœ¨é¢å¯¹éœ€è¦å±•ç¤ºæœ€æ–°åˆ—è¡¨ã€æ’è¡Œæ¦œç­‰åœºæ™¯æ—¶ï¼Œå¦‚æœæ•°æ®æ›´æ–°é¢‘ç¹æˆ–è€…éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Sorted Setã€‚</p><h2 id="äºŒå€¼çŠ¶æ€ç»Ÿè®¡ï¼ˆBitmapï¼‰"><a href="#äºŒå€¼çŠ¶æ€ç»Ÿè®¡ï¼ˆBitmapï¼‰" class="headerlink" title="äºŒå€¼çŠ¶æ€ç»Ÿè®¡ï¼ˆBitmapï¼‰"></a>äºŒå€¼çŠ¶æ€ç»Ÿè®¡ï¼ˆBitmapï¼‰</h2><p>&emsp;&emsp;äºŒå€¼çŠ¶æ€å°±æ˜¯æŒ‡é›†åˆå…ƒç´ çš„å– å€¼å°±åªæœ‰ 0 å’Œ 1 ä¸¤ç§ã€‚åœ¨ç­¾åˆ°æ‰“å¡çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åªç”¨è®°å½•ç­¾åˆ°ï¼ˆ1ï¼‰æˆ–æœªç­¾åˆ°ï¼ˆ0ï¼‰ï¼Œæ‰€ä»¥å®ƒå°±æ˜¯éå¸¸å…¸å‹çš„äºŒå€¼çŠ¶æ€ã€‚</p><h3 id="ä¸šåŠ¡åœºæ™¯-2"><a href="#ä¸šåŠ¡åœºæ™¯-2" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h3><p>&emsp;&emsp;åœ¨ç­¾åˆ°ç»Ÿè®¡æ—¶ï¼Œæ¯ä¸ªç”¨æˆ·ä¸€å¤©çš„ç­¾åˆ°ç”¨ 1 ä¸ª bit ä½å°±èƒ½è¡¨ç¤ºï¼Œä¸€ä¸ªæœˆï¼ˆå‡è®¾æ˜¯ 31 å¤©ï¼‰çš„ç­¾åˆ°æƒ…å†µç”¨ 31 ä¸ª bit ä½å°±å¯ä»¥ï¼Œè€Œä¸€å¹´çš„ç­¾åˆ°ä¹Ÿåªéœ€è¦ç”¨ 365 ä¸ª bit ä½ï¼Œæ ¹æœ¬ä¸ç”¨å¤ªå¤æ‚çš„é›†åˆç±»å‹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹© Bitmapã€‚è¿™æ˜¯ Redis æä¾›çš„æ‰©å±•æ•°æ®ç±»å‹ã€‚</p><h3 id="bitmap-çš„å®ç°åŸç†"><a href="#bitmap-çš„å®ç°åŸç†" class="headerlink" title="bitmap çš„å®ç°åŸç†"></a>bitmap çš„å®ç°åŸç†</h3><p>&emsp;&emsp;Bitmap æœ¬èº«æ˜¯ç”¨ String ç±»å‹ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å®ç°çš„ä¸€ç§ç»Ÿè®¡äºŒå€¼çŠ¶æ€çš„æ•°æ®ç±»å‹ã€‚String ç±»å‹æ˜¯ä¼šä¿å­˜ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥ï¼ŒRedis å°±æŠŠå­—èŠ‚æ•°ç»„çš„æ¯ä¸ª bit ä½åˆ©ç”¨èµ·æ¥ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„äºŒå€¼çŠ¶æ€ã€‚ä½ å¯ä»¥æŠŠ Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ª bit æ•°ç»„ã€‚<br>&emsp;&emsp;Bitmap æä¾›äº† GETBIT/SETBIT æ“ä½œï¼Œä½¿ç”¨ä¸€ä¸ªåç§»å€¼ offset å¯¹ bit æ•°ç»„çš„æŸä¸€ä¸ª bit ä½è¿›è¡Œè¯»å’Œå†™ã€‚ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒBitmap çš„åç§»é‡æ˜¯ä» 0 å¼€å§‹ç®—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ offset çš„æœ€å°å€¼æ˜¯ 0ã€‚å½“ä½¿ç”¨ SETBIT å¯¹ä¸€ä¸ª bit ä½è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œè¿™ä¸ª bit ä½ä¼šè¢«è®¾ç½®ä¸º 1ã€‚Bitmap è¿˜æä¾›äº† BITCOUNT æ“ä½œï¼Œç”¨æ¥ç»Ÿè®¡è¿™ä¸ª bit æ•°ç»„ä¸­æ‰€æœ‰â€œ1â€çš„ä¸ªæ•°ã€‚</p><h3 id="å…·ä½“ä¾‹å­1"><a href="#å…·ä½“ä¾‹å­1" class="headerlink" title="å…·ä½“ä¾‹å­1"></a>å…·ä½“ä¾‹å­1</h3><p>&emsp;&emsp;å‡è®¾æˆ‘ä»¬è¦ç»Ÿè®¡ ID 3000 çš„ç”¨æˆ·åœ¨ 2020 å¹´ 8 æœˆä»½çš„ç­¾åˆ°æƒ…å†µï¼Œå°±å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œæ“ä½œã€‚</p><ol><li><p>ç¬¬ä¸€æ­¥ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®°å½•è¯¥ç”¨æˆ· 8 æœˆ 3 å·å·²ç­¾åˆ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETBIT uid:sign:3000:202008 2 1</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬äºŒæ­¥ï¼Œæ£€æŸ¥è¯¥ç”¨æˆ· 8 æœˆ 3 æ—¥æ˜¯å¦ç­¾åˆ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GETBIT uid:sign:3000:202008 2</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬ä¸‰æ­¥ï¼Œç»Ÿè®¡è¯¥ç”¨æˆ·åœ¨ 8 æœˆä»½çš„ç­¾åˆ°æ¬¡æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT uid:sign:3000:202008</span><br></pre></td></tr></table></figure></li></ol><h3 id="å…·ä½“ä¾‹å­2"><a href="#å…·ä½“ä¾‹å­2" class="headerlink" title="å…·ä½“ä¾‹å­2"></a>å…·ä½“ä¾‹å­2</h3><p>&emsp;&emsp;ï¼šå¦‚æœè®°å½•äº† 1 äº¿ä¸ªç”¨æˆ· 10 å¤©çš„ç­¾åˆ°æƒ…å†µï¼Œä½ æœ‰åŠæ³•ç»Ÿè®¡å‡ºè¿™ 10 å¤©è¿ç»­ç­¾åˆ°çš„ç”¨æˆ·æ€»æ•°å—ï¼Ÿ<br>&emsp;&emsp;Bitmap æ”¯æŒç”¨ BITOP å‘½ä»¤å¯¹å¤šä¸ª Bitmap æŒ‰ä½åšâ€œä¸â€â€œæˆ–â€â€œå¼‚æˆ–â€çš„æ“ä½œï¼Œæ“ä½œçš„ç»“æœä¼šä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„ Bitmap ä¸­ã€‚æˆ‘ä»¥æŒ‰ä½â€œä¸â€æ“ä½œä¸ºä¾‹æ¥å…·ä½“è§£é‡Šä¸€ä¸‹ã€‚ä»ä¸‹å›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ª Bitmap bm1ã€bm2 å’Œ bm3ï¼Œå¯¹åº” bit ä½åšâ€œä¸â€æ“ä½œï¼Œç»“æœä¿å­˜åˆ°äº†ä¸€ä¸ªæ–°çš„ Bitmap ä¸­ï¼ˆç¤ºä¾‹ä¸­ï¼Œè¿™ä¸ªç»“æœ Bitmap çš„ key è¢«è®¾ä¸ºâ€œresmapâ€ï¼‰ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis52.jpg" alt="avatar"><br>&emsp;&emsp;åœ¨ç»Ÿè®¡ 1 äº¿ä¸ªç”¨æˆ·è¿ç»­ 10 å¤©çš„ç­¾åˆ°æƒ…å†µæ—¶ï¼Œä½ å¯ä»¥æŠŠæ¯å¤©çš„æ—¥æœŸä½œä¸º keyï¼Œæ¯ä¸ª key å¯¹åº”ä¸€ä¸ª 1 äº¿ä½çš„ Bitmapï¼Œæ¯ä¸€ä¸ª bit å¯¹åº”ä¸€ä¸ªç”¨æˆ·å½“å¤©çš„ç­¾åˆ°æƒ…å†µã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹ 10 ä¸ª Bitmap åšâ€œä¸â€æ“ä½œï¼Œå¾—åˆ°çš„ç»“æœä¹Ÿæ˜¯ä¸€ä¸ª Bitmapã€‚åœ¨è¿™ä¸ª Bitmap ä¸­ï¼Œåªæœ‰ 10 å¤©éƒ½ç­¾åˆ°çš„ç”¨æˆ·å¯¹åº”çš„ bit ä½ä¸Šçš„å€¼æ‰ä¼šæ˜¯ 1ã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ BITCOUNT ç»Ÿè®¡ä¸‹ Bitmap ä¸­çš„ 1 çš„ä¸ªæ•°ï¼Œè¿™å°±æ˜¯è¿ç»­ç­¾åˆ° 10 å¤©çš„ç”¨æˆ·æ€»æ•°äº†ã€‚<br>&emsp;&emsp;ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ä¸€ä¸‹è®°å½•äº† 10 å¤©ç­¾åˆ°æƒ…å†µåçš„å†…å­˜å¼€é”€ã€‚æ¯å¤©ä½¿ç”¨ 1 ä¸ª 1 äº¿ä½çš„ Bitmapï¼Œå¤§çº¦å  12MB çš„å†…å­˜ï¼ˆ10^8/8/1024/1024ï¼‰ï¼Œ10 å¤©çš„ Bitmap çš„å†…å­˜å¼€é”€çº¦ä¸º 120MBï¼Œå†…å­˜å‹åŠ›ä¸ç®—å¤ªå¤§ã€‚ä¸è¿‡ï¼Œåœ¨å®é™…åº”ç”¨æ—¶ï¼Œæœ€å¥½å¯¹ Bitmap è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè®© Redis è‡ªåŠ¨åˆ é™¤ä¸å†éœ€è¦çš„ç­¾åˆ°è®°å½•ï¼Œä»¥èŠ‚çœå†…å­˜å¼€é”€ã€‚</p><p>&emsp;&emsp;æ‰€ä»¥ï¼Œå¦‚æœåªéœ€è¦ç»Ÿè®¡æ•°æ®çš„äºŒå€¼çŠ¶æ€ï¼Œä¾‹å¦‚å•†å“æœ‰æ²¡æœ‰ã€ç”¨æˆ·åœ¨ä¸åœ¨ç­‰ï¼Œå°±å¯ä»¥ä½¿ç”¨ Bitmapï¼Œå› ä¸ºå®ƒåªç”¨ä¸€ä¸ª bit ä½å°±èƒ½è¡¨ç¤º 0 æˆ– 1ã€‚åœ¨è®°å½•æµ·é‡æ•°æ®æ—¶ï¼ŒBitmap èƒ½å¤Ÿæœ‰æ•ˆåœ°èŠ‚çœå†…å­˜ç©ºé—´ã€‚</p><h2 id="åŸºæ•°ç»Ÿè®¡ï¼ˆHyperLogLogï¼‰"><a href="#åŸºæ•°ç»Ÿè®¡ï¼ˆHyperLogLogï¼‰" class="headerlink" title="åŸºæ•°ç»Ÿè®¡ï¼ˆHyperLogLogï¼‰"></a>åŸºæ•°ç»Ÿè®¡ï¼ˆHyperLogLogï¼‰</h2><p>&emsp;&emsp;åŸºæ•°ç»Ÿè®¡å°±æ˜¯æŒ‡ç»Ÿè®¡ä¸€ä¸ªé›†åˆä¸­ä¸é‡å¤çš„å…ƒç´ ä¸ªæ•°ã€‚</p><h3 id="ä¸šåŠ¡åœºæ™¯-3"><a href="#ä¸šåŠ¡åœºæ™¯-3" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h3><p>&emsp;&emsp;ç½‘é¡µ UV çš„ç»Ÿè®¡æœ‰ä¸ªç‹¬ç‰¹çš„åœ°æ–¹ï¼Œå°±æ˜¯éœ€è¦å»é‡ï¼Œä¸€ä¸ªç”¨æˆ·ä¸€å¤©å†…çš„å¤šæ¬¡è®¿é—®åªèƒ½ç®—ä½œä¸€æ¬¡ã€‚åœ¨ Redis çš„é›†åˆç±»å‹ä¸­ï¼ŒSet ç±»å‹é»˜è®¤æ”¯æŒå»é‡ï¼Œæ‰€ä»¥çœ‹åˆ°æœ‰å»é‡éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ç¬¬ä¸€æ—¶é—´å°±ä¼šæƒ³åˆ°ç”¨ Set ç±»å‹ã€‚</p><p>æˆ‘ä»¬æ¥ç»“åˆä¸€ä¸ªä¾‹å­çœ‹ä¸€çœ‹ç”¨ Set çš„æƒ…å†µã€‚</p><ol><li>æœ‰ä¸€ä¸ªç”¨æˆ· user1 è®¿é—® page1 æ—¶ï¼Œä½ æŠŠè¿™ä¸ªä¿¡æ¯åŠ åˆ° Set ä¸­ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SADD page1:uv user1</span><br></pre></td></tr></table></figure></li></ol><p>&emsp;&emsp;ç”¨æˆ· 1 å†æ¥è®¿é—®æ—¶ï¼ŒSet çš„å»é‡åŠŸèƒ½å°±ä¿è¯äº†ä¸ä¼šé‡å¤è®°å½•ç”¨æˆ· 1 çš„è®¿é—®æ¬¡æ•°ï¼Œè¿™æ ·ï¼Œç”¨ æˆ· 1 å°±ç®—æ˜¯ä¸€ä¸ªç‹¬ç«‹è®¿å®¢ã€‚å½“ä½ éœ€è¦ç»Ÿè®¡ UV æ—¶ï¼Œå¯ä»¥ç›´æ¥ç”¨ SCARD å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚<br>&emsp;&emsp;ä½†æ˜¯ï¼Œå¦‚æœ page1 éå¸¸ç«çˆ†ï¼ŒUV è¾¾åˆ°äº†åƒä¸‡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸€ä¸ª Set å°±è¦è®°å½•åƒä¸‡ä¸ªç”¨æˆ· IDã€‚å¯¹äºä¸€ä¸ªæå¤§ä¿ƒçš„ç”µå•†ç½‘ç«™è€Œè¨€ï¼Œè¿™æ ·çš„é¡µé¢å¯èƒ½æœ‰æˆåƒä¸Šä¸‡ä¸ªï¼Œå¦‚æœæ¯ä¸ªé¡µé¢éƒ½ç”¨è¿™æ ·çš„ä¸€ä¸ª Setï¼Œå°±ä¼šæ¶ˆè€—å¾ˆå¤§çš„å†…å­˜ç©ºé—´ã€‚</p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ Hash ç±»å‹è®°å½• UVã€‚<br>ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŠŠç”¨æˆ· ID ä½œä¸º Hash é›†åˆçš„ keyï¼Œå½“ç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼Œå°±ç”¨ HSET å‘½ä»¤ï¼ˆç”¨ äºè®¾ç½® Hash é›†åˆå…ƒç´ çš„å€¼ï¼‰ï¼Œå¯¹è¿™ä¸ªç”¨æˆ· ID è®°å½•ä¸€ä¸ªå€¼â€œ1â€ï¼Œè¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹è®¿å®¢ï¼Œç”¨ æˆ· 1 è®¿é—® page1 åï¼Œæˆ‘ä»¬å°±è®°å½•ä¸º 1 ä¸ªç‹¬ç«‹è®¿å®¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSET page1:uv user1 1</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å³ä½¿ç”¨æˆ· 1 å¤šæ¬¡è®¿é—®é¡µé¢ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ª HSET å‘½ä»¤ï¼Œä¹Ÿåªä¼šæŠŠ user1 çš„å€¼è®¾ç½®ä¸º 1ï¼Œä»ç„¶åªè®°ä¸º 1 ä¸ªç‹¬ç«‹è®¿å®¢ã€‚å½“è¦ç»Ÿè®¡ UV æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ HLEN å‘½ä»¤ç»Ÿè®¡ Hash é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°ã€‚ä½†æ˜¯ï¼Œå’Œ Set ç±»å‹ç›¸ä¼¼ï¼Œå½“é¡µé¢å¾ˆå¤šæ—¶ï¼ŒHash ç±»å‹ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤§çš„å†…å­˜ç©ºé—´ã€‚é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆåŠæ³•æ—¢èƒ½å®Œæˆç»Ÿè®¡ï¼Œè¿˜èƒ½èŠ‚çœå†…å­˜å—ï¼Ÿ</p><h3 id="ä½¿ç”¨-HyperLogLog"><a href="#ä½¿ç”¨-HyperLogLog" class="headerlink" title="ä½¿ç”¨ HyperLogLog"></a>ä½¿ç”¨ HyperLogLog</h3><p>&emsp;&emsp;HyperLogLog æ˜¯ä¸€ç§ç”¨äºç»Ÿè®¡åŸºæ•°çš„æ•°æ®é›†åˆç±»å‹ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿å°±åœ¨äºï¼Œå½“é›†åˆå…ƒç´ æ•°é‡éå¸¸å¤šæ—¶ï¼Œå®ƒè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ï¼Œè€Œä¸”è¿˜å¾ˆå°ã€‚åœ¨ Redis ä¸­ï¼Œæ¯ä¸ª HyperLogLog åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªå…ƒç´ çš„åŸºæ•°ã€‚å’Œå…ƒç´ è¶Šå¤šå°±è¶Šè€—è´¹å†…å­˜çš„ Set å’Œ Hash ç±»å‹ç›¸æ¯”ï¼ŒHyperLogLog å°±éå¸¸èŠ‚çœç©ºé—´ã€‚</p><ol><li><p>åœ¨ç»Ÿè®¡ UV æ—¶ï¼Œå¯ä»¥ç”¨ PFADD å‘½ä»¤ï¼ˆç”¨äºå‘ HyperLogLog ä¸­æ·»åŠ æ–°å…ƒç´ ï¼‰æŠŠè®¿é—®é¡µé¢çš„æ¯ä¸ªç”¨æˆ·éƒ½æ·»åŠ åˆ° HyperLogLog ä¸­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFADD page1:uv user1 user2 user3 user4 user5</span><br></pre></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç”¨ PFCOUNT å‘½ä»¤ç›´æ¥è·å¾— page1 çš„ UV å€¼äº†ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨å°±æ˜¯è¿”å› HyperLogLog çš„ç»Ÿè®¡ç»“æœã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PFCOUNT page1:uv</span><br></pre></td></tr></table></figure></li></ol><h3 id="HyperLogLog-çš„ç²¾åº¦å±€é™æ€§"><a href="#HyperLogLog-çš„ç²¾åº¦å±€é™æ€§" class="headerlink" title="HyperLogLog çš„ç²¾åº¦å±€é™æ€§"></a>HyperLogLog çš„ç²¾åº¦å±€é™æ€§</h3><p>&emsp;&emsp;ä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ä½ æ³¨æ„ä¸€ä¸‹ï¼ŒHyperLogLog çš„ç»Ÿè®¡è§„åˆ™æ˜¯åŸºäºæ¦‚ç‡å®Œæˆçš„ï¼Œæ‰€ä»¥å®ƒç»™å‡ºçš„ç»Ÿè®¡ç»“æœæ˜¯æœ‰ä¸€å®šè¯¯å·®çš„ï¼Œæ ‡å‡†è¯¯ç®—ç‡æ˜¯ 0.81%ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œä½ ä½¿ç”¨HyperLogLog ç»Ÿè®¡çš„ UV æ˜¯ 100 ä¸‡ï¼Œä½†å®é™…çš„ UV å¯èƒ½æ˜¯ 101 ä¸‡ã€‚è™½ç„¶è¯¯å·®ç‡ä¸ç®—å¤§ï¼Œä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ç²¾ç¡®ç»Ÿè®¡ç»“æœçš„è¯ï¼Œæœ€å¥½è¿˜æ˜¯ç»§ç»­ç”¨ Set æˆ– Hash ç±»å‹ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>&emsp;&emsp;åœ¨æœ¬ç»“ä¸­ï¼Œæˆ‘ä»¬ç»“åˆç»Ÿè®¡ç”¨æˆ·æ–°å¢æ•°å’Œç•™å­˜æ•°ã€æœ€æ–°è¯„è®ºåˆ—è¡¨ã€ç­¾åˆ°ç»Ÿè®¡ä»¥åŠç½‘é¡µç‹¬ç«‹è®¿é—®é‡è¿™ 4 ç§å…¸å‹åœºæ™¯ï¼Œè®¨è®ºäº† 4 ç§ç»Ÿè®¡æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯èšåˆç»Ÿè®¡ã€æ’åºç»Ÿè®¡ã€äºŒå€¼çŠ¶æ€ç»Ÿè®¡å’ŒåŸºæ•°ç»Ÿè®¡ã€‚ä¸‹è¡¨æ˜¯è¿™ 4 ç§ç»Ÿè®¡æ¨¡å¼å¯¹åº” Redis ç±»å‹çš„è§£å†³ç­–ç•¥ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis53.jpg" alt="avatar"><br>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼ŒSet å’Œ Sorted Set éƒ½æ”¯æŒå¤šç§èšåˆç»Ÿè®¡ï¼Œä¸è¿‡ï¼Œå¯¹äºå·®é›†è®¡ç®—æ¥è¯´ï¼Œåªæœ‰ Set æ”¯æŒã€‚Bitmap ä¹Ÿèƒ½åšå¤šä¸ª Bitmap é—´çš„èšåˆè®¡ç®—ï¼ŒåŒ…æ‹¬ä¸ã€æˆ–å’Œå¼‚æˆ–æ“ä½œã€‚</p><p>&emsp;&emsp;å½“éœ€è¦è¿›è¡Œæ’åºç»Ÿè®¡æ—¶ï¼ŒList ä¸­çš„å…ƒç´ è™½ç„¶æœ‰åºï¼Œä½†æ˜¯ä¸€æ—¦æœ‰æ–°å…ƒç´ æ’å…¥ï¼ŒåŸæ¥çš„å…ƒç´ åœ¨ List ä¸­çš„ä½ç½®å°±ä¼šç§»åŠ¨ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ä½ç½®è¯»å–çš„æ’åºç»“æœå¯èƒ½å°±ä¸å‡†ç¡®äº†ã€‚è€Œ Sorted Set æœ¬èº«æ˜¯æŒ‰ç…§é›†åˆå…ƒç´ çš„æƒé‡æ’åºï¼Œå¯ä»¥å‡†ç¡®åœ°æŒ‰åºè·å–ç»“æœï¼Œæ‰€ä»¥å»ºè®®ä¼˜å…ˆä½¿ç”¨å®ƒã€‚</p><p>&emsp;&emsp;å¦‚æœæˆ‘ä»¬è®°å½•çš„æ•°æ®åªæœ‰ 0 å’Œ 1 ä¸¤ä¸ªå€¼çš„çŠ¶æ€ï¼ŒBitmap ä¼šæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œè¿™ä¸»è¦å½’åŠŸäº Bitmap å¯¹äºä¸€ä¸ªæ•°æ®åªç”¨ 1 ä¸ª bit è®°å½•ï¼Œå¯ä»¥èŠ‚çœå†…å­˜ã€‚</p><p>&emsp;&emsp;å¯¹äºåŸºæ•°ç»Ÿè®¡æ¥è¯´ï¼Œå¦‚æœé›†åˆå…ƒç´ é‡è¾¾åˆ°äº¿çº§åˆ«è€Œä¸”ä¸éœ€è¦ç²¾ç¡®ç»Ÿè®¡æ—¶ï¼Œå»ºè®®ä½ ä½¿ç”¨ HyperLogLogã€‚</p><h1 id="GEO-ç±»å‹"><a href="#GEO-ç±»å‹" class="headerlink" title="GEO ç±»å‹"></a>GEO ç±»å‹</h1><p>&emsp;&emsp;åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šä¾èµ–æœç´¢â€œé™„è¿‘çš„é¤é¦†â€ã€åœ¨æ‰“è½¦è½¯ä»¶ä¸Šå«è½¦ï¼Œè¿™äº›éƒ½ç¦»ä¸å¼€åŸºäºä½ç½®ä¿¡æ¯æœåŠ¡ï¼ˆLocation-Based Serviceï¼ŒLBSï¼‰çš„åº”ç”¨ã€‚LBS åº”ç”¨è®¿é—®çš„æ•°æ®æ˜¯å’Œäººæˆ–ç‰©å…³è”çš„ä¸€ç»„ç»çº¬åº¦ä¿¡æ¯ï¼Œè€Œä¸”è¦èƒ½æŸ¥è¯¢ç›¸é‚»çš„ç»çº¬åº¦èŒƒå›´ï¼ŒGEO å°±éå¸¸é€‚åˆåº”ç”¨åœ¨ LBS æœåŠ¡çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„åº•å±‚ç»“æ„ã€‚</p><h2 id="GEO-çš„åº•å±‚ç»“æ„"><a href="#GEO-çš„åº•å±‚ç»“æ„" class="headerlink" title="GEO çš„åº•å±‚ç»“æ„"></a>GEO çš„åº•å±‚ç»“æ„</h2><h3 id="GEO-è¦å¤„ç†çš„æ•°æ®çš„ç‰¹ç‚¹"><a href="#GEO-è¦å¤„ç†çš„æ•°æ®çš„ç‰¹ç‚¹" class="headerlink" title="GEO è¦å¤„ç†çš„æ•°æ®çš„ç‰¹ç‚¹"></a>GEO è¦å¤„ç†çš„æ•°æ®çš„ç‰¹ç‚¹</h3><p>&emsp;&emsp;æˆ‘ä»¥å«è½¦æœåŠ¡ä¸ºä¾‹ï¼Œæ¥åˆ†æä¸‹ LBS åº”ç”¨ä¸­ç»çº¬åº¦çš„å­˜å–ç‰¹ç‚¹ã€‚</p><ol><li>æ¯ä¸€è¾†ç½‘çº¦è½¦éƒ½æœ‰ä¸€ä¸ªç¼–å·ï¼ˆä¾‹å¦‚ 33ï¼‰ï¼Œç½‘çº¦è½¦éœ€è¦å°†è‡ªå·±çš„ç»åº¦ä¿¡æ¯ï¼ˆä¾‹å¦‚116.034579ï¼‰å’Œçº¬åº¦ä¿¡æ¯ï¼ˆä¾‹å¦‚ 39.000452 ï¼‰å‘ç»™å«è½¦åº”ç”¨ã€‚</li><li>ç”¨æˆ·åœ¨å«è½¦çš„æ—¶å€™ï¼Œå«è½¦åº”ç”¨ä¼šæ ¹æ®ç”¨æˆ·çš„ç»çº¬åº¦ä½ç½®ï¼ˆä¾‹å¦‚ç»åº¦ 116.054579ï¼Œçº¬åº¦39.030452ï¼‰ï¼ŒæŸ¥æ‰¾ç”¨æˆ·çš„é™„è¿‘è½¦è¾†ï¼Œå¹¶è¿›è¡ŒåŒ¹é…ã€‚</li><li>ç­‰æŠŠä½ç½®ç›¸è¿‘çš„ç”¨æˆ·å’Œè½¦è¾†åŒ¹é…ä¸Šä»¥åï¼Œå«è½¦åº”ç”¨å°±ä¼šæ ¹æ®è½¦è¾†çš„ç¼–å·ï¼Œè·å–è½¦è¾†çš„ä¿¡æ¯ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</li></ol><p>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œä¸€è¾†è½¦ï¼ˆæˆ–ä¸€ä¸ªç”¨æˆ·ï¼‰å¯¹åº”ä¸€ç»„ç»çº¬åº¦ï¼Œå¹¶ä¸”éšç€è½¦ï¼ˆæˆ–ç”¨æˆ·ï¼‰çš„ä½ç½®ç§»åŠ¨ï¼Œç›¸åº”çš„ç»çº¬åº¦ä¹Ÿä¼šå˜åŒ–ã€‚è¿™ç§æ•°æ®è®°å½•æ¨¡å¼å±äºä¸€ä¸ª keyï¼ˆä¾‹å¦‚è½¦ IDï¼‰å¯¹åº”ä¸€ä¸ª valueï¼ˆä¸€ç»„ç»çº¬åº¦ï¼‰ã€‚å½“æœ‰å¾ˆå¤šè½¦è¾†ä¿¡æ¯è¦ä¿å­˜æ—¶ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªé›†åˆæ¥ä¿å­˜ä¸€ç³»åˆ—çš„ key å’Œ valueã€‚Hash é›†åˆç±»å‹å¯ä»¥å¿«é€Ÿå­˜å–ä¸€ç³»åˆ—çš„ key å’Œ valueï¼Œæ­£å¥½å¯ä»¥ç”¨æ¥è®°å½•ä¸€ç³»åˆ—è½¦è¾† ID å’Œç»çº¬åº¦çš„å¯¹åº”å…³ç³»ï¼Œ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸åŒè½¦è¾†çš„ ID å’Œå®ƒä»¬å¯¹åº”çš„ç»çº¬åº¦ä¿¡æ¯å­˜åœ¨ Hash é›†åˆä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis54.jpg" alt="avatra"><br>&emsp;&emsp;åŒæ—¶ï¼ŒHash ç±»å‹çš„ HSET æ“ä½œå‘½ä»¤ï¼Œä¼šæ ¹æ® key æ¥è®¾ç½®ç›¸åº”çš„ value å€¼ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¿«é€Ÿåœ°æ›´æ–°è½¦è¾†å˜åŒ–çš„ç»çº¬åº¦ä¿¡æ¯ã€‚<br>&emsp;&emsp;åˆ°è¿™é‡Œï¼ŒHash ç±»å‹çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½†é—®é¢˜æ˜¯ï¼Œå¯¹äºä¸€ä¸ª LBS åº”ç”¨æ¥è¯´ï¼Œé™¤äº†è®°å½•ç»çº¬åº¦ä¿¡æ¯ï¼Œè¿˜éœ€è¦æ ¹æ®ç”¨æˆ·çš„ç»çº¬åº¦ä¿¡æ¯åœ¨è½¦è¾†çš„ Hash é›†åˆä¸­è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ã€‚ä¸€ æ—¦æ¶‰åŠåˆ°èŒƒå›´æŸ¥è¯¢ï¼Œå°±æ„å‘³ç€é›†åˆä¸­çš„å…ƒç´ éœ€è¦æœ‰åºï¼Œï¼ˆ<strong>å¦‚æœæ— åºé‚£ä¹ˆåªèƒ½å…¨å±€éå†æœç´¢ï¼Œå…¶æ—¶é—´ä»£ä»·æ˜¯ä¸èƒ½å¤Ÿæ¥å—çš„</strong>ï¼‰ï¼Œä½† Hash ç±»å‹çš„å…ƒç´ æ˜¯æ— åºçš„ï¼Œæ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ã€‚</p><p>&emsp;&emsp;æˆ‘ä»¬å†æ¥çœ‹çœ‹ä½¿ç”¨ Sorted Set ç±»å‹æ˜¯ä¸æ˜¯åˆé€‚ã€‚Sorted Set ç±»å‹ä¹Ÿæ”¯æŒä¸€ä¸ª key å¯¹åº”ä¸€ä¸ª value çš„è®°å½•æ¨¡å¼ï¼Œå…¶ä¸­ï¼Œkey å°±æ˜¯ Sorted Set ä¸­çš„å…ƒç´ ï¼Œè€Œ value åˆ™æ˜¯å…ƒç´ çš„æƒé‡åˆ†æ•°ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒSorted Set å¯ä»¥æ ¹æ®å…ƒç´ çš„ æƒé‡åˆ†æ•°æ’åºï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚è¿™å°±èƒ½æ»¡è¶³ LBS æœåŠ¡ä¸­æŸ¥æ‰¾ç›¸é‚»ä½ç½®çš„éœ€æ±‚äº†ã€‚å®é™…ä¸Šï¼ŒGEO ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„å°±æ˜¯ç”¨ Sorted Set æ¥å®ç°çš„ã€‚å’±ä»¬è¿˜æ˜¯å€Ÿç€å«è½¦åº”ç”¨çš„ä¾‹å­æ¥åŠ æ·±ä¸‹ç†è§£ã€‚<br>&emsp;&emsp;ç”¨ Sorted Set æ¥ä¿å­˜è½¦è¾†çš„ç»çº¬åº¦ä¿¡æ¯æ—¶ï¼ŒSorted Set çš„å…ƒç´ æ˜¯è½¦è¾† IDï¼Œå…ƒç´ çš„æƒé‡åˆ†æ•°æ˜¯ç»çº¬åº¦ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis55.jpg" alt="avatar"><br>&emsp;&emsp;è¿™æ—¶é—®é¢˜æ¥äº†ï¼ŒSorted Set å…ƒç´ çš„æƒé‡åˆ†æ•°æ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ˆfloat ç±»å‹ï¼‰ï¼Œè€Œä¸€ç»„ç»çº¬åº¦åŒ…å«çš„æ˜¯ç»åº¦å’Œçº¬åº¦ä¸¤ä¸ªå€¼ï¼Œæ˜¯æ²¡æ³•ç›´æ¥ä¿å­˜ä¸ºä¸€ä¸ªæµ®ç‚¹æ•°çš„ï¼Œé‚£å…·ä½“è¯¥æ€ä¹ˆè¿›è¡Œä¿å­˜å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ° GEO ç±»å‹ä¸­çš„ GeoHash ç¼–ç äº†ã€‚</p><h3 id="GeoHash-çš„ç¼–ç æ–¹æ³•"><a href="#GeoHash-çš„ç¼–ç æ–¹æ³•" class="headerlink" title="GeoHash çš„ç¼–ç æ–¹æ³•"></a>GeoHash çš„ç¼–ç æ–¹æ³•</h3><p>&emsp;&emsp;ä¸ºäº†èƒ½é«˜æ•ˆåœ°å¯¹ç»çº¬åº¦è¿›è¡Œæ¯”è¾ƒï¼ŒRedis é‡‡ç”¨äº†ä¸šç•Œå¹¿æ³›ä½¿ç”¨çš„ GeoHash ç¼–ç æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„åŸºæœ¬åŸç†å°±æ˜¯â€œäºŒåˆ†åŒºé—´ï¼ŒåŒºé—´ç¼–ç â€ã€‚å½“æˆ‘ä»¬è¦å¯¹ä¸€ç»„ç»çº¬åº¦è¿›è¡Œ GeoHash ç¼–ç æ—¶ï¼Œæˆ‘ä»¬è¦å…ˆå¯¹ç»åº¦å’Œçº¬åº¦åˆ†åˆ«ç¼–ç ï¼Œç„¶åå†æŠŠç»çº¬åº¦å„è‡ªçš„ç¼–ç ç»„åˆæˆä¸€ä¸ªæœ€ç»ˆç¼–ç ã€‚</p><ol><li>ä¸‹ç»åº¦å’Œçº¬åº¦çš„å•ç‹¬ç¼–ç è¿‡ç¨‹:<br>&emsp;&emsp;å¯¹äºä¸€ä¸ªåœ°ç†ä½ç½®ä¿¡æ¯æ¥è¯´ï¼Œå®ƒçš„ç»åº¦èŒƒå›´æ˜¯[-180,180]ã€‚GeoHash ç¼–ç ä¼šæŠŠä¸€ä¸ªç»åº¦å€¼ç¼–ç æˆä¸€ä¸ª N ä½çš„äºŒè¿›åˆ¶å€¼ï¼Œæˆ‘ä»¬æ¥å¯¹ç»åº¦èŒƒå›´[-180,180]åš N æ¬¡çš„äºŒåˆ†åŒºæ“ä½œï¼Œå…¶ä¸­ N å¯ä»¥è‡ªå®šä¹‰ã€‚<br>&emsp;&emsp;åœ¨è¿›è¡Œç¬¬ä¸€æ¬¡äºŒåˆ†åŒºæ—¶ï¼Œç»åº¦èŒƒå›´[-180,180]ä¼šè¢«åˆ†æˆä¸¤ä¸ªå­åŒºé—´ï¼š[-180,0) å’Œ[0,180] ï¼ˆå·¦ã€å³åˆ†åŒºï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸€ä¸‹è¦ç¼–ç çš„ç»åº¦å€¼è½åœ¨äº†å·¦åˆ†åŒºè¿˜æ˜¯å³åˆ†åŒºã€‚å¦‚æœæ˜¯è½åœ¨å·¦åˆ†åŒºï¼Œæˆ‘ä»¬å°±ç”¨ 0 è¡¨ç¤ºï¼›å¦‚æœè½åœ¨å³åˆ†åŒºï¼Œå°±ç”¨ 1 è¡¨ç¤ºã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¯åšå®Œä¸€æ¬¡äºŒåˆ†åŒºï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ° 1 ä½ç¼–ç å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬å†å¯¹ç»åº¦å€¼æ‰€å±çš„åˆ†åŒºå†åšä¸€æ¬¡äºŒåˆ†åŒºï¼ŒåŒæ—¶å†æ¬¡æŸ¥çœ‹ç»åº¦å€¼è½åœ¨äº†äºŒåˆ†åŒºåçš„å·¦åˆ†åŒºè¿˜æ˜¯å³åˆ†åŒºï¼ŒæŒ‰ç…§åˆšæ‰çš„è§„åˆ™å†åš 1 ä½ç¼–ç ã€‚å½“åšå®Œ N æ¬¡çš„äºŒåˆ†åŒºåï¼Œç»åº¦å€¼å°±å¯ä»¥ç”¨ä¸€ä¸ª N bit çš„æ•°æ¥è¡¨ç¤ºäº†ã€‚</li></ol><p>&emsp;&emsp;ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬è¦ç¼–ç çš„ç»åº¦å€¼æ˜¯ 116.37ï¼Œæˆ‘ä»¬ç”¨ 5 ä½ç¼–ç å€¼ï¼ˆä¹Ÿå°±æ˜¯ N=5ï¼Œåš 5 æ¬¡åˆ†åŒºï¼‰ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis56.jpg" alt="avatar"><br>å¯¹çº¬åº¦çš„ç¼–ç æ–¹å¼ï¼Œå’Œå¯¹ç»åº¦çš„ä¸€æ ·ï¼Œåªæ˜¯çº¬åº¦çš„èŒƒå›´æ˜¯[-90ï¼Œ90]ï¼Œä¸‹é¢è¿™å¼ è¡¨æ˜¾ç¤ºäº†å¯¹ çº¬åº¦å€¼ 39.86 çš„ç¼–ç è¿‡ç¨‹ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis57.jpg" alt="avatar"></p><ol start="2"><li>æŠŠå®ƒä»¬çš„å„è‡ªç¼–ç å€¼ç»„åˆåœ¨ä¸€èµ·:<br>&emsp;&emsp;ç»„åˆçš„è§„åˆ™æ˜¯ï¼šæœ€ç»ˆç¼–ç å€¼çš„å¶æ•°ä½ä¸Šä¾æ¬¡æ˜¯ç»åº¦çš„ç¼–ç å€¼ï¼Œå¥‡æ•°ä½ä¸Šä¾æ¬¡æ˜¯çº¬åº¦çš„ç¼–ç å€¼ï¼Œå…¶ä¸­ï¼Œå¶æ•°ä½ä» 0 å¼€å§‹ï¼Œå¥‡æ•°ä½ä» 1 å¼€å§‹ã€‚æˆ‘ä»¬åˆšåˆšè®¡ç®—çš„ç»çº¬åº¦ï¼ˆ116.37ï¼Œ39.86ï¼‰çš„å„è‡ªç¼–ç å€¼æ˜¯ 11010 å’Œ 10111ï¼Œç»„åˆä¹‹åï¼Œç¬¬ 0 ä½æ˜¯ç»åº¦çš„ç¬¬ 0 ä½ 1ï¼Œç¬¬ 1 ä½æ˜¯çº¬åº¦çš„ç¬¬ 0 ä½ 1ï¼Œç¬¬ 2 ä½æ˜¯ç»åº¦çš„ç¬¬ 1 ä½ 1ï¼Œç¬¬ 3 ä½æ˜¯çº¬åº¦çš„ç¬¬ 1 ä½ 0ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå°±èƒ½å¾—åˆ°æœ€ç»ˆç¼–ç å€¼ 1110011101ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis58.jpg" alt="avatar"><br>&emsp;&emsp;ç”¨äº† GeoHash ç¼–ç åï¼ŒåŸæ¥æ— æ³•ç”¨ä¸€ä¸ªæƒé‡åˆ†æ•°è¡¨ç¤ºçš„ä¸€ç»„ç»çº¬åº¦ï¼ˆ116.37ï¼Œ39.86ï¼‰å°±å¯ä»¥ç”¨ 1110011101 è¿™ä¸€ä¸ªå€¼æ¥è¡¨ç¤ºï¼Œå°±å¯ä»¥ä¿å­˜ä¸º Sorted Set çš„æƒé‡åˆ†æ•°äº†ã€‚å½“ç„¶ï¼Œä½¿ç”¨ GeoHash ç¼–ç åï¼Œæˆ‘ä»¬ç›¸å½“äºæŠŠæ•´ä¸ªåœ°ç†ç©ºé—´åˆ’åˆ†æˆäº†ä¸€ä¸ªä¸ªæ–¹æ ¼ï¼Œæ¯ä¸ªæ–¹æ ¼å¯¹åº”äº† GeoHash ä¸­çš„ä¸€ä¸ªåˆ†åŒºã€‚<br>&emsp;&emsp;ä¸¾ä¸ªä¾‹å­ã€‚æˆ‘ä»¬æŠŠç»åº¦åŒºé—´[-180,180]åšä¸€æ¬¡äºŒåˆ†åŒºï¼ŒæŠŠçº¬åº¦åŒºé—´[-90,90]åšä¸€æ¬¡äºŒåˆ†åŒºï¼Œå°±ä¼šå¾—åˆ° 4 ä¸ªåˆ†åŒºã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒä»¬çš„ç»åº¦å’Œçº¬åº¦èŒƒå›´ä»¥åŠå¯¹åº”çš„ GeoHash ç»„åˆç¼–ç ã€‚</li></ol><ul><li>åˆ†åŒºä¸€ï¼š[-180,0) å’Œ[-90,0)ï¼Œç¼–ç  00ï¼›</li><li>åˆ†åŒºäºŒï¼š[-180,0) å’Œ[0,90]ï¼Œç¼–ç  01ï¼›</li><li>åˆ†åŒºä¸‰ï¼š[0,180]å’Œ[-90,0)ï¼Œç¼–ç  10ï¼›</li><li>åˆ†åŒºå››ï¼š[0,180]å’Œ[0,90]ï¼Œç¼–ç  11ã€‚</li></ul><p>&emsp;&emsp;è¿™ 4 ä¸ªåˆ†åŒºå¯¹åº”äº† 4 ä¸ªæ–¹æ ¼ï¼Œæ¯ä¸ªæ–¹æ ¼è¦†ç›–äº†ä¸€å®šèŒƒå›´å†…çš„ç»çº¬åº¦å€¼ï¼Œåˆ†åŒºè¶Šå¤šï¼Œæ¯ä¸ªæ–¹æ ¼èƒ½è¦†ç›–åˆ°çš„åœ°ç†ç©ºé—´å°±è¶Šå°ï¼Œä¹Ÿå°±è¶Šç²¾å‡†ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰æ–¹æ ¼çš„ç¼–ç å€¼æ˜ å°„åˆ°ä¸€ç»´ç©ºé—´æ—¶ï¼Œç›¸é‚»æ–¹æ ¼çš„ GeoHash ç¼–ç å€¼åŸºæœ¬ä¹Ÿæ˜¯æ¥è¿‘çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis59.jpg" alt="avatar"><br>&emsp;&emsp;æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ Sorted Set èŒƒå›´æŸ¥è¯¢å¾—åˆ°çš„ç›¸è¿‘ç¼–ç å€¼ï¼Œåœ¨å®é™…çš„åœ°ç†ç©ºé—´ä¸Šï¼Œä¹Ÿæ˜¯ç›¸é‚»çš„æ–¹æ ¼ï¼Œè¿™å°±å¯ä»¥å®ç° LBS åº”ç”¨â€œæœç´¢é™„è¿‘çš„äººæˆ–ç‰©â€çš„åŠŸèƒ½äº†ã€‚ä¸è¿‡ï¼Œæœ‰çš„ç¼–ç å€¼è™½ç„¶åœ¨å¤§å°ä¸Šæ¥è¿‘ï¼Œä½†å®é™…å¯¹åº”çš„æ–¹æ ¼å´è·ç¦»æ¯”è¾ƒè¿œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨ 4 ä½æ¥åš GeoHash ç¼–ç ï¼ŒæŠŠç»åº¦åŒºé—´[-180,180]å’Œçº¬åº¦åŒºé—´[-90,90]å„ åˆ†æˆäº† 4 ä¸ªåˆ†åŒºï¼Œä¸€å…± 16 ä¸ªåˆ†åŒºï¼Œå¯¹åº”äº† 16 ä¸ªæ–¹æ ¼ã€‚ç¼–ç å€¼ä¸º 0111 å’Œ 1000 çš„ä¸¤ä¸ªæ–¹æ ¼å°±ç¦»å¾—æ¯”è¾ƒè¿œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis60.jpg" alt="avatar"><br>&emsp;&emsp;æ‰€ä»¥ï¼Œä¸ºäº†é¿å…æŸ¥è¯¢ä¸å‡†ç¡®é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æŸ¥è¯¢ç»™å®šç»çº¬åº¦æ‰€åœ¨çš„æ–¹æ ¼å‘¨å›´çš„ 4 ä¸ªæˆ– 8 ä¸ªæ–¹æ ¼ã€‚</p><h2 id="å¦‚ä½•æ“ä½œ-GEO-ç±»å‹"><a href="#å¦‚ä½•æ“ä½œ-GEO-ç±»å‹" class="headerlink" title="å¦‚ä½•æ“ä½œ GEO ç±»å‹"></a>å¦‚ä½•æ“ä½œ GEO ç±»å‹</h2><p>&emsp;&emsp;åœ¨ä½¿ç”¨ GEO ç±»å‹æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°ä¸¤ä¸ªå‘½ä»¤ï¼Œåˆ†åˆ«æ˜¯ GEOADD å’Œ GEORADIUSã€‚</p><ul><li>GEOADD å‘½ä»¤ï¼šç”¨äºæŠŠä¸€ç»„ç»çº¬åº¦ä¿¡æ¯å’Œç›¸å¯¹åº”çš„ä¸€ä¸ª ID è®°å½•åˆ° GEO ç±»å‹é›†åˆä¸­ï¼›</li><li>GEORADIUS å‘½ä»¤ï¼šä¼šæ ¹æ®è¾“å…¥çš„ç»çº¬åº¦ä½ç½®ï¼ŒæŸ¥æ‰¾ä»¥è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒçš„ä¸€å®šèŒƒå›´å†…çš„å…¶ä»–å…ƒç´ ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰è¿™ä¸ªèŒƒå›´ã€‚</li></ul><p>&emsp;&emsp;æˆ‘è¿˜æ˜¯ä»¥å«è½¦åº”ç”¨çš„è½¦è¾†åŒ¹é…åœºæ™¯ä¸ºä¾‹ï¼Œä»‹ç»ä¸‹å…·ä½“å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤ã€‚å‡è®¾è½¦è¾† ID æ˜¯ 33ï¼Œç»çº¬åº¦ä½ç½®æ˜¯ï¼ˆ116.034579ï¼Œ39.030452ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª GEO é›†åˆä¿å­˜æ‰€æœ‰è½¦è¾†çš„ç»çº¬åº¦ï¼Œé›†åˆ key æ˜¯ cars:locationsã€‚æ‰§è¡Œä¸‹é¢çš„è¿™ä¸ªå‘½ä»¤ï¼Œå°±å¯ä»¥ æŠŠ ID å·ä¸º 33 çš„è½¦è¾†çš„å½“å‰ç»çº¬åº¦ä½ç½®å­˜å…¥ GEO é›†åˆä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEOADD cars:locations 116.034579 39.030452 33</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å½“ç”¨æˆ·æƒ³è¦å¯»æ‰¾è‡ªå·±é™„è¿‘çš„ç½‘çº¦è½¦æ—¶ï¼ŒLBS åº”ç”¨å°±å¯ä»¥ä½¿ç”¨ GEORADIUS å‘½ä»¤ã€‚ä¾‹å¦‚ï¼ŒLBS åº”ç”¨æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ—¶ï¼ŒRedis ä¼šæ ¹æ®è¾“å…¥çš„ç”¨æˆ·çš„ç»çº¬åº¦ä¿¡æ¯ ï¼ˆ116.054579ï¼Œ39.030452 ï¼‰ï¼ŒæŸ¥æ‰¾ä»¥è¿™ä¸ªç»çº¬åº¦ä¸ºä¸­å¿ƒçš„ 5 å…¬é‡Œå†…çš„è½¦è¾†ä¿¡æ¯ï¼Œå¹¶è¿”å›ç»™ LBS åº”ç”¨ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥ä¿®æ”¹â€œ5â€è¿™ä¸ªå‚æ•°ï¼Œæ¥è¿”å›æ›´å¤§æˆ–æ›´å°èŒƒå›´å†…çš„è½¦è¾†ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥é™å®šè¿”å›çš„è½¦è¾†ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ASC é€‰é¡¹ï¼Œè®©è¿”å›çš„è½¦è¾†ä¿¡æ¯æŒ‰ç…§è·ç¦»è¿™ä¸ªä¸­å¿ƒä½ç½®ä»è¿‘åˆ°è¿œçš„æ–¹å¼æ¥æ’åºï¼Œä»¥æ–¹ä¾¿é€‰æ‹©æœ€è¿‘çš„è½¦è¾†ï¼›è¿˜å¯ä»¥ä½¿ç”¨ COUNT é€‰é¡¹ï¼ŒæŒ‡å®šè¿”å›çš„è½¦è¾†ä¿¡æ¯çš„æ•°é‡ã€‚æ¯•ç«Ÿï¼Œ5 å…¬é‡ŒèŒƒå›´å†…çš„è½¦è¾†å¯èƒ½æœ‰å¾ˆå¤šï¼Œå¦‚æœè¿”å›å…¨éƒ¨ä¿¡æ¯ï¼Œä¼šå ç”¨æ¯”è¾ƒå¤šçš„æ•°æ®å¸¦å®½ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥å¸®åŠ©æ§åˆ¶è¿”å›çš„æ•°æ®é‡ï¼ŒèŠ‚çœå¸¦å®½ã€‚</p><h1 id="è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹"><a href="#è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹"></a>è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹</h1><h2 id="å¦‚ä½•è‡ªå®šä¹‰æ•°æ®ç±»å‹"><a href="#å¦‚ä½•è‡ªå®šä¹‰æ•°æ®ç±»å‹" class="headerlink" title="å¦‚ä½•è‡ªå®šä¹‰æ•°æ®ç±»å‹"></a>å¦‚ä½•è‡ªå®šä¹‰æ•°æ®ç±»å‹</h2><p>&emsp;&emsp;ä¸ºäº†å®ç°è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ Redis çš„åŸºæœ¬å¯¹è±¡ç»“æ„ RedisObjectï¼Œå›  ä¸º Redis é”®å€¼å¯¹ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æ˜¯ç”¨ RedisObject ä¿å­˜çš„ã€‚RedisObject åŒ…æ‹¬å…ƒæ•°æ®å’ŒæŒ‡é’ˆã€‚å…¶ä¸­ï¼Œå…ƒæ•°æ®çš„ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ç”¨æ¥åŒºåˆ†ä¸åŒçš„æ•°æ®ç±»å‹ï¼ŒæŒ‡é’ˆç”¨æ¥æŒ‡å‘å…·ä½“çš„æ•°æ®ç±»å‹çš„å€¼ã€‚æ‰€ä»¥ï¼Œè¦æƒ³å¼€å‘æ–°æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å°±å…ˆæ¥äº†è§£ä¸‹ RedisObject çš„å…ƒæ•°æ®å’ŒæŒ‡é’ˆã€‚</p><h2 id="Redis-çš„åŸºæœ¬å¯¹è±¡ç»“æ„"><a href="#Redis-çš„åŸºæœ¬å¯¹è±¡ç»“æ„" class="headerlink" title="Redis çš„åŸºæœ¬å¯¹è±¡ç»“æ„"></a>Redis çš„åŸºæœ¬å¯¹è±¡ç»“æ„</h2><p>&emsp;&emsp;RedisObject çš„å†…éƒ¨ç»„æˆåŒ…æ‹¬äº† type,ã€encoding,ã€lru å’Œ refcount 4 ä¸ªå…ƒæ•°æ®ï¼Œä»¥åŠ 1 ä¸ª*ptræŒ‡é’ˆã€‚</p><ul><li>typeï¼šè¡¨ç¤ºå€¼çš„ç±»å‹ï¼Œæ¶µç›–äº†æˆ‘ä»¬å‰é¢å­¦ä¹ çš„äº”å¤§åŸºæœ¬ç±»å‹ï¼›</li><li>encodingï¼šæ˜¯å€¼çš„ç¼–ç æ–¹å¼ï¼Œç”¨æ¥è¡¨ç¤º Redis ä¸­å®ç°å„ä¸ªåŸºæœ¬ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ SDSã€å‹ç¼©åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€è·³è¡¨ç­‰ï¼›</li><li>lruï¼šè®°å½•äº†è¿™ä¸ªå¯¹è±¡æœ€åä¸€æ¬¡è¢«è®¿é—®çš„æ—¶é—´ï¼Œç”¨äºæ·˜æ±°è¿‡æœŸçš„é”®å€¼å¯¹ï¼›</li><li>refcountï¼šè®°å½•äº†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼›</li><li>*ptrï¼šæ˜¯æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="redis61.jpg" alt="avatar"><br>&emsp;&emsp;RedisObject ç»“æ„å€ŸåŠ©*ptræŒ‡é’ˆï¼Œå°±å¯ä»¥æŒ‡å‘ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ*ptræŒ‡å‘ä¸€ä¸ª SDS æˆ–ä¸€ä¸ªè·³è¡¨ï¼Œå°±è¡¨ç¤ºé”®å€¼å¯¹ä¸­çš„å€¼æ˜¯ String ç±»å‹æˆ– Sorted Set ç±»å‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰äº†æ–°çš„æ•°æ®ç±»å‹åï¼Œä¹Ÿåªè¦åœ¨ RedisObject ä¸­è®¾ç½®å¥½æ–°ç±»å‹çš„ type å’Œ encodingï¼Œå† ç”¨*ptræŒ‡å‘æ–°ç±»å‹çš„å®ç°ï¼Œå°±è¡Œäº†ã€‚</p><h1 id="åœ¨-Redis-ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"><a href="#åœ¨-Redis-ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®" class="headerlink" title="åœ¨ Redis ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"></a>åœ¨ Redis ä¸­ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®</h1><h2 id="éœ€æ±‚æ¦‚æ‹¬"><a href="#éœ€æ±‚æ¦‚æ‹¬" class="headerlink" title="éœ€æ±‚æ¦‚æ‹¬"></a>éœ€æ±‚æ¦‚æ‹¬</h2><p>&emsp;&emsp;æˆ‘ä»¬ç°åœ¨åšäº’è”ç½‘äº§å“çš„æ—¶å€™ï¼Œéƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šè®°å½•ç”¨æˆ·åœ¨ç½‘ç«™æˆ–è€… App ä¸Šçš„ç‚¹å‡»è¡Œä¸ºæ•°æ®ï¼Œæ¥åˆ†æç”¨æˆ·è¡Œä¸ºã€‚è¿™é‡Œçš„æ•°æ®ä¸€èˆ¬åŒ…æ‹¬ç”¨æˆ· IDã€è¡Œä¸ºç±»å‹ï¼ˆä¾‹å¦‚æµè§ˆã€ç™»å½•ã€ä¸‹å•ç­‰ï¼‰ã€è¡Œä¸ºå‘ç”Ÿçš„æ—¶é—´æˆ³ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserID, Type, TimeStamp</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å†æ¯”å¦‚åšç‰©è”ç½‘é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦å‘¨æœŸæ€§åœ°ç»Ÿè®¡è¿‘ä¸‡å°è®¾å¤‡çš„å®æ—¶çŠ¶æ€ï¼ŒåŒ…æ‹¬è®¾å¤‡ IDã€å‹åŠ›ã€æ¸©åº¦ã€æ¹¿åº¦ï¼Œä»¥åŠå¯¹åº”çš„æ—¶é—´æˆ³ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DeviceID, Pressure, Temperature, Humidity, TimeStamp</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™äº›<strong>ä¸å‘ç”Ÿæ—¶é—´ç›¸å…³</strong>çš„ä¸€ç»„æ•°æ®ï¼Œå°±æ˜¯æ—¶é—´åºåˆ—æ•°æ®ã€‚è¿™äº›æ•°æ®çš„ç‰¹ç‚¹æ˜¯æ²¡æœ‰ä¸¥æ ¼çš„å…³ç³»æ¨¡å‹ï¼Œè®°å½•çš„ä¿¡æ¯å¯ä»¥è¡¨ç¤ºæˆé”®å’Œå€¼çš„å…³ç³»ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªè®¾å¤‡ ID å¯¹åº”ä¸€æ¡è®°å½•ï¼‰ï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸éœ€è¦ä¸“é—¨ç”¨å…³ç³»å‹æ•°æ®åº“ï¼ˆä¾‹å¦‚ MySQLï¼‰æ¥ä¿å­˜ã€‚è€Œ Redis çš„é”®å€¼æ•°æ®æ¨¡å‹ï¼Œæ­£å¥½å¯ä»¥æ»¡è¶³è¿™é‡Œçš„æ•°æ®å­˜å–éœ€æ±‚ã€‚</p><h2 id="æ—¶é—´åºåˆ—æ•°æ®çš„è¯»å†™ç‰¹ç‚¹"><a href="#æ—¶é—´åºåˆ—æ•°æ®çš„è¯»å†™ç‰¹ç‚¹" class="headerlink" title="æ—¶é—´åºåˆ—æ•°æ®çš„è¯»å†™ç‰¹ç‚¹"></a>æ—¶é—´åºåˆ—æ•°æ®çš„è¯»å†™ç‰¹ç‚¹</h2><ul><li><p>å†™æ•°æ®<br>&emsp;&emsp;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ—¶é—´åºåˆ—æ•°æ®é€šå¸¸æ˜¯æŒç»­é«˜å¹¶å‘å†™å…¥çš„ï¼Œä¾‹å¦‚ï¼Œéœ€è¦è¿ç»­è®°å½•æ•°ä¸‡ä¸ªè®¾å¤‡çš„å®æ—¶çŠ¶æ€å€¼ã€‚åŒæ—¶ï¼Œæ—¶é—´åºåˆ—æ•°æ®çš„å†™å…¥ä¸»è¦å°±æ˜¯æ’å…¥æ–°æ•°æ®ï¼Œè€Œä¸æ˜¯æ›´æ–°ä¸€ä¸ªå·²å­˜åœ¨çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªæ—¶é—´åºåˆ—æ•°æ®è¢«è®°å½•åé€šå¸¸å°±ä¸ä¼šå˜äº†ï¼Œå› ä¸ºå®ƒå°±ä»£è¡¨äº†ä¸€ä¸ªè®¾å¤‡åœ¨æŸä¸ªæ—¶åˆ»çš„çŠ¶æ€å€¼ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªè®¾å¤‡åœ¨æŸä¸ªæ—¶åˆ»çš„æ¸©åº¦æµ‹é‡å€¼ï¼Œä¸€æ—¦è®°å½•ä¸‹æ¥ï¼Œè¿™ä¸ªå€¼æœ¬èº«å°±ä¸ä¼šå†å˜äº†ï¼‰ã€‚æ‰€ä»¥ï¼Œ<strong>è¿™ç§æ•°æ®çš„å†™å…¥ç‰¹ç‚¹å¾ˆç®€å•ï¼Œå°±æ˜¯æ’å…¥æ•°æ®å¿«ï¼Œè¿™å°±è¦æ±‚æˆ‘ä»¬é€‰æ‹©çš„æ•°æ®ç±»å‹ï¼Œåœ¨è¿›è¡Œæ•°æ®æ’å…¥æ—¶ï¼Œå¤æ‚åº¦è¦ä½ï¼Œå°½é‡ä¸è¦é˜»å¡</strong>ã€‚</p></li><li><p>è¯»æ•°æ®<br>&emsp;&emsp;æˆ‘ä»¬åœ¨æŸ¥è¯¢æ—¶é—´åºåˆ—æ•°æ®æ—¶ï¼Œæ—¢æœ‰å¯¹å•æ¡è®°å½•çš„æŸ¥è¯¢ï¼ˆä¾‹å¦‚æŸ¥è¯¢æŸä¸ªè®¾å¤‡åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„è¿è¡ŒçŠ¶æ€ä¿¡æ¯ï¼Œå¯¹åº”çš„å°±æ˜¯è¿™ä¸ªè®¾å¤‡çš„ä¸€æ¡è®°å½•ï¼‰ï¼Œä¹Ÿæœ‰å¯¹æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®çš„æŸ¥è¯¢ï¼ˆä¾‹å¦‚æ¯å¤©æ—©ä¸Š 8 ç‚¹åˆ° 10 ç‚¹çš„æ‰€æœ‰è®¾å¤‡çš„çŠ¶æ€ä¿¡æ¯ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚å¯¹æŸä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®åšèšåˆè®¡ç®—ã€‚è¿™é‡Œçš„èšåˆè®¡ç®—ï¼Œå°±æ˜¯å¯¹ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„æ‰€æœ‰æ•°æ®åšè®¡ç®—ï¼ŒåŒ…æ‹¬è®¡ç®—å‡å€¼ã€æœ€å¤§ / æœ€å°å€¼ã€æ±‚å’Œç­‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦è®¡ç®—æŸä¸ªæ—¶é—´æ®µå†…çš„è®¾å¤‡å‹åŠ›çš„æœ€å¤§å€¼ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æœ‰æ•…éšœå‘ç”Ÿã€‚é‚£ç”¨ä¸€ä¸ªè¯æ¦‚æ‹¬æ—¶é—´åºåˆ—æ•°æ®çš„â€œè¯»â€ï¼Œå°±æ˜¯<strong>æŸ¥è¯¢æ¨¡å¼å¤š</strong>ã€‚</p></li></ul><p>&emsp;&emsp;Redis æä¾› äº†ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®çš„ä¸¤ç§æ–¹æ¡ˆï¼Œåˆ†åˆ«å¯ä»¥åŸºäº Hash å’Œ Sorted Set å®ç°ï¼Œä»¥åŠåŸºäº RedisTimeSeries æ¨¡å—å®ç°ã€‚</p><h2 id="åŸºäº-Hash-å’Œ-Sorted-Set-ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"><a href="#åŸºäº-Hash-å’Œ-Sorted-Set-ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®" class="headerlink" title="åŸºäº Hash å’Œ Sorted Set ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"></a>åŸºäº Hash å’Œ Sorted Set ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®</h2><h3 id="ä¸ºä»€ä¹ˆè¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹"><a href="#ä¸ºä»€ä¹ˆè¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹"></a>ä¸ºä»€ä¹ˆè¦åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§ç±»å‹</h3><p>&emsp;&emsp;å…³äº Hash ç±»å‹ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå®ƒæœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå¯ä»¥å®ç°å¯¹å•é”®çš„å¿«é€ŸæŸ¥è¯¢ã€‚è¿™å°±æ»¡è¶³äº†æ—¶é—´åºåˆ—æ•°æ®çš„å•é”®æŸ¥è¯¢éœ€æ±‚ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ—¶é—´æˆ³ä½œä¸º Hash é›†åˆçš„ keyï¼ŒæŠŠè®°å½•çš„è®¾å¤‡çŠ¶æ€å€¼ä½œä¸º Hash é›†åˆçš„ valueã€‚<br>å¯ä»¥çœ‹ä¸‹ç”¨ Hash é›†åˆè®°å½•è®¾å¤‡çš„æ¸©åº¦å€¼çš„ç¤ºæ„å›¾ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis62.jpg" alt="avatar"><br>&emsp;&emsp;å½“æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æŸä¸ªæ—¶é—´ç‚¹æˆ–è€…æ˜¯å¤šä¸ªæ—¶é—´ç‚¹ä¸Šçš„æ¸©åº¦æ•°æ®æ—¶ï¼Œç›´æ¥ä½¿ç”¨ HGET å‘½ä»¤æˆ–è€… HMGET å‘½ä»¤ï¼Œå°±å¯ä»¥åˆ†åˆ«è·å¾— Hash é›†åˆä¸­çš„ä¸€ä¸ª key å’Œå¤šä¸ª key çš„ value å€¼äº†ã€‚</p><p>&emsp;&emsp;ä¸¾ä¸ªä¾‹å­ã€‚æˆ‘ä»¬ç”¨ HGET å‘½ä»¤æŸ¥è¯¢ 202008030905 è¿™ä¸ªæ—¶åˆ»çš„æ¸©åº¦å€¼ï¼Œä½¿ç”¨ HMGET æŸ¥è¯¢ 202008030905ã€202008030907ã€202008030908 è¿™ä¸‰ä¸ªæ—¶åˆ»çš„æ¸©åº¦å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HGET device:temperature 202008030905 </span><br><span class="line"><span class="string">&quot;25.1&quot;</span></span><br><span class="line"></span><br><span class="line">HMGET device:temperature 202008030905 202008030907 202008030908</span><br><span class="line">1) <span class="string">&quot;25.1&quot;</span></span><br><span class="line">2) <span class="string">&quot;25.9&quot;</span></span><br><span class="line">3) <span class="string">&quot;24.9&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç”¨ Hash ç±»å‹æ¥å®ç°å•é”®çš„æŸ¥è¯¢å¾ˆç®€å•ã€‚ä½†æ˜¯ï¼ŒHash ç±»å‹æœ‰ä¸ªçŸ­æ¿ï¼š<strong>å®ƒå¹¶ä¸æ”¯æŒå¯¹æ•°æ®è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</strong>ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦å¯¹ Hash ç±»å‹è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„è¯ï¼Œå°±éœ€è¦æ‰«æ Hash é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå†æŠŠè¿™äº›æ•°æ®å–å›åˆ°å®¢æˆ·ç«¯è¿›è¡Œæ’åºï¼Œç„¶åï¼Œæ‰èƒ½åœ¨å®¢æˆ·ç«¯å¾—åˆ°æ‰€æŸ¥è¯¢èŒƒå›´å†…çš„æ•°æ®ã€‚æ˜¾ç„¶ï¼ŒæŸ¥è¯¢æ•ˆç‡å¾ˆä½ã€‚</p><p>&emsp;&emsp;ä¸ºäº†èƒ½åŒæ—¶æ”¯æŒæŒ‰æ—¶é—´æˆ³èŒƒå›´çš„æŸ¥è¯¢ï¼Œå¯ä»¥ç”¨ Sorted Set æ¥ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæ ¹æ®å…ƒç´ çš„æƒé‡åˆ†æ•°æ¥æ’åºã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ—¶é—´æˆ³ä½œä¸º Sorted Set é›†åˆçš„å…ƒç´ åˆ†æ•°ï¼ŒæŠŠæ—¶é—´ç‚¹ä¸Šè®°å½•çš„æ•°æ®ä½œä¸ºå…ƒç´ æœ¬èº«ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis63.jpg" alt="avatar"></p><p>&emsp;&emsp;ä½¿ç”¨ Sorted Set ä¿å­˜æ•°æ®åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ ZRANGEBYSCORE å‘½ä»¤ï¼ŒæŒ‰ç…§è¾“å…¥çš„æœ€å¤§æ—¶é—´æˆ³å’Œæœ€å°æ—¶é—´æˆ³æ¥æŸ¥è¯¢è¿™ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ¸©åº¦å€¼äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬æ¥æŸ¥è¯¢ä¸€ä¸‹åœ¨ 2020 å¹´ 8 æœˆ 3 æ—¥ 9 ç‚¹ 7 åˆ†åˆ° 9 ç‚¹ 10 åˆ†é—´çš„æ‰€æœ‰æ¸©åº¦å€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ZRANGEBYSCORE device:temperature 202008030907 202008030910</span><br><span class="line">1) <span class="string">&quot;25.9&quot;</span></span><br><span class="line">2) <span class="string">&quot;24.9&quot;</span></span><br><span class="line">3) <span class="string">&quot;25.3&quot;</span></span><br><span class="line">4) <span class="string">&quot;25.2&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨ Hash å’Œ Sorted Setï¼Œå°±èƒ½æ»¡è¶³å¯¹å•ä¸ªæ—¶é—´ç‚¹å’Œä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®æŸ¥è¯¢éœ€æ±‚ã€‚ä½†æ˜¯åˆä¼šé¢ä¸´ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦è§£å†³çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•ä¿è¯å†™å…¥ Hash å’Œ Sorted Set æ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œå‘¢</strong>ï¼Ÿ</p><h3 id="å¦‚ä½•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Ÿ"></a>å¦‚ä½•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Ÿ</h3><ul><li>MULTI å‘½ä»¤ï¼šè¡¨ç¤ºä¸€ç³»åˆ—åŸå­æ€§æ“ä½œçš„å¼€å§‹ã€‚æ”¶åˆ°è¿™ä¸ªå‘½ä»¤åï¼ŒRedis å°±çŸ¥é“ï¼Œæ¥ä¸‹æ¥å†æ”¶åˆ°çš„å‘½ä»¤éœ€è¦æ”¾åˆ°ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ—ä¸­ï¼Œåç»­ä¸€èµ·æ‰§è¡Œï¼Œä¿è¯åŸå­æ€§ã€‚</li><li>EXEC å‘½ä»¤ï¼šè¡¨ç¤ºä¸€ç³»åˆ—åŸå­æ€§æ“ä½œçš„ç»“æŸã€‚ä¸€æ—¦ Redis æ”¶åˆ°äº†è¿™ä¸ªå‘½ä»¤ï¼Œå°±è¡¨ç¤ºæ‰€æœ‰è¦ä¿è¯åŸå­æ€§çš„å‘½ä»¤æ“ä½œéƒ½å·²ç»å‘é€å®Œæˆäº†ã€‚æ­¤æ—¶ï¼ŒRedis å¼€å§‹æ‰§è¡Œåˆšæ‰æ”¾åˆ°å†…éƒ¨é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="redis64.jpg" alt="avatar"><br>&emsp;&emsp;ä»¥ä¿å­˜è®¾å¤‡çŠ¶æ€ä¿¡æ¯çš„éœ€æ±‚ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„ä»£ç ï¼ŒæŠŠè®¾å¤‡åœ¨ 2020 å¹´ 8 æœˆ 3 æ—¥ 9 æ—¶ 5 åˆ†çš„æ¸©åº¦ï¼Œåˆ†åˆ«ç”¨ HSET å‘½ä»¤å’Œ ZADD å‘½ä»¤å†™å…¥ Hash é›†åˆå’Œ Sorted Set é›†åˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI </span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; HSET device:temperature 202008030911 26.8 </span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ZADD device:temperature 202008030911 26.8 </span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) (<span class="built_in">integer</span>) 1</span><br><span class="line">2) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;é¦–å…ˆï¼ŒRedis æ”¶åˆ°äº†å®¢æˆ·ç«¯æ‰§è¡Œçš„ MULTI å‘½ä»¤ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯å†æ‰§è¡Œ HSET å’Œ ZADD å‘½ä»¤åï¼ŒRedis è¿”å›çš„ç»“æœä¸ºâ€œQUEUEDâ€ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªå‘½ä»¤æš‚æ—¶å…¥é˜Ÿï¼Œå…ˆä¸æ‰§è¡Œï¼›æ‰§è¡Œäº† EXEC å‘½ä»¤åï¼ŒHSET å‘½ä»¤å’Œ ZADD å‘½ä»¤æ‰çœŸæ­£æ‰§è¡Œï¼Œå¹¶è¿”å›æˆåŠŸç»“æœï¼ˆç»“æœå€¼ä¸º 1ï¼‰ã€‚<br>&emsp;&emsp;åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±è§£å†³äº†æ—¶é—´åºåˆ—æ•°æ®çš„å•ç‚¹æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢é—®é¢˜ï¼Œå¹¶ä½¿ç”¨ MUTLI å’Œ EXEC å‘½ä»¤ä¿è¯äº† Redis èƒ½åŸå­æ€§åœ°æŠŠæ•°æ®ä¿å­˜åˆ° Hash å’Œ Sorted Set ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­è§£å†³ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•å¯¹æ—¶é—´åºåˆ—æ•°æ®è¿›è¡Œèšåˆè®¡ç®—</strong>ï¼Ÿ</p><h3 id="å¦‚ä½•å®ç°èšåˆè®¡ç®—"><a href="#å¦‚ä½•å®ç°èšåˆè®¡ç®—" class="headerlink" title="å¦‚ä½•å®ç°èšåˆè®¡ç®—"></a>å¦‚ä½•å®ç°èšåˆè®¡ç®—</h3><p>&emsp;&emsp;å› ä¸º Sorted Set åªæ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œèšåˆè®¡ç®—ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½å…ˆæŠŠæ—¶é—´èŒƒå›´å†…çš„æ•°æ®å–å›åˆ°å®¢æˆ·ç«¯ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯è‡ªè¡Œå®Œæˆèšåˆè®¡ç®—ã€‚è¿™ä¸ªæ–¹æ³•è™½ç„¶èƒ½å®Œæˆèšåˆè®¡ç®—ï¼Œä½†æ˜¯ä¼šå¸¦æ¥ä¸€å®šçš„æ½œåœ¨é£é™©ï¼Œä¹Ÿå°±æ˜¯<strong>å¤§é‡æ•°æ®åœ¨ Redis å®ä¾‹å’Œå®¢æˆ·ç«¯é—´é¢‘ç¹ä¼ è¾“ï¼Œè¿™ä¼šå’Œå…¶ä»–æ“ä½œå‘½ä»¤ç«äº‰ç½‘ç»œèµ„æºï¼Œå¯¼è‡´å…¶ä»–æ“ä½œå˜æ…¢</strong>ã€‚<br>&emsp;&emsp;åœ¨æˆ‘ä»¬è¿™ä¸ªç‰©è”ç½‘é¡¹ç›®ä¸­ï¼Œå°±éœ€è¦æ¯ 3 åˆ†é’Ÿç»Ÿè®¡ä¸€ä¸‹å„ä¸ªè®¾å¤‡çš„æ¸©åº¦çŠ¶æ€ï¼Œä¸€æ—¦è®¾å¤‡æ¸©åº¦è¶…å‡ºäº†è®¾å®šçš„é˜ˆå€¼ï¼Œå°±è¦è¿›è¡ŒæŠ¥è­¦ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„èšåˆè®¡ç®—åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ•°æ®ä½“é‡ã€‚<br>&emsp;&emsp;å‡è®¾æˆ‘ä»¬éœ€è¦æ¯ 3 åˆ†é’Ÿè®¡ç®—ä¸€æ¬¡çš„æ‰€æœ‰è®¾å¤‡å„æŒ‡æ ‡çš„æœ€å¤§å€¼ï¼Œæ¯ä¸ªè®¾å¤‡æ¯ 15 ç§’è®°å½•ä¸€ä¸ªæŒ‡æ ‡å€¼ï¼Œ1 åˆ†é’Ÿå°±ä¼šè®°å½• 4 ä¸ªå€¼ï¼Œ3 åˆ†é’Ÿå°±ä¼šæœ‰ 12 ä¸ªå€¼ã€‚æˆ‘ä»¬è¦ç»Ÿè®¡çš„è®¾å¤‡æŒ‡æ ‡æ•°é‡æœ‰ 33 ä¸ªï¼Œæ‰€ä»¥ï¼Œå•ä¸ªè®¾å¤‡æ¯ 3 åˆ†é’Ÿè®°å½•çš„æŒ‡æ ‡æ•°æ®æœ‰å°†è¿‘ 400 ä¸ªï¼ˆ33 * 12 = 396ï¼‰ï¼Œè€Œè®¾å¤‡æ€»æ•°é‡æœ‰ 1 ä¸‡å°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¯ 3 åˆ†é’Ÿå°±æœ‰å°†è¿‘ 400 ä¸‡æ¡ï¼ˆ396 * 1 ä¸‡ = 396 ä¸‡ï¼‰æ•°æ®éœ€è¦åœ¨å®¢æˆ·ç«¯å’Œ Redis å®ä¾‹é—´è¿›è¡Œä¼ è¾“ã€‚<br>&emsp;&emsp;ä¸ºäº†é¿å…å®¢æˆ·ç«¯å’Œ Redis å®ä¾‹é—´é¢‘ç¹çš„å¤§é‡æ•°æ®ä¼ è¾“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ RedisTimeSeries æ¥ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®ã€‚RedisTimeSeries æ”¯æŒç›´æ¥åœ¨ Redis å®ä¾‹ä¸Šè¿›è¡Œèšåˆè®¡ç®—ã€‚è¿˜æ˜¯ä»¥åˆšæ‰æ¯ 3 åˆ†é’Ÿç®—ä¸€æ¬¡æœ€å¤§å€¼ä¸ºä¾‹ã€‚åœ¨ Redis å®ä¾‹ä¸Šç›´æ¥èšåˆè®¡ç®—ï¼Œé‚£ä¹ˆï¼Œå¯¹äºå•ä¸ªè®¾å¤‡çš„ä¸€ä¸ªæŒ‡æ ‡å€¼æ¥è¯´ï¼Œæ¯ 3 åˆ†é’Ÿè®°å½•çš„ 12 æ¡æ•°æ®å¯ä»¥èšåˆè®¡ç®—æˆä¸€ä¸ªå€¼ï¼Œå•ä¸ªè®¾å¤‡æ¯ 3 åˆ†é’Ÿä¹Ÿå°±åªæœ‰ 33 ä¸ªèšåˆå€¼éœ€è¦ä¼ è¾“ï¼Œ1 ä¸‡å°è®¾å¤‡ä¹Ÿåªæœ‰ 33 ä¸‡æ¡æ•°æ®ã€‚æ•°æ®é‡å¤§çº¦æ˜¯åœ¨å®¢æˆ·ç«¯åšèšåˆè®¡ç®—çš„ååˆ†ä¹‹ä¸€ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå¯ä»¥å‡å°‘å¤§é‡æ•°æ®ä¼ è¾“å¯¹ Redis å®ä¾‹ç½‘ç»œçš„æ€§èƒ½å½±å“ã€‚<br>&emsp;&emsp;æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå•ä¸ªæ—¶é—´ç‚¹æŸ¥è¯¢æˆ–æ˜¯å¯¹æŸä¸ªæ—¶é—´èŒƒå›´æŸ¥è¯¢çš„è¯ï¼Œé€‚åˆä½¿ç”¨ Hash å’Œ Sorted Set çš„ç»„åˆï¼Œå®ƒä»¬éƒ½æ˜¯ Redis çš„å†…åœ¨æ•°æ®ç»“æ„ï¼Œæ€§èƒ½å¥½ï¼Œç¨³å®šæ€§é«˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è¿›è¡Œå¤§é‡çš„èšåˆè®¡ç®—ï¼ŒåŒæ—¶ç½‘ç»œå¸¦å®½æ¡ä»¶ä¸æ˜¯å¤ªå¥½æ—¶ï¼ŒHash å’Œ Sorted Set çš„ç»„åˆå°±ä¸å¤ªé€‚åˆäº†ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ RedisTimeSeries å°±æ›´åŠ åˆé€‚ä¸€äº›ã€‚</p><h2 id="åŸºäº-RedisTimeSeries-æ¨¡å—ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"><a href="#åŸºäº-RedisTimeSeries-æ¨¡å—ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®" class="headerlink" title="åŸºäº RedisTimeSeries æ¨¡å—ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®"></a>åŸºäº RedisTimeSeries æ¨¡å—ä¿å­˜æ—¶é—´åºåˆ—æ•°æ®</h2><ul><li><input disabled type="checkbox"> TODO</li></ul><h1 id="Redis-å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ"><a href="#Redis-å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redis å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ"></a>Redis å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆ</h1><h2 id="æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å–éœ€æ±‚"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å–éœ€æ±‚" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å–éœ€æ±‚"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„å­˜å–éœ€æ±‚</h2><p>&emsp;&emsp;æ¶ˆæ¯é˜Ÿåˆ—çš„æœ¬è´¨æ˜¯ä¸ºç»„ä»¶é—´æˆ–è€…è¯´ç³»ç»Ÿé—´æä¾›è§£è€¦çš„æœåŠ¡ï¼Œä½¿ç»„ä»¶é—´çš„æœåŠ¡å¯ä»¥å¼‚æ­¥å®Œæˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis65.jpg" alt="avatar"><br>&emsp;&emsp;æˆ‘ä»¬ä¸€èˆ¬æŠŠæ¶ˆæ¯é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯çš„ç»„ä»¶ç§°ä¸ºç”Ÿäº§è€…ï¼ˆä¾‹å­ä¸­çš„ç»„ä»¶ 1ï¼‰ï¼ŒæŠŠæ¥æ”¶æ¶ˆæ¯çš„ç»„ä»¶ç§°ä¸ºæ¶ˆè´¹è€…ï¼ˆä¾‹å­ä¸­çš„ç»„ä»¶ 2ï¼‰ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªé€šç”¨çš„æ¶ˆæ¯é˜Ÿåˆ—çš„æ¶æ„æ¨¡å‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis66.jpg" alt="avatar"><br>&emsp;&emsp;åœ¨ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥å¼‚æ­¥è¯»å–ç”Ÿäº§è€…æ¶ˆæ¯ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é€Ÿåº¦è¿œè¿œè¶…è¿‡äº†æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦ï¼Œç”Ÿäº§è€…å·²ç»å‘é€çš„æ¶ˆæ¯ä¹Ÿå¯ä»¥ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé¿å…é˜»å¡ç”Ÿäº§è€…ï¼Œè¿™æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä½œä¸ºåˆ†å¸ƒå¼ç»„ä»¶é€šä¿¡çš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p><p>&emsp;&emsp;ä¸è¿‡ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨å­˜å–æ¶ˆæ¯æ—¶ï¼Œå¿…é¡»è¦æ»¡è¶³ä¸‰ä¸ªéœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯<strong>æ¶ˆæ¯ä¿åº</strong>ã€<strong>å¤„ç†é‡å¤çš„æ¶ˆæ¯</strong>å’Œ<strong>ä¿è¯æ¶ˆæ¯å¯é æ€§</strong>ã€‚</p><h3 id="éœ€æ±‚ä¸€ï¼šæ¶ˆæ¯ä¿å­˜"><a href="#éœ€æ±‚ä¸€ï¼šæ¶ˆæ¯ä¿å­˜" class="headerlink" title="éœ€æ±‚ä¸€ï¼šæ¶ˆæ¯ä¿å­˜"></a>éœ€æ±‚ä¸€ï¼šæ¶ˆæ¯ä¿å­˜</h3><p>&emsp;&emsp;è™½ç„¶æ¶ˆè´¹è€…æ˜¯å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œä½†æ˜¯ï¼Œæ¶ˆè´¹è€…ä»ç„¶éœ€è¦æŒ‰ç…§ç”Ÿäº§è€…å‘é€æ¶ˆæ¯çš„é¡ºåºæ¥å¤„ç†æ¶ˆæ¯ï¼Œé¿å…åå‘é€çš„æ¶ˆæ¯è¢«å…ˆå¤„ç†äº†ã€‚å¯¹äºè¦æ±‚æ¶ˆæ¯ä¿åºçš„åœºæ™¯æ¥è¯´ï¼Œä¸€æ—¦å‡ºç°è¿™ç§æ¶ˆæ¯è¢«ä¹±åºå¤„ç†çš„æƒ…å†µï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸šåŠ¡é€»è¾‘è¢«é”™è¯¯æ‰§è¡Œï¼Œä»è€Œç»™ä¸šåŠ¡æ–¹é€ æˆæŸå¤±ã€‚<br>&emsp;&emsp;æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´æ–°å•†å“åº“å­˜çš„åœºæ™¯ã€‚å‡è®¾ç”Ÿäº§è€…è´Ÿè´£æ¥æ”¶åº“å­˜æ›´æ–°è¯·æ±‚ï¼Œæ¶ˆè´¹è€…è´Ÿè´£å®é™…æ›´æ–°åº“å­˜ï¼Œç°æœ‰åº“å­˜é‡æ˜¯ 10ã€‚ç”Ÿäº§è€…å…ˆåå‘é€äº†æ¶ˆæ¯ 1 å’Œæ¶ˆæ¯ 2ï¼Œæ¶ˆæ¯ 1 è¦æŠŠå•†å“ X çš„åº“å­˜è®°å½•æ›´æ–°ä¸º 5ï¼Œæ¶ˆæ¯ 2 æ˜¯æŠŠå•†å“ X åº“å­˜æ›´æ–°ä¸º 3ã€‚å¦‚æœæ¶ˆæ¯ 1 å’Œ 2 åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ— æ³•ä¿åºï¼Œå‡ºç°æ¶ˆæ¯ 2 æ—©äºæ¶ˆæ¯ 1 è¢«å¤„ç†çš„æƒ…å†µï¼Œé‚£ä¹ˆï¼Œå¾ˆæ˜¾ç„¶ï¼Œåº“å­˜æ›´æ–°å°±å‡ºé”™äº†ã€‚è¿™æ˜¯ä¸šåŠ¡åº”ç”¨æ— æ³•æ¥å—çš„ã€‚é¢å¯¹è¿™ç§æƒ…å†µï¼Œä½ å¯èƒ½ä¼šæƒ³åˆ°ä¸€ç§è§£å†³æ–¹æ¡ˆï¼š<strong>ä¸è¦æŠŠæ›´æ–°åçš„åº“å­˜é‡ä½œä¸ºç”Ÿäº§è€…å‘é€çš„æ¶ˆæ¯ï¼Œè€Œæ˜¯æŠŠåº“å­˜æ‰£é™¤å€¼ä½œä¸ºæ¶ˆæ¯çš„å†…å®¹</strong>ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ¶ˆæ¯ 1 æ˜¯æ‰£å‡åº“å­˜é‡ 5ï¼Œæ¶ˆæ¯ 2 æ˜¯æ‰£å‡åº“å­˜é‡ 2ã€‚å¦‚æœæ¶ˆæ¯ 1 å’Œæ¶ˆæ¯ 2 ä¹‹é—´æ²¡æœ‰åº“å­˜æŸ¥è¯¢è¯·æ±‚çš„è¯ï¼Œå³ä½¿æ¶ˆè´¹è€…å…ˆå¤„ç†æ¶ˆæ¯ 2ï¼Œå†å¤„ç†æ¶ˆæ¯ 1ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿèƒ½å¤Ÿä¿è¯æœ€ç»ˆçš„åº“å­˜é‡æ˜¯æ­£ç¡®çš„ï¼Œä¹Ÿå°±æ˜¯åº“å­˜é‡ä¸º 3ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼šå‡å¦‚æ¶ˆè´¹è€…æ”¶åˆ°äº†è¿™æ ·ä¸‰æ¡æ¶ˆæ¯ï¼šæ¶ˆæ¯ 1 æ˜¯æ‰£å‡åº“ å­˜é‡ 5ï¼Œæ¶ˆæ¯ 2 æ˜¯è¯»å–åº“å­˜é‡ï¼Œæ¶ˆæ¯ 3 æ˜¯æ‰£å‡åº“å­˜é‡ 2ï¼Œæ­¤æ—¶ï¼Œå¦‚æœæ¶ˆè´¹è€…å…ˆå¤„ç†äº†æ¶ˆæ¯ 3ï¼ˆæŠŠåº“å­˜é‡æ‰£å‡ 2ï¼‰ï¼Œé‚£ä¹ˆåº“å­˜é‡å°±å˜æˆäº† 8ã€‚ç„¶åï¼Œæ¶ˆè´¹è€…å¤„ç†äº†æ¶ˆæ¯ 2ï¼Œè¯»å–å½“å‰çš„åº“å­˜é‡æ˜¯ 8ï¼Œè¿™å°±ä¼šå‡ºç°åº“å­˜é‡æŸ¥è¯¢ä¸æ­£ç¡®çš„æƒ…å†µã€‚ä»ä¸šåŠ¡åº”ç”¨å±‚é¢çœ‹ï¼Œæ¶ˆæ¯ 1ã€2ã€3 åº”è¯¥æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ï¼Œæ¶ˆæ¯ 2 æŸ¥è¯¢åˆ°çš„åº”è¯¥æ˜¯æ‰£å‡äº† 5 ä»¥åçš„åº“å­˜é‡ï¼Œè€Œä¸æ˜¯æ‰£å‡äº† 2 ä»¥åçš„åº“å­˜é‡ã€‚æ‰€ä»¥ï¼Œç”¨åº“å­˜æ‰£é™¤å€¼ä½œä¸ºæ¶ˆæ¯çš„æ–¹æ¡ˆï¼Œ<strong>åœ¨æ¶ˆæ¯ä¸­åŒæ—¶åŒ…å«è¯»å†™æ“ä½œçš„åœºæ™¯ä¸‹ï¼Œä¼šå¸¦æ¥æ•°æ®è¯»å–é”™è¯¯çš„é—®é¢˜</strong>ã€‚è€Œä¸”ï¼Œè¿™ä¸ªæ–¹æ¡ˆè¿˜ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯<strong>é‡å¤æ¶ˆæ¯å¤„ç†</strong>ã€‚</p><h3 id="éœ€æ±‚äºŒï¼šé‡å¤æ¶ˆæ¯å¤„ç†"><a href="#éœ€æ±‚äºŒï¼šé‡å¤æ¶ˆæ¯å¤„ç†" class="headerlink" title="éœ€æ±‚äºŒï¼šé‡å¤æ¶ˆæ¯å¤„ç†"></a>éœ€æ±‚äºŒï¼šé‡å¤æ¶ˆæ¯å¤„ç†</h3><p>&emsp;&emsp;æ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—è¯»å–æ¶ˆæ¯æ—¶ï¼Œæœ‰æ—¶ä¼šå› ä¸ºç½‘ç»œå µå¡è€Œå‡ºç°æ¶ˆæ¯é‡ä¼ çš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šæ”¶åˆ°å¤šæ¡é‡å¤çš„æ¶ˆæ¯ã€‚å¯¹äºé‡å¤çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å¦‚æœå¤šæ¬¡å¤„ç†çš„è¯ï¼Œå°±å¯èƒ½é€ æˆä¸€ä¸ªä¸šåŠ¡é€»è¾‘è¢«å¤šæ¬¡æ‰§è¡Œï¼Œå¦‚æœä¸šåŠ¡é€»è¾‘æ­£å¥½æ˜¯è¦ä¿®æ”¹æ•°æ®ï¼Œé‚£å°±ä¼šå‡ºç°æ•°æ®è¢«å¤šæ¬¡ä¿®æ”¹çš„é—®é¢˜äº†ã€‚è¿˜æ˜¯ä»¥åº“å­˜æ›´æ–°ä¸ºä¾‹ï¼Œå‡è®¾æ¶ˆè´¹è€…æ”¶åˆ°äº†ä¸€æ¬¡æ¶ˆæ¯ 1ï¼Œè¦æ‰£å‡åº“å­˜é‡ 5ï¼Œç„¶ååˆæ”¶åˆ°äº†ä¸€æ¬¡æ¶ˆæ¯ 1ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæ¶ˆè´¹è€…æ— æ³•è¯†åˆ«è¿™ä¸¤æ¡æ¶ˆæ¯å®é™…æ˜¯ä¸€æ¡ç›¸åŒæ¶ˆæ¯çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œä¸¤æ¬¡æ‰£å‡åº“å­˜é‡ 5 çš„æ“ä½œï¼Œæ­¤æ—¶ï¼Œåº“å­˜é‡å°±ä¸å¯¹äº†ã€‚è¿™å½“ç„¶ä¹Ÿæ˜¯æ— æ³•æ¥å—çš„ã€‚</p><h3 id="éœ€æ±‚ä¸‰ï¼šæ¶ˆæ¯å¯é æ€§ä¿è¯"><a href="#éœ€æ±‚ä¸‰ï¼šæ¶ˆæ¯å¯é æ€§ä¿è¯" class="headerlink" title="éœ€æ±‚ä¸‰ï¼šæ¶ˆæ¯å¯é æ€§ä¿è¯"></a>éœ€æ±‚ä¸‰ï¼šæ¶ˆæ¯å¯é æ€§ä¿è¯</h3><p>&emsp;&emsp;å¦å¤–ï¼Œæ¶ˆè´¹è€…åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¿˜å¯èƒ½å‡ºç°å› ä¸ºæ•…éšœæˆ–å®•æœºå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆçš„æƒ…å†µã€‚æ­¤æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—éœ€è¦èƒ½æä¾›æ¶ˆæ¯å¯é æ€§çš„ä¿è¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ¶ˆè´¹è€…é‡å¯åï¼Œå¯ä»¥é‡æ–°è¯»å–æ¶ˆæ¯å†æ¬¡è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™ï¼Œå°±ä¼šå‡ºç°æ¶ˆæ¯æ¼å¤„ç†çš„é—®é¢˜äº†ã€‚</p><p>&emsp;&emsp;Redis çš„ List å’Œ Streams ä¸¤ç§æ•°æ®ç±»å‹ï¼Œå°±å¯ä»¥æ»¡è¶³æ¶ˆæ¯é˜Ÿåˆ—çš„è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹åŸºäº List çš„æ¶ˆæ¯é˜Ÿåˆ—å®ç°æ–¹æ³•ã€‚</p><h2 id="åŸºäº-List-çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ"><a href="#åŸºäº-List-çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åŸºäº List çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ"></a>åŸºäº List çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ</h2><h3 id="æ¶ˆæ¯ä¿å­˜"><a href="#æ¶ˆæ¯ä¿å­˜" class="headerlink" title="æ¶ˆæ¯ä¿å­˜"></a>æ¶ˆæ¯ä¿å­˜</h3><p>&emsp;&emsp;List æœ¬èº«å°±æ˜¯æŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºå¯¹æ•°æ®è¿›è¡Œå­˜å–çš„ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨ List ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¿å­˜æ¶ˆæ¯çš„è¯ï¼Œå°±å·²ç»èƒ½æ»¡è¶³æ¶ˆæ¯ä¿åºçš„éœ€æ±‚äº†ã€‚å…·ä½“æ¥è¯´ï¼Œç”Ÿäº§è€…å¯ä»¥ä½¿ç”¨ LPUSH å‘½ä»¤æŠŠè¦å‘é€çš„æ¶ˆæ¯ä¾æ¬¡å†™å…¥ Listï¼Œè€Œæ¶ˆè´¹è€…åˆ™å¯ä»¥ä½¿ ç”¨ RPOP å‘½ä»¤ï¼Œä» List çš„å¦ä¸€ç«¯æŒ‰ç…§æ¶ˆæ¯çš„å†™å…¥é¡ºåºï¼Œä¾æ¬¡è¯»å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†ã€‚<br>&emsp;&emsp;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”Ÿäº§è€…å…ˆç”¨ LPUSH å†™å…¥äº†ä¸¤æ¡åº“å­˜æ¶ˆæ¯ï¼Œåˆ†åˆ«æ˜¯ 5 å’Œ 3ï¼Œè¡¨ç¤ºè¦æŠŠåº“å­˜æ›´æ–°ä¸º 5 å’Œ 3ï¼›æ¶ˆè´¹è€…åˆ™ç”¨ RPOP æŠŠä¸¤æ¡æ¶ˆæ¯ä¾æ¬¡è¯»å‡ºï¼Œç„¶åè¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis67.jpg" alt="avatar"><br>&emsp;&emsp;ä¸è¿‡ï¼Œåœ¨æ¶ˆè´¹è€…è¯»å–æ•°æ®æ—¶ï¼Œæœ‰ä¸€ä¸ªæ½œåœ¨çš„æ€§èƒ½é£é™©ç‚¹ã€‚åœ¨ç”Ÿäº§è€…å¾€ List ä¸­å†™å…¥æ•°æ®æ—¶ï¼ŒList å¹¶ä¸ä¼šä¸»åŠ¨åœ°é€šçŸ¥æ¶ˆè´¹è€…æœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼Œ<strong>å¦‚æœæ¶ˆè´¹è€…æƒ³è¦åŠæ—¶å¤„ç†æ¶ˆæ¯ï¼Œå°±éœ€è¦åœ¨ç¨‹åºä¸­ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤</strong>ï¼ˆæ¯”å¦‚ä½¿ç”¨ä¸€ä¸ª while(1) å¾ªç¯ï¼‰ã€‚å¦‚æœæœ‰æ–°æ¶ˆæ¯å†™å…¥ï¼ŒRPOP å‘½ä»¤å°±ä¼šè¿”å›ç»“æœï¼Œå¦åˆ™ï¼ŒRPOP å‘½ä»¤è¿”å›ç©ºå€¼ï¼Œå†ç»§ç»­å¾ªç¯ã€‚æ‰€ä»¥ï¼Œå³ä½¿æ²¡æœ‰æ–°æ¶ˆæ¯å†™å…¥ Listï¼Œæ¶ˆè´¹è€…ä¹Ÿè¦ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤ï¼Œè¿™å°±ä¼šå¯¼è‡´æ¶ˆè´¹è€…ç¨‹åºçš„ CPU ä¸€ç›´æ¶ˆè€—åœ¨æ‰§è¡Œ RPOP å‘½ä»¤ä¸Šï¼Œå¸¦æ¥ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚<br>&emsp;&emsp;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æä¾›äº† BRPOP å‘½ä»¤ã€‚BRPOP å‘½ä»¤ä¹Ÿç§°ä¸ºé˜»å¡å¼è¯»å–ï¼Œå®¢æˆ·ç«¯åœ¨æ²¡æœ‰è¯»åˆ°é˜Ÿåˆ—æ•°æ®æ—¶ï¼Œè‡ªåŠ¨é˜»å¡ï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®å†™å…¥é˜Ÿåˆ—ï¼Œå†å¼€å§‹è¯»å–æ–°æ•°æ®ã€‚å’Œæ¶ˆè´¹è€…ç¨‹åºè‡ªå·±ä¸åœåœ°è°ƒç”¨ RPOP å‘½ä»¤ç›¸æ¯”ï¼Œè¿™ç§æ–¹å¼èƒ½èŠ‚çœ CPU å¼€é”€ã€‚</p><h3 id="é‡å¤æ¶ˆæ¯å¤„ç†"><a href="#é‡å¤æ¶ˆæ¯å¤„ç†" class="headerlink" title="é‡å¤æ¶ˆæ¯å¤„ç†"></a>é‡å¤æ¶ˆæ¯å¤„ç†</h3><p>&emsp;&emsp;æ¶ˆæ¯ä¿åºçš„é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘è§£å†³é‡å¤æ¶ˆæ¯å¤„ç†çš„é—®é¢˜ï¼Œè¿™é‡Œå…¶å®æœ‰ä¸€ä¸ªè¦æ±‚ï¼šæ¶ˆè´¹è€…ç¨‹åºæœ¬èº«èƒ½å¯¹é‡å¤æ¶ˆæ¯è¿›è¡Œåˆ¤æ–­ã€‚<br>&emsp;&emsp;ä¸€æ–¹é¢ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è¦èƒ½ç»™æ¯ä¸€ä¸ªæ¶ˆæ¯æä¾›å…¨å±€å”¯ä¸€çš„ ID å·ï¼›å¦ä¸€æ–¹é¢ï¼Œæ¶ˆè´¹è€…ç¨‹åºè¦æŠŠå·²ç»å¤„ç†è¿‡çš„æ¶ˆæ¯çš„ ID å·è®°å½•ä¸‹æ¥ã€‚(<strong>åœ¨æ‰£æ¬¾ä¸šåŠ¡ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œç”Ÿæˆå”¯ä¸€çš„è®¢å•å·å°±æ˜¯æœåŠ¡ç«¯åªæ‰£æ¬¾ä¸€æ¬¡çš„ä¿è¯</strong>)å½“æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯åï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±å¯ä»¥å¯¹æ¯”æ”¶åˆ°çš„æ¶ˆæ¯ ID å’Œè®°å½•çš„å·²å¤„ç†è¿‡çš„æ¶ˆæ¯ IDï¼Œ æ¥åˆ¤æ–­å½“å‰æ”¶åˆ°çš„æ¶ˆæ¯æœ‰æ²¡æœ‰ç»è¿‡å¤„ç†ã€‚å¦‚æœå·²ç»å¤„ç†è¿‡ï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå°±ä¸å†è¿›è¡Œå¤„ç†äº†ã€‚è¿™ç§å¤„ç†ç‰¹æ€§ä¹Ÿç§°ä¸º<strong>å¹‚ç­‰æ€§</strong>ï¼Œå¹‚ç­‰æ€§å°±æ˜¯æŒ‡ï¼Œå¯¹äºåŒä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ”¶åˆ°ä¸€æ¬¡çš„å¤„ç†ç»“æœå’Œæ”¶åˆ°å¤šæ¬¡çš„å¤„ç†ç»“æœæ˜¯ä¸€è‡´çš„ã€‚ä¸è¿‡ï¼ŒList æœ¬èº«æ˜¯ä¸ä¼šä¸ºæ¯ä¸ªæ¶ˆæ¯ç”Ÿæˆ ID å·çš„ï¼Œæ‰€ä»¥ï¼Œæ¶ˆæ¯çš„å…¨å±€å”¯ä¸€ ID å·å°±éœ€è¦ç”Ÿäº§è€…ç¨‹åºåœ¨å‘é€æ¶ˆæ¯å‰è‡ªè¡Œç”Ÿæˆã€‚ç”Ÿæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨ç”¨ LPUSH å‘½ä»¤æŠŠæ¶ˆæ¯æ’å…¥ List æ—¶ï¼Œéœ€è¦åœ¨æ¶ˆæ¯ä¸­åŒ…å«è¿™ä¸ªå…¨å±€å”¯ä¸€ IDã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°±æŠŠä¸€æ¡å…¨å±€ ID ä¸º 101030001ã€åº“å­˜é‡ä¸º 5 çš„æ¶ˆæ¯æ’å…¥äº†æ¶ˆæ¯é˜Ÿåˆ—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPUSH mq <span class="string">&quot;101030001:stock:5&quot;</span> </span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><h3 id="ä¿è¯æ¶ˆæ¯å¯é æ€§"><a href="#ä¿è¯æ¶ˆæ¯å¯é æ€§" class="headerlink" title="ä¿è¯æ¶ˆæ¯å¯é æ€§"></a>ä¿è¯æ¶ˆæ¯å¯é æ€§</h3><p>&emsp;&emsp;å½“æ¶ˆè´¹è€…ç¨‹åºä» List ä¸­è¯»å–ä¸€æ¡æ¶ˆæ¯åï¼ŒList å°±ä¸ä¼šå†ç•™å­˜è¿™æ¡æ¶ˆæ¯äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºåœ¨å¤„ç†æ¶ˆæ¯çš„è¿‡ç¨‹å‡ºç°äº†<strong>æ•…éšœæˆ–å®•æœº</strong>ï¼Œå°±ä¼šå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å¤„ç†å®Œæˆï¼Œé‚£ä¹ˆï¼Œæ¶ˆè´¹è€…ç¨‹åºå†æ¬¡å¯åŠ¨åï¼Œå°±æ²¡æ³•å†æ¬¡ä» List ä¸­è¯»å–æ¶ˆæ¯äº†ã€‚<br>&emsp;&emsp;ä¸ºäº†ç•™å­˜æ¶ˆæ¯ï¼ŒList ç±»å‹æä¾›äº† BRPOPLPUSH å‘½ä»¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯è®©æ¶ˆè´¹è€…ç¨‹åºä»ä¸€ä¸ª List ä¸­è¯»å–æ¶ˆæ¯ï¼ŒåŒæ—¶ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯å†æ’å…¥åˆ°å¦ä¸€ä¸ª Listï¼ˆå¯ä»¥å«ä½œå¤‡ä»½ Listï¼‰ç•™å­˜ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæ¶ˆè´¹è€…ç¨‹åºè¯»äº†æ¶ˆæ¯ä½†æ²¡èƒ½æ­£å¸¸å¤„ç†ï¼Œç­‰å®ƒé‡å¯åï¼Œå°±å¯ä»¥ä»å¤‡ä»½ List ä¸­é‡æ–°è¯»å–æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis68.jpg" alt="avatar"></p><p>&emsp;&emsp;ä½†æ˜¯ï¼Œåœ¨ç”¨ List åšæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œè¿˜å¯èƒ½é‡åˆ°è¿‡ä¸€ä¸ªé—®é¢˜ï¼šç”Ÿäº§è€…æ¶ˆæ¯å‘é€å¾ˆ å¿«ï¼Œè€Œæ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™å°±å¯¼è‡´ List ä¸­çš„æ¶ˆæ¯è¶Šç§¯è¶Šå¤šï¼Œç»™ Redis çš„å†…å­˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ç¨‹åºç»„æˆä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œä¸€èµ·åˆ†æ‹…å¤„ç† List ä¸­çš„æ¶ˆæ¯ã€‚ ä½†æ˜¯ï¼ŒList ç±»å‹å¹¶ä¸æ”¯æŒæ¶ˆè´¹ç»„çš„å®ç°ã€‚é‚£ä¹ˆï¼Œè¿˜æœ‰æ²¡æœ‰æ›´åˆé€‚çš„è§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿè¿™å°±è¦è¯´ åˆ° Redis ä» 5.0 ç‰ˆæœ¬å¼€å§‹æä¾›çš„ Streams æ•°æ®ç±»å‹äº†ã€‚</p><h2 id="åŸºäº-Streams-çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ"><a href="#åŸºäº-Streams-çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åŸºäº Streams çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ"></a>åŸºäº Streams çš„æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆ</h2><p>&emsp;&emsp;Streams æ˜¯ Redis ä¸“é—¨ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„æ•°æ®ç±»å‹ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„æ¶ˆæ¯é˜Ÿåˆ—æ“ä½œå‘½ä»¤ã€‚</p><ol><li>XADDï¼šæ’å…¥æ¶ˆæ¯ï¼Œä¿è¯æœ‰åºï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆå…¨å±€å”¯ä¸€ IDï¼›</li><li>XREADï¼šç”¨äºè¯»å–æ¶ˆæ¯ï¼Œå¯ä»¥æŒ‰ ID è¯»å–æ•°æ®ï¼›</li><li>XREADGROUPï¼šæŒ‰æ¶ˆè´¹ç»„å½¢å¼è¯»å–æ¶ˆæ¯ï¼›</li><li>XPENDING å’Œ XACKï¼šXPENDING å‘½ä»¤å¯ä»¥ç”¨æ¥æŸ¥è¯¢æ¯ä¸ªæ¶ˆè´¹ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…å·²è¯»å–ä½†å°šæœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œè€Œ XACK å‘½ä»¤ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—ç¡®è®¤æ¶ˆæ¯å¤„ç†å·²å®Œæˆã€‚</li></ol><ul><li><p>XADD<br>&emsp;&emsp;XADD å‘½ä»¤å¯ä»¥å¾€æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥æ–°æ¶ˆæ¯ï¼Œæ¶ˆæ¯çš„æ ¼å¼æ˜¯é”® - å€¼å¯¹å½¢å¼ã€‚å¯¹äºæ’å…¥çš„æ¯ä¸€æ¡æ¶ˆæ¯ï¼ŒStreams å¯ä»¥è‡ªåŠ¨ä¸ºå…¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDã€‚<br>&emsp;&emsp;æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥å¾€åç§°ä¸º mqstream çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’å…¥ä¸€æ¡æ¶ˆæ¯ï¼Œ æ¶ˆæ¯çš„é”®æ˜¯ repoï¼Œå€¼æ˜¯ 5ã€‚å…¶ä¸­ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åç§°åé¢çš„*ï¼Œè¡¨ç¤ºè®© Redis ä¸ºæ’å…¥çš„æ•°æ®è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œä¾‹å¦‚â€œ1599203861727-0â€ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç”¨*ï¼Œç›´æ¥åœ¨æ¶ˆæ¯é˜Ÿåˆ—åç§°åè‡ªè¡Œè®¾å®šä¸€ä¸ª ID å·ï¼Œåªè¦ä¿è¯è¿™ä¸ª ID å·æ˜¯å…¨å±€å”¯ä¸€çš„å°±è¡Œã€‚ä¸è¿‡ï¼Œç›¸æ¯”è‡ªè¡Œè®¾å®š ID å·ï¼Œä½¿ç”¨*ä¼šæ›´åŠ æ–¹ä¾¿é«˜æ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XADD mqstream * repo 5</span><br><span class="line"><span class="string">&quot;1599203861727-0&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆæ¯çš„å…¨å±€å”¯ä¸€ ID ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†â€œ1599203861727â€æ˜¯æ•°æ®æ’å…¥æ—¶ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½è®¡ç®—çš„å½“å‰æœåŠ¡å™¨æ—¶é—´ï¼Œç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºæ’å…¥æ¶ˆæ¯åœ¨å½“å‰æ¯«ç§’å†…çš„æ¶ˆæ¯åºå·ï¼Œè¿™æ˜¯ä» 0 å¼€å§‹ç¼–å·çš„ã€‚ä¾‹å¦‚ï¼Œâ€œ1599203861727-0â€å°±è¡¨ç¤ºåœ¨â€œ1599203861727â€æ¯«ç§’å†…çš„ç¬¬ 1 æ¡æ¶ˆæ¯ã€‚</p></li><li><p>XREAD<br>&emsp;&emsp;XREAD åœ¨è¯»å–æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ¶ˆæ¯ IDï¼Œå¹¶ä»è¿™ä¸ªæ¶ˆæ¯ ID çš„ä¸‹ä¸€æ¡æ¶ˆæ¯å¼€å§‹è¿›è¡Œè¯»å–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä» ID å·ä¸º 1599203861727-0 çš„æ¶ˆæ¯å¼€å§‹ï¼Œè¯»å–åç»­çš„æ‰€æœ‰æ¶ˆæ¯ï¼ˆç¤ºä¾‹ä¸­ä¸€å…± 3 æ¡ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">XREAD BLOCK 100 STREAMS mqstream 1599203861727-0</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1599274912765-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;3&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;1599274925823-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">    2) <span class="string">&quot;2&quot;</span></span><br><span class="line">      3) 1) <span class="string">&quot;1599274927910-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure></li></ul><p>&emsp;&emsp;å¦å¤–ï¼Œæ¶ˆè´¹è€…ä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ XRAED æ—¶è®¾å®š block é…ç½®é¡¹ï¼Œå®ç°ç±»ä¼¼äº BRPOP çš„é˜»å¡è¯»å–æ“ä½œã€‚å½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œä¸€æ—¦è®¾ç½®äº† block é…ç½®é¡¹ï¼ŒXREAD å°±ä¼šé˜»å¡ï¼Œé˜»å¡çš„æ—¶é•¿å¯ä»¥åœ¨ block é…ç½®é¡¹è¿›è¡Œè®¾ç½®ã€‚<br>&emsp;&emsp;ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„å‘½ä»¤ï¼Œå…¶ä¸­ï¼Œå‘½ä»¤æœ€åçš„â€œ$â€ç¬¦å·è¡¨ç¤ºè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬è®¾ç½®äº† block 10000 çš„é…ç½®é¡¹ï¼Œ10000 çš„å•ä½æ˜¯æ¯«ç§’ï¼Œè¡¨æ˜ XREAD åœ¨è¯»å–æœ€æ–°æ¶ˆæ¯æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯åˆ°æ¥ï¼ŒXREAD å°†é˜»å¡ 10000 æ¯«ç§’ï¼ˆå³ 10 ç§’ï¼‰ï¼Œç„¶åå†è¿”å›ã€‚ä¸‹é¢å‘½ä»¤ä¸­çš„ XREAD æ‰§è¡Œåï¼Œæ¶ˆæ¯é˜Ÿåˆ— mqstream ä¸­ä¸€ç›´æ²¡æœ‰æ¶ˆæ¯ï¼Œæ‰€ä»¥ï¼ŒXREAD åœ¨10 ç§’åè¿”å›ç©ºå€¼ï¼ˆnilï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XREAD block 10000 streams mqstream $ </span><br><span class="line">(nil) </span><br><span class="line">(10.00s)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;åˆšåˆšè®²åˆ°çš„è¿™äº›æ“ä½œæ˜¯ List ä¹Ÿæ”¯æŒçš„ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å­¦ä¹ ä¸‹ Streams ç‰¹æœ‰çš„åŠŸèƒ½ã€‚<br>&emsp;&emsp;Streams æœ¬èº«å¯ä»¥ä½¿ç”¨ XGROUP åˆ›å»ºæ¶ˆè´¹ç»„ï¼Œåˆ›å»ºæ¶ˆè´¹ç»„ä¹‹åï¼ŒStreams å¯ä»¥ä½¿ç”¨ XREADGROUP å‘½ä»¤è®©æ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º group1 çš„æ¶ˆè´¹ç»„ï¼Œè¿™ä¸ªæ¶ˆè´¹ç»„æ¶ˆè´¹çš„æ¶ˆæ¯é˜Ÿåˆ—æ˜¯ mqstreamã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">XGROUP create mqstream group1 0 </span><br><span class="line">OK</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ç„¶åï¼Œæˆ‘ä»¬å†æ‰§è¡Œä¸€æ®µå‘½ä»¤ï¼Œè®© group1 æ¶ˆè´¹ç»„é‡Œçš„æ¶ˆè´¹è€… consumer1 ä» mqstream ä¸­è¯»å–æ‰€æœ‰æ¶ˆæ¯ï¼Œå…¶ä¸­ï¼Œå‘½ä»¤æœ€åçš„å‚æ•°â€œ&gt;â€ï¼Œè¡¨ç¤ºä»ç¬¬ä¸€æ¡å°šæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹è¯»å–ã€‚ å› ä¸ºåœ¨ consumer1 è¯»å–æ¶ˆæ¯å‰ï¼Œgroup1 ä¸­æ²¡æœ‰å…¶ä»–æ¶ˆè´¹è€…è¯»å–è¿‡æ¶ˆæ¯ï¼Œæ‰€ä»¥ï¼Œ consumer1 å°±å¾—åˆ° mqstream æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ¶ˆæ¯äº†ï¼ˆä¸€å…± 4 æ¡ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP group group1 consumer1 streams mqstream &gt;</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1599203861727-0&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">         2) <span class="string">&quot;5&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;1599274912765-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;3&quot;</span></span><br><span class="line">      3) 1) <span class="string">&quot;1599274925823-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;2&quot;</span></span><br><span class="line">      4) 1) <span class="string">&quot;1599274927910-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¸€æ—¦è¢«æ¶ˆè´¹ç»„é‡Œçš„ä¸€ä¸ªæ¶ˆè´¹è€…è¯»å–äº†ï¼Œå°±ä¸èƒ½å†è¢«è¯¥æ¶ˆè´¹ç»„å†…çš„å…¶ä»–æ¶ˆè´¹è€…è¯»å–äº†ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬æ‰§è¡Œå®Œåˆšæ‰çš„ XREADGROUP å‘½ä»¤åï¼Œå†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œè®© group1 å†…çš„ consumer2 è¯»å–æ¶ˆæ¯æ—¶ï¼Œconsumer2 è¯»åˆ°çš„å°±æ˜¯ç©ºå€¼ï¼Œå› ä¸ºæ¶ˆæ¯å·²ç»è¢« consumer1 è¯»å–å®Œäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP group group1 consumer2 streams mqstream 0</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) (empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä½¿ç”¨æ¶ˆè´¹ç»„çš„ç›®çš„æ˜¯è®©ç»„å†…çš„å¤šä¸ªæ¶ˆè´¹è€…å…±åŒåˆ†æ‹…è¯»å–æ¶ˆæ¯ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè®©æ¯ä¸ªæ¶ˆè´¹è€…è¯»å–éƒ¨åˆ†æ¶ˆæ¯ï¼Œä»è€Œå®ç°æ¶ˆæ¯è¯»å–è´Ÿè½½åœ¨å¤šä¸ªæ¶ˆè´¹è€…é—´æ˜¯å‡è¡¡åˆ†å¸ƒçš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼Œè®© group2 ä¸­çš„ consumer1ã€2ã€3 å„è‡ªè¯»å–ä¸€æ¡æ¶ˆæ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">XREADGROUP group group2 consumer1 count 1 streams mqstream &gt;</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1599203861727-0&quot;</span></span><br><span class="line">         2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">            2) <span class="string">&quot;5&quot;</span></span><br><span class="line">XREADGROUP group group2 consumer2 count 1 streams mqstream &gt;</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1599274912765-0&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">         2) <span class="string">&quot;3&quot;</span></span><br><span class="line">XREADGROUP group group2 consumer3 count 1 streams mqstream &gt;</span><br><span class="line">1) 1) <span class="string">&quot;mqstream&quot;</span></span><br><span class="line">   2) 1) 1) <span class="string">&quot;1599274925823-0&quot;</span></span><br><span class="line">      2) 1) <span class="string">&quot;repo&quot;</span></span><br><span class="line">         2) <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;ä¸ºäº†ä¿è¯æ¶ˆè´¹è€…åœ¨å‘ç”Ÿæ•…éšœæˆ–å®•æœºå†æ¬¡é‡å¯åï¼Œä»ç„¶å¯ä»¥è¯»å–æœªå¤„ç†å®Œçš„æ¶ˆæ¯ï¼ŒStreams ä¼šè‡ªåŠ¨ä½¿ç”¨å†…éƒ¨é˜Ÿåˆ—ï¼ˆä¹Ÿç§°ä¸º PENDING Listï¼‰ç•™å­˜æ¶ˆè´¹ç»„é‡Œæ¯ä¸ªæ¶ˆè´¹è€…è¯»å–çš„æ¶ˆæ¯ï¼Œç›´åˆ°æ¶ˆè´¹è€…ä½¿ç”¨ XACK å‘½ä»¤é€šçŸ¥ Streamsâ€œæ¶ˆæ¯å·²ç»å¤„ç†å®Œæˆâ€ã€‚å¦‚æœæ¶ˆè´¹è€…æ²¡æœ‰æˆåŠŸå¤„ç†æ¶ˆæ¯ï¼Œå®ƒå°±ä¸ä¼šç»™ Streams å‘é€ XACK å‘½ä»¤ï¼Œæ¶ˆæ¯ä»ç„¶ä¼šç•™å­˜ã€‚æ­¤æ—¶ï¼Œæ¶ˆè´¹è€…å¯ä»¥åœ¨é‡å¯åï¼Œç”¨ XPENDING å‘½ä»¤æŸ¥çœ‹å·²è¯»å–ã€ä½†å°šæœªç¡®è®¤å¤„ç†å®Œæˆçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥æŸ¥çœ‹ä¸€ä¸‹ group2 ä¸­å„ä¸ªæ¶ˆè´¹è€…å·²è¯»å–ã€ä½†å°šæœªç¡®è®¤çš„æ¶ˆæ¯ä¸ªæ•°ã€‚å…¶ä¸­ï¼Œ XPENDING è¿”å›ç»“æœçš„ç¬¬äºŒã€ä¸‰è¡Œåˆ†åˆ«è¡¨ç¤º group2 ä¸­æ‰€æœ‰æ¶ˆè´¹è€…è¯»å–çš„æ¶ˆæ¯æœ€å° ID å’Œ æœ€å¤§ IDã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">XPENDING mqstream group2</span><br><span class="line">1) (<span class="built_in">integer</span>) 3</span><br><span class="line">2) <span class="string">&quot;1599203861727-0&quot;</span></span><br><span class="line">3) <span class="string">&quot;1599274925823-0&quot;</span></span><br><span class="line">4) 1) 1) <span class="string">&quot;consumer1&quot;</span></span><br><span class="line">      2) <span class="string">&quot;1&quot;</span></span><br><span class="line">   2) 1) <span class="string">&quot;consumer2&quot;</span></span><br><span class="line">      2) <span class="string">&quot;1&quot;</span></span><br><span class="line">   3) 1) <span class="string">&quot;consumer3&quot;</span></span><br><span class="line">      2) <span class="string">&quot;1&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦è¿›ä¸€æ­¥æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…å…·ä½“è¯»å–äº†å“ªäº›æ•°æ®ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">XPENDING mqstream group2 - + 10 consumer2</span><br><span class="line">1) 1) <span class="string">&quot;1599274912765-0&quot;</span></span><br><span class="line">   2) <span class="string">&quot;consumer2&quot;</span></span><br><span class="line">   3) (<span class="built_in">integer</span>) 513336</span><br><span class="line">   4) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œconsumer2 å·²è¯»å–çš„æ¶ˆæ¯çš„ ID æ˜¯ 1599274912765-0ã€‚ä¸€æ—¦æ¶ˆæ¯ 1599274912765-0 è¢« consumer2 å¤„ç†äº†ï¼Œconsumer2 å°±å¯ä»¥ä½¿ç”¨ XACK å‘½ä»¤é€šçŸ¥ Streamsï¼Œç„¶åè¿™æ¡æ¶ˆæ¯å°±ä¼šè¢«åˆ é™¤ã€‚å½“æˆ‘ä»¬å†ä½¿ç”¨ XPENDING å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°ï¼Œconsumer2 å·²ç»æ²¡æœ‰å·²è¯»å–ã€ä½†å°šæœªç¡®è®¤å¤„ç†çš„æ¶ˆæ¯äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XACK mqstream group2 1599274912765-0 </span><br><span class="line">(<span class="built_in">integer</span>) 1 </span><br><span class="line">XPENDING mqstream group2 - + 10 consumer2 </span><br><span class="line">(empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure><h1 id="å¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡"><a href="#å¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡" class="headerlink" title="å¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡"></a>å¼‚æ­¥æœºåˆ¶ï¼šå¦‚ä½•é¿å…å•çº¿ç¨‹æ¨¡å‹çš„é˜»å¡</h1><p>&emsp;&emsp;Redis çš„æ“ä½œåŸºæœ¬å¯ä»¥åˆ†ä¸º 4 ç±»ï¼š</p><ol><li>æœåŠ¡å®¢æˆ·ç«¯è¯·æ±‚çš„é”®å€¼å¯¹å¢åˆ æ”¹æŸ¥æ“ä½œï¼›</li><li>ç½‘ç»œ IOï¼›</li><li>ä¿è¯å¯é æ€§çš„æŒä¹…åŒ–æ“ä½œï¼›</li><li>è¿›è¡Œä¸»ä»å¤åˆ¶æ—¶çš„æ•°æ®åŒæ­¥æ“ä½œã€‚</li></ol><h2 id="Redis-å®ä¾‹æœ‰å“ªäº›é˜»å¡ç‚¹"><a href="#Redis-å®ä¾‹æœ‰å“ªäº›é˜»å¡ç‚¹" class="headerlink" title="Redis å®ä¾‹æœ‰å“ªäº›é˜»å¡ç‚¹"></a>Redis å®ä¾‹æœ‰å“ªäº›é˜»å¡ç‚¹</h2><p>&emsp;&emsp;Redis å®ä¾‹åœ¨è¿è¡Œæ—¶ï¼Œè¦å’Œè®¸å¤šå¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œè¿™äº›ä¸åŒçš„äº¤äº’å°±ä¼šæ¶‰åŠä¸åŒçš„æ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å’Œ Redis å®ä¾‹äº¤äº’çš„å¯¹è±¡ï¼Œä»¥åŠäº¤äº’æ—¶ä¼šå‘ç”Ÿçš„æ“ä½œã€‚</p><ul><li>å®¢æˆ·ç«¯ï¼šç½‘ç»œ IOï¼Œé”®å€¼å¯¹å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œæ•°æ®åº“æ“ä½œï¼›</li><li>ç£ç›˜ï¼šç”Ÿæˆ RDB å¿«ç…§ï¼Œè®°å½• AOF æ—¥å¿—ï¼ŒAOF æ—¥å¿—é‡å†™ï¼›</li><li>ä¸»ä»èŠ‚ç‚¹ï¼šä¸»åº“ç”Ÿæˆã€ä¼ è¾“ RDB æ–‡ä»¶ï¼Œä»åº“æ¥æ”¶ RDB æ–‡ä»¶ã€æ¸…ç©ºæ•°æ®åº“ã€åŠ è½½ RDB æ–‡ä»¶ï¼›</li><li>åˆ‡ç‰‡é›†ç¾¤å®ä¾‹ï¼šå‘å…¶ä»–å®ä¾‹ä¼ è¾“å“ˆå¸Œæ§½ä¿¡æ¯ï¼Œæ•°æ®è¿ç§»ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis69.jpg" alt="avatar"></li></ul><h3 id="å’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡ç‚¹"><a href="#å’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡ç‚¹" class="headerlink" title="å’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡ç‚¹"></a>å’Œå®¢æˆ·ç«¯äº¤äº’æ—¶çš„é˜»å¡ç‚¹</h3><p>&emsp;&emsp;ç½‘ç»œ IO æœ‰æ—¶å€™ä¼šæ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯ Redis ä½¿ç”¨äº† IO å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹ä¸€ç›´å¤„åœ¨ç­‰å¾…ç½‘ç»œè¿æ¥æˆ–è¯·æ±‚åˆ°æ¥çš„çŠ¶æ€ï¼Œæ‰€ä»¥ï¼Œç½‘ç»œ IO ä¸æ˜¯å¯¼è‡´ Redis é˜»å¡çš„å› ç´ ã€‚</p><ol><li><p>æ½œåœ¨é˜»å¡ç‚¹ä¸€ï¼šå¤æ‚åº¦é«˜çš„æ“ä½œ<br>&emsp;&emsp;é”®å€¼å¯¹çš„å¢åˆ æ”¹æŸ¥æ“ä½œæ˜¯ Redis å’Œå®¢æˆ·ç«¯äº¤äº’çš„ä¸»è¦éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯ Redis ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä¸»è¦ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œå¤æ‚åº¦é«˜çš„å¢åˆ æ”¹æŸ¥æ“ä½œè‚¯å®šä¼šé˜»å¡ Redisã€‚<br>&emsp;&emsp;é‚£ä¹ˆï¼Œæ€ä¹ˆåˆ¤æ–­æ“ä½œå¤æ‚åº¦æ˜¯ä¸æ˜¯é«˜å‘¢ï¼Ÿè¿™é‡Œæœ‰ä¸€ä¸ªæœ€åŸºæœ¬çš„æ ‡å‡†ï¼Œå°±æ˜¯çœ‹æ“ä½œçš„å¤æ‚åº¦æ˜¯å¦ä¸º O(N)ã€‚Redis ä¸­æ¶‰åŠé›†åˆçš„æ“ä½œå¤æ‚åº¦é€šå¸¸ä¸º O(N)ï¼Œæˆ‘ä»¬è¦åœ¨ä½¿ç”¨æ—¶é‡è§†èµ·æ¥ã€‚ä¾‹å¦‚é›†åˆå…ƒç´ å…¨é‡æŸ¥è¯¢æ“ä½œ HGETALLã€SMEMBERSï¼Œä»¥åŠé›†åˆçš„èšåˆç»Ÿè®¡æ“ä½œï¼Œä¾‹å¦‚æ±‚äº¤ã€å¹¶å’Œå·®é›†ã€‚è¿™äº›æ“ä½œå¯ä»¥ä½œä¸º Redis çš„ç¬¬ä¸€ä¸ªé˜»å¡ç‚¹ï¼š<strong>é›†åˆå…¨é‡æŸ¥è¯¢</strong>å’Œ<strong>èšåˆæ“ä½œ</strong>ã€‚</p></li><li><p>æ½œåœ¨é˜»å¡ç‚¹äºŒï¼šbigkey çš„åˆ é™¤<br>&emsp;&emsp;é™¤æ­¤ä¹‹å¤–ï¼Œé›†åˆè‡ªèº«çš„åˆ é™¤æ“ä½œåŒæ ·ä¹Ÿæœ‰æ½œåœ¨çš„é˜»å¡é£é™©ã€‚ä½ å¯èƒ½ä¼šè®¤ä¸ºï¼Œåˆ é™¤æ“ä½œå¾ˆç®€å•ï¼Œç›´æ¥æŠŠæ•°æ®åˆ é™¤å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šé˜»å¡ä¸»çº¿ç¨‹å‘¢ï¼Ÿå…¶å®ï¼Œåˆ é™¤æ“ä½œçš„æœ¬è´¨æ˜¯è¦é‡Šæ”¾é”®å€¼å¯¹å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ä½ å¯ä¸è¦å°ç§å†…å­˜çš„é‡Šæ”¾è¿‡ç¨‹ã€‚ é‡Šæ”¾å†…å­˜åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œä¸ºäº†æ›´åŠ é«˜æ•ˆåœ°ç®¡ç†å†…å­˜ç©ºé—´ï¼Œåœ¨åº”ç”¨ç¨‹åºé‡Šæ”¾å†…å­˜æ—¶ï¼Œ<strong>æ“ä½œç³»ç»Ÿéœ€è¦æŠŠé‡Šæ”¾æ‰çš„å†…å­˜å—æ’å…¥ä¸€ä¸ªç©ºé—²å†…å­˜å—çš„é“¾è¡¨</strong>ï¼Œä»¥ä¾¿åç»­è¿›è¡Œç®¡ç†å’Œå†åˆ†é…ã€‚è¿™ä¸ªè¿‡ç¨‹æœ¬èº«éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè€Œä¸”ä¼š<strong>é˜»å¡å½“å‰é‡Šæ”¾å†…å­˜çš„åº”ç”¨ç¨‹åº</strong>ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸‹å­é‡Šæ”¾äº†å¤§é‡å†…å­˜ï¼Œç©ºé—²å†…å­˜å—é“¾è¡¨æ“ä½œæ—¶é—´å°±ä¼šå¢åŠ ï¼Œç›¸åº”åœ°å°±ä¼šé€ æˆ Redis ä¸»çº¿ç¨‹çš„é˜»å¡ã€‚<br>&emsp;&emsp;é‚£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™ä¼šé‡Šæ”¾å¤§é‡å†…å­˜å‘¢ï¼Ÿå…¶å®å°±æ˜¯åœ¨åˆ é™¤å¤§é‡é”®å€¼å¯¹æ•°æ®çš„æ—¶å€™ï¼Œæœ€å…¸å‹çš„å°±æ˜¯åˆ é™¤åŒ…å«äº†å¤§é‡å…ƒç´ çš„é›†åˆï¼Œä¹Ÿç§°ä¸º bigkey åˆ é™¤ã€‚æµ‹è¯•äº†ä¸åŒå…ƒç´ æ•°é‡çš„é›†åˆåœ¨è¿›è¡Œåˆ é™¤æ“ä½œæ—¶æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis70.jpg" alt="avatar"></p></li><li><p>æ½œåœ¨é˜»å¡ç‚¹ä¸‰ï¼šæ¸…ç©ºæ•°æ®åº“<br>&emsp;&emsp;æ—¢ç„¶é¢‘ç¹åˆ é™¤é”®å€¼å¯¹éƒ½æ˜¯æ½œåœ¨çš„é˜»å¡ç‚¹äº†ï¼Œé‚£ä¹ˆï¼Œåœ¨ Redis çš„æ•°æ®åº“çº§åˆ«æ“ä½œä¸­ï¼Œæ¸…ç©ºæ•° æ®åº“ï¼ˆä¾‹å¦‚ FLUSHDB å’Œ FLUSHALL æ“ä½œï¼‰å¿…ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªæ½œåœ¨çš„é˜»å¡é£é™©ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ° åˆ é™¤å’Œé‡Šæ”¾æ‰€æœ‰çš„é”®å€¼å¯¹ã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ Redis çš„ç¬¬ä¸‰ä¸ªé˜»å¡ç‚¹ï¼šæ¸…ç©ºæ•°æ®åº“ã€‚</p></li></ol><h3 id="å’Œç£ç›˜äº¤äº’çš„é˜»å¡ç‚¹"><a href="#å’Œç£ç›˜äº¤äº’çš„é˜»å¡ç‚¹" class="headerlink" title="å’Œç£ç›˜äº¤äº’çš„é˜»å¡ç‚¹"></a>å’Œç£ç›˜äº¤äº’çš„é˜»å¡ç‚¹</h3><ol start="4"><li>æ½œåœ¨é˜»å¡ç‚¹å››ï¼šAOF æ—¥å¿—åŒæ­¥å†™<br>&emsp;&emsp;Redis å¼€å‘è€…æ—©å·²è®¤è¯†åˆ°ç£ç›˜ IO ä¼šå¸¦æ¥é˜»å¡ï¼Œæ‰€ä»¥å°±æŠŠ Redis è¿›ä¸€æ­¥è®¾è®¡ä¸ºé‡‡ç”¨å­è¿›ç¨‹çš„æ–¹å¼ç”Ÿæˆ RDB å¿«ç…§æ–‡ä»¶ï¼Œä»¥åŠæ‰§è¡Œ AOF æ—¥å¿—é‡å†™æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™ä¸¤ä¸ªæ“ä½œç”±å­è¿›ç¨‹è´Ÿè´£æ‰§è¡Œï¼Œæ…¢é€Ÿçš„ç£ç›˜ IO å°±ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹äº†ã€‚ä½†æ˜¯ï¼ŒRedis ç›´æ¥è®°å½• AOF æ—¥å¿—æ—¶ï¼Œä¼šæ ¹æ®ä¸åŒçš„å†™å›ç­–ç•¥å¯¹æ•°æ®åšè½ç›˜ä¿å­˜ã€‚ä¸€ä¸ªåŒæ­¥å†™ç£ç›˜çš„æ“ä½œçš„è€—æ—¶å¤§çº¦æ˜¯ 1ï½2msï¼Œå¦‚æœæœ‰å¤§é‡çš„å†™æ“ä½œéœ€è¦è®°å½•åœ¨ AOF æ—¥å¿—ä¸­ï¼Œå¹¶åŒ æ­¥å†™å›çš„è¯ï¼Œå°±ä¼šé˜»å¡ä¸»çº¿ç¨‹äº†ã€‚è¿™å°±å¾—åˆ°äº† Redis çš„ç¬¬å››ä¸ªé˜»å¡ç‚¹äº†ï¼šAOF æ—¥å¿—åŒæ­¥å†™ã€‚</li></ol><h3 id="ä¸»ä»èŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡ç‚¹"><a href="#ä¸»ä»èŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡ç‚¹" class="headerlink" title="ä¸»ä»èŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡ç‚¹"></a>ä¸»ä»èŠ‚ç‚¹äº¤äº’æ—¶çš„é˜»å¡ç‚¹</h3><p>&emsp;&emsp;åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»åº“éœ€è¦ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œå¹¶ä¼ è¾“ç»™ä»åº“ã€‚ä¸»åº“åœ¨å¤åˆ¶çš„è¿‡ç¨‹ä¸­ï¼Œåˆ›å»ºå’Œä¼ è¾“ RDB æ–‡ä»¶éƒ½æ˜¯ç”±å­è¿›ç¨‹æ¥å®Œæˆçš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œå¯¹äºä»åº“æ¥è¯´ï¼Œå®ƒåœ¨æ¥æ”¶äº† RDB æ–‡ä»¶åï¼Œéœ€è¦ä½¿ç”¨ FLUSHDB å‘½ä»¤æ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œè¿™å°±æ­£å¥½æ’ä¸Šäº†åˆšæ‰æˆ‘ä»¬åˆ†æçš„ç¬¬ä¸‰ä¸ªé˜»å¡ç‚¹ã€‚</p><ol start="5"><li>æ½œåœ¨é˜»å¡ç‚¹äº”ï¼šä»èŠ‚ç‚¹åŠ è½½ RDB æ–‡ä»¶<br>&emsp;&emsp;æ­¤å¤–ï¼Œä»åº“åœ¨æ¸…ç©ºå½“å‰æ•°æ®åº“åï¼Œè¿˜éœ€è¦æŠŠ RDB æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„å¿«æ…¢å’Œ RDB æ–‡ä»¶çš„å¤§å°å¯†åˆ‡ç›¸å…³ï¼ŒRDB æ–‡ä»¶è¶Šå¤§ï¼ŒåŠ è½½è¿‡ç¨‹è¶Šæ…¢ï¼Œæ‰€ä»¥ï¼ŒåŠ è½½ RDB æ–‡ä»¶å°±æˆä¸ºäº† Redis çš„ç¬¬äº”ä¸ªé˜»å¡ç‚¹ã€‚</li></ol><h3 id="åˆ‡ç‰‡é›†ç¾¤å®ä¾‹äº¤äº’æ—¶çš„é˜»å¡ç‚¹"><a href="#åˆ‡ç‰‡é›†ç¾¤å®ä¾‹äº¤äº’æ—¶çš„é˜»å¡ç‚¹" class="headerlink" title="åˆ‡ç‰‡é›†ç¾¤å®ä¾‹äº¤äº’æ—¶çš„é˜»å¡ç‚¹"></a>åˆ‡ç‰‡é›†ç¾¤å®ä¾‹äº¤äº’æ—¶çš„é˜»å¡ç‚¹</h3><p>&emsp;&emsp;æœ€åï¼Œå½“æˆ‘ä»¬éƒ¨ç½² Redis åˆ‡ç‰‡é›†ç¾¤æ—¶ï¼Œæ¯ä¸ª Redis å®ä¾‹ä¸Šåˆ†é…çš„å“ˆå¸Œæ§½ä¿¡æ¯éœ€è¦åœ¨ä¸åŒå®ä¾‹é—´è¿›è¡Œä¼ é€’ï¼ŒåŒæ—¶ï¼Œå½“éœ€è¦è¿›è¡Œè´Ÿè½½å‡è¡¡æˆ–è€…æœ‰å®ä¾‹å¢åˆ æ—¶ï¼Œæ•°æ®ä¼šåœ¨ä¸åŒçš„å®ä¾‹é—´è¿›è¡Œè¿ç§»ã€‚ä¸è¿‡ï¼Œå“ˆå¸Œæ§½çš„ä¿¡æ¯é‡ä¸å¤§ï¼Œè€Œæ•°æ®è¿ç§»æ˜¯æ¸è¿›å¼æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸¤ç±»æ“ä½œå¯¹ Redis ä¸»çº¿ç¨‹çš„é˜»å¡é£é™©ä¸å¤§ã€‚ä¸è¿‡ï¼Œå¦‚æœä½ ä½¿ç”¨äº† Redis Cluster æ–¹æ¡ˆï¼Œè€Œä¸”åŒæ—¶æ­£å¥½è¿ç§»çš„æ˜¯ bigkey çš„è¯ï¼Œå°±ä¼šé€ æˆä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œå› ä¸º Redis Cluster ä½¿ç”¨äº†åŒæ­¥è¿ç§»ã€‚å½“æ²¡æœ‰ bigkey æ—¶ï¼Œåˆ‡ç‰‡é›†ç¾¤çš„å„å®ä¾‹åœ¨è¿›è¡Œäº¤äº’æ—¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</p><p>&emsp;&emsp;æ€»ç»“ä¸€ä¸‹äº”ä¸ªé˜»å¡ç‚¹ï¼š</p><ol><li>é›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œï¼›</li><li>bigkey åˆ é™¤ï¼›</li><li>æ¸…ç©ºæ•°æ®åº“ï¼›</li><li>AOF æ—¥å¿—åŒæ­¥å†™ï¼›</li><li>ä»åº“åŠ è½½ RDB æ–‡ä»¶ã€‚</li></ol><p>&emsp;&emsp;å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè¿™äº›æ“ä½œï¼Œå¿…ç„¶ä¼šå¯¼è‡´ä¸»çº¿ç¨‹é•¿æ—¶é—´æ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚ã€‚ä¸ºäº†é¿å…é˜»å¡å¼æ“ä½œï¼ŒRedis æä¾›äº†å¼‚æ­¥çº¿ç¨‹æœºåˆ¶ã€‚æ‰€è°“çš„å¼‚æ­¥çº¿ç¨‹æœºåˆ¶ï¼Œå°±æ˜¯æŒ‡ï¼ŒRedis ä¼šå¯åŠ¨ä¸€äº›å­çº¿ç¨‹ï¼Œç„¶åæŠŠä¸€äº›ä»»åŠ¡äº¤ç»™è¿™äº›å­çº¿ç¨‹ï¼Œè®©å®ƒä»¬åœ¨åå°å®Œæˆï¼Œè€Œä¸å†ç”±ä¸»çº¿ç¨‹æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ä½¿ç”¨å¼‚æ­¥çº¿ç¨‹æœºåˆ¶æ‰§è¡Œæ“ä½œï¼Œå¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ã€‚</p><h2 id="å“ªäº›é˜»å¡ç‚¹å¯ä»¥å¼‚æ­¥æ‰§è¡Œ"><a href="#å“ªäº›é˜»å¡ç‚¹å¯ä»¥å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å“ªäº›é˜»å¡ç‚¹å¯ä»¥å¼‚æ­¥æ‰§è¡Œ"></a>å“ªäº›é˜»å¡ç‚¹å¯ä»¥å¼‚æ­¥æ‰§è¡Œ</h2><p>&emsp;&emsp;å¦‚æœä¸€ä¸ªæ“ä½œèƒ½è¢«å¼‚æ­¥æ‰§è¡Œï¼Œå°±æ„å‘³ç€ï¼Œå®ƒå¹¶ä¸æ˜¯ Redis ä¸»çº¿ç¨‹çš„å…³é”®è·¯å¾„ä¸Šçš„æ“ä½œã€‚å…³é”®è·¯å¾„ä¸Šçš„æ“ä½œå°±æ˜¯å®¢æˆ·ç«¯æŠŠè¯·æ±‚å‘é€ç»™ Redis åï¼Œç­‰ç€ Redis è¿”å›æ•°æ®ç»“æœçš„æ“ä½œã€‚</p><p><img lazyload src="/images/loading.svg" data-src="redis71.jpg" alt="avatar"><br>&emsp;&emsp;ä¸»çº¿ç¨‹æ¥æ”¶åˆ°æ“ä½œ 1 åï¼Œå› ä¸ºæ“ä½œ 1 å¹¶ä¸ç”¨ç»™å®¢æˆ·ç«¯è¿”å›å…·ä½“çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œä¸»çº¿ç¨‹å¯ä»¥æŠŠå®ƒäº¤ç»™åå°å­çº¿ç¨‹æ¥å®Œæˆï¼ŒåŒæ—¶åªè¦ç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªâ€œOKâ€ç»“æœå°±è¡Œã€‚åœ¨å­çº¿ç¨‹æ‰§è¡Œæ“ä½œ 1 çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯åˆå‘ Redis å®ä¾‹å‘é€äº†æ“ä½œ 2ï¼Œè€Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯æ˜¯éœ€è¦ä½¿ç”¨æ“ä½œ 2 è¿”å›çš„æ•°æ®ç»“æœçš„ï¼Œå¦‚æœæ“ä½œ 2 ä¸è¿”å›ç»“æœï¼Œé‚£ä¹ˆï¼Œå®¢æˆ·ç«¯å°†ä¸€ç›´å¤„äºç­‰å¾…çŠ¶æ€ã€‚</p><ol><li><p>é›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œ<br>&emsp;&emsp;å¯¹äº Redis æ¥è¯´ï¼Œè¯»æ“ä½œæ˜¯å…¸å‹çš„å…³é”®è·¯å¾„æ“ä½œï¼Œå› ä¸ºå®¢æˆ·ç«¯å‘é€äº†è¯»æ“ä½œä¹‹åï¼Œå°±ä¼šç­‰å¾…è¯»å–çš„æ•°æ®è¿”å›ï¼Œä»¥ä¾¿è¿›è¡Œåç»­çš„æ•°æ®å¤„ç†ã€‚è€Œ Redis çš„ç¬¬ä¸€ä¸ªé˜»å¡ç‚¹â€œé›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œâ€éƒ½æ¶‰åŠåˆ°äº†è¯»æ“ä½œï¼Œæ‰€ä»¥ï¼Œå®ƒä»¬æ˜¯ä¸èƒ½è¿›è¡Œå¼‚æ­¥æ“ä½œäº†ã€‚</p></li><li><p>bigkey åˆ é™¤ &amp; æ¸…ç©ºæ•°æ®åº“<br>&emsp;&emsp;æˆ‘ä»¬å†æ¥çœ‹çœ‹åˆ é™¤æ“ä½œã€‚åˆ é™¤æ“ä½œå¹¶ä¸éœ€è¦ç»™å®¢æˆ·ç«¯è¿”å›å…·ä½“çš„æ•°æ®ç»“æœï¼Œæ‰€ä»¥ä¸ç®—æ˜¯å…³é”®è·¯å¾„æ“ä½œã€‚è€Œæˆ‘ä»¬åˆšæ‰æ€»ç»“çš„ç¬¬äºŒä¸ªé˜»å¡ç‚¹â€œbigkey åˆ é™¤â€ï¼Œå’Œç¬¬ä¸‰ä¸ªé˜»å¡ç‚¹â€œæ¸…ç©ºæ•°æ®åº“â€ï¼Œéƒ½æ˜¯å¯¹æ•°æ®åšåˆ é™¤ï¼Œå¹¶ä¸åœ¨å…³é”®è·¯å¾„ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå°å­çº¿ç¨‹æ¥å¼‚æ­¥æ‰§è¡Œåˆ é™¤æ“ä½œã€‚</p></li><li><p>AOF æ—¥å¿—åŒæ­¥<br>&emsp;&emsp;å¯¹äºç¬¬å››ä¸ªé˜»å¡ç‚¹â€œAOF æ—¥å¿—åŒæ­¥å†™â€æ¥è¯´ï¼Œä¸ºäº†ä¿è¯æ•°æ®å¯é æ€§ï¼ŒRedis å®ä¾‹éœ€è¦ä¿è¯ AOF æ—¥å¿—ä¸­çš„æ“ä½œè®°å½•å·²ç»è½ç›˜ï¼Œè¿™ä¸ªæ“ä½œè™½ç„¶éœ€è¦å®ä¾‹ç­‰å¾…ï¼Œä½†å®ƒå¹¶ä¸ä¼šè¿”å›å…·ä½“çš„æ•°æ®ç»“æœç»™å®ä¾‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯åŠ¨ä¸€ä¸ªå­çº¿ç¨‹æ¥æ‰§è¡Œ AOF æ—¥å¿—çš„åŒæ­¥å†™ï¼Œè€Œä¸ç”¨è®©ä¸»çº¿ç¨‹ç­‰å¾… AOF æ—¥å¿—çš„å†™å®Œæˆã€‚</p></li><li><p>ä»åº“åŠ è½½ RDB æ–‡ä»¶<br>&emsp;&emsp;æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹â€œä»åº“åŠ è½½ RDB æ–‡ä»¶â€è¿™ä¸ªé˜»å¡ç‚¹ã€‚ä»åº“è¦æƒ³å¯¹å®¢æˆ·ç«¯æä¾›æ•°æ®å­˜å–æœåŠ¡ï¼Œå°±å¿…é¡»æŠŠ RDB æ–‡ä»¶åŠ è½½å®Œæˆã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿå±äºå…³é”®è·¯å¾„ä¸Šçš„æ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»è®©ä»åº“çš„ä¸»çº¿ç¨‹æ¥æ‰§è¡Œã€‚</p></li></ol><p>&emsp;&emsp;å¯¹äº Redis çš„äº”å¤§é˜»å¡ç‚¹æ¥è¯´ï¼Œé™¤äº†â€œé›†åˆå…¨é‡æŸ¥è¯¢å’Œèšåˆæ“ä½œâ€å’Œâ€œä»åº“åŠ è½½ RDB æ–‡ä»¶â€ï¼Œå…¶ä»–ä¸‰ä¸ªé˜»å¡ç‚¹æ¶‰åŠçš„æ“ä½œéƒ½ä¸åœ¨å…³é”®è·¯å¾„ä¸Šï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Redis çš„å¼‚æ­¥å­çº¿ç¨‹æœºåˆ¶æ¥å®ç° bigkey åˆ é™¤ï¼Œæ¸…ç©ºæ•°æ®åº“ï¼Œä»¥åŠ AOF æ—¥å¿—åŒæ­¥å†™ã€‚</p><h2 id="Redis-çš„å¼‚æ­¥å­çº¿ç¨‹æœºåˆ¶"><a href="#Redis-çš„å¼‚æ­¥å­çº¿ç¨‹æœºåˆ¶" class="headerlink" title="Redis çš„å¼‚æ­¥å­çº¿ç¨‹æœºåˆ¶"></a>Redis çš„å¼‚æ­¥å­çº¿ç¨‹æœºåˆ¶</h2><p>&emsp;&emsp;Redis ä¸»çº¿ç¨‹å¯åŠ¨åï¼Œä¼š<strong>ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ pthread_create å‡½æ•°åˆ›å»º 3 ä¸ªå­çº¿ç¨‹</strong>ï¼Œåˆ†åˆ«ç”±å®ƒä»¬è´Ÿè´£ AOF æ—¥å¿—å†™æ“ä½œã€é”®å€¼å¯¹åˆ é™¤ä»¥åŠæ–‡ä»¶å…³é—­çš„å¼‚æ­¥æ‰§è¡Œã€‚</p><ol><li>é”®å€¼å¯¹åˆ é™¤å­çº¿ç¨‹<br>&emsp;&emsp;ä¸»çº¿ç¨‹é€šè¿‡ä¸€ä¸ªé“¾è¡¨å½¢å¼çš„ä»»åŠ¡é˜Ÿåˆ—å’Œå­çº¿ç¨‹è¿›è¡Œäº¤äº’ã€‚å½“æ”¶åˆ°é”®å€¼å¯¹åˆ é™¤å’Œæ¸…ç©ºæ•°æ®åº“çš„æ“ä½œæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šæŠŠè¿™ä¸ªæ“ä½œå°è£…æˆä¸€ä¸ªä»»åŠ¡ï¼Œæ”¾å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åç»™å®¢æˆ·ç«¯è¿”å›ä¸€ä¸ªå®Œæˆä¿¡æ¯ï¼Œè¡¨æ˜åˆ é™¤å·²ç»å®Œæˆã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªæ—¶å€™åˆ é™¤è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œç­‰åˆ°åå°å­çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è¯»å–ä»»åŠ¡åï¼Œæ‰å¼€å§‹å®é™…åˆ é™¤é”®å€¼å¯¹ï¼Œå¹¶é‡Šæ”¾ç›¸åº”çš„å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŠŠè¿™ç§å¼‚æ­¥åˆ é™¤ä¹Ÿç§°ä¸ºæƒ°æ€§åˆ é™¤ï¼ˆlazy freeï¼‰ã€‚æ­¤æ—¶ï¼Œåˆ é™¤æˆ–æ¸…ç©ºæ“ä½œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™å°±é¿å…äº†å¯¹ä¸»çº¿ç¨‹çš„æ€§èƒ½å½±å“ã€‚<br>&emsp;&emsp;å¼‚æ­¥çš„é”®å€¼å¯¹åˆ é™¤å’Œæ•°æ®åº“æ¸…ç©ºæ“ä½œæ˜¯ Redis 4.0 åæä¾›çš„åŠŸèƒ½ï¼ŒRedis ä¹Ÿæä¾›äº†æ–°çš„å‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸¤ä¸ªæ“ä½œã€‚</li></ol><ul><li>é”®å€¼å¯¹åˆ é™¤ï¼šå½“é›†åˆç±»å‹ä¸­æœ‰å¤§é‡å…ƒç´ ï¼ˆä¾‹å¦‚æœ‰ç™¾ä¸‡çº§åˆ«æˆ–åƒä¸‡çº§åˆ«å…ƒç´ ï¼‰éœ€è¦åˆ é™¤æ—¶ï¼Œå»ºè®®ä½¿ç”¨ UNLINK å‘½ä»¤ã€‚</li><li>æ¸…ç©ºæ•°æ®åº“ï¼šå¯ä»¥åœ¨ FLUSHDB å’Œ FLUSHALL å‘½ä»¤ååŠ ä¸Š ASYNC é€‰é¡¹ï¼Œè¿™æ ·å°±å¯ä»¥è®©åå°å­çº¿ç¨‹å¼‚æ­¥åœ°æ¸…ç©ºæ•°æ®åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FLUSHDB ASYNC </span><br><span class="line">FLUSHALL ASYNC</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>AOF æ—¥å¿—åŒæ­¥<br>&emsp;&emsp;å½“ AOF æ—¥å¿—é…ç½®æˆ everysec é€‰é¡¹åï¼Œä¸»çº¿ç¨‹ä¼šæŠŠ AOF å†™æ—¥å¿—æ“ä½œå°è£…æˆä¸€ä¸ªä»»åŠ¡ï¼Œä¹Ÿæ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚åå°å­çº¿ç¨‹è¯»å–ä»»åŠ¡åï¼Œå¼€å§‹è‡ªè¡Œå†™å…¥ AOF æ—¥å¿—ï¼Œè¿™æ ·ä¸»çº¿ç¨‹å°±ä¸ç”¨ä¸€ç›´ç­‰å¾… AOF æ—¥å¿—å†™å®Œäº†ã€‚</li></ol><p>&emsp;&emsp;ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº† Redis ä¸­çš„å¼‚æ­¥å­çº¿ç¨‹æ‰§è¡Œæœºåˆ¶:<br><img lazyload src="/images/loading.svg" data-src="redis72.jpg" alt="avatar"></p><h2 id="ä½¿ç”¨-scan-é¿å…-keys-å‘½ä»¤"><a href="#ä½¿ç”¨-scan-é¿å…-keys-å‘½ä»¤" class="headerlink" title="ä½¿ç”¨ scan é¿å… keys å‘½ä»¤"></a>ä½¿ç”¨ scan é¿å… keys å‘½ä»¤</h2><p>&emsp;&emsp;æœ‰æ—¶å€™éœ€è¦ä» Redis å®ä¾‹æˆåƒä¸Šä¸‡çš„ key ä¸­æ‰¾å‡ºç‰¹å®šå‰ç¼€çš„ key åˆ—è¡¨æ¥æ‰‹åŠ¨å¤„ç†æ•°æ®ï¼Œå¯èƒ½æ˜¯ä¿®æ”¹å®ƒçš„å€¼ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆ é™¤ keyã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•ä»æµ·é‡çš„ key ä¸­æ‰¾å‡ºæ»¡è¶³ç‰¹å®šå‰ç¼€çš„ key åˆ—è¡¨æ¥ï¼ŸRedis æä¾›äº†ä¸€ä¸ªç®€å•æš´åŠ›çš„æŒ‡ä»¤ keys ç”¨æ¥åˆ—å‡ºæ‰€æœ‰æ»¡è¶³ç‰¹å®šæ­£åˆ™å­—ç¬¦ä¸²è§„åˆ™çš„ keyã€‚è¿™ä¸ªæŒ‡ä»¤ä½¿ç”¨éå¸¸ç®€å•ï¼Œæä¾›ä¸€ä¸ªç®€å•çš„æ­£åˆ™å­—ç¬¦ä¸²å³å¯ï¼Œä½†æ˜¯æœ‰å¾ˆæ˜æ˜¾çš„ä¸¤ä¸ªç¼ºç‚¹ã€‚</p><ol><li>æ²¡æœ‰ offsetã€limit å‚æ•°ï¼Œä¸€æ¬¡æ€§åå‡ºæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„ keyï¼Œä¸‡ä¸€å®ä¾‹ä¸­æœ‰å‡ ç™¾ w ä¸ª key æ»¡è¶³æ¡ä»¶ï¼Œå½“ä½ çœ‹åˆ°æ»¡å±çš„å­—ç¬¦ä¸²åˆ·çš„æ²¡æœ‰å°½å¤´æ—¶ï¼Œä½ å°±çŸ¥é“éš¾å—äº†;</li><li>keys ç®—æ³•æ˜¯éå†ç®—æ³•ï¼Œå¤æ‚åº¦æ˜¯ O(n)ï¼Œå¦‚æœå®ä¾‹ä¸­æœ‰åƒä¸‡çº§ä»¥ä¸Šçš„ keyï¼Œè¿™ä¸ªæŒ‡ä»¤å°±ä¼šå¯¼è‡´ Redis æœåŠ¡å¡é¡¿ï¼Œæ‰€æœ‰è¯»å†™ Redis çš„å…¶å®ƒçš„æŒ‡ä»¤éƒ½ä¼šè¢«å»¶åç”šè‡³ä¼šè¶…æ—¶æŠ¥é”™ï¼Œå› ä¸º Redis æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œé¡ºåºæ‰§è¡Œæ‰€æœ‰æŒ‡ä»¤ï¼Œå…¶å®ƒæŒ‡ä»¤å¿…é¡»ç­‰åˆ°å½“å‰çš„ keys æŒ‡ä»¤æ‰§è¡Œå®Œäº†æ‰å¯ä»¥ç»§ç»­ã€‚</li></ol><p>&emsp;&emsp;å› æ­¤åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­å»ºè®®å±è”½æ‰ keys å‘½ä»¤ã€‚Redis ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåœ¨ 2.8 ç‰ˆæœ¬ä¸­åŠ å…¥äº†æŒ‡ä»¤â€”â€”scanã€‚<br>&emsp;&emsp;scan ç›¸æ¯” keys å…·å¤‡æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>å¤æ‚åº¦è™½ç„¶ä¹Ÿæ˜¯ O(n)ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡æ¸¸æ ‡åˆ†æ­¥è¿›è¡Œçš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ï¼›</li><li>æä¾› limit å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶æ¯æ¬¡è¿”å›ç»“æœçš„æœ€å¤§æ¡æ•°ï¼Œlimit åªæ˜¯å¯¹å¢é‡å¼è¿­ä»£å‘½ä»¤çš„ä¸€ç§æç¤º(hint)ï¼Œè¿”å›çš„ç»“æœå¯å¤šå¯å°‘ï¼›</li><li>åŒ keys ä¸€æ ·ï¼Œå®ƒä¹Ÿæä¾›æ¨¡å¼åŒ¹é…åŠŸèƒ½ï¼›</li><li>æœåŠ¡å™¨ä¸éœ€è¦ä¸ºæ¸¸æ ‡ä¿å­˜çŠ¶æ€ï¼Œæ¸¸æ ‡çš„å”¯ä¸€çŠ¶æ€å°±æ˜¯ scan è¿”å›ç»™å®¢æˆ·ç«¯çš„æ¸¸æ ‡æ•´æ•°ï¼›</li><li>è¿”å›çš„ç»“æœå¯èƒ½ä¼šæœ‰é‡å¤ï¼Œéœ€è¦å®¢æˆ·ç«¯å»é‡å¤ï¼Œè¿™ç‚¹éå¸¸é‡è¦ï¼›</li><li>éå†çš„è¿‡ç¨‹ä¸­å¦‚æœæœ‰æ•°æ®ä¿®æ”¹ï¼Œæ”¹åŠ¨åçš„æ•°æ®èƒ½ä¸èƒ½éå†åˆ°æ˜¯ä¸ç¡®å®šçš„ï¼›</li><li>å•æ¬¡è¿”å›çš„ç»“æœæ˜¯ç©ºçš„å¹¶ä¸æ„å‘³ç€éå†ç»“æŸï¼Œè€Œè¦çœ‹è¿”å›çš„æ¸¸æ ‡å€¼æ˜¯å¦ä¸ºé›¶ã€‚</li></ol><h3 id="scan-åŸºç¡€ä½¿ç”¨"><a href="#scan-åŸºç¡€ä½¿ç”¨" class="headerlink" title="scan åŸºç¡€ä½¿ç”¨"></a>scan åŸºç¡€ä½¿ç”¨</h3><p><strong>SCAN cursor [MATCH pattern] [COUNT count]</strong><br>&emsp;&emsp;åˆå§‹æ‰§è¡Œscanå‘½ä»¤ä¾‹å¦‚scan 0ã€‚SCANå‘½ä»¤æ˜¯ä¸€ä¸ªåŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ã€‚è¿™æ„å‘³ç€å‘½ä»¤æ¯æ¬¡è¢«è°ƒç”¨éƒ½éœ€è¦ä½¿ç”¨ä¸Šä¸€æ¬¡è¿™ä¸ªè°ƒç”¨è¿”å›çš„æ¸¸æ ‡ä½œä¸ºè¯¥æ¬¡è°ƒç”¨çš„æ¸¸æ ‡å‚æ•°ï¼Œä»¥æ­¤æ¥å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹ã€‚å½“SCANå‘½ä»¤çš„æ¸¸æ ‡å‚æ•°è¢«è®¾ç½®ä¸º0æ—¶ï¼ŒæœåŠ¡å™¨å°†å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œè€Œå½“redisæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›å€¼ä¸º0çš„æ¸¸æ ‡æ—¶ï¼Œè¡¨ç¤ºè¿­ä»£å·²ç»“æŸï¼Œè¿™æ˜¯å”¯ä¸€è¿­ä»£ç»“æŸçš„åˆ¤å®šæ–¹å¼ï¼Œè€Œä¸èƒ½é€šè¿‡è¿”å›ç»“æœé›†æ˜¯å¦ä¸ºç©ºåˆ¤æ–­è¿­ä»£ç»“æŸã€‚<br>&emsp;&emsp;scan å‚æ•°æä¾›äº†ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ cursor æ•´æ•°å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯ key çš„æ­£åˆ™æ¨¡å¼ï¼Œç¬¬ä¸‰ä¸ªæ˜¯éå†çš„ limit hintã€‚ä¾‹å¦‚ä¸‹é¢æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">scan 0 match key99* count 1000</span><br><span class="line">1) <span class="string">&quot;13912&quot;</span> </span><br><span class="line">2) 1) <span class="string">&quot;key997&quot;</span> </span><br><span class="line">   2) <span class="string">&quot;key9906&quot;</span> </span><br><span class="line">   3) <span class="string">&quot;key9957&quot;</span> </span><br><span class="line">   4) <span class="string">&quot;key9902&quot;</span> </span><br><span class="line">   5) <span class="string">&quot;key9971&quot;</span> </span><br><span class="line">   6) <span class="string">&quot;key9935&quot;</span> </span><br><span class="line">   7) <span class="string">&quot;key9958&quot;</span> </span><br><span class="line">   8) <span class="string">&quot;key9928&quot;</span> </span><br><span class="line">   9) <span class="string">&quot;key9931&quot;</span> </span><br><span class="line">   10) <span class="string">&quot;key9961&quot;</span> </span><br><span class="line">   11) <span class="string">&quot;key9948&quot;</span> </span><br><span class="line">   12) <span class="string">&quot;key9965&quot;</span> </span><br><span class="line">   13) <span class="string">&quot;key9937&quot;</span></span><br><span class="line">   </span><br><span class="line">scan 13912 match key99* count 1000</span><br><span class="line">1) <span class="string">&quot;5292&quot;</span> </span><br><span class="line">2) 1) <span class="string">&quot;key996&quot;</span> </span><br><span class="line">   2) <span class="string">&quot;key9960&quot;</span> </span><br><span class="line">   3) <span class="string">&quot;key9973&quot;</span> </span><br><span class="line">   4) <span class="string">&quot;key9978&quot;</span> </span><br><span class="line">   5) <span class="string">&quot;key9927&quot;</span></span><br><span class="line">   6) <span class="string">&quot;key995&quot;</span> </span><br><span class="line">   7) <span class="string">&quot;key9992&quot;</span> </span><br><span class="line">   8) <span class="string">&quot;key9993&quot;</span> </span><br><span class="line">   9) <span class="string">&quot;key9964&quot;</span> </span><br><span class="line">   10) <span class="string">&quot;key9934&quot;</span></span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿”å›ç»“æœåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†å³ 1) å°±æ˜¯ä¸‹ä¸€æ¬¡è¿­ä»£æ¸¸æ ‡ï¼Œç¬¬äºŒéƒ¨åˆ†å³ 2) å°±æ˜¯æœ¬æ¬¡è¿­ä»£ç»“æœé›†ã€‚ä»ä¸Šé¢çš„è¿‡ç¨‹å¯ä»¥çœ‹åˆ°è™½ç„¶æä¾›çš„ limit æ˜¯ 1000ï¼Œä½†æ˜¯è¿”å›çš„ç»“æœåªæœ‰ 10 ä¸ªå·¦å³ã€‚å› ä¸ºè¿™ä¸ª limit ä¸æ˜¯é™å®šè¿”å›ç»“æœçš„æ•°é‡ï¼Œè€Œæ˜¯é™å®šæœåŠ¡å™¨å•æ¬¡éå†çš„å­—å…¸æ§½ä½æ•°é‡(çº¦ç­‰äº)ã€‚å¦‚æœå°† limit è®¾ç½®ä¸º 10ï¼Œä½ ä¼šå‘ç°è¿”å›ç»“æœæ˜¯ç©ºçš„ï¼Œä½†æ˜¯æ¸¸æ ‡å€¼ä¸ä¸ºé›¶ï¼Œæ„å‘³ç€éå†è¿˜æ²¡ç»“æŸã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scan 0 match key99* count 10</span><br><span class="line">1) <span class="string">&quot;15360&quot;</span> </span><br><span class="line">2) (empty list or <span class="built_in">set</span>)</span><br><span class="line">scan 15360 match key99* count 10</span><br><span class="line">1) <span class="string">&quot;2304&quot;</span> </span><br><span class="line">2) (empty list or <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure><h1 id="åˆ é™¤æ•°æ®åä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ"><a href="#åˆ é™¤æ•°æ®åä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ" class="headerlink" title="åˆ é™¤æ•°æ®åä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ"></a>åˆ é™¤æ•°æ®åä¸ºä»€ä¹ˆå†…å­˜å ç”¨ç‡è¿˜æ˜¯å¾ˆé«˜ï¼Ÿ</h1><p>&emsp;&emsp;åœ¨ä½¿ç”¨ Redis æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šæ˜æ˜åšäº†æ•°æ®åˆ é™¤ï¼Œæ•°æ®é‡å·²ç»ä¸å¤§ äº†ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ top å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œè¿˜ä¼šå‘ç° Redis å ç”¨äº†å¾ˆå¤šå†…å­˜å‘¢ï¼Ÿé¦–å…ˆè¦æ˜ç™½ä¸€ä¸ªæ¦‚å¿µï¼Œé‚£å°±æ˜¯æ“ä½œç³»ç»Ÿçš„å†…å­˜ç¢ç‰‡æ˜¯ä»€ä¹ˆã€‚åº”ç”¨ç”³è¯·å†…å­˜é€šå¸¸æ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œä»¥ 64 ä½çš„ç³»ç»Ÿä¸ºä¾‹ï¼Œä¸€ä¸ªå†…å­˜å—çš„å¤§å°æ˜¯ 8 å­—èŠ‚ï¼Œå½“è¦ä¿å­˜ä¸€æ®µ 6 å­—èŠ‚çš„æ•°æ®æ—¶ï¼Œä¼šç”³è¯·ä¸€å—æ–°çš„å†…å­˜å—ï¼Œè¿™æ ·å°±ä¼šå‰©ä¸‹ 2 å­—èŠ‚çš„å†…å­˜æ²¡è¢«å ç”¨å¹¶ä¸”ä¹Ÿä¸ä¼šå†è¢«åˆ†é…ç»™å…¶ä»–çš„æ•°æ®ã€‚è¿™æ ·å°±å‡ºç°äº† 2 å­—èŠ‚çš„å†…å­˜ç¢ç‰‡ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis73.jpg" alt="avatar"></p><h2 id="å‡ºç°å†…å­˜ç¢ç‰‡çš„åŸå› "><a href="#å‡ºç°å†…å­˜ç¢ç‰‡çš„åŸå› " class="headerlink" title="å‡ºç°å†…å­˜ç¢ç‰‡çš„åŸå› "></a>å‡ºç°å†…å­˜ç¢ç‰‡çš„åŸå› </h2><h3 id="å†…å› ï¼šå†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥"><a href="#å†…å› ï¼šå†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥" class="headerlink" title="å†…å› ï¼šå†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥"></a>å†…å› ï¼šå†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥</h3><p>&emsp;&emsp;å†…å­˜åˆ†é…å™¨çš„åˆ†é…ç­–ç•¥å°±å†³å®šäº†æ“ä½œç³»ç»Ÿæ— æ³•åšåˆ°â€œæŒ‰éœ€åˆ†é…â€ã€‚è¿™æ˜¯å› ä¸ºï¼Œå†…å­˜åˆ†é…å™¨ä¸€èˆ¬æ˜¯æŒ‰å›ºå®šå¤§å°æ¥åˆ†é…å†…å­˜ï¼Œè€Œä¸æ˜¯å®Œå…¨æŒ‰ç…§åº”ç”¨ç¨‹åºç”³è¯·çš„å†…å­˜ç©ºé—´å¤§å°ç»™ç¨‹åºåˆ†é…ã€‚<br>&emsp;&emsp;Redis å¯ä»¥ä½¿ç”¨ libcã€jemallocã€tcmalloc å¤šç§å†…å­˜åˆ†é…å™¨æ¥åˆ†é…å†…å­˜ï¼Œé»˜è®¤ä½¿ç”¨ jemallocã€‚æ¥ä¸‹æ¥ï¼Œå°±ä»¥ jemalloc ä¸ºä¾‹ï¼Œæ¥å…·ä½“è§£é‡Šä¸€ä¸‹ã€‚å…¶ä»–åˆ†é…å™¨ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚<br>&emsp;&emsp;jemalloc çš„åˆ†é…ç­–ç•¥ä¹‹ä¸€ï¼Œæ˜¯æŒ‰ç…§ä¸€ç³»åˆ—å›ºå®šçš„å¤§å°åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œä¾‹å¦‚ 8 å­—èŠ‚ã€16 å­—èŠ‚ã€32 å­—èŠ‚ã€48 å­—èŠ‚ï¼Œâ€¦, 2KBã€4KBã€8KB ç­‰ã€‚å½“ç¨‹åºç”³è¯·çš„å†…å­˜æœ€æ¥è¿‘æŸä¸ªå›ºå®šå€¼ ï¼Œjemalloc ä¼šç»™å®ƒåˆ†é…ç›¸åº”å¤§å°çš„ç©ºé—´ã€‚è¿™æ ·çš„åˆ†é…æ–¹å¼æœ¬èº«æ˜¯ä¸ºäº†å‡å°‘åˆ†é…æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼ŒRedis ç”³è¯·ä¸€ä¸ª 20 å­—èŠ‚çš„ç©ºé—´ä¿å­˜æ•°æ®ï¼Œjemalloc å°±ä¼šåˆ†é… 32 å­—èŠ‚ï¼Œæ­¤æ—¶ï¼Œå¦‚æœåº”ç”¨è¿˜è¦å†™å…¥ 10 å­—èŠ‚çš„æ•°æ®ï¼ŒRedis å°±ä¸ç”¨å†å‘æ“ä½œç³»ç»Ÿç”³è¯·ç©ºé—´äº†ï¼Œå› ä¸ºåˆšæ‰åˆ†é…çš„ 32 å­—èŠ‚å·²ç»å¤Ÿç”¨äº†ï¼Œè¿™å°±é¿å…äº†ä¸€æ¬¡åˆ†é…æ“ä½œã€‚ä½†æ˜¯ï¼Œå¦‚æœ Redis æ¯æ¬¡å‘åˆ†é…å™¨ç”³è¯·çš„å†…å­˜ç©ºé—´å¤§å°ä¸ä¸€æ ·ï¼Œè¿™ç§åˆ†é…æ–¹å¼å°±ä¼šæœ‰å½¢æˆç¢ç‰‡çš„é£é™©ï¼Œè€Œè¿™æ­£å¥½æ¥æºäº Redis çš„å¤–å› äº†ã€‚</p><h3 id="å¤–å› ï¼šé”®å€¼å¯¹å¤§å°ä¸ä¸€æ ·å’Œåˆ æ”¹æ“ä½œ"><a href="#å¤–å› ï¼šé”®å€¼å¯¹å¤§å°ä¸ä¸€æ ·å’Œåˆ æ”¹æ“ä½œ" class="headerlink" title="å¤–å› ï¼šé”®å€¼å¯¹å¤§å°ä¸ä¸€æ ·å’Œåˆ æ”¹æ“ä½œ"></a>å¤–å› ï¼šé”®å€¼å¯¹å¤§å°ä¸ä¸€æ ·å’Œåˆ æ”¹æ“ä½œ</h3><p>&emsp;&emsp;Redis é€šå¸¸ä½œä¸ºå…±ç”¨çš„ç¼“å­˜ç³»ç»Ÿæˆ–é”®å€¼æ•°æ®åº“å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ‰€ä»¥ï¼Œä¸åŒä¸šåŠ¡åº”ç”¨çš„æ•°æ®éƒ½å¯èƒ½ä¿å­˜åœ¨ Redis ä¸­ï¼Œè¿™å°±ä¼šå¸¦æ¥ä¸åŒå¤§å°çš„é”®å€¼å¯¹ã€‚è¿™æ ·ä¸€æ¥ï¼ŒRedis ç”³è¯·å†…å­˜ç©ºé—´åˆ†é…æ—¶ï¼Œæœ¬èº«å°±ä¼šæœ‰å¤§å°ä¸ä¸€çš„ç©ºé—´éœ€æ±‚ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªå¤–å› ã€‚<br>&emsp;&emsp;ç¬¬äºŒä¸ªå¤–å› æ˜¯ï¼Œè¿™äº›é”®å€¼å¯¹ä¼šè¢«ä¿®æ”¹å’Œåˆ é™¤ï¼Œè¿™ä¼šå¯¼è‡´ç©ºé—´çš„æ‰©å®¹å’Œé‡Šæ”¾ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€æ–¹é¢ï¼Œå¦‚æœä¿®æ”¹åçš„é”®å€¼å¯¹å˜å¤§æˆ–å˜å°äº†ï¼Œå°±éœ€è¦å ç”¨é¢å¤–çš„ç©ºé—´æˆ–è€…é‡Šæ”¾ä¸ç”¨çš„ç©ºé—´ã€‚å¦ä¸€æ–¹é¢ï¼Œåˆ é™¤çš„é”®å€¼å¯¹å°±ä¸å†éœ€è¦å†…å­˜ç©ºé—´äº†ï¼Œæ­¤æ—¶ï¼Œå°±ä¼šæŠŠç©ºé—´é‡Šæ”¾å‡ºæ¥ï¼Œå½¢æˆç©ºé—²ç©ºé—´ã€‚</p><h3 id="å¦‚ä½•æ¸…ç†å†…å­˜ç¢ç‰‡ï¼Ÿ"><a href="#å¦‚ä½•æ¸…ç†å†…å­˜ç¢ç‰‡ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ¸…ç†å†…å­˜ç¢ç‰‡ï¼Ÿ"></a>å¦‚ä½•æ¸…ç†å†…å­˜ç¢ç‰‡ï¼Ÿ</h3><p>&emsp;&emsp;å½“ Redis å‘ç”Ÿå†…å­˜ç¢ç‰‡åï¼Œä¸€ä¸ªâ€œç®€å•ç²—æš´â€çš„æ–¹æ³•å°±æ˜¯é‡å¯ Redis å®ä¾‹ã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œä¼˜é›…â€çš„æ–¹æ³•ï¼Œæ¯•ç«Ÿï¼Œé‡å¯ Redis ä¼šå¸¦æ¥ä¸¤ä¸ªåæœï¼š</p><ol><li>å¦‚æœ Redis ä¸­çš„æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ï¼›</li><li>å³ä½¿ Redis æ•°æ®æŒä¹…åŒ–äº†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é€šè¿‡ AOF æˆ– RDB è¿›è¡Œæ¢å¤ï¼Œæ¢å¤æ—¶é•¿å–å†³äº AOF æˆ– RDB çš„å¤§å°ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª Redis å®ä¾‹ï¼Œæ¢å¤é˜¶æ®µæ— æ³•æä¾›æœåŠ¡ã€‚</li></ol><p>æ¸…ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis74.jpg" alt="avatar"><br>&emsp;&emsp;ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šç¢ç‰‡æ¸…ç†æ˜¯æœ‰ä»£ä»·çš„ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦æŠŠå¤šä»½æ•°æ®æ‹·è´åˆ°æ–°ä½ç½®ï¼ŒæŠŠåŸæœ‰ç©ºé—´é‡Šæ”¾å‡ºæ¥ï¼Œè¿™ä¼šå¸¦æ¥æ—¶é—´å¼€é”€ã€‚å› ä¸º Redis æ˜¯å•çº¿ç¨‹ï¼Œåœ¨æ•°æ®æ‹·è´æ—¶ï¼ŒRedis åªèƒ½ç­‰ç€ï¼Œè¿™å°±å¯¼è‡´ Redis æ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚ï¼Œæ€§èƒ½å°±ä¼šé™ä½ã€‚è€Œä¸”ï¼Œæœ‰çš„æ—¶å€™ï¼Œæ•°æ®æ‹·è´è¿˜éœ€è¦æ³¨æ„é¡ºåºï¼Œå°±åƒåˆšåˆšè¯´çš„æ¸…ç†å†…å­˜ç¢ç‰‡çš„ä¾‹å­ï¼Œæ“ä½œç³»ç»Ÿéœ€è¦å…ˆæ‹·è´ Dï¼Œå¹¶é‡Šæ”¾ D çš„ç©ºé—´åï¼Œæ‰èƒ½æ‹·è´ Bã€‚è¿™ç§å¯¹é¡ºåºæ€§çš„è¦æ±‚ï¼Œä¼šè¿›ä¸€æ­¥å¢åŠ  Redis çš„ç­‰å¾…æ—¶é—´ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ã€‚é‚£ä¹ˆï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å°½é‡ç¼“è§£è¿™ä¸ªé—®é¢˜å—ï¼Ÿè¿™å°±è¦æåˆ°ï¼ŒRedis ä¸“é—¨ä¸ºè‡ªåŠ¨å†…å­˜ç¢ç‰‡æ¸…ç†åŠŸæœºåˆ¶è®¾ç½®çš„å‚æ•°äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°ï¼Œæ¥æ§åˆ¶ç¢ç‰‡æ¸…ç†çš„å¼€å§‹å’Œç»“æŸæ—¶æœºï¼Œä»¥åŠå ç”¨çš„ CPU æ¯”ä¾‹ï¼Œä»è€Œå‡å°‘ç¢ç‰‡æ¸…ç†å¯¹ Redis æœ¬èº«è¯·æ±‚å¤„ç†çš„æ€§èƒ½å½±å“ã€‚</p><p>&emsp;&emsp;é¦–å…ˆï¼ŒRedis éœ€è¦å¯ç”¨è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ¸…ç†ï¼Œå¯ä»¥æŠŠ activedefrag é…ç½®é¡¹è®¾ç½®ä¸º yesï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> activedefrag yes</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è‡ªåŠ¨å†…å­˜ç¢ç‰‡æ¸…ç†æœºåˆ¶åœ¨æ§åˆ¶ç¢ç‰‡æ¸…ç†å¯åœçš„æ—¶æœºä¸Šï¼Œæ—¢è€ƒè™‘äº†ç¢ç‰‡çš„ç©ºé—´å æ¯”ã€å¯¹ Redis å†…å­˜ä½¿ç”¨æ•ˆç‡çš„å½±å“ï¼Œè¿˜è€ƒè™‘äº†æ¸…ç†æœºåˆ¶æœ¬èº«çš„ CPU æ—¶é—´å æ¯”ã€å¯¹ Redis æ€§èƒ½çš„å½±å“ã€‚</p><h1 id="Redis-ä½œä¸ºç¼“å­˜çš„ä¸¤ç§ç­–ç•¥"><a href="#Redis-ä½œä¸ºç¼“å­˜çš„ä¸¤ç§ç­–ç•¥" class="headerlink" title="Redis ä½œä¸ºç¼“å­˜çš„ä¸¤ç§ç­–ç•¥"></a>Redis ä½œä¸ºç¼“å­˜çš„ä¸¤ç§ç­–ç•¥</h1><p>&emsp;&emsp;åœ¨å•†å“å¤§ä¿ƒçš„åœºæ™¯ä¸­ï¼Œå•†å“çš„åº“å­˜ä¿¡æ¯ä¼šä¸€ç›´è¢«ä¿®æ”¹ã€‚å¦‚æœæ¯æ¬¡ä¿®æ”¹éƒ½éœ€åˆ°æ•°æ®åº“ä¸­å¤„ç†ï¼Œå°±ä¼šæ‹–æ…¢æ•´ä¸ªåº”ç”¨ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé€‰æ‹©è¯»å†™ç¼“å­˜çš„æ¨¡å¼ã€‚è€Œåœ¨çŸ­è§†é¢‘ App çš„åœºæ™¯ä¸­ï¼Œè™½ç„¶è§†é¢‘çš„å±æ€§æœ‰å¾ˆå¤šï¼Œä½†æ˜¯ï¼Œä¸€èˆ¬ç¡®å®šåï¼Œä¿®æ”¹å¹¶ä¸é¢‘ç¹ï¼Œæ­¤æ—¶ï¼Œåœ¨æ•°æ®åº“ä¸­è¿›è¡Œä¿®æ”¹å¯¹ç¼“å­˜å½±å“ä¸å¤§ï¼Œæ‰€ä»¥åªè¯»ç¼“å­˜æ¨¡å¼æ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©ã€‚</p><h2 id="åªè¯»ç¼“å­˜"><a href="#åªè¯»ç¼“å­˜" class="headerlink" title="åªè¯»ç¼“å­˜"></a>åªè¯»ç¼“å­˜</h2><p>&emsp;&emsp;å½“ Redis ç”¨ä½œåªè¯»ç¼“å­˜æ—¶ï¼Œåº”ç”¨è¦è¯»å–æ•°æ®çš„è¯ï¼Œä¼šå…ˆè°ƒç”¨ Redis GET æ¥å£ï¼ŒæŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚è€Œæ‰€æœ‰çš„æ•°æ®å†™è¯·æ±‚ï¼Œä¼šç›´æ¥å‘å¾€åç«¯çš„æ•°æ®åº“ï¼Œåœ¨æ•°æ®åº“ä¸­å¢åˆ æ”¹ã€‚å¯¹äºåˆ  çš„æ•°æ®æ¥è¯´ï¼Œå¦‚æœ Redis å·²ç»ç¼“å­˜äº†ç›¸åº”çš„æ•°æ®ï¼Œåº”ç”¨éœ€è¦æŠŠè¿™äº›ç¼“å­˜çš„æ•°æ®åˆ é™¤ï¼ŒRedis ä¸­å°±æ²¡æœ‰è¿™äº›æ•°æ®äº†ã€‚å½“åº”ç”¨å†æ¬¡è¯»å–è¿™äº›æ•°æ®æ—¶ï¼Œä¼šå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œåº”ç”¨ä¼šæŠŠè¿™äº›æ•°æ®ä»æ•°æ®åº“ä¸­è¯»å‡ºæ¥ï¼Œå¹¶å†™åˆ°ç¼“å­˜ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿™äº›æ•°æ®åç»­å†è¢«è¯»å–æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ï¼Œèƒ½èµ·åˆ°åŠ é€Ÿè®¿é—®çš„æ•ˆæœã€‚ä¸¾ä¸ªä¾‹å­ã€‚å‡è®¾ä¸šåŠ¡åº”ç”¨è¦ä¿®æ”¹æ•°æ® Aï¼Œæ­¤æ—¶ï¼Œæ•°æ® A åœ¨ Redis ä¸­ä¹Ÿç¼“å­˜äº†ï¼Œé‚£ä¹ˆï¼Œåº”ç”¨ä¼šå…ˆç›´æ¥åœ¨æ•°æ®åº“é‡Œä¿®æ”¹ Aï¼Œå¹¶æŠŠ Redis ä¸­çš„ A åˆ é™¤ã€‚ç­‰åˆ°åº”ç”¨éœ€è¦è¯»å–æ•°æ® A æ—¶ï¼Œä¼šå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œæ­¤æ—¶ï¼Œåº”ç”¨ä»æ•°æ®åº“ä¸­è¯»å– Aï¼Œå¹¶å†™å…¥ Redisï¼Œä»¥ä¾¿åç»­è¯·æ±‚ä»ç¼“å­˜ä¸­ç›´æ¥è¯»å–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis75.jpg" alt="avatar"><br>&emsp;&emsp;åªè¯»ç¼“å­˜ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ›´æ–°æ•°æ®çš„å¥½å¤„æ˜¯ï¼Œæ‰€æœ‰æœ€æ–°çš„æ•°æ®éƒ½åœ¨æ•°æ®åº“ä¸­ï¼Œè€Œæ•°æ®åº“æ˜¯æä¾›æ•°æ®å¯é æ€§ä¿éšœçš„ï¼Œè¿™äº›æ•°æ®ä¸ä¼šæœ‰ä¸¢å¤±çš„é£é™©ã€‚å½“æˆ‘ä»¬éœ€è¦ç¼“å­˜å›¾ç‰‡ã€çŸ­è§†é¢‘è¿™äº›ç”¨æˆ·åªè¯»çš„æ•°æ®æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨åªè¯»ç¼“å­˜è¿™ä¸ªç±»å‹äº†ã€‚</p><h2 id="è¯»å†™ç¼“å­˜"><a href="#è¯»å†™ç¼“å­˜" class="headerlink" title="è¯»å†™ç¼“å­˜"></a>è¯»å†™ç¼“å­˜</h2><p>&emsp;&emsp;å¯¹äºè¯»å†™ç¼“å­˜æ¥è¯´ï¼Œé™¤äº†è¯»è¯·æ±‚ä¼šå‘é€åˆ°ç¼“å­˜è¿›è¡Œå¤„ç†ï¼ˆç›´æ¥åœ¨ç¼“å­˜ä¸­æŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨)ï¼Œæ‰€æœ‰çš„å†™è¯·æ±‚ä¹Ÿä¼šå‘é€åˆ°ç¼“å­˜ï¼Œåœ¨ç¼“å­˜ä¸­ç›´æ¥å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹æ“ä½œã€‚æ­¤æ—¶ï¼Œå¾—ç›Šäº Redis çš„é«˜æ€§èƒ½è®¿é—®ç‰¹æ€§ï¼Œæ•°æ®çš„å¢åˆ æ”¹æ“ä½œå¯ä»¥åœ¨ç¼“å­˜ä¸­å¿«é€Ÿå®Œæˆï¼Œå¤„ç†ç»“æœä¹Ÿä¼šå¿«é€Ÿè¿”å›ç»™ä¸šåŠ¡åº”ç”¨ï¼Œè¿™å°±å¯ä»¥æå‡ä¸šåŠ¡åº”ç”¨çš„å“åº”é€Ÿåº¦ã€‚ä½†æ˜¯ï¼Œå’Œåªè¯»ç¼“å­˜ä¸ä¸€æ ·çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨è¯»å†™ç¼“å­˜æ—¶ï¼Œæœ€æ–°çš„æ•°æ®æ˜¯åœ¨ Redis ä¸­ï¼Œè€Œ Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œä¸€æ—¦å‡ºç°æ‰ç”µæˆ–å®•æœºï¼Œå†…å­˜ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨çš„æœ€æ–°æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼Œç»™åº”ç”¨ä¸šåŠ¡å¸¦æ¥é£é™©ã€‚æ‰€ä»¥ï¼Œæ ¹æ®ä¸šåŠ¡åº”ç”¨å¯¹æ•°æ®å¯é æ€§å’Œç¼“å­˜æ€§èƒ½çš„ä¸åŒè¦æ±‚ï¼Œæˆ‘ä»¬ä¼šæœ‰åŒæ­¥ç›´å†™å’Œå¼‚æ­¥å†™å›ä¸¤ç§ç­–ç•¥ã€‚å…¶ä¸­ï¼ŒåŒæ­¥ç›´å†™ç­–ç•¥ä¼˜å…ˆä¿è¯æ•°æ®å¯é æ€§ï¼Œè€Œå¼‚æ­¥å†™å›ç­–ç•¥ä¼˜å…ˆæä¾›å¿«é€Ÿå“åº”ã€‚å­¦ä¹ äº†è§£è¿™ä¸¤ç§ç­–ç•¥ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œåšå‡ºæ­£ç¡®çš„è®¾è®¡é€‰æ‹©ã€‚</p><p>&emsp;&emsp;å…³äºæ˜¯é€‰æ‹©åªè¯»ç¼“å­˜ï¼Œè¿˜æ˜¯è¯»å†™ç¼“å­˜ï¼Œä¸»è¦çœ‹æˆ‘ä»¬å¯¹å†™è¯·æ±‚æ˜¯å¦æœ‰åŠ é€Ÿçš„éœ€æ±‚ã€‚</p><ul><li>å¦‚æœéœ€è¦å¯¹å†™è¯·æ±‚è¿›è¡ŒåŠ é€Ÿï¼Œæˆ‘ä»¬é€‰æ‹©è¯»å†™ç¼“å­˜ï¼›</li><li>å¦‚æœå†™è¯·æ±‚å¾ˆå°‘ï¼Œæˆ–è€…æ˜¯åªéœ€è¦æå‡è¯»è¯·æ±‚çš„å“åº”é€Ÿåº¦çš„è¯ï¼Œæˆ‘ä»¬é€‰æ‹©åªè¯»ç¼“å­˜ã€‚</li></ul><h3 id="åŒæ­¥ç›´å†™"><a href="#åŒæ­¥ç›´å†™" class="headerlink" title="åŒæ­¥ç›´å†™"></a>åŒæ­¥ç›´å†™</h3><p>&emsp;&emsp;å†™è¯·æ±‚å‘ç»™ç¼“å­˜çš„åŒæ—¶ï¼Œä¹Ÿä¼šå‘ç»™åç«¯æ•°æ®åº“è¿›è¡Œå¤„ç†ï¼Œç­‰åˆ°ç¼“å­˜å’Œæ•°æ®åº“éƒ½å†™å®Œæ•°æ®ï¼Œæ‰ç»™å®¢æˆ·ç«¯è¿”å›ã€‚è¿™æ ·ï¼Œå³ä½¿ç¼“å­˜å®•æœºæˆ–å‘ç”Ÿæ•…éšœï¼Œæœ€æ–°çš„æ•°æ®ä»ç„¶ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè¿™å°±æä¾›äº†æ•°æ®å¯é æ€§ä¿è¯ã€‚ä¸è¿‡ï¼ŒåŒæ­¥ç›´å†™ä¼šé™ä½ç¼“å­˜çš„è®¿é—®æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜ä¸­å¤„ç†å†™è¯·æ±‚çš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œè€Œæ•°æ®åº“å¤„ç†å†™è¯·æ±‚çš„é€Ÿåº¦è¾ƒæ…¢ã€‚å³ä½¿ç¼“å­˜å¾ˆå¿«åœ°å¤„ç†äº†å†™è¯·æ±‚ï¼Œä¹Ÿéœ€è¦ç­‰å¾…æ•°æ®åº“å¤„ç†å®Œæ‰€æœ‰çš„å†™è¯·æ±‚ï¼Œæ‰èƒ½ç»™åº”ç”¨è¿”å›ç»“æœï¼Œè¿™å°±å¢åŠ äº†ç¼“å­˜çš„å“åº”å»¶è¿Ÿã€‚</p><h3 id="å¼‚æ­¥å†™å›"><a href="#å¼‚æ­¥å†™å›" class="headerlink" title="å¼‚æ­¥å†™å›"></a>å¼‚æ­¥å†™å›</h3><p>&emsp;&emsp;è€Œå¼‚æ­¥å†™å›ç­–ç•¥ï¼Œåˆ™æ˜¯ä¼˜å…ˆè€ƒè™‘äº†å“åº”å»¶è¿Ÿã€‚æ­¤æ—¶ï¼Œæ‰€æœ‰å†™è¯·æ±‚éƒ½å…ˆåœ¨ç¼“å­˜ä¸­å¤„ç†ã€‚ç­‰åˆ°è¿™äº›å¢æ”¹çš„æ•°æ®è¦è¢«ä»ç¼“å­˜ä¸­æ·˜æ±°å‡ºæ¥æ—¶ï¼Œç¼“å­˜å°†å®ƒä»¬å†™å›åç«¯æ•°æ®åº“ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¤„ç†è¿™äº›æ•°æ®çš„æ“ä½œæ˜¯åœ¨ç¼“å­˜ä¸­è¿›è¡Œçš„ï¼Œå¾ˆå¿«å°±èƒ½å®Œæˆã€‚åªä¸è¿‡ï¼Œå¦‚æœå‘ç”Ÿäº†æ‰ç”µï¼Œè€Œå®ƒä»¬è¿˜æ²¡æœ‰è¢«å†™å›æ•°æ®åº“ï¼Œå°±ä¼šæœ‰ä¸¢å¤±çš„é£é™©äº†ã€‚</p><h1 id="Redis-çš„ç¼“å­˜ç­–ç•¥"><a href="#Redis-çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="Redis çš„ç¼“å­˜ç­–ç•¥"></a>Redis çš„ç¼“å­˜ç­–ç•¥</h1><p><img lazyload src="/images/loading.svg" data-src="redis76.jpg" alt="avatar"></p><ol><li><p>noeviction<br>&emsp;&emsp;é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedis åœ¨ä½¿ç”¨çš„å†…å­˜ç©ºé—´è¶…è¿‡ maxmemory å€¼æ—¶ï¼Œå¹¶ä¸ä¼šæ·˜æ±°æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è®¾å®šçš„ noeviction ç­–ç•¥ã€‚å¯¹åº”åˆ° Redis ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æŒ‡ï¼Œä¸€æ—¦ç¼“å­˜è¢«å†™æ»¡äº†ï¼Œå†æœ‰å†™è¯·æ±‚æ¥æ—¶ï¼ŒRedis ä¸å†æä¾›æœåŠ¡ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é”™è¯¯ã€‚Redis ç”¨ä½œç¼“å­˜æ—¶ï¼Œå®é™…çš„æ•°æ®é›†é€šå¸¸éƒ½æ˜¯å¤§äºç¼“å­˜å®¹é‡çš„ï¼Œæ€»ä¼šæœ‰æ–°çš„æ•°æ®è¦å†™å…¥ç¼“å­˜ï¼Œè¿™ä¸ªç­–ç•¥æœ¬èº«ä¸æ·˜æ±°æ•°æ®ï¼Œä¹Ÿå°±ä¸ä¼šè…¾å‡ºæ–°çš„ç¼“å­˜ç©ºé—´ï¼Œæˆ‘ä»¬ä¸æŠŠå®ƒç”¨åœ¨ Redis ç¼“å­˜ä¸­ã€‚</p></li><li><p>volatileï¼šåªåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¸­è¿›è¡Œåˆ é™¤</p></li><li><ol><li>volatile-ttl åœ¨ç­›é€‰æ—¶ï¼Œä¼šé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼Œæ ¹æ®è¿‡æœŸæ—¶é—´çš„å…ˆåè¿›è¡Œåˆ é™¤ï¼Œè¶Šæ—©è¿‡æœŸçš„è¶Šå…ˆè¢«åˆ é™¤ï¼›</li></ol></li><li><ol start="2"><li>volatile-random åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ä¸­ï¼Œè¿›è¡Œéšæœºåˆ é™¤ï¼›</li></ol></li><li><ol start="3"><li>volatile-lru ä½¿ç”¨ LRU ç®—æ³•ç­›é€‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ï¼›</li></ol></li><li><ol start="4"><li>volatile-lfu ä½¿ç”¨ LFU ç®—æ³•é€‰æ‹©è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼å¯¹ã€‚</li></ol></li></ol><p>&emsp;&emsp;å¦‚æœä¸€ä¸ªé”®å€¼å¯¹è¢«åˆ é™¤ç­–ç•¥é€‰ä¸­äº†ï¼Œå³ä½¿å®ƒçš„è¿‡æœŸæ—¶é—´è¿˜æ²¡åˆ°ï¼Œä¹Ÿéœ€è¦è¢«åˆ  é™¤ã€‚å½“ç„¶ï¼Œå¦‚æœå®ƒçš„è¿‡æœŸæ—¶é—´åˆ°äº†ä½†æœªè¢«ç­–ç•¥é€‰ä¸­ï¼ŒåŒæ ·ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p><ol start="3"><li>allkeysï¼šå¤‡é€‰æ·˜æ±°æ•°æ®èŒƒå›´ï¼Œæ‰©å¤§åˆ°äº†æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ— è®ºè¿™äº›é”®å€¼å¯¹æ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´</li><li><ol><li>allkeys-randomï¼šä»æ‰€æœ‰é”®å€¼å¯¹ä¸­éšæœºé€‰æ‹©å¹¶åˆ é™¤æ•°æ®ï¼›</li></ol></li><li><ol start="2"><li>allkeys-lruï¼šä½¿ç”¨ LRU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰ï¼›</li></ol></li><li><ol start="3"><li>allkeys-lfuï¼šä½¿ç”¨ LFU ç®—æ³•åœ¨æ‰€æœ‰æ•°æ®ä¸­è¿›è¡Œç­›é€‰ã€‚</li></ol></li></ol><h2 id="å¦‚ä½•å¤„ç†è¢«æ·˜æ±°çš„æ•°æ®ï¼Ÿ"><a href="#å¦‚ä½•å¤„ç†è¢«æ·˜æ±°çš„æ•°æ®ï¼Ÿ" class="headerlink" title="å¦‚ä½•å¤„ç†è¢«æ·˜æ±°çš„æ•°æ®ï¼Ÿ"></a>å¦‚ä½•å¤„ç†è¢«æ·˜æ±°çš„æ•°æ®ï¼Ÿ</h2><p>&emsp;&emsp;ä¸€èˆ¬æ¥è¯´ï¼Œä¸€æ—¦è¢«æ·˜æ±°çš„æ•°æ®é€‰å®šåï¼Œå¦‚æœè¿™ä¸ªæ•°æ®æ˜¯å¹²å‡€æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç›´æ¥åˆ é™¤ï¼›å¦‚æœè¿™ä¸ªæ•°æ®æ˜¯è„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒå†™å›æ•°æ®åº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis77.jpg" alt="avatar"><br>é‚£æ€ä¹ˆåˆ¤æ–­ä¸€ä¸ªæ•°æ®åˆ°åº•æ˜¯å¹²å‡€çš„è¿˜æ˜¯è„çš„å‘¢ï¼Ÿå¹²å‡€æ•°æ®å’Œè„æ•°æ®çš„åŒºåˆ«å°±åœ¨äºï¼Œå’Œæœ€åˆä»åç«¯æ•°æ®åº“é‡Œè¯»å–æ—¶çš„å€¼ç›¸æ¯”ï¼Œæœ‰æ²¡æœ‰è¢«ä¿®æ”¹è¿‡ã€‚å¹²å‡€æ•°æ®ä¸€ç›´æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥åç«¯æ•°æ®åº“é‡Œçš„æ•°æ®ä¹Ÿæ˜¯æœ€æ–°å€¼ã€‚åœ¨æ›¿æ¢æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç›´æ¥åˆ é™¤ã€‚è€Œè„æ•°æ®å°±æ˜¯æ›¾ç»è¢«ä¿®æ”¹è¿‡çš„ï¼Œå·²ç»å’Œåç«¯æ•°æ®åº“ä¸­ä¿å­˜çš„æ•°æ®ä¸ä¸€è‡´äº†ã€‚æ­¤æ—¶ï¼Œå¦‚æœä¸æŠŠè„æ•°æ®å†™å›åˆ°æ•°æ®åº“ä¸­ï¼Œè¿™ä¸ªæ•°æ®çš„æœ€æ–°å€¼å°±ä¸¢å¤±äº†ï¼Œå°±ä¼šå½±å“åº”ç”¨çš„æ­£å¸¸ä½¿ç”¨ã€‚</p><h1 id="ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´é—®é¢˜"><a href="#ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´é—®é¢˜" class="headerlink" title="ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´é—®é¢˜"></a>ç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸€è‡´é—®é¢˜</h1><h2 id="æ•°æ®ä¸€è‡´æ€§"><a href="#æ•°æ®ä¸€è‡´æ€§" class="headerlink" title="æ•°æ®ä¸€è‡´æ€§"></a>æ•°æ®ä¸€è‡´æ€§</h2><p>â€œä¸€è‡´æ€§â€åŒ…å«äº†ä¸¤ç§æƒ…å†µï¼š</p><ol><li>ç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œé‚£ä¹ˆï¼Œç¼“å­˜çš„æ•°æ®å€¼éœ€è¦å’Œæ•°æ®åº“ä¸­çš„å€¼ç›¸åŒï¼›</li><li>ç¼“å­˜ä¸­æœ¬èº«æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆï¼Œæ•°æ®åº“ä¸­çš„å€¼å¿…é¡»æ˜¯æœ€æ–°å€¼ã€‚</li></ol><h2 id="åªè¯»ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜"><a href="#åªè¯»ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜" class="headerlink" title="åªè¯»ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜"></a>åªè¯»ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜</h2><h3 id="æ–°å¢æ•°æ®"><a href="#æ–°å¢æ•°æ®" class="headerlink" title="æ–°å¢æ•°æ®"></a>æ–°å¢æ•°æ®</h3><p>&emsp;&emsp;å¦‚æœæ˜¯æ–°å¢æ•°æ®ï¼Œæ•°æ®ä¼šç›´æ¥å†™åˆ°æ•°æ®åº“ä¸­ï¼Œä¸ç”¨å¯¹ç¼“å­˜åšä»»ä½•æ“ä½œï¼Œæ­¤æ—¶ï¼Œç¼“å­˜ä¸­æœ¬èº«å°±æ²¡æœ‰æ–°å¢æ•°æ®ï¼Œè€Œæ•°æ®åº“ä¸­æ˜¯æœ€æ–°å€¼ï¼Œè¿™ç§æƒ…å†µç¬¦åˆæˆ‘ä»¬åˆšåˆšæ‰€è¯´çš„ä¸€è‡´æ€§çš„ç¬¬ 2 ç§æƒ…å†µï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚</p><h3 id="åˆ æ”¹æ•°æ®"><a href="#åˆ æ”¹æ•°æ®" class="headerlink" title="åˆ æ”¹æ•°æ®"></a>åˆ æ”¹æ•°æ®</h3><p>&emsp;&emsp;å¦‚æœå‘ç”Ÿåˆ æ”¹æ“ä½œï¼Œåº”ç”¨æ—¢è¦æ›´æ–°æ•°æ®åº“ï¼Œä¹Ÿè¦åœ¨ç¼“å­˜ä¸­åˆ é™¤æ•°æ®ã€‚è¿™ä¸¤ä¸ªæ“ä½œå¦‚æœæ— æ³•ä¿è¯åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦ä¸éƒ½å®Œæˆï¼Œè¦ä¸éƒ½æ²¡å®Œæˆï¼Œæ­¤æ—¶ï¼Œå°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´é—®é¢˜äº†ã€‚</p><ul><li><p>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“<br>æˆ‘ä»¬å‡è®¾åº”ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œå¦‚æœç¼“å­˜åˆ é™¤æˆåŠŸï¼Œä½†æ˜¯æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆï¼Œåº”ç”¨å†è®¿é—®æ•°æ®æ—¶ï¼Œç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±ä¼šå‘ç”Ÿç¼“å­˜ç¼ºå¤±ã€‚ç„¶åï¼Œåº”ç”¨å†è®¿é—®æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­çš„å€¼ä¸ºæ—§å€¼ï¼Œåº”ç”¨å°±è®¿é—®åˆ°æ—§å€¼äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis78.jpg" alt="avatar"><br>&emsp;&emsp;åº”ç”¨è¦æŠŠæ•°æ® X çš„å€¼ä» 10 æ›´æ–°ä¸º 3ï¼Œå…ˆåœ¨ Redis ç¼“å­˜ä¸­åˆ é™¤äº† X çš„ç¼“å­˜å€¼ï¼Œä½†æ˜¯æ›´æ–°æ•°æ®åº“å´å¤±è´¥äº†ã€‚å¦‚æœæ­¤æ—¶æœ‰å…¶ä»–å¹¶å‘çš„è¯·æ±‚è®¿é—® Xï¼Œä¼šå‘ç° Redis ä¸­ç¼“å­˜ç¼ºå¤±ï¼Œç´§æ¥ç€ï¼Œè¯·æ±‚å°±ä¼šè®¿é—®æ•°æ®åº“ï¼Œè¯»åˆ°çš„å´æ˜¯æ—§å€¼ 10ã€‚</p></li><li><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜<br>&emsp;&emsp;å¦‚æœåº”ç”¨å…ˆå®Œæˆäº†æ•°æ®åº“çš„æ›´æ–°ï¼Œä½†æ˜¯ï¼Œåœ¨åˆ é™¤ç¼“å­˜æ—¶å¤±è´¥äº†ï¼Œé‚£ä¹ˆï¼Œæ•°æ®åº“ä¸­çš„å€¼æ˜¯æ–°å€¼ï¼Œè€Œç¼“å­˜ä¸­çš„æ˜¯æ—§å€¼ï¼Œè¿™è‚¯å®šæ˜¯ä¸ä¸€è‡´çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæœ‰å…¶ä»–çš„å¹¶å‘è¯·æ±‚æ¥è®¿é—®æ•°æ®ï¼ŒæŒ‰ç…§æ­£å¸¸çš„ç¼“å­˜è®¿é—®æµç¨‹ï¼Œå°±ä¼šå…ˆåœ¨ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œä½†æ­¤æ—¶ï¼Œå°±ä¼šè¯»åˆ°æ—§å€¼äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis79.jpg" alt="avatar"><br>&emsp;&emsp;åº”ç”¨è¦æŠŠæ•°æ® X çš„å€¼ä» 10 æ›´æ–°ä¸º 3ï¼Œå…ˆæˆåŠŸæ›´æ–°äº†æ•°æ®åº“ï¼Œç„¶ååœ¨ Redis ç¼“å­˜ä¸­åˆ é™¤ X çš„ç¼“å­˜ï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œå´å¤±è´¥äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ•°æ®åº“ä¸­ X çš„æ–°å€¼ä¸º 3ï¼ŒRedis ä¸­çš„ X çš„ç¼“å­˜å€¼ä¸º 10ï¼Œè¿™è‚¯å®šæ˜¯ä¸ä¸€è‡´çš„ã€‚å¦‚æœåˆšå¥½æ­¤æ—¶æœ‰å…¶ä»–å®¢æˆ·ç«¯ä¹Ÿå‘é€è¯·æ±‚è®¿é—® Xï¼Œä¼šå…ˆåœ¨ Redis ä¸­æŸ¥è¯¢ï¼Œè¯¥å®¢æˆ·ç«¯ä¼šå‘ç°ç¼“å­˜å‘½ä¸­ï¼Œä½†æ˜¯è¯»åˆ°çš„å´æ˜¯æ—§å€¼ 10ã€‚</p></li></ul><p>&emsp;&emsp;æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ›´æ–°æ•°æ®åº“å’Œåˆ é™¤ç¼“å­˜å€¼çš„è¿‡ç¨‹ä¸­ï¼Œæ— è®ºè¿™ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºè°å…ˆè°åï¼Œåªè¦æœ‰ä¸€ä¸ªæ“ä½œå¤±è´¥äº†ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¯»å–åˆ°æ—§å€¼ã€‚ä¸‹é¢è¿™å¼ è¡¨æ€»ç»“äº†åˆšåˆšæ‰€è¯´çš„è¿™ä¸¤ç§æƒ…å†µã€‚<br><img lazyload src="/images/loading.svg" data-src="redis80.jpg" alt="avatar"></p><h4 id="å¦‚ä½•è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ"></a>å¦‚ä½•è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Ÿ</h4><p><strong>é‡è¯•æœºåˆ¶</strong>ï¼šå…·ä½“æ¥è¯´ï¼Œå¯ä»¥æŠŠè¦åˆ é™¤çš„ç¼“å­˜å€¼æˆ–è€…æ˜¯è¦æ›´æ–°çš„æ•°æ®åº“å€¼æš‚å­˜åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ˆä¾‹å¦‚ä½¿ç”¨ Kafka æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€‚å½“åº”ç”¨æ²¡æœ‰èƒ½å¤ŸæˆåŠŸåœ°åˆ é™¤ç¼“å­˜å€¼æˆ–è€…æ˜¯æ›´æ–°æ•°æ®åº“å€¼æ—¶ï¼Œå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–è¿™äº›å€¼ï¼Œç„¶åå†æ¬¡è¿›è¡Œåˆ é™¤æˆ–æ›´æ–°ã€‚<br>&emsp;&emsp;å¦‚æœèƒ½å¤ŸæˆåŠŸåœ°åˆ é™¤æˆ–æ›´æ–°ï¼Œæˆ‘ä»¬å°±è¦æŠŠè¿™äº›å€¼ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»é™¤ï¼Œä»¥å…é‡å¤æ“ä½œï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿è¯æ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®ä¸€è‡´äº†ã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†æ¬¡è¿›è¡Œé‡è¯•ã€‚å¦‚æœé‡è¯•è¶…è¿‡çš„ä¸€å®šæ¬¡æ•°ï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œæˆ‘ä»¬å°±éœ€è¦å‘ä¸šåŠ¡å±‚å‘é€æŠ¥é”™ä¿¡æ¯äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis81.jpg" alt="avatar"></p><p><strong>å¹¶å‘æƒ…å†µä¸‹æ€æ ·è§£å†³</strong></p><ul><li>æƒ…å†µä¸€ï¼šå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“<br>&emsp;&emsp;å‡è®¾çº¿ç¨‹ A åˆ é™¤ç¼“å­˜å€¼åï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠæ›´æ–°æ•°æ®åº“ï¼ˆæ¯”å¦‚è¯´æœ‰ç½‘ç»œå»¶è¿Ÿï¼‰ï¼Œçº¿ç¨‹ B å°±å¼€å§‹è¯»å–æ•°æ®äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œçº¿ç¨‹ B ä¼šå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œå°±åªèƒ½å»æ•°æ®åº“è¯»å–ã€‚è¿™ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</li></ul><ol><li>çº¿ç¨‹ B è¯»å–åˆ°äº†æ—§å€¼ï¼›</li><li>çº¿ç¨‹ B æ˜¯åœ¨ç¼“å­˜ç¼ºå¤±çš„æƒ…å†µä¸‹è¯»å–çš„æ•°æ®åº“ï¼Œæ‰€ä»¥ï¼Œå®ƒè¿˜ä¼šæŠŠæ—§å€¼å†™å…¥ç¼“å­˜ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹ä»ç¼“å­˜ä¸­è¯»åˆ°æ—§å€¼ã€‚<br>&emsp;&emsp;ç­‰åˆ°çº¿ç¨‹ B ä»æ•°æ®åº“è¯»å–å®Œæ•°æ®ã€æ›´æ–°äº†ç¼“å­˜åï¼Œçº¿ç¨‹ A æ‰å¼€å§‹æ›´æ–°æ•°æ®åº“ï¼Œæ­¤æ—¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ—§å€¼ï¼Œè€Œæ•°æ®åº“ä¸­çš„æ˜¯æœ€æ–°å€¼ï¼Œä¸¤è€…å°±ä¸ä¸€è‡´äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis82.jpg" alt="avatar"></li></ol><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨çº¿ç¨‹ A æ›´æ–°å®Œæ•°æ®åº“å€¼ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒå…ˆ sleep ä¸€å°æ®µæ—¶é—´ï¼Œå†è¿›è¡Œä¸€æ¬¡ç¼“å­˜åˆ é™¤æ“ä½œã€‚<br>&emsp;&emsp;ä¹‹æ‰€ä»¥è¦åŠ ä¸Š sleep çš„è¿™æ®µæ—¶é—´ï¼Œå°±æ˜¯ä¸ºäº†è®©çº¿ç¨‹ B èƒ½å¤Ÿå…ˆä»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†æŠŠç¼ºå¤±çš„æ•°æ®å†™å…¥ç¼“å­˜ï¼Œç„¶åï¼Œçº¿ç¨‹ A å†è¿›è¡Œåˆ é™¤ã€‚æ‰€ä»¥ï¼Œçº¿ç¨‹ A sleep çš„æ—¶é—´ï¼Œå°±éœ€è¦å¤§äºçº¿ç¨‹ B è¯»å–æ•°æ®å†å†™å…¥ç¼“å­˜çš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´æ€ä¹ˆç¡®å®šå‘¢ï¼Ÿå»ºè®®ä½ åœ¨ä¸šåŠ¡ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œç»Ÿè®¡ä¸‹çº¿ç¨‹è¯»æ•°æ®å’Œå†™ç¼“å­˜çš„æ“ä½œæ—¶é—´ï¼Œä»¥æ­¤ä¸ºåŸºç¡€æ¥è¿›è¡Œä¼°ç®—ã€‚è¿™æ ·ä¸€æ¥ï¼Œå…¶å®ƒçº¿ç¨‹è¯»å–æ•°æ®æ—¶ï¼Œä¼šå‘ç°ç¼“å­˜ç¼ºå¤±ï¼Œæ‰€ä»¥ä¼šä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°å€¼ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ¡ˆä¼šåœ¨ç¬¬ä¸€æ¬¡åˆ é™¤ç¼“å­˜å€¼åï¼Œå»¶è¿Ÿä¸€æ®µæ—¶é—´å†æ¬¡è¿›è¡Œåˆ é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹ŸæŠŠå®ƒå«åšâ€œå»¶è¿ŸåŒåˆ â€ã€‚ä¸‹é¢çš„è¿™æ®µä¼ªä»£ç å°±æ˜¯â€œå»¶è¿ŸåŒåˆ â€æ–¹æ¡ˆçš„ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis.delKey(X) // å…ˆåˆ é™¤ç¼“å­˜</span><br><span class="line">db.update(X)// å†æ›´æ–°æ•°æ®åº“</span><br><span class="line">Thread.sleep(N) // ç¡çœ ä¸€ä¼šå„¿</span><br><span class="line">redis.delKey(X) // å†åˆ é™¤ä¸€éç¼“å­˜ï¼Œç¡®ä¿ä¹‹åç¼“å­˜ä¸­çš„æ•°æ®æ˜¯æ›´æ–°åçš„</span><br></pre></td></tr></table></figure><ul><li>æƒ…å†µäºŒï¼šå…ˆæ›´æ–°æ•°æ®åº“å€¼ï¼Œå†åˆ é™¤ç¼“å­˜å€¼<br>&emsp;&emsp;å¦‚æœçº¿ç¨‹ A åˆ é™¤äº†æ•°æ®åº“ä¸­çš„å€¼ï¼Œä½†è¿˜æ²¡æ¥å¾—åŠåˆ é™¤ç¼“å­˜å€¼ï¼Œçº¿ç¨‹ B å°±å¼€å§‹è¯»å–æ•°æ®äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œçº¿ç¨‹ B æŸ¥è¯¢ç¼“å­˜æ—¶ï¼Œå‘ç°ç¼“å­˜å‘½ä¸­ï¼Œå°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–æ—§å€¼ã€‚ä¸è¿‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶ä»–çº¿ç¨‹å¹¶å‘è¯»ç¼“å­˜çš„è¯·æ±‚ä¸å¤šï¼Œé‚£ä¹ˆï¼Œå°±ä¸ä¼šæœ‰å¾ˆå¤šè¯·æ±‚è¯»å–åˆ°æ—§å€¼ã€‚è€Œä¸”ï¼Œçº¿ç¨‹ A ä¸€èˆ¬ä¹Ÿä¼šå¾ˆå¿«åˆ é™¤ç¼“å­˜å€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…¶ä»–çº¿ç¨‹å†æ¬¡è¯»å–æ—¶ï¼Œå°±ä¼šå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œè¿›è€Œä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°å€¼ã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µå¯¹ä¸šåŠ¡çš„å½±å“è¾ƒå°ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis83.jpg" alt="avatar"></li></ul><p>&emsp;&emsp;æ€»ç»“ä¸€ä¸‹ä¸Šè¿°çš„è§£å†³æ–¹æ¡ˆï¼š</p><ol><li>åˆ é™¤ç¼“å­˜å’Œæ›´æ–°æ•°æ®åº“çš„â€œåŸå­â€æ“ä½œï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå½“å‰ä¸€ä¸ªäº‹ä»¶å®Œæˆåç«‹å³å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æŠ•é€’æ¶ˆæ¯ï¼Œåªæœ‰å½“åç»­äº‹ä»¶æˆåŠŸæ‰æ¶ˆè´¹æ‰è¿™ä¸ªæ¶ˆæ¯ï¼Œé¿å…ä¹‹åçš„äº‹ä»¶å› ä¸ºå¤±è´¥è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼›</li><li>å¦‚æœé‡‡ç”¨å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“çš„ç­–ç•¥ï¼Œä½¿ç”¨â€œå»¶è¿ŸåŒåˆ â€æ–¹æ¡ˆï¼šç¡®ä¿ç¼“å­˜ä¸­çš„æ•°æ®æœ€ç»ˆä¸€å®šå’Œæ•°æ®åº“ä¸€è‡´ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis84.jpg" alt="avatar"></li></ol><h2 id="è¯»å†™ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜"><a href="#è¯»å†™ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜" class="headerlink" title="è¯»å†™ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜"></a>è¯»å†™ç¼“å­˜çš„æ•°æ®ä¸€è‡´é—®é¢˜</h2><p>&emsp;&emsp;è¿™ç§æƒ…å†µåˆ æ”¹æ“ä½œåŒæ—¶æ“ä½œæ•°æ®åº“å’Œç¼“å­˜ã€‚</p><h3 id="æ–°å¢æ•°æ®-1"><a href="#æ–°å¢æ•°æ®-1" class="headerlink" title="æ–°å¢æ•°æ®"></a>æ–°å¢æ•°æ®</h3><p>&emsp;&emsp;åŒåªè¯»ç¼“å­˜</p><h3 id="åˆ æ”¹æ•°æ®-1"><a href="#åˆ æ”¹æ•°æ®-1" class="headerlink" title="åˆ æ”¹æ•°æ®"></a>åˆ æ”¹æ•°æ®</h3><ul><li><strong>é‡è¯•æœºåˆ¶</strong>ï¼šåŒåªè¯»ç¼“å­˜</li></ul><ol><li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼šå¦‚æœæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œä½†ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æœ€æ–°å€¼ï¼Œä½†ç¼“å­˜ä¸­æ˜¯æ—§å€¼ï¼Œåç»­çš„è¯»è¯·æ±‚ä¼šç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œå¾—åˆ°çš„æ˜¯æ—§å€¼ã€‚  </li><li>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼šå¦‚æœæ›´æ–°ç¼“å­˜æˆåŠŸï¼Œä½†æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œæ­¤æ—¶ç¼“å­˜ä¸­æ˜¯æœ€æ–°å€¼ï¼Œæ•°æ®åº“ä¸­æ˜¯æ—§å€¼ï¼Œåç»­è¯»è¯·æ±‚ä¼šç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œä½†å¾—åˆ°çš„æ˜¯æœ€æ–°å€¼ï¼ŒçŸ­æœŸå¯¹ä¸šåŠ¡å½±å“ä¸å¤§ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦ç¼“å­˜è¿‡æœŸæˆ–è€…æ»¡å®¹åè¢«æ·˜æ±°ï¼Œè¯»è¯·æ±‚å°±ä¼šä»æ•°æ®åº“ä¸­é‡æ–°åŠ è½½æ—§å€¼åˆ°ç¼“å­˜ä¸­ï¼Œä¹‹åçš„è¯»è¯·æ±‚ä¼šä»ç¼“å­˜ä¸­å¾—åˆ°æ—§å€¼ï¼Œå¯¹ä¸šåŠ¡äº§ç”Ÿå½±å“ã€‚  </li></ol><p>&emsp;&emsp;åŒæ ·åœ°ï¼Œé’ˆå¯¹è¿™ç§å…¶ä¸­ä¸€ä¸ªæ“ä½œå¯èƒ½å¤±è´¥çš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é‡è¯•æœºåˆ¶è§£å†³ï¼ŒæŠŠç¬¬äºŒæ­¥æ“ä½œæ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºæ¶ˆæ¯ï¼Œå†æ›´æ–°ç¼“å­˜æˆ–æ•°æ®åº“ï¼ŒæˆåŠŸåæŠŠæ¶ˆæ¯ä»æ¶ˆæ¯é˜Ÿåˆ—åˆ é™¤ï¼Œå¦åˆ™è¿›è¡Œé‡è¯•ï¼Œä»¥æ­¤è¾¾åˆ°æ•°æ®åº“å’Œç¼“å­˜çš„æœ€ç»ˆä¸€è‡´ã€‚</p><p><strong>å¹¶å‘æƒ…å†µä¸‹æ€æ ·è§£å†³</strong></p><ol><li><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Œå†™+è¯»å¹¶å‘ï¼šçº¿ç¨‹Aå…ˆæ›´æ–°æ•°æ®åº“ï¼Œä¹‹åçº¿ç¨‹Bè¯»å–æ•°æ®ï¼Œæ­¤æ—¶çº¿ç¨‹Bä¼šå‘½ä¸­ç¼“å­˜ï¼Œè¯»å–åˆ°æ—§å€¼ï¼Œä¹‹åçº¿ç¨‹Aæ›´æ–°ç¼“å­˜æˆåŠŸï¼Œåç»­çš„è¯»è¯·æ±‚ä¼šå‘½ä¸­ç¼“å­˜å¾—åˆ°æœ€æ–°å€¼ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹Aæœªæ›´æ–°å®Œç¼“å­˜ä¹‹å‰ï¼Œåœ¨è¿™æœŸé—´çš„è¯»è¯·æ±‚ä¼šçŸ­æš‚è¯»åˆ°æ—§å€¼ï¼Œå¯¹ä¸šåŠ¡çŸ­æš‚å½±å“ã€‚</p></li><li><p>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œå†™+è¯»å¹¶å‘ï¼šçº¿ç¨‹Aå…ˆæ›´æ–°ç¼“å­˜æˆåŠŸï¼Œä¹‹åçº¿ç¨‹Bè¯»å–æ•°æ®ï¼Œæ­¤æ—¶çº¿ç¨‹Bå‘½ä¸­ç¼“å­˜ï¼Œè¯»å–åˆ°æœ€æ–°å€¼åè¿”å›ï¼Œä¹‹åçº¿ç¨‹Aæ›´æ–°æ•°æ®åº“æˆåŠŸã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œè™½ç„¶çº¿ç¨‹Aè¿˜æœªæ›´æ–°å®Œæ•°æ®åº“ï¼Œæ•°æ®åº“ä¼šä¸ç¼“å­˜å­˜åœ¨çŸ­æš‚ä¸ä¸€è‡´ï¼Œä½†åœ¨è¿™ä¹‹å‰è¿›æ¥çš„è¯»è¯·æ±‚éƒ½èƒ½ç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œè·å–åˆ°æœ€æ–°å€¼ï¼Œæ‰€ä»¥å¯¹ä¸šåŠ¡æ²¡å½±å“ã€‚</p></li><li><p>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ï¼Œå†™+å†™å¹¶å‘ï¼šçº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ›´æ–°åŒä¸€æ¡æ•°æ®ï¼Œå‡å¦‚æ›´æ–°æ•°æ®åº“çš„é¡ºåºæ˜¯å…ˆAåBï¼Œä½†æ›´æ–°ç¼“å­˜æ—¶é¡ºåºæ˜¯å…ˆBåAï¼Œè¿™ä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜çš„ä¸ä¸€è‡´ã€‚</p></li><li><p>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Œå†™+å†™å¹¶å‘ï¼šä¸åœºæ™¯3ç±»ä¼¼ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹BåŒæ—¶æ›´æ–°åŒä¸€æ¡æ•°æ®ï¼Œå‡å¦‚æ›´æ–°ç¼“å­˜çš„é¡ºåºæ˜¯å…ˆAåBï¼Œä½†æ˜¯æ›´æ–°æ•°æ®åº“çš„é¡ºåºæ˜¯å…ˆBåAï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜çš„ä¸ä¸€è‡´ã€‚</p></li></ol><p>æ€»ç»“ï¼šåœºæ™¯1å’Œ2å¯¹ä¸šåŠ¡å½±å“è¾ƒå°ï¼Œåœºæ™¯3å’Œ4ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´ï¼Œå½±å“è¾ƒå¤§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¯»å†™ç¼“å­˜æ¨¡å¼ä¸‹ï¼Œå†™+è¯»å¹¶å‘å¯¹ä¸šåŠ¡çš„å½±å“è¾ƒå°ï¼Œè€Œå†™+å†™å¹¶å‘æ—¶ï¼Œä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜çš„ä¸ä¸€è‡´ã€‚é’ˆå¯¹åœºæ™¯3å’Œ4çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå¯¹äºå†™è¯·æ±‚ï¼Œéœ€è¦é…åˆåˆ†å¸ƒå¼é”ä½¿ç”¨ã€‚å†™è¯·æ±‚è¿›æ¥æ—¶ï¼Œé’ˆå¯¹åŒä¸€ä¸ªèµ„æºçš„ä¿®æ”¹æ“ä½œï¼Œå…ˆåŠ åˆ†å¸ƒå¼é”ï¼Œè¿™æ ·åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜ï¼Œæ²¡æœ‰æ‹¿åˆ°é”çš„çº¿ç¨‹æŠŠæ“ä½œæ”¾å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼Œå»¶æ—¶å¤„ç†ã€‚ç”¨è¿™ç§æ–¹å¼ä¿è¯å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€èµ„æºçš„é¡ºåºæ€§ï¼Œä»¥æ­¤ä¿è¯ä¸€è‡´æ€§ã€‚ç»¼ä¸Šï¼Œä½¿ç”¨è¯»å†™ç¼“å­˜åŒæ—¶æ“ä½œæ•°æ®åº“å’Œç¼“å­˜æ—¶ï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªæ“ä½œå¤±è´¥å¯¼è‡´ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>é‡è¯•æ¥è§£å†³ã€‚è€Œåœ¨å¹¶å‘çš„åœºæ™¯ä¸‹ï¼Œè¯»+å†™å¹¶å‘å¯¹ä¸šåŠ¡æ²¡æœ‰å½±å“æˆ–è€…å½±å“è¾ƒå°ï¼Œè€Œ<strong>å†™+å†™å¹¶å‘æ—¶éœ€è¦é…åˆåˆ†å¸ƒå¼é”</strong>çš„ä½¿ç”¨ï¼Œæ‰èƒ½ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚</p><p>&emsp;&emsp;å¦å¤–ï¼Œè¯»å†™ç¼“å­˜æ¨¡å¼ç”±äºä¼šåŒæ—¶æ›´æ–°æ•°æ®åº“å’Œç¼“å­˜ï¼Œä¼˜ç‚¹æ˜¯ï¼Œç¼“å­˜ä¸­ä¸€ç›´ä¼šæœ‰æ•°æ®ï¼Œå¦‚æœæ›´æ–°æ“ä½œåä¼šç«‹å³å†æ¬¡è®¿é—®ï¼Œå¯ä»¥ç›´æ¥å‘½ä¸­ç¼“å­˜ï¼Œèƒ½å¤Ÿé™ä½è¯»è¯·æ±‚å¯¹äºæ•°æ®åº“çš„å‹åŠ›ï¼ˆæ²¡æœ‰äº†åªè¯»ç¼“å­˜çš„åˆ é™¤ç¼“å­˜å¯¼è‡´ç¼“å­˜ç¼ºå¤±å’Œå†åŠ è½½çš„è¿‡ç¨‹ï¼‰ã€‚ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœæ›´æ–°åçš„æ•°æ®ï¼Œä¹‹åå¾ˆå°‘å†è¢«è®¿é—®åˆ°ï¼Œä¼šå¯¼è‡´ç¼“å­˜ä¸­ä¿ç•™çš„ä¸æ˜¯æœ€çƒ­çš„æ•°æ®ï¼Œç¼“å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼ˆåªè¯»ç¼“å­˜ä¸­ä¿ç•™çš„éƒ½æ˜¯çƒ­æ•°æ®ï¼‰ï¼Œæ‰€ä»¥è¯»å†™ç¼“å­˜æ¯”è¾ƒé€‚åˆç”¨äºè¯»å†™ç›¸å½“çš„ä¸šåŠ¡åœºæ™¯ã€‚</p><h1 id="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ"></a>å¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ã€å‡»ç©¿ã€ç©¿é€éš¾é¢˜ï¼Ÿ</h1><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><p>&emsp;&emsp;ç¼“å­˜é›ªå´©æ˜¯æŒ‡å¤§é‡çš„åº”ç”¨è¯·æ±‚æ— æ³•åœ¨ Redis ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œç´§æ¥ç€ï¼Œåº”ç”¨å°†å¤§é‡è¯·æ±‚å‘é€åˆ°æ•°æ®åº“å±‚ï¼Œå¯¼è‡´æ•°æ®åº“å±‚çš„å‹åŠ›æ¿€å¢ã€‚ç¼“å­˜é›ªå´©ä¸€èˆ¬æ˜¯ç”±ä¸¤ä¸ªåŸå› å¯¼è‡´çš„ï¼Œåº”å¯¹æ–¹æ¡ˆä¹Ÿæœ‰æ‰€ä¸åŒï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹ã€‚</p><ol><li>ç¬¬ä¸€ä¸ªåŸå› æ˜¯ï¼šç¼“å­˜ä¸­æœ‰å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ— æ³•å¾—åˆ°å¤„ç†ã€‚</li></ol><p><strong>å¦‚ä½•é¿å…</strong>ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ç»™å¤§é‡çš„æ•°æ®è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´ã€‚å¦‚æœä¸šåŠ¡å±‚çš„ç¡®è¦æ±‚æœ‰äº›æ•°æ®åŒæ—¶å¤±æ•ˆï¼Œä½ å¯ä»¥åœ¨ç”¨ EXPIRE å‘½ä»¤ç»™æ¯ä¸ªæ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œç»™è¿™äº›æ•°æ®çš„è¿‡æœŸæ—¶é—´å¢åŠ ä¸€ä¸ªè¾ƒå°çš„éšæœºæ•°ï¼ˆä¾‹å¦‚ï¼Œéšæœºå¢åŠ  1~3 åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸åŒæ•°æ®çš„è¿‡æœŸæ—¶é—´æœ‰æ‰€å·®åˆ«ï¼Œä½†å·®åˆ«åˆä¸ä¼šå¤ªå¤§ï¼Œæ—¢é¿å…äº†å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†è¿™äº›æ•°æ®åŸºæœ¬åœ¨ç›¸è¿‘çš„æ—¶é—´å¤±æ•ˆï¼Œä»ç„¶èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚é™¤äº†å¾®è°ƒè¿‡æœŸæ—¶é—´ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<strong>æœåŠ¡é™çº§</strong>ï¼Œæ¥åº”å¯¹ç¼“å­˜é›ªå´©ã€‚æ‰€è°“çš„æœåŠ¡é™çº§ï¼Œæ˜¯æŒ‡å‘ç”Ÿç¼“å­˜é›ªå´©æ—¶ï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®é‡‡å–ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯éæ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“å±æ€§ï¼‰æ—¶ï¼Œæš‚æ—¶åœæ­¢ä»ç¼“å­˜ä¸­æŸ¥è¯¢è¿™äº›æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é¢„å®šä¹‰ä¿¡æ¯ã€ç©ºå€¼æˆ–æ˜¯é”™è¯¯ä¿¡æ¯ï¼›å½“ä¸šåŠ¡åº”ç”¨è®¿é—®çš„æ˜¯æ ¸å¿ƒæ•°æ®ï¼ˆä¾‹å¦‚ç”µå•†å•†å“åº“å­˜ï¼‰æ—¶ï¼Œä»ç„¶å…è®¸æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ ç¼ºå¤±ï¼Œä¹Ÿå¯ä»¥ç»§ç»­é€šè¿‡æ•°æ®åº“è¯»å–ã€‚<br>&emsp;&emsp;è¿™æ ·ä¸€æ¥ï¼Œåªæœ‰éƒ¨åˆ†è¿‡æœŸæ•°æ®çš„è¯·æ±‚ä¼šå‘é€åˆ°æ•°æ®åº“ï¼Œæ•°æ®åº“çš„å‹åŠ›å°±æ²¡æœ‰é‚£ä¹ˆå¤§äº†ã€‚ä¸‹é¢è¿™å¼ å›¾æ˜¾ç¤ºçš„æ˜¯æœåŠ¡é™çº§æ—¶æ•°æ®è¯·æ±‚çš„æ‰§è¡Œæƒ…å†µï¼š<br><img lazyload src="/images/loading.svg" data-src="redis85.jpg" alt="avatar"><br>2. Redis ç¼“å­˜å®ä¾‹å‘ç”Ÿæ•…éšœå®•æœºäº†ï¼Œæ— æ³•å¤„ç†è¯·æ±‚ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡è¯·æ±‚ä¸€ä¸‹å­ç§¯å‹åˆ°æ•°æ®åº“å±‚ï¼Œä»è€Œå‘ç”Ÿç¼“å­˜é›ªå´©ã€‚<br><strong>å¦‚ä½•é¿å…</strong>ï¼š<strong>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­å®ç°æœåŠ¡ç†”æ–­æˆ–è¯·æ±‚é™æµæœºåˆ¶</strong>ï¼Œæ‰€è°“çš„æœåŠ¡ç†”æ–­ï¼Œæ˜¯æŒ‡åœ¨å‘ç”Ÿç¼“å­˜é›ªå´©æ—¶ï¼Œä¸ºäº†é˜²æ­¢å¼•å‘è¿é”çš„æ•°æ®åº“é›ªå´©ï¼Œç”šè‡³æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒï¼Œæˆ‘ä»¬æš‚åœä¸šåŠ¡åº”ç”¨å¯¹ç¼“å­˜ç³»ç»Ÿçš„æ¥å£è®¿é—®ã€‚å†å…·ä½“ç‚¹è¯´ï¼Œå°±æ˜¯ä¸šåŠ¡åº”ç”¨è°ƒç”¨ç¼“å­˜æ¥å£æ—¶ï¼Œç¼“å­˜å®¢æˆ·ç«¯å¹¶ä¸æŠŠè¯·æ±‚å‘ç»™ Redis ç¼“å­˜å®ä¾‹ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œç­‰åˆ° Redis ç¼“å­˜å®ä¾‹é‡æ–°æ¢å¤æœåŠ¡åï¼Œå†å…è®¸åº”ç”¨è¯·æ±‚å‘é€åˆ°ç¼“å­˜ç³»ç»Ÿã€‚<br>&emsp;&emsp;æœåŠ¡ç†”æ–­è™½ç„¶å¯ä»¥ä¿è¯æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æš‚åœäº†æ•´ä¸ªç¼“å­˜ç³»ç»Ÿçš„è®¿é—®ï¼Œå¯¹ä¸šåŠ¡åº”ç”¨çš„å½±å“èŒƒå›´å¤§ã€‚ä¸ºäº†å°½å¯èƒ½å‡å°‘è¿™ç§å½±å“ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œè¯·æ±‚é™æµã€‚è¿™é‡Œè¯´çš„è¯·æ±‚é™æµï¼Œå°±æ˜¯æŒ‡ï¼Œæˆ‘ä»¬åœ¨ä¸šåŠ¡ç³»ç»Ÿçš„è¯·æ±‚å…¥å£å‰ç«¯æ§åˆ¶æ¯ç§’è¿›å…¥ç³»ç»Ÿçš„è¯·æ±‚æ•°ï¼Œé¿å…è¿‡å¤šçš„è¯·æ±‚è¢«å‘é€åˆ°æ•°æ®åº“ã€‚<br>&emsp;&emsp;<strong>äº‹å‰é¢„é˜²</strong>ï¼š é€šè¿‡ä¸»ä»èŠ‚ç‚¹çš„æ–¹å¼æ„å»º Redis ç¼“å­˜é«˜å¯é é›†ç¾¤ã€‚å¦‚æœ Redis ç¼“å­˜çš„ä¸»èŠ‚ç‚¹æ•…éšœå®•æœºäº†ï¼Œä»èŠ‚ç‚¹è¿˜å¯ä»¥åˆ‡æ¢æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œç»§ç»­æä¾›ç¼“å­˜æœåŠ¡ï¼Œé¿å…äº†ç”±äºç¼“å­˜å®ä¾‹å®•æœºè€Œå¯¼è‡´çš„ç¼“å­˜é›ªå´©é—®é¢˜ã€‚</p><h2 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h2><p>&emsp;&emsp;ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ï¼Œé’ˆå¯¹æŸä¸ªè®¿é—®éå¸¸é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®çš„è¯·æ±‚ï¼Œæ— æ³•åœ¨ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œç´§æ¥ç€ï¼Œè®¿é—®è¯¥æ•°æ®çš„å¤§é‡è¯·æ±‚ï¼Œä¸€ä¸‹å­éƒ½å‘é€åˆ°äº†åç«¯æ•°æ®åº“ï¼Œå¯¼è‡´äº†æ•°æ®åº“å‹åŠ›æ¿€å¢ï¼Œä¼šå½±å“æ•°æ®åº“å¤„ç†å…¶ä»–è¯·æ±‚ã€‚ç¼“å­˜å‡»ç©¿çš„æƒ…å†µï¼Œç»å¸¸å‘ç”Ÿåœ¨çƒ­ç‚¹æ•°æ®è¿‡æœŸå¤±æ•ˆæ—¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis86.jpg" alt="avatar"><br><strong>å¦‚ä½•é¿å…</strong>ï¼šä¸ºäº†é¿å…ç¼“å­˜å‡»ç©¿ç»™æ•°æ®åº“å¸¦æ¥çš„æ¿€å¢å‹åŠ›ï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ³•ä¹Ÿæ¯”è¾ƒç›´æ¥ï¼Œå¯¹äºè®¿é—®ç‰¹åˆ«é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®ï¼Œæˆ‘ä»¬å°±ä¸è®¾ç½®è¿‡æœŸæ—¶é—´äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹çƒ­ç‚¹æ•°æ®çš„è®¿é—®è¯·æ±‚ï¼Œéƒ½å¯ä»¥åœ¨ç¼“å­˜ä¸­è¿›è¡Œå¤„ç†ï¼Œè€Œ Redis æ•°ä¸‡çº§åˆ«çš„é«˜ååé‡å¯ä»¥å¾ˆå¥½åœ°åº”å¯¹å¤§é‡çš„å¹¶å‘è¯·æ±‚è®¿é—®ã€‚</p><h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p>&emsp;&emsp;ç¼“å­˜ç©¿é€æ˜¯æŒ‡è¦è®¿é—®çš„æ•°æ®æ—¢ä¸åœ¨ Redis ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸åœ¨æ•°æ®åº“ä¸­ï¼Œå¯¼è‡´è¯·æ±‚åœ¨è®¿é—®ç¼“å­˜æ—¶ï¼Œå‘ç”Ÿç¼“å­˜ç¼ºå¤±ï¼Œå†å»è®¿é—®æ•°æ®åº“æ—¶ï¼Œå‘ç°æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰è¦è®¿é—®çš„æ•°æ®ã€‚æ­¤æ—¶ï¼Œåº”ç”¨ä¹Ÿæ— æ³•ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å†å†™å…¥ç¼“å­˜ï¼Œæ¥æœåŠ¡åç»­è¯·æ±‚ï¼Œè¿™æ ·ä¸€æ¥ï¼Œç¼“å­˜ä¹Ÿå°±æˆäº†â€œæ‘†è®¾â€ï¼Œå¦‚æœåº”ç”¨æŒç»­æœ‰å¤§é‡è¯·æ±‚è®¿é—®æ•°æ®ï¼Œå°±ä¼šåŒæ—¶ç»™ç¼“å­˜å’Œæ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis87.jpg" alt="avatar"><br>&emsp;&emsp;ç¼“å­˜ç©¿é€ä¼šå‘ç”Ÿåœ¨ä»€ä¹ˆæ—¶å€™å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œæœ‰ä¸¤ç§æƒ…å†µã€‚</p><ol><li>ä¸šåŠ¡å±‚è¯¯æ“ä½œï¼šç¼“å­˜ä¸­çš„æ•°æ®å’Œæ•°æ®åº“ä¸­çš„æ•°æ®è¢«è¯¯åˆ é™¤äº†ï¼Œæ‰€ä»¥ç¼“å­˜å’Œæ•°æ®åº“ä¸­éƒ½æ²¡ æœ‰æ•°æ®ï¼›</li><li>æ¶æ„æ”»å‡»ï¼šä¸“é—¨è®¿é—®æ•°æ®åº“ä¸­æ²¡æœ‰çš„æ•°æ®ã€‚</li></ol><p><strong>å¦‚ä½•é¿å…</strong>ï¼š</p><ol><li><strong>ç¼“å­˜ç©ºå€¼æˆ–ç¼ºçœå€¼</strong>ï¼šä¸€æ—¦å‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œæˆ‘ä»¬å°±å¯ä»¥é’ˆå¯¹æŸ¥è¯¢çš„æ•°æ®ï¼Œåœ¨ Redis ä¸­ç¼“å­˜ä¸€ä¸ªç©ºå€¼æˆ–æ˜¯å’Œä¸šåŠ¡å±‚åå•†ç¡®å®šçš„ç¼ºçœå€¼ï¼ˆä¾‹å¦‚ï¼Œåº“å­˜çš„ç¼ºçœå€¼å¯ä»¥è®¾ä¸º 0ï¼‰ã€‚ç´§æ¥ç€ï¼Œåº”ç”¨å‘é€çš„åç»­è¯·æ±‚å†è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥ä» Redis ä¸­è¯»å–ç©ºå€¼æˆ–ç¼ºçœå€¼ï¼Œè¿”å›ç»™ä¸šåŠ¡åº”ç”¨äº†ï¼Œé¿å…äº†æŠŠå¤§é‡è¯·æ±‚å‘é€ç»™æ•°æ®åº“å¤„ç†ï¼Œä¿æŒäº†æ•°æ®åº“çš„æ­£å¸¸è¿è¡Œã€‚</li><li>ä½¿ç”¨<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œé¿å…ä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå‡è½»æ•°æ®åº“å‹åŠ›ã€‚å¸ƒéš†è¿‡æ»¤å™¨ç”±ä¸€ä¸ªåˆå€¼éƒ½ä¸º 0 çš„ bit æ•°ç»„å’Œ N ä¸ªå“ˆå¸Œå‡½æ•°ç»„æˆï¼Œå¯ä»¥ç”¨æ¥å¿«é€Ÿåˆ¤æ–­æŸä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ã€‚å½“æˆ‘ä»¬æƒ³æ ‡è®°æŸä¸ªæ•°æ®å­˜åœ¨æ—¶ï¼ˆä¾‹å¦‚ï¼Œæ•°æ®å·²è¢«å†™å…¥æ•°æ®åº“ï¼‰ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ä¼šé€šè¿‡ä¸‰ä¸ªæ“ä½œå®Œæˆæ ‡è®°ï¼šé¦–å…ˆï¼Œä½¿ç”¨ N ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œåˆ†åˆ«è®¡ç®—è¿™ä¸ªæ•°æ®çš„å“ˆå¸Œå€¼ï¼Œå¾—åˆ° N ä¸ªå“ˆå¸Œå€¼ï¼›ç„¶åï¼Œæˆ‘ä»¬æŠŠè¿™ N ä¸ªå“ˆå¸Œå€¼å¯¹ bit æ•°ç»„çš„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°æ¯ä¸ªå“ˆå¸Œå€¼åœ¨æ•°ç»„ä¸­çš„å¯¹åº”ä½ç½®ï¼›æœ€åï¼Œæˆ‘ä»¬æŠŠå¯¹åº”ä½ç½®çš„ bit ä½è®¾ç½®ä¸º 1ï¼Œè¿™å°±å®Œæˆäº†åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ ‡è®°æ•°æ®çš„æ“ä½œã€‚å½“éœ€è¦æŸ¥è¯¢æŸä¸ªæ•°æ®æ—¶ï¼Œæˆ‘ä»¬å°±æ‰§è¡Œåˆšåˆšè¯´çš„è®¡ç®—è¿‡ç¨‹ï¼Œå…ˆå¾—åˆ°è¿™ä¸ªæ•°æ®åœ¨ bit æ•°ç»„ä¸­å¯¹åº”çš„ N ä¸ªä½ç½®ã€‚ç´§æ¥ç€ï¼Œæˆ‘ä»¬æŸ¥çœ‹ bit æ•°ç»„ä¸­è¿™ N ä¸ªä½ç½®ä¸Šçš„ bit å€¼ã€‚åªè¦è¿™ N ä¸ª bit å€¼ æœ‰ä¸€ä¸ªä¸ä¸º 1ï¼Œè¿™å°±è¡¨æ˜å¸ƒéš†è¿‡æ»¤å™¨æ²¡æœ‰å¯¹è¯¥æ•°æ®åšè¿‡æ ‡è®°ï¼Œæ‰€ä»¥ï¼ŒæŸ¥è¯¢çš„æ•°æ®ä¸€å®šæ²¡æœ‰ åœ¨æ•°æ®åº“ä¸­ä¿å­˜ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis88.jpg" alt="avatar"><br>&emsp;&emsp;å›¾ä¸­å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªåŒ…å« 10 ä¸ª bit ä½çš„æ•°ç»„ï¼Œä½¿ç”¨äº† 3 ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå½“åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­æ ‡è®°æ•°æ® X æ—¶ï¼ŒX ä¼šè¢«è®¡ç®— 3 æ¬¡å“ˆå¸Œå€¼ï¼Œå¹¶å¯¹ 10 å–æ¨¡ï¼Œå–æ¨¡ç»“æœåˆ†åˆ«æ˜¯ 1ã€3ã€7ã€‚æ‰€ ä»¥ï¼Œbit æ•°ç»„çš„ç¬¬ 1ã€3ã€7 ä½è¢«è®¾ç½®ä¸º 1ã€‚å½“åº”ç”¨æƒ³è¦æŸ¥è¯¢ X æ—¶ï¼Œåªè¦æŸ¥çœ‹æ•°ç»„çš„ç¬¬ 1ã€ 3ã€7 ä½æ˜¯å¦ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸º 0ï¼Œé‚£ä¹ˆï¼ŒX å°±è‚¯å®šä¸åœ¨æ•°æ®åº“ä¸­ã€‚<br>&emsp;&emsp;æ­£æ˜¯åŸºäºå¸ƒéš†è¿‡æ»¤å™¨çš„å¿«é€Ÿæ£€æµ‹ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŠŠæ•°æ®å†™å…¥æ•°æ®åº“æ—¶ï¼Œä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨åšä¸ªæ ‡è®°ã€‚å½“ç¼“å­˜ç¼ºå¤±åï¼Œåº”ç”¨æŸ¥è¯¢æ•°æ®åº“æ—¶ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨å¿«é€Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¸ç”¨å†å»æ•°æ®åº“ä¸­æŸ¥è¯¢äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å‘ç”Ÿç¼“å­˜ç©¿é€äº†ï¼Œå¤§é‡è¯·æ±‚åªä¼šæŸ¥è¯¢ Redis å’Œå¸ƒéš†è¿‡æ»¤å™¨ï¼Œè€Œä¸ä¼šç§¯å‹åˆ°æ•°æ®åº“ï¼Œä¹Ÿå°±ä¸ä¼šå½±å“æ•°æ®åº“çš„æ­£å¸¸ è¿è¡Œã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ä½¿ç”¨ Redis å®ç°ï¼Œæœ¬èº«å°±èƒ½æ‰¿æ‹…è¾ƒå¤§çš„å¹¶å‘è®¿é—®å‹åŠ›ã€‚<strong>åˆ¤æ–­æ•°æ®ä¸åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œä¸€å®šä¸åœ¨æ•°æ®åº“ä¸­ï¼Œç›´æ¥è¿”å›ã€‚åˆ¤æ–­åœ¨å¸ƒéš†è¿‡æ»¤å™¨ä¸­ï¼Œå¯èƒ½è¯¯åˆ¤ï¼Œä¸ä¸€å®šåœ¨æ•°æ®åº“ä¸­ï¼Œè‹¥ä¸åœ¨æ•°æ®åº“ä¸­ä»ç„¶å‘ç”Ÿç¼“å­˜ç©¿é€ï¼Œç„¶åç¼“å­˜ç©ºå€¼æˆ–ç¼ºçœå€¼</strong>ã€‚</li><li>æœ€åä¸€ç§æ–¹æ¡ˆæ˜¯ï¼Œ<strong>åœ¨è¯·æ±‚å…¥å£çš„å‰ç«¯è¿›è¡Œè¯·æ±‚æ£€æµ‹</strong>ã€‚ç¼“å­˜ç©¿é€çš„ä¸€ä¸ªåŸå› æ˜¯æœ‰å¤§é‡çš„æ¶æ„è¯·æ±‚è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„åº”å¯¹æ–¹æ¡ˆæ˜¯åœ¨è¯·æ±‚å…¥å£å‰ç«¯ï¼Œå¯¹ä¸šåŠ¡ç³»ç»Ÿæ¥æ”¶åˆ°çš„è¯·æ±‚è¿›è¡Œåˆæ³•æ€§æ£€æµ‹ï¼ŒæŠŠæ¶æ„çš„è¯·æ±‚ï¼ˆä¾‹å¦‚è¯·æ±‚å‚æ•°ä¸åˆç†ã€è¯·æ±‚å‚æ•°æ˜¯éæ³•å€¼ã€è¯· æ±‚å­—æ®µä¸å­˜åœ¨ï¼‰ç›´æ¥è¿‡æ»¤æ‰ï¼Œä¸è®©å®ƒä»¬è®¿é—®åç«¯ç¼“å­˜å’Œæ•°æ®åº“ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°ç¼“å­˜ç©¿é€é—®é¢˜äº†ã€‚</li></ol><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><img lazyload src="/images/loading.svg" data-src="redis89.jpg" alt="avatar"><br>&emsp;&emsp;ï¼ŒæœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€è¯·æ±‚é™æµè¿™äº›æ–¹æ³•éƒ½æ˜¯å±äºâ€œæœ‰æŸâ€æ–¹æ¡ˆï¼Œåœ¨ä¿è¯æ•°æ®åº“å’Œæ•´ä½“ç³»ç»Ÿç¨³å®šçš„åŒæ—¶ï¼Œä¼šå¯¹ä¸šåŠ¡åº”ç”¨å¸¦æ¥è´Ÿé¢å½±å“ã€‚ä¾‹å¦‚ä½¿ç”¨æœåŠ¡é™çº§æ—¶ï¼Œæœ‰éƒ¨åˆ†æ•°æ®çš„è¯·æ±‚å°±åªèƒ½å¾—åˆ°é”™è¯¯è¿”å›ä¿¡æ¯ï¼Œæ— æ³•æ­£å¸¸å¤„ç†ã€‚å¦‚æœä½¿ç”¨äº†æœåŠ¡ç†”æ–­ï¼Œé‚£ä¹ˆï¼Œæ•´ä¸ªç¼“å­˜ç³»ç»Ÿçš„æœåŠ¡éƒ½è¢«æš‚åœäº†ï¼Œå½±å“çš„ä¸šåŠ¡èŒƒå›´æ›´å¤§ã€‚è€Œä½¿ç”¨äº†è¯·æ±‚é™æµæœºåˆ¶åï¼Œæ•´ä¸ªä¸šåŠ¡ç³»ç»Ÿçš„ååç‡ä¼šé™ä½ï¼Œèƒ½å¹¶å‘å¤„ç†çš„ç”¨æˆ·è¯·æ±‚ä¼šå‡å°‘ï¼Œä¼šå½±å“åˆ°ç”¨æˆ·ä½“éªŒã€‚æ‰€ä»¥å»ºè®®å°½é‡ä½¿ç”¨å°½é‡ä½¿ç”¨é¢„é˜²å¼æ–¹æ¡ˆï¼š</p><ol><li>é’ˆå¯¹ç¼“å­˜é›ªå´©ï¼Œåˆç†åœ°è®¾ç½®æ•°æ®è¿‡æœŸæ—¶é—´ï¼Œä»¥åŠæ­å»ºé«˜å¯é ç¼“å­˜é›†ç¾¤ï¼›</li><li>é’ˆå¯¹ç¼“å­˜å‡»ç©¿ï¼Œåœ¨ç¼“å­˜è®¿é—®éå¸¸é¢‘ç¹çš„çƒ­ç‚¹æ•°æ®æ—¶ï¼Œä¸è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼›</li><li>é’ˆå¯¹ç¼“å­˜ç©¿é€ï¼Œæå‰åœ¨å…¥å£å‰ç«¯å®ç°æ¶æ„è¯·æ±‚æ£€æµ‹ï¼Œæˆ–è€…è§„èŒƒæ•°æ®åº“çš„æ•°æ®åˆ é™¤æ“ä½œï¼Œé¿å…è¯¯åˆ é™¤ã€‚</li></ol><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>&emsp;&emsp;åœ¨æåˆ°ç¼“å­˜é›ªå´©æ—¶ï¼Œå¯ä»¥é‡‡ç”¨æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€è¯·æ±‚é™æµçš„æ–¹å¼æ¥åº”å¯¹ã€‚è¿™ä¸‰ä¸ªæœºåˆ¶å¯ä»¥ç”¨æ¥åº”å¯¹æ··å­˜ç©¿é€é—®é¢˜å—ï¼Ÿè¿˜æœ‰æ²¡æœ‰å…¶ä»–ç­–ç•¥æ¥è§£å†³è¿™ä¸€é—®é¢˜ï¼Ÿ</p><blockquote><p> æœåŠ¡ç†”æ–­ã€æœåŠ¡é™çº§ã€è¯·æ±‚é™æµè¿™ä¸‰ä¸ªæœºåˆ¶ä¸é€‚åˆæ¥å¤„ç†ç¼“å­˜ç©¿é€çš„åœºæ™¯ã€‚ ä¸‰ä¸ªæœºåˆ¶éƒ½æ˜¯åœ¨æœåŠ¡ä¸å¯ç”¨æ—¶æ¥å‡å°‘å½±å“çš„ï¼Œç¼“å­˜ç©¿é€çš„åœºæ™¯ä¸‹ï¼Œæœ¬è´¨ä¸ŠæœåŠ¡æ˜¯å¯ç”¨çš„ï¼Œ å¦‚æœä½¿ç”¨ä¸Šè¿°ä¸‰ä¸ªæœºåˆ¶ä¼šå½±å“å…¶ä»–æ­£å¸¸çš„è¯·æ±‚ã€‚å¯ä»¥è®°å½•ipå’Œç©¿é€è®¿é—®çš„æ¬¡æ•°ï¼Œé¢‘ç‡è¶…è¿‡é˜ˆå€¼çš„ipç›´æ¥æ‹‰é»‘</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;String-ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„&quot;&gt;&lt;a href=&quot;#String-ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;String ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„&quot;&gt;&lt;/a&gt;String ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„&lt;/h1&gt;&lt;h2 id=&quot;ä¸ºä»€ä¹ˆ-Strin</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://jiahaohong1997.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="Redis" scheme="http://jiahaohong1997.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>SQLå­¦ä¹ ç¬”è®°</title>
    <link href="http://jiahaohong1997.github.io/2022/01/05/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://jiahaohong1997.github.io/2022/01/05/SQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2022-01-05T12:31:00.000Z</published>
    <updated>2022-01-05T12:45:59.362Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„"><a href="#MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„" class="headerlink" title="MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„"></a>MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„</h1><p>&emsp;&emsp;MySQLæ˜¯å…¸å‹çš„ Client/Server æ¶æ„ï¼ŒæœåŠ¡å™¨ç«¯ç¨‹åºä½¿ç”¨çš„æ˜¯ mysqldã€‚æ•´ä½“çš„ MySQL æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="mysql1.jpg" alt="avatar"><br>&emsp;&emsp;å¯ä»¥çœ‹åˆ°çš„MySQLä¸‰å±‚ï¼š</p><ol><li>==è¿æ¥å±‚==ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å»ºç«‹è¿æ¥ï¼ˆä¾‹å¦‚tcpï¼‰ï¼Œå®¢æˆ·ç«¯å‘é€ SQL è‡³æœåŠ¡ç«¯ï¼›</li><li>==SQL å±‚==ï¼šå¯¹ SQL è¯­å¥è¿›è¡ŒæŸ¥è¯¢å¤„ç†ï¼›</li><li>==å­˜å‚¨å¼•æ“å±‚==ï¼šä¸æ•°æ®åº“æ–‡ä»¶æ‰“äº¤é“ï¼Œè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè¯»å–ã€‚</li></ol><h2 id="SQL-å±‚"><a href="#SQL-å±‚" class="headerlink" title="SQL å±‚"></a>SQL å±‚</h2><p>å…¶ä¸­ SQL å±‚ä¸æ•°æ®åº“æ–‡ä»¶çš„å­˜å‚¨æ–¹å¼æ— å…³ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ SQL å±‚çš„ç»“æ„ï¼š<br><img lazyload src="/images/loading.svg" data-src="mysql2.jpg" alt="avatar"><br>&emsp;&emsp;å…¶æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li>==æŸ¥è¯¢ç¼“å­˜==ï¼šæœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„ SQL è¯­å¥åï¼Œå…ˆåœ¨ç¼“å­˜ä¸­æŸ¥è¯¢è¯¥è¯­å¥ï¼Œæœ‰ç»“æœå‘½ä¸­ç¼“å­˜å°±ç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼›å¦‚æœæ²¡æœ‰å°±è¿›å…¥åˆ°è§£æå™¨é˜¶æ®µï¼›</li><li>==è§£æå™¨==ï¼šåœ¨è§£æå™¨ä¸­å¯¹ SQL è¯­å¥è¿›è¡Œè¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼›</li><li>==ä¼˜åŒ–å™¨==ï¼šåœ¨ä¼˜åŒ–å™¨ä¸­ä¼šç¡®å®š SQL è¯­å¥çš„æ‰§è¡Œè·¯å¾„ï¼Œæ¯”å¦‚æ˜¯æ ¹æ®å…¨è¡¨æ£€ç´¢ï¼Œè¿˜æ˜¯æ ¹æ®ç´¢å¼•æ¥æ£€ç´¢ç­‰ï¼›</li><li>==æ‰§è¡Œå™¨==ï¼šåœ¨æ‰§è¡Œä¹‹å‰éœ€è¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å…·å¤‡æƒé™ï¼Œå¦‚æœå…·å¤‡æƒé™å°±æ‰§è¡Œ SQL æŸ¥è¯¢å¹¶è¿”å›ç»“æœã€‚å¦‚æœè®¾ç½®äº†æŸ¥è¯¢ç¼“å­˜ï¼Œè¿™æ—¶ä¼šå°†æŸ¥è¯¢ç»“æœè¿›è¡Œç¼“å­˜ã€‚</li></ol><p>SQL è¯­å¥â†’ç¼“ å­˜æŸ¥è¯¢â†’è§£æå™¨â†’ä¼˜åŒ–å™¨â†’æ‰§è¡Œå™¨</p><h2 id="å­˜å‚¨å¼•æ“å±‚"><a href="#å­˜å‚¨å¼•æ“å±‚" class="headerlink" title="å­˜å‚¨å¼•æ“å±‚"></a>å­˜å‚¨å¼•æ“å±‚</h2><p>&emsp;&emsp;MySQL çš„å­˜å‚¨å¼•æ“é‡‡ç”¨äº†æ’ä»¶çš„å½¢ å¼ï¼Œæ¯ä¸ªå­˜å‚¨å¼•æ“éƒ½é¢å‘ä¸€ç§ç‰¹å®šçš„æ•°æ®åº“åº”ç”¨ç¯å¢ƒã€‚åŒæ—¶å¼€æºçš„ MySQL è¿˜å…è®¸å¼€å‘äººå‘˜è®¾ç½®è‡ªå·±çš„å­˜å‚¨å¼•æ“ã€‚</p><ol><li>==InnoDB å­˜å‚¨å¼•æ“==ï¼šMySQL 5.5 ç‰ˆæœ¬ä¹‹åé»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”å®šã€å¤–é”®çº¦æŸç­‰ã€‚</li><li>==MyISAM å­˜å‚¨å¼•æ“==ï¼šMySQL 5.5 ç‰ˆæœ¬ä¹‹å‰æ˜¯é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œä¸æ”¯æŒäº‹åŠ¡ï¼Œä¹Ÿä¸æ”¯æŒå¤–é”®ï¼Œæœ€å¤§çš„ç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œå ç”¨èµ„æºå°‘ã€‚</li><li>Memory å­˜å‚¨å¼•æ“ï¼šä½¿ç”¨ç³»ç»Ÿå†…å­˜ä½œä¸ºå­˜å‚¨ä»‹è´¨ï¼Œä»¥ä¾¿å¾—åˆ°æ›´å¿«çš„å“åº”é€Ÿåº¦ã€‚ä¸è¿‡å¦‚æœ mysqld è¿›ç¨‹å´©æºƒï¼Œåˆ™ä¼šå¯¼è‡´æ‰€æœ‰çš„æ•°æ®ä¸¢å¤±ï¼Œå› æ­¤æˆ‘ä»¬åªæœ‰å½“æ•°æ®æ˜¯ä¸´æ—¶çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ Memory å­˜å‚¨å¼•æ“ã€‚</li><li>NDB å­˜å‚¨å¼•æ“ï¼šä¹Ÿå«åš NDB Cluster å­˜å‚¨å¼•æ“ï¼Œä¸»è¦ç”¨äº MySQL Cluster åˆ†å¸ƒå¼é›†ç¾¤ç¯å¢ƒï¼Œç±»ä¼¼äº Oracle çš„ RAC é›†ç¾¤ã€‚</li><li>Archive å­˜å‚¨å¼•æ“ï¼šå®ƒæœ‰å¾ˆå¥½çš„å‹ç¼©æœºåˆ¶ï¼Œç”¨äºæ–‡ä»¶å½’æ¡£ï¼Œåœ¨è¯·æ±‚å†™å…¥æ—¶ä¼šè¿›è¡Œå‹ç¼©ï¼Œæ‰€ä»¥ä¹Ÿç»å¸¸ç”¨æ¥åšä»“åº“ã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„&quot;&gt;&lt;a href=&quot;#MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„&quot; class=&quot;headerlink&quot; title=&quot;MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„&quot;&gt;&lt;/a&gt;MySQLä¸­çš„SQLæ˜¯å¦‚ä½•æ‰§è¡Œçš„&lt;/h1&gt;&lt;p&gt;&amp;emsp;&amp;emsp;My</summary>
      
    
    
    
    <category term="SQL" scheme="http://jiahaohong1997.github.io/categories/SQL/"/>
    
    
    <category term="MySQL" scheme="http://jiahaohong1997.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>Rediså­¦ä¹ ç¬”è®°ï¼ˆäºŒï¼‰</title>
    <link href="http://jiahaohong1997.github.io/2022/01/05/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://jiahaohong1997.github.io/2022/01/05/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</id>
    <published>2022-01-05T03:10:00.000Z</published>
    <updated>2022-02-17T13:28:31.641Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿"><a href="#ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿" class="headerlink" title="ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿"></a>ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿</h1><p><img lazyload src="/images/loading.svg" data-src="redis1.jpg" alt="avatar"></p><ul><li><p>ä¸¤å¤§ç»´åº¦</p></li><li><p><input disabled type="checkbox">  åº”ç”¨çº¬åº¦</p></li><li><p><input disabled type="checkbox">  ç³»ç»Ÿçº¬åº¦</p></li><li><p>ä¸‰å¤§ä¸»çº¿</p></li><li><p><input disabled type="checkbox">  ==é«˜æ€§èƒ½ä¸»çº¿==ï¼ŒåŒ…æ‹¬çº¿ç¨‹æ¨¡å‹ã€æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€ç½‘ç»œæ¡†æ¶</p></li><li><p><input disabled type="checkbox">  ==é«˜å¯é ä¸»çº¿==ï¼ŒåŒ…æ‹¬ä¸»ä»å¤åˆ¶ã€å“¨å…µæœºåˆ¶</p></li><li><p><input disabled type="checkbox">  ==é«˜å¯æ‰©å±•ä¸»çº¿==ï¼ŒåŒ…æ‹¬æ•°æ®åˆ†ç‰‡ã€è´Ÿè½½å‡è¡¡</p></li></ul><h2 id="Redisçš„ç»„ä»¶å’ŒåŠŸèƒ½"><a href="#Redisçš„ç»„ä»¶å’ŒåŠŸèƒ½" class="headerlink" title="Redisçš„ç»„ä»¶å’ŒåŠŸèƒ½"></a>Redisçš„ç»„ä»¶å’ŒåŠŸèƒ½</h2><p><img lazyload src="/images/loading.svg" data-src="redis2.jpg" alt="avatar"></p><ol><li>Redis ä¸»è¦é€šè¿‡ç½‘ç»œæ¡†æ¶è¿›è¡Œè®¿é—®ï¼Œè€Œä¸å†æ˜¯åŠ¨æ€åº“äº†ï¼Œè¿™ä¹Ÿä½¿å¾— Redis å¯ä»¥ä½œä¸ºä¸€ä¸ªåŸºç¡€æ€§çš„ç½‘ç»œæœåŠ¡è¿›è¡Œè®¿é—®ï¼Œæ‰©å¤§äº† Redis çš„åº”ç”¨èŒƒå›´ã€‚</li><li>Redis æ•°æ®æ¨¡å‹ä¸­çš„ value ç±»å‹å¾ˆä¸°å¯Œï¼Œå› æ­¤ä¹Ÿå¸¦æ¥äº†æ›´å¤šçš„æ“ä½œæ¥å£ï¼Œä¾‹å¦‚é¢å‘åˆ—è¡¨çš„ LPUSH/LPOPï¼Œé¢å‘é›†åˆçš„ SADD/SREM ç­‰ã€‚</li><li>Redis çš„æŒä¹…åŒ–æ¨¡å—èƒ½æ”¯æŒä¸¤ç§æ–¹å¼ï¼šæ—¥å¿—ï¼ˆAOFï¼‰å’Œå¿«ç…§ï¼ˆRDBï¼‰ï¼Œè¿™ä¸¤ç§æŒä¹…åŒ–æ–¹å¼å…·æœ‰ä¸åŒçš„ä¼˜åŠ£åŠ¿ï¼Œå½±å“åˆ° Redis çš„è®¿é—®æ€§èƒ½å’Œå¯é æ€§ã€‚</li><li>Redis æ”¯æŒé«˜å¯é é›†ç¾¤å’Œé«˜å¯æ‰©å±•é›†ç¾¤</li></ol><h1 id="å¿«é€Ÿçš„Redisæœ‰å“ªäº›æ…¢æ“ä½œ"><a href="#å¿«é€Ÿçš„Redisæœ‰å“ªäº›æ…¢æ“ä½œ" class="headerlink" title="å¿«é€Ÿçš„Redisæœ‰å“ªäº›æ…¢æ“ä½œ"></a>å¿«é€Ÿçš„Redisæœ‰å“ªäº›æ…¢æ“ä½œ</h1><h2 id="Rediså¿«åœ¨å“ªå„¿"><a href="#Rediså¿«åœ¨å“ªå„¿" class="headerlink" title="Rediså¿«åœ¨å“ªå„¿"></a>Rediså¿«åœ¨å“ªå„¿</h2><ul><li>Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œ æ‰€æœ‰æ“ä½œéƒ½åœ¨å†…å­˜ä¸Šå®Œæˆï¼Œå†…å­˜çš„è®¿é—®é€Ÿåº¦æœ¬èº«å°±å¾ˆå¿«ã€‚</li><li>å½’åŠŸäºå®ƒçš„æ•°æ®ç»“æ„ã€‚é”®å€¼å¯¹æ˜¯æŒ‰ä¸€å®šçš„æ•°æ®ç»“æ„æ¥ç»„ç»‡çš„ï¼Œæ“ä½œé”®å€¼å¯¹æœ€ç»ˆå°±æ˜¯å¯¹æ•°æ®ç»“æ„è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œæ‰€ä»¥é«˜æ•ˆçš„æ•°æ®ç»“æ„æ˜¯ Redis å¿«é€Ÿå¤„ç†æ•°æ®çš„åŸºç¡€ã€‚</li></ul><h2 id="Redisçš„æ•°æ®ç»“æ„"><a href="#Redisçš„æ•°æ®ç»“æ„" class="headerlink" title="Redisçš„æ•°æ®ç»“æ„"></a>Redisçš„æ•°æ®ç»“æ„</h2><h3 id="åº•å±‚æ•°æ®ç»“æ„"><a href="#åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="åº•å±‚æ•°æ®ç»“æ„"></a>åº•å±‚æ•°æ®ç»“æ„</h3><p>&emsp;&emsp;åº•å±‚æ•°æ®ç»“æ„ä¸€å…±æœ‰ 6 ç§ï¼Œåˆ†åˆ«æ˜¯ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ã€åŒå‘é“¾è¡¨ã€å‹ç¼©åˆ—è¡¨ã€å“ˆå¸Œè¡¨ã€è·³è¡¨å’Œæ•´æ•°æ•°ç»„ã€‚å®ƒä»¬å’Œæ•°æ®ç±»å‹çš„å¯¹åº”å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis3.jpg" alt="avatar"><br>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼ŒString ç±»å‹çš„åº•å±‚å®ç°åªæœ‰ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ç®€å•åŠ¨æ€å­—ç¬¦ä¸²ã€‚è€Œ Listã€Hashã€Set å’Œ Sorted Set è¿™å››ç§æ•°æ®ç±»å‹ï¼Œéƒ½æœ‰ä¸¤ç§åº•å±‚å®ç°ç»“æ„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™å››ç§ç±»å‹ç§°ä¸ºé›†åˆç±»å‹ï¼Œå®ƒä»¬çš„ç‰¹ç‚¹æ˜¯<strong>ä¸€ä¸ªé”®å¯¹åº”äº†ä¸€ä¸ªé›†åˆçš„æ•°æ®</strong>ã€‚</p><h3 id="é”®å’Œå€¼ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ç»„ç»‡"><a href="#é”®å’Œå€¼ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ç»„ç»‡" class="headerlink" title="é”®å’Œå€¼ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ç»„ç»‡"></a>é”®å’Œå€¼ç”¨ä»€ä¹ˆæ•°æ®ç»“æ„ç»„ç»‡</h3><p>&emsp;&emsp;ä¸ºäº†å®ç°ä»é”®åˆ°å€¼çš„å¿«é€Ÿè®¿é—®ï¼ŒRedis ä½¿ç”¨äº†ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥ä¿å­˜æ‰€æœ‰é”®å€¼å¯¹ã€‚ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ ç§°ä¸ºä¸€ä¸ªå“ˆå¸Œæ¡¶ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸¸è¯´ï¼Œä¸€ ä¸ªå“ˆå¸Œè¡¨æ˜¯ç”±å¤šä¸ªå“ˆå¸Œæ¡¶ç»„æˆçš„ï¼Œæ¯ä¸ªå“ˆå¸Œæ¡¶ä¸­ä¿å­˜äº†é”®å€¼å¯¹æ•°æ®ã€‚å“ˆå¸Œæ¡¶ä¸­çš„å…ƒç´ ä¿å­˜çš„å¹¶ä¸æ˜¯å€¼æœ¬èº«ï¼Œè€Œæ˜¯æŒ‡å‘å…·ä½“å€¼çš„æŒ‡é’ˆã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡å€¼æ˜¯ Stringï¼Œè¿˜æ˜¯é›†åˆç±»å‹ï¼Œå“ˆå¸Œæ¡¶ä¸­çš„å…ƒç´ éƒ½æ˜¯æŒ‡å‘å®ƒä»¬çš„æŒ‡é’ˆã€‚<br>&emsp;&emsp;åœ¨ä¸‹å›¾ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå“ˆå¸Œæ¡¶ä¸­çš„ entry å…ƒç´ ä¸­ä¿å­˜äº† key å’Œ value æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†å®é™…çš„é”®å’Œå€¼ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å€¼æ˜¯ä¸€ä¸ªé›†åˆï¼Œä¹Ÿå¯ä»¥é€šè¿‡ value æŒ‡é’ˆè¢«æŸ¥æ‰¾åˆ°ã€‚</p><p><img lazyload src="/images/loading.svg" data-src="redis4.jpg" alt="avatar"></p><p>&emsp;&emsp;å› ä¸ºè¿™ä¸ªå“ˆå¸Œè¡¨ä¿å­˜äº†æ‰€æœ‰çš„é”®å€¼å¯¹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä¹ŸæŠŠå®ƒç§°ä¸º==å…¨å±€å“ˆå¸Œè¡¨==ã€‚å“ˆå¸Œè¡¨çš„æœ€å¤§å¥½å¤„å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯è®©æˆ‘ä»¬å¯ä»¥ç”¨ O(1) çš„æ—¶é—´å¤æ‚åº¦æ¥å¿«é€ŸæŸ¥æ‰¾åˆ°é”®å€¼å¯¹â€”â€”æˆ‘ä»¬åªéœ€è¦è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œå°±å¯ä»¥çŸ¥é“å®ƒæ‰€å¯¹åº”çš„å“ˆå¸Œæ¡¶ä½ç½®ï¼Œç„¶åå°±å¯ä»¥è®¿é—®ç›¸åº”çš„ entry å…ƒç´ ã€‚<br>&emsp;&emsp;æŸ¥æ‰¾è¿‡ç¨‹ä¸»è¦ä¾èµ–äºå“ˆå¸Œè®¡ç®—ï¼Œå’Œæ•°æ®é‡çš„å¤šå°‘å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ ä¸ç®¡å“ˆå¸Œè¡¨é‡Œæœ‰ 10 ä¸‡ä¸ªé”®è¿˜æ˜¯ 100 ä¸‡ä¸ªé”®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€æ¬¡è®¡ç®—å°±èƒ½æ‰¾åˆ°ç›¸åº”çš„é”®ã€‚ä½†æ˜¯ï¼Œå½“ä½ å¾€ Redis ä¸­å†™å…¥å¤§é‡æ•°æ®åï¼Œå°±å¯èƒ½å‘ç°æ“ä½œæœ‰æ—¶å€™ä¼šçªç„¶å˜æ…¢äº†ã€‚è¿™å…¶å®æ˜¯å› ä¸ºä½ å¿½ç•¥äº†ä¸€ä¸ªæ½œåœ¨çš„é£é™©ç‚¹ï¼Œé‚£å°±æ˜¯å“ˆå¸Œè¡¨çš„å†²çªé—®é¢˜å’Œ rehash å¯èƒ½å¸¦æ¥çš„æ“ä½œé˜»å¡ã€‚</p><h3 id="ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ“ä½œå˜æ…¢äº†"><a href="#ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ“ä½œå˜æ…¢äº†" class="headerlink" title="ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ“ä½œå˜æ…¢äº†"></a>ä¸ºä»€ä¹ˆå“ˆå¸Œè¡¨æ“ä½œå˜æ…¢äº†</h3><p>&emsp;&emsp;å½“ä½ å¾€å“ˆå¸Œè¡¨ä¸­å†™å…¥æ›´å¤šæ•°æ®æ—¶ï¼Œå“ˆå¸Œå†²çªæ˜¯ä¸å¯é¿å…çš„é—®é¢˜ã€‚è¿™é‡Œçš„å“ˆå¸Œå†²çªï¼Œä¹Ÿå°±æ˜¯æŒ‡ï¼Œä¸¤ä¸ª key çš„å“ˆå¸Œå€¼å’Œå“ˆå¸Œæ¡¶è®¡ç®—å¯¹åº”å…³ç³»æ—¶ï¼Œæ­£å¥½è½åœ¨äº†åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚æ¯•ç«Ÿï¼Œå“ˆå¸Œæ¡¶çš„ä¸ªæ•°é€šå¸¸è¦å°‘äº key çš„æ•°é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œéš¾å…ä¼šæœ‰ä¸€äº› keyçš„å“ˆå¸Œå€¼å¯¹ åº”åˆ°äº†åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚Redis è§£å†³å“ˆå¸Œå†²çªçš„æ–¹å¼ï¼Œå°±æ˜¯é“¾å¼å“ˆå¸Œã€‚é“¾å¼å“ˆå¸Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯æŒ‡åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­çš„å¤šä¸ªå…ƒç´ ç”¨ä¸€ä¸ªé“¾è¡¨æ¥ä¿å­˜ï¼Œå®ƒä»¬ä¹‹é—´ä¾æ¬¡ç”¨æŒ‡é’ˆè¿æ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šentry1ã€entry2 å’Œ entry3 éƒ½éœ€è¦ä¿å­˜åœ¨å“ˆå¸Œæ¡¶ 3 ä¸­ï¼Œå¯¼è‡´äº†å“ˆå¸Œå†²çªã€‚æ­¤æ—¶ï¼Œentry1 å…ƒç´ ä¼šé€šè¿‡ä¸€ä¸ª<em>nextæŒ‡é’ˆæŒ‡å‘ entry2ï¼ŒåŒæ ·ï¼Œentry2 ä¹Ÿä¼šé€šè¿‡</em>nextæŒ‡é’ˆæŒ‡å‘ entry3ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å“ˆå¸Œæ¡¶ 3 ä¸­çš„å…ƒç´ æœ‰ 100 ä¸ªï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ entry å…ƒç´ ä¸­çš„æŒ‡é’ˆï¼ŒæŠŠå®ƒä»¬è¿èµ·æ¥ã€‚è¿™å°±å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨ï¼Œä¹Ÿå«ä½œå“ˆå¸Œå†²çªé“¾ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis5.jpg" alt="avatar"></p><p>&emsp;&emsp;ä½†æ˜¯ï¼Œè¿™é‡Œä¾ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå“ˆå¸Œå†²çªé“¾ä¸Šçš„å…ƒç´ åªèƒ½é€šè¿‡æŒ‡é’ˆé€ä¸€æŸ¥æ‰¾å†æ“ä½œã€‚å¦‚æœå“ˆå¸Œè¡¨é‡Œå†™å…¥çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œå“ˆå¸Œå†²çªå¯èƒ½ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿™å°±ä¼šå¯¼è‡´æŸäº›å“ˆå¸Œå†²çªé“¾è¿‡é•¿ï¼Œè¿›è€Œå¯¼è‡´è¿™ä¸ªé“¾ä¸Šçš„å…ƒç´ æŸ¥æ‰¾è€—æ—¶é•¿ï¼Œæ•ˆç‡é™ä½ã€‚å¯¹äºè¿½æ±‚â€œå¿«â€çš„ Redis æ¥è¯´ï¼Œè¿™æ˜¯ä¸å¤ªèƒ½æ¥å—çš„ã€‚æ‰€ä»¥ï¼ŒRedis ä¼šå¯¹å“ˆå¸Œè¡¨åš rehash æ“ä½œã€‚rehash ä¹Ÿå°±æ˜¯å¢åŠ ç°æœ‰çš„å“ˆå¸Œæ¡¶æ•°é‡ï¼Œè®©é€æ¸å¢å¤šçš„ entry å…ƒç´ èƒ½åœ¨æ›´å¤šçš„æ¡¶ä¹‹é—´åˆ†æ•£ä¿å­˜ï¼Œå‡å°‘å•ä¸ªæ¡¶ä¸­çš„å…ƒç´ æ•°é‡ï¼Œä»è€Œå‡å°‘å•ä¸ªæ¡¶ä¸­çš„å†²çªã€‚é‚£å…·ä½“æ€ä¹ˆåšå‘¢ï¼Ÿ<br>&emsp;&emsp;ä¸ºäº†ä½¿ rehash æ“ä½œæ›´é«˜æ•ˆï¼ŒRedis é»˜è®¤ä½¿ç”¨äº†ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨ï¼šå“ˆå¸Œè¡¨ 1 å’Œå“ˆå¸Œè¡¨ 2ã€‚ä¸€å¼€å§‹ï¼Œå½“ä½ åˆšæ’å…¥æ•°æ®æ—¶ï¼Œé»˜è®¤ä½¿ç”¨å“ˆå¸Œè¡¨ 1ï¼Œæ­¤æ—¶çš„å“ˆå¸Œè¡¨ 2 å¹¶æ²¡æœ‰è¢«åˆ†é…ç©ºé—´ã€‚éšç€æ•°æ®é€æ­¥å¢å¤šï¼ŒRedis å¼€å§‹æ‰§è¡Œ rehashï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol><li>ç»™å“ˆå¸Œè¡¨ 2 åˆ†é…æ›´å¤§çš„ç©ºé—´ï¼Œä¾‹å¦‚æ˜¯å½“å‰å“ˆå¸Œè¡¨ 1 å¤§å°çš„ä¸¤å€ï¼›</li><li>æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®é‡æ–°æ˜ å°„å¹¶æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­ï¼›</li><li>é‡Šæ”¾å“ˆå¸Œè¡¨ 1 çš„ç©ºé—´ã€‚</li></ol><p>&emsp;&emsp;è¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼ç®€å•ï¼Œä½†æ˜¯ç¬¬äºŒæ­¥æ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œå¦‚æœä¸€æ¬¡æ€§æŠŠå“ˆå¸Œè¡¨ 1 ä¸­çš„æ•°æ®éƒ½è¿ç§»å®Œï¼Œä¼šé€ æˆ Redis çº¿ç¨‹é˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚ã€‚æ­¤æ—¶ï¼ŒRedis å°±æ— æ³•å¿«é€Ÿè®¿é—®æ•°æ®äº†ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼ŒRedis é‡‡ç”¨äº†æ¸è¿›å¼ rehashã€‚ç®€å•æ¥è¯´å°±æ˜¯åœ¨ç¬¬äºŒæ­¥æ‹·è´æ•°æ®æ—¶ï¼ŒRedis ä»ç„¶æ­£å¸¸å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ¯å¤„ç†ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œä»å“ˆå¸Œè¡¨ 1 ä¸­çš„ç¬¬ä¸€ä¸ªç´¢å¼•ä½ç½®å¼€å§‹ï¼Œé¡ºå¸¦ç€å°†è¿™ä¸ªç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ entries æ‹·è´åˆ°å“ˆå¸Œè¡¨ 2 ä¸­ï¼›ç­‰å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå†é¡ºå¸¦æ‹·è´å“ˆå¸Œè¡¨ 1 ä¸­çš„ä¸‹ä¸€ä¸ªç´¢å¼•ä½ç½®çš„ entriesã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis6.jpg" alt="avatar"><br>&emsp;&emsp;è¿™æ ·å°±å·§å¦™åœ°æŠŠä¸€æ¬¡æ€§å¤§é‡æ‹·è´çš„å¼€é”€ï¼Œåˆ†æ‘Šåˆ°äº†å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œé¿å…äº†è€—æ—¶æ“ ä½œï¼Œä¿è¯äº†æ•°æ®çš„å¿«é€Ÿè®¿é—®ã€‚</p><h3 id="é›†åˆç±»æ•°æ®çš„æ“ä½œæ•ˆç‡"><a href="#é›†åˆç±»æ•°æ®çš„æ“ä½œæ•ˆç‡" class="headerlink" title="é›†åˆç±»æ•°æ®çš„æ“ä½œæ•ˆç‡"></a>é›†åˆç±»æ•°æ®çš„æ“ä½œæ•ˆç‡</h3><p>&emsp;&emsp;å’Œ String ç±»å‹ä¸åŒï¼Œä¸€ä¸ªé›†åˆç±»å‹çš„å€¼ï¼Œ==ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡å…¨å±€å“ˆå¸Œè¡¨æ‰¾åˆ°å¯¹åº”çš„å“ˆå¸Œæ¡¶ä½ç½®==ï¼Œ==ç¬¬äºŒæ­¥æ˜¯åœ¨é›†åˆä¸­å†å¢åˆ æ”¹æŸ¥==ã€‚é‚£ä¹ˆï¼Œé›†åˆçš„æ“ä½œæ•ˆç‡å’Œå“ªäº›å› ç´ ç›¸å…³å‘¢ï¼Ÿé¦–å…ˆï¼Œä¸é›†åˆçš„åº•å±‚æ•°æ®ç»“æ„æœ‰å…³ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å®ç°çš„é›†åˆï¼Œè¦æ¯”ä½¿ç”¨é“¾è¡¨å®ç°çš„ é›†åˆè®¿é—®æ•ˆç‡æ›´é«˜ã€‚å…¶æ¬¡ï¼Œæ“ä½œæ•ˆç‡å’Œè¿™äº›æ“ä½œæœ¬èº«çš„æ‰§è¡Œç‰¹ç‚¹æœ‰å…³ï¼Œæ¯”å¦‚è¯»å†™ä¸€ä¸ªå…ƒç´  çš„æ“ä½œè¦æ¯”è¯»å†™æ‰€æœ‰å…ƒç´ çš„æ•ˆç‡é«˜ã€‚</p><h4 id="é›†åˆç±»æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„"><a href="#é›†åˆç±»æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="é›†åˆç±»æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„"></a>é›†åˆç±»æ•°æ®çš„åº•å±‚æ•°æ®ç»“æ„</h4><p>&emsp;&emsp;é›†åˆç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ä¸»è¦æœ‰ 5 ç§ï¼šæ•´æ•°æ•°ç»„ã€åŒå‘é“¾è¡¨ã€å“ˆå¸Œè¡¨ã€å‹ç¼©åˆ—è¡¨å’Œè·³è¡¨ã€‚<br>&emsp;&emsp;å‹ç¼©åˆ—è¡¨å®é™…ä¸Šç±»ä¼¼äºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½å¯¹åº”ä¿å­˜ä¸€ä¸ªæ•°æ®ã€‚å’Œæ•°ç»„ä¸åŒçš„æ˜¯ï¼Œå‹ç¼©åˆ—è¡¨åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µ zlbytesã€zltail å’Œ zllenï¼Œåˆ†åˆ«è¡¨ç¤ºåˆ—è¡¨é•¿åº¦ã€åˆ—è¡¨å°¾çš„åç§»é‡å’Œåˆ—è¡¨ä¸­çš„ entry ä¸ªæ•°ï¼›å‹ç¼©åˆ—è¡¨åœ¨è¡¨å°¾è¿˜æœ‰ä¸€ä¸ª zlendï¼Œè¡¨ç¤ºåˆ—è¡¨ç»“æŸã€‚<br><img lazyload src="/images/loading.svg" data-src="redis7.jpg" alt="avatar"><br>&emsp;&emsp;åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å®šä½ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¯ä»¥é€šè¿‡è¡¨å¤´ä¸‰ä¸ªå­—æ®µçš„é•¿åº¦ç›´æ¥å®šä½ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚è€ŒæŸ¥æ‰¾å…¶ä»–å…ƒç´ æ—¶ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆäº†ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼Œæ­¤æ—¶çš„å¤æ‚åº¦å°±æ˜¯ O(N) äº†ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸‹è·³è¡¨ã€‚</p><p>&emsp;&emsp;æœ‰åºé“¾è¡¨åªèƒ½é€ä¸€æŸ¥æ‰¾å…ƒç´ ï¼Œå¯¼è‡´æ“ä½œèµ·æ¥éå¸¸ç¼“æ…¢ï¼Œäºæ˜¯å°±å‡ºç°äº†è·³è¡¨ã€‚å…·ä½“æ¥è¯´ï¼Œè·³è¡¨åœ¨é“¾è¡¨çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†å¤šçº§ç´¢å¼•ï¼Œé€šè¿‡ç´¢å¼•ä½ç½®çš„å‡ ä¸ªè·³è½¬ï¼Œå®ç°æ•°æ®çš„å¿«é€Ÿå®šä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis8.jpg" alt="avatar"></p><p>&emsp;&emsp;å¦‚æœæˆ‘ä»¬è¦åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾ 33 è¿™ä¸ªå…ƒç´ ï¼Œåªèƒ½ä»å¤´å¼€å§‹éå†é“¾è¡¨ï¼ŒæŸ¥æ‰¾ 6 æ¬¡ï¼Œç›´åˆ°æ‰¾åˆ° 33 ä¸ºæ­¢ã€‚æ­¤æ—¶ï¼Œå¤æ‚åº¦æ˜¯ O(N)ï¼ŒæŸ¥æ‰¾æ•ˆç‡å¾ˆä½ã€‚<br>&emsp;&emsp;ä¸ºäº†æé«˜æŸ¥æ‰¾é€Ÿåº¦ï¼Œæˆ‘ä»¬æ¥å¢åŠ ä¸€çº§ç´¢å¼•ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œæ¯ä¸¤ä¸ªå…ƒç´ é€‰ä¸€ä¸ªå‡ºæ¥ä½œä¸ºç´¢å¼•ã€‚è¿™äº›ç´¢å¼•å†é€šè¿‡æŒ‡é’ˆæŒ‡å‘åŸå§‹çš„é“¾è¡¨ã€‚ä¾‹å¦‚ï¼Œä»å‰ä¸¤ä¸ªå…ƒç´ ä¸­æŠ½å–å…ƒç´  1 ä½œä¸ºä¸€çº§ç´¢å¼•ï¼Œä»ç¬¬ä¸‰ã€å››ä¸ªå…ƒç´ ä¸­æŠ½å–å…ƒç´  11 ä½œä¸ºä¸€çº§ç´¢å¼•ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ 4 æ¬¡æŸ¥æ‰¾å°± èƒ½å®šä½åˆ°å…ƒç´  33 äº†ã€‚<br>&emsp;&emsp;å¦‚æœæˆ‘ä»¬è¿˜æƒ³å†å¿«ï¼Œå¯ä»¥å†å¢åŠ äºŒçº§ç´¢å¼•ï¼šä»ä¸€çº§ç´¢å¼•ä¸­ï¼Œå†æŠ½å–éƒ¨åˆ†å…ƒç´ ä½œä¸ºäºŒçº§ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œä»ä¸€çº§ç´¢å¼•ä¸­æŠ½å– 1ã€27ã€100 ä½œä¸ºäºŒçº§ç´¢å¼•ï¼ŒäºŒçº§ç´¢å¼•æŒ‡å‘ä¸€çº§ç´¢å¼•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦ 3 æ¬¡æŸ¥æ‰¾ï¼Œå°±èƒ½å®šä½åˆ°å…ƒç´  33 äº†ã€‚<br>&emsp;&emsp;å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å°±æ˜¯åœ¨å¤šçº§ç´¢å¼•ä¸Šè·³æ¥è·³å»ï¼Œæœ€åå®šä½åˆ°å…ƒç´ ã€‚è¿™ä¹Ÿæ­£å¥½ç¬¦åˆâ€œè·³â€è¡¨çš„å«æ³•ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè·³è¡¨çš„æŸ¥æ‰¾å¤æ‚åº¦å°±æ˜¯ O(logN)ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis9.jpg" alt="avatar"></p><h2 id="ä¸åŒæ“ä½œçš„å¤æ‚åº¦"><a href="#ä¸åŒæ“ä½œçš„å¤æ‚åº¦" class="headerlink" title="ä¸åŒæ“ä½œçš„å¤æ‚åº¦"></a>ä¸åŒæ“ä½œçš„å¤æ‚åº¦</h2><ol><li>==å•å…ƒç´ æ“ä½œ==ï¼Œæ˜¯æŒ‡æ¯ä¸€ç§é›†åˆç±»å‹å¯¹å•ä¸ªæ•°æ®å®ç°çš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚ä¾‹å¦‚ï¼ŒHash ç±»å‹çš„ HGETã€HSET å’Œ HDELï¼ŒSet ç±»å‹çš„ SADDã€SREMã€SRANDMEMBER ç­‰ã€‚è¿™äº›æ“ä½œçš„å¤æ‚åº¦ç”±é›†åˆé‡‡ç”¨çš„æ•°æ®ç»“æ„å†³å®šï¼Œä¾‹å¦‚ï¼ŒHGETã€HSET å’Œ HDEL æ˜¯å¯¹å“ˆå¸Œè¡¨åšæ“ä½œï¼Œæ‰€ä»¥å®ƒä»¬çš„å¤æ‚åº¦éƒ½æ˜¯ O(1)ï¼›Set ç±»å‹ç”¨å“ˆå¸Œè¡¨ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„æ—¶ï¼Œå®ƒçš„ SADDã€ SREMã€SRANDMEMBER å¤æ‚åº¦ä¹Ÿæ˜¯ O(1)ã€‚é›†åˆç±»å‹æ”¯æŒåŒæ—¶å¯¹å¤šä¸ªå…ƒç´ è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼Œä¾‹å¦‚ Hash ç±»å‹çš„ HMGET å’Œ HMSETï¼ŒSet ç±»å‹çš„ SADD ä¹Ÿæ”¯æŒåŒæ—¶å¢åŠ å¤šä¸ªå…ƒç´ ã€‚æ­¤æ—¶ï¼Œè¿™äº›æ“ä½œçš„å¤æ‚åº¦ï¼Œå°±æ˜¯ç”±å•ä¸ªå…ƒç´ æ“ä½œå¤æ‚åº¦å’Œå…ƒç´ ä¸ªæ•°å†³å®šçš„ã€‚ä¾‹å¦‚ï¼ŒHMSET å¢åŠ  M ä¸ªå…ƒç´ æ—¶ï¼Œå¤æ‚åº¦å°±ä» O(1) å˜æˆ O(M) äº†ã€‚</li><li>==èŒƒå›´æ“ä½œ==ï¼Œ<strong>æ˜¯æŒ‡é›†åˆç±»å‹ä¸­çš„éå†æ“ä½œï¼Œå¯ä»¥è¿”å›é›†åˆä¸­çš„æ‰€æœ‰æ•°æ®</strong>ï¼Œæ¯”å¦‚ Hash ç±»å‹çš„ HGETALL å’Œ Set ç±»å‹çš„ SMEMBERSï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªèŒƒå›´å†…çš„éƒ¨åˆ†æ•°æ®ï¼Œæ¯”å¦‚ List ç±»å‹çš„ LRANGE å’Œ ZSet ç±»å‹çš„ ZRANGEã€‚<strong>è¿™ç±»æ“ä½œçš„å¤æ‚åº¦ä¸€èˆ¬æ˜¯ O(N)ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œ æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…</strong>ã€‚ä¸è¿‡ï¼ŒRedis ä» 2.8 ç‰ˆæœ¬å¼€å§‹æä¾›äº† SCAN ç³»åˆ—æ“ä½œï¼ˆåŒ…æ‹¬ HSCANï¼ŒSSCAN å’Œ ZSCANï¼‰ï¼Œè¿™ç±»æ“ä½œå®ç°äº†<strong>æ¸è¿›å¼éå†</strong>ï¼Œæ¯æ¬¡åªè¿”å›æœ‰é™æ•°é‡çš„æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œç›¸æ¯”äº HGETALLã€SMEMBERS è¿™ç±»æ“ä½œæ¥è¯´ï¼Œå°±é¿å…äº†ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰å…ƒç´ è€Œå¯¼è‡´çš„ Redis é˜»å¡ã€‚</li><li>==ç»Ÿè®¡æ“ä½œ==ï¼Œæ˜¯æŒ‡<strong>é›†åˆç±»å‹å¯¹é›†åˆä¸­æ‰€æœ‰å…ƒç´ ä¸ªæ•°çš„è®°å½•</strong>ï¼Œä¾‹å¦‚ LLEN å’Œ SCARDã€‚è¿™ç±»æ“ä½œå¤æ‚åº¦åªæœ‰ O(1)ï¼Œè¿™æ˜¯å› ä¸ºå½“é›†åˆç±»å‹é‡‡ç”¨å‹ç¼©åˆ—è¡¨ã€åŒå‘é“¾è¡¨ã€æ•´æ•°æ•°ç»„è¿™äº›æ•°æ®ç»“æ„æ—¶ï¼Œè¿™äº›ç»“æ„ä¸­ä¸“é—¨è®°å½•äº†å…ƒç´ çš„ä¸ªæ•°ç»Ÿè®¡ï¼Œå› æ­¤å¯ä»¥é«˜æ•ˆåœ°å®Œæˆç›¸å…³æ“ä½œã€‚</li><li>==ä¾‹å¤–æƒ…å†µ==ï¼Œæ˜¯æŒ‡æŸäº›æ•°æ®ç»“æ„çš„ç‰¹æ®Šè®°å½•ï¼Œä¾‹å¦‚<strong>å‹ç¼©åˆ—è¡¨å’ŒåŒå‘é“¾è¡¨éƒ½ä¼šè®°å½•è¡¨å¤´å’Œè¡¨å°¾çš„åç§»é‡</strong>ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¯¹äº List ç±»å‹çš„ LPOPã€RPOPã€LPUSHã€RPUSH è¿™å››ä¸ªæ“ä½œæ¥è¯´ï¼Œå®ƒä»¬æ˜¯åœ¨åˆ—è¡¨çš„å¤´å°¾å¢åˆ å…ƒç´ ï¼Œè¿™å°±å¯ä»¥é€šè¿‡åç§»é‡ç›´æ¥å®šä½ï¼Œæ‰€ä»¥å®ƒä»¬çš„å¤æ‚åº¦ä¹Ÿåªæœ‰ O(1)ï¼Œå¯ä»¥å®ç°å¿«é€Ÿæ“ä½œã€‚</li></ol><h2 id="Redisé€‰æ‹©ä¸åŒæ•°æ®ç»“æ„çš„è€ƒé‡"><a href="#Redisé€‰æ‹©ä¸åŒæ•°æ®ç»“æ„çš„è€ƒé‡" class="headerlink" title="Redisé€‰æ‹©ä¸åŒæ•°æ®ç»“æ„çš„è€ƒé‡"></a>Redisé€‰æ‹©ä¸åŒæ•°æ®ç»“æ„çš„è€ƒé‡</h2><p>&emsp;&emsp;Redis ä¹‹æ‰€ä»¥èƒ½å¿«é€Ÿæ“ä½œé”®å€¼å¯¹ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸º O(1) å¤æ‚åº¦çš„å“ˆå¸Œè¡¨è¢«å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Stringã€Hash å’Œ Setï¼Œå®ƒä»¬çš„æ“ä½œå¤æ‚åº¦åŸºæœ¬ç”±å“ˆå¸Œè¡¨å†³å®šï¼Œå¦ä¸€æ–¹é¢ï¼ŒSorted Set ä¹Ÿé‡‡ç”¨äº† O(logN) å¤æ‚åº¦çš„è·³è¡¨ã€‚ä¸è¿‡ï¼Œé›†åˆç±»å‹çš„èŒƒå›´æ“ä½œï¼Œå› ä¸ºè¦éå†åº•å±‚æ•°æ®ç»“æ„ï¼Œå¤ æ‚åº¦é€šå¸¸æ˜¯ O(N)ã€‚è¿™é‡Œï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼šç”¨å…¶ä»–å‘½ä»¤æ¥æ›¿ä»£ï¼Œä¾‹å¦‚å¯ä»¥ç”¨ SCAN æ¥ä»£æ›¿ï¼Œ é¿å…åœ¨ Redis å†…éƒ¨äº§ç”Ÿè´¹æ—¶çš„å…¨é›†åˆéå†æ“ä½œã€‚<br>&emsp;&emsp;å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¿˜äº†å¤æ‚åº¦è¾ƒé«˜çš„ List ç±»å‹ï¼Œå®ƒçš„ä¸¤ç§åº•å±‚å®ç°ç»“æ„ï¼šåŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨çš„æ“ä½œå¤æ‚åº¦éƒ½æ˜¯ O(N)ã€‚ä½†æ˜¯å®ƒçš„ POP/PUSH æ•ˆç‡å¾ˆé«˜ï¼Œé‚£ä¹ˆå°±å°†å®ƒä¸»è¦ç”¨äº FIFO é˜Ÿåˆ—åœºæ™¯ï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ä¸ªå¯ä»¥éšæœºè¯»å†™çš„é›†åˆã€‚<strong>å¦å¤–ï¼ŒListåº•å±‚ä½¿ç”¨å‹ç¼©åˆ—è¡¨æœ¬è´¨ä¸Šæ˜¯å°†æ‰€æœ‰å…ƒç´ ç´§æŒ¨ç€å­˜å‚¨ï¼Œæ‰€ä»¥åˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œè™½ç„¶æ•°æ®ç»“æ„æœ¬èº«æ²¡æœ‰æ—¶é—´å¤æ‚åº¦çš„ä¼˜åŠ¿ï¼Œä½†æ˜¯è¿™æ ·èŠ‚çœç©ºé—´è€Œä¸”ä¹Ÿèƒ½é¿å…ä¸€ äº›å†…å­˜ç¢ç‰‡ï¼Œå®ƒæ¯”é“¾è¡¨å ç”¨çš„å†…å­˜è¦æ›´å°‘ã€‚ Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¤§é‡æ•°æ®å­˜åˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶éœ€è¦åšå°½å¯èƒ½çš„ä¼˜åŒ–ï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨ç‡ã€‚</strong></p><h1 id="é«˜æ€§èƒ½-IO-æ¨¡å‹"><a href="#é«˜æ€§èƒ½-IO-æ¨¡å‹" class="headerlink" title="é«˜æ€§èƒ½ IO æ¨¡å‹"></a>é«˜æ€§èƒ½ IO æ¨¡å‹</h1><p>&emsp;&emsp;é¦–å…ˆè¦å˜æ¸…ä¸€ä¸ªäº‹å®ï¼Œè¯´ Redis æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä¸»è¦æ˜¯æŒ‡ <strong>Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹çš„è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„</strong>ï¼Œè¿™ä¹Ÿæ˜¯ Redis å¯¹å¤–æä¾›é”®å€¼å­˜å‚¨æœåŠ¡çš„ä¸»è¦æµç¨‹ã€‚ ä½† Redis çš„å…¶ä»–åŠŸèƒ½ï¼Œæ¯”å¦‚æŒä¹…åŒ–ã€å¼‚æ­¥åˆ é™¤ã€é›†ç¾¤æ•°æ®åŒæ­¥ç­‰ï¼Œå…¶å®æ˜¯ç”±é¢å¤–çš„çº¿ç¨‹æ‰§è¡Œçš„ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹</h2><ol><li>==ä¸ºä»€ä¹ˆä¸ä½¿ç”¨å¤šçº¿ç¨‹==ï¼šå¹¶å‘è®¿é—®æ§åˆ¶ä¸€ç›´æ˜¯å¤šçº¿ç¨‹å¼€å‘ä¸­çš„ä¸€ä¸ªéš¾ç‚¹é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰ç²¾ç»†çš„è®¾è®¡ï¼Œæ¯”å¦‚è¯´ï¼Œåªæ˜¯ç®€å•åœ°é‡‡ç”¨ä¸€ä¸ªç²—ç²’åº¦äº’æ–¥é”ï¼Œå°±ä¼šå‡ºç°ä¸ç†æƒ³çš„ç»“æœï¼šå³ä½¿å¢åŠ äº†çº¿ç¨‹ï¼Œå¤§éƒ¨åˆ†çº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…è·å–è®¿é—®å…±äº«èµ„æºçš„äº’æ–¥é”ï¼Œå¹¶è¡Œå˜ä¸²è¡Œï¼Œç³»ç»Ÿååç‡å¹¶æ²¡æœ‰éšç€çº¿ç¨‹çš„å¢åŠ è€Œå¢åŠ ã€‚è€Œä¸”ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹å¼€å‘ä¸€èˆ¬ä¼šå¼•å…¥åŒæ­¥åŸè¯­æ¥ä¿æŠ¤å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ï¼Œè¿™ä¹Ÿä¼šé™ä½ç³»ç»Ÿä»£ç çš„æ˜“è°ƒè¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼ŒRedis ç›´æ¥é‡‡ç”¨äº†å•çº¿ç¨‹æ¨¡å¼ã€‚</li><li>==å•çº¿ç¨‹ Redis ä¸ºä»€ä¹ˆå¿«==ï¼šä¸€æ–¹é¢ï¼ŒRedis çš„å¤§éƒ¨åˆ†æ“ä½œåœ¨å†…å­˜ä¸Šå®Œæˆï¼Œå†åŠ ä¸Šå®ƒä½¿ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚å“ˆå¸Œè¡¨å’Œè·³è¡¨ï¼Œè¿™æ˜¯å®ƒå®ç°é«˜æ€§èƒ½çš„ä¸€ä¸ªé‡è¦åŸå› ã€‚å¦ä¸€æ–¹é¢ï¼Œå°±æ˜¯ Redis é‡‡ç”¨äº†å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œä½¿å…¶åœ¨ç½‘ç»œ IO æ“ä½œä¸­èƒ½å¹¶å‘å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå®ç°é«˜ååç‡ã€‚</li></ol><h2 id="åŸºæœ¬-IO-æ¨¡å‹ä¸é˜»å¡ç‚¹"><a href="#åŸºæœ¬-IO-æ¨¡å‹ä¸é˜»å¡ç‚¹" class="headerlink" title="åŸºæœ¬ IO æ¨¡å‹ä¸é˜»å¡ç‚¹"></a>åŸºæœ¬ IO æ¨¡å‹ä¸é˜»å¡ç‚¹</h2><p>&emsp;&emsp;Redis å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯å‘æ¥çš„ Get è¯·æ±‚ï¼Œè¦ç»è¿‡ä»¥ä¸‹æ­¥éª¤ï¼šè¦ç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ ï¼ˆbind/listenï¼‰ï¼Œå’Œå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ï¼ˆacceptï¼‰ï¼Œä» socket ä¸­è¯»å–è¯·æ±‚ï¼ˆrecvï¼‰ï¼Œè§£æå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ˆparseï¼‰ï¼Œæ ¹æ®è¯·æ±‚ç±»å‹è¯»å–é”®å€¼æ•°æ®ï¼ˆgetï¼‰ï¼Œæœ€åç»™å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œå³å‘ socket ä¸­å†™å›æ•°æ®ï¼ˆsendï¼‰ã€‚<br>&emsp;&emsp;ä¸‹å›¾æ˜¾ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼Œå…¶ä¸­ï¼Œbind/listenã€acceptã€recvã€parse å’Œ send å±äºç½‘ç»œ IO å¤„ç†ï¼Œè€Œ get å±äºé”®å€¼æ•°æ®æ“ä½œã€‚æ—¢ç„¶ Redis æ˜¯å•çº¿ç¨‹ï¼Œé‚£ä¹ˆï¼Œæœ€åŸºæœ¬çš„ä¸€ç§å®ç°æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¾æ¬¡æ‰§è¡Œä¸Šé¢è¯´çš„è¿™äº›æ“ä½œã€‚<br><img lazyload src="/images/loading.svg" data-src="redis10.jpg" alt="avatar"><br>&emsp;&emsp;ä½†æ˜¯ï¼Œåœ¨è¿™é‡Œçš„ç½‘ç»œ IO æ“ä½œä¸­ï¼Œæœ‰æ½œåœ¨çš„é˜»å¡ç‚¹ï¼Œåˆ†åˆ«æ˜¯ accept() å’Œ recv()ã€‚å½“ Redis ç›‘å¬åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯æœ‰è¿æ¥è¯·æ±‚ï¼Œä½†ä¸€ç›´==æœªèƒ½æˆåŠŸå»ºç«‹èµ·è¿æ¥==æ—¶ï¼Œä¼šé˜»å¡åœ¨ accept() å‡½æ•°è¿™é‡Œï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯æ— æ³•å’Œ Redis å»ºç«‹è¿æ¥ã€‚ç±»ä¼¼çš„ï¼Œå½“ Redis é€šè¿‡ recv() ä»ä¸€ä¸ªå®¢æˆ·ç«¯è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœ==æ•°æ®ä¸€ç›´æ²¡æœ‰åˆ°è¾¾==ï¼ŒRedis ä¹Ÿä¼šä¸€ç›´é˜»å¡åœ¨ recv()ã€‚è¿™å°±å¯¼è‡´ Redis æ•´ä¸ªçº¿ç¨‹é˜»å¡ï¼Œæ— æ³•å¤„ç†å…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæ•ˆç‡å¾ˆä½ã€‚ä¸è¿‡ï¼Œå¹¸è¿çš„æ˜¯ï¼Œ socket ç½‘ç»œæ¨¡å‹æœ¬èº«æ”¯æŒéé˜»å¡æ¨¡å¼ã€‚</p><h3 id="éé˜»å¡æ¨¡å¼"><a href="#éé˜»å¡æ¨¡å¼" class="headerlink" title="éé˜»å¡æ¨¡å¼"></a>éé˜»å¡æ¨¡å¼</h3><p>&emsp;&emsp;åœ¨ socket æ¨¡å‹ä¸­ï¼Œä¸åŒæ“ä½œè°ƒç”¨åä¼šè¿”å›ä¸åŒçš„å¥—æ¥å­—ç±»å‹ã€‚socket() æ–¹æ³•ä¼šè¿”å›ä¸»åŠ¨å¥—æ¥å­—ï¼Œç„¶åè°ƒç”¨ listen() æ–¹æ³•ï¼Œå°†ä¸»åŠ¨å¥—æ¥å­—è½¬åŒ–ä¸ºç›‘å¬å¥—æ¥å­—ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚æœ€åï¼Œè°ƒç”¨ accept() æ–¹æ³•æ¥æ”¶åˆ°è¾¾çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶è¿”å›å·²è¿æ¥å¥—æ¥å­—ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis11.jpg" alt="avatar"><br>&emsp;&emsp;é’ˆå¯¹ç›‘å¬å¥—æ¥å­—ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®éé˜»å¡æ¨¡å¼ï¼šå½“ Redis è°ƒç”¨ accept() ä½†ä¸€ç›´æœªæœ‰è¿æ¥è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒRedis çº¿ç¨‹å¯ä»¥è¿”å›å¤„ç†å…¶ä»–æ“ä½œï¼Œè€Œä¸ç”¨ä¸€ç›´ç­‰å¾…ã€‚ä½†æ˜¯ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨ accept() æ—¶ï¼Œå·²ç»å­˜åœ¨ç›‘å¬å¥—æ¥å­—äº†ã€‚<br>&emsp;&emsp;è™½ç„¶ Redis çº¿ç¨‹å¯ä»¥ä¸ç”¨ç»§ç»­ç­‰å¾…ï¼Œä½†æ˜¯æ€»å¾—æœ‰æœºåˆ¶ç»§ç»­åœ¨ç›‘å¬å¥—æ¥å­—ä¸Šç­‰å¾…åç»­è¿æ¥è¯·æ±‚ï¼Œå¹¶åœ¨æœ‰è¯·æ±‚æ—¶é€šçŸ¥ Redisã€‚ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é’ˆå¯¹å·²è¿æ¥å¥—æ¥å­—è®¾ç½®éé˜»å¡æ¨¡å¼ï¼šRedis è°ƒç”¨ recv() åï¼Œå¦‚æœå·²è¿ æ¥å¥—æ¥å­—ä¸Šä¸€ç›´æ²¡æœ‰æ•°æ®åˆ°è¾¾ï¼ŒRedis çº¿ç¨‹åŒæ ·å¯ä»¥è¿”å›å¤„ç†å…¶ä»–æ“ä½œã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰æœº åˆ¶ç»§ç»­ç›‘å¬è¯¥å·²è¿æ¥å¥—æ¥å­—ï¼Œå¹¶åœ¨æœ‰æ•°æ®è¾¾åˆ°æ—¶é€šçŸ¥ Redisã€‚è¿™æ ·æ‰èƒ½ä¿è¯ Redis çº¿ç¨‹ï¼Œæ—¢ä¸ä¼šåƒåŸºæœ¬ IO æ¨¡å‹ä¸­ä¸€ç›´åœ¨é˜»å¡ç‚¹ç­‰å¾…ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´ Redis æ— æ³•å¤„ç†å®é™…åˆ°è¾¾çš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®ã€‚</p><p>åˆ°æ­¤ï¼ŒLinux ä¸­çš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶å°±è¦ç™»åœºäº†ã€‚</p><h3 id="åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½-I-O-æ¨¡å‹"><a href="#åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½-I-O-æ¨¡å‹" class="headerlink" title="åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½ I/O æ¨¡å‹"></a>åŸºäºå¤šè·¯å¤ç”¨çš„é«˜æ€§èƒ½ I/O æ¨¡å‹</h3><p>&emsp;&emsp;Linux ä¸­çš„ IO å¤šè·¯å¤ç”¨æœºåˆ¶æ˜¯æŒ‡ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO æµï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„ select/epoll æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨ Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­ï¼Œ<strong>åŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬å¥—æ¥å­—å’Œå·²è¿æ¥å¥—æ¥å­—</strong>ã€‚å†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº›å¥—æ¥å­—ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚ä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†ï¼Œè¿™å°±å®ç°äº†ä¸€ä¸ª Redis çº¿ç¨‹å¤„ç†å¤šä¸ª IO æµçš„æ•ˆæœã€‚<br>&emsp;&emsp;ä¸‹å›¾å°±æ˜¯åŸºäºå¤šè·¯å¤ç”¨çš„ Redis IO æ¨¡å‹ã€‚å›¾ä¸­çš„å¤šä¸ª FD å°±æ˜¯åˆšæ‰æ‰€è¯´çš„å¤šä¸ªå¥—æ¥å­—ã€‚ Redis ç½‘ç»œæ¡†æ¶è°ƒç”¨ epoll æœºåˆ¶ï¼Œè®©å†…æ ¸ç›‘å¬è¿™äº›å¥—æ¥å­—ã€‚æ­¤æ—¶ï¼ŒRedis çº¿ç¨‹ä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªç‰¹å®šçš„ç›‘å¬æˆ–å·²è¿æ¥å¥—æ¥å­—ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šé˜»å¡åœ¨æŸä¸€ä¸ªç‰¹å®šçš„å®¢æˆ·ç«¯è¯·æ±‚å¤„ç† ä¸Šã€‚æ­£å› ä¸ºæ­¤ï¼ŒRedis å¯ä»¥åŒæ—¶å’Œå¤šä¸ªå®¢æˆ·ç«¯è¿æ¥å¹¶å¤„ç†è¯·æ±‚ï¼Œä»è€Œæå‡å¹¶å‘æ€§ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis12.jpg" alt="avatar"><br>&emsp;&emsp;ä¸ºäº†åœ¨è¯·æ±‚åˆ°è¾¾æ—¶èƒ½é€šçŸ¥åˆ° Redis çº¿ç¨‹ï¼Œselect/epoll æä¾›äº†åŸºäºäº‹ä»¶çš„å›è°ƒæœºåˆ¶ï¼Œå³é’ˆå¯¹ä¸åŒäº‹ä»¶çš„å‘ç”Ÿï¼Œè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚select/epoll ä¸€æ—¦ç›‘æµ‹åˆ° FD ä¸Šæœ‰è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œå°±ä¼šè§¦å‘ç›¸åº”çš„äº‹ä»¶ã€‚è¿™äº›äº‹ä»¶ä¼šè¢«æ”¾è¿›ä¸€ä¸ªäº‹ä»¶é˜Ÿåˆ—ï¼ŒRedis å•çº¿ç¨‹å¯¹è¯¥äº‹ä»¶é˜Ÿåˆ—ä¸æ–­è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œ Redis æ— éœ€ä¸€ç›´è½®è¯¢æ˜¯å¦æœ‰è¯·æ±‚å®é™…å‘ç”Ÿï¼Œè¿™å°±å¯ä»¥é¿å…é€ æˆ CPU èµ„æºæµªè´¹ã€‚åŒæ—¶ï¼Œ Redis åœ¨å¯¹äº‹ä»¶é˜Ÿåˆ—ä¸­çš„äº‹ä»¶è¿›è¡Œå¤„ç†æ—¶ï¼Œä¼šè°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œè¿™å°±å®ç°äº†åŸºäºäº‹ä»¶çš„å›è°ƒã€‚å› ä¸º Redis ä¸€ç›´åœ¨å¯¹äº‹ä»¶é˜Ÿåˆ—è¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥èƒ½åŠæ—¶å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œæå‡ Redis çš„å“åº”æ€§èƒ½ã€‚<br>&emsp;&emsp;ä»¥è¿æ¥è¯·æ±‚å’Œè¯»æ•°æ®è¯·æ±‚ä¸ºä¾‹ï¼Œå…·ä½“è§£é‡Šä¸€ä¸‹:<br>&emsp;&emsp;è¿™ä¸¤ä¸ªè¯·æ±‚åˆ†åˆ«å¯¹åº” Accept äº‹ä»¶å’Œ Read äº‹ä»¶ï¼ŒRedis åˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªäº‹ä»¶æ³¨å†Œ accept å’Œ get å›è°ƒå‡½æ•°ã€‚å½“ Linux å†…æ ¸ç›‘å¬åˆ°æœ‰è¿æ¥è¯·æ±‚æˆ–è¯»æ•°æ®è¯·æ±‚æ—¶ï¼Œå°±ä¼šè§¦å‘ Accept äº‹ä»¶ å’Œ Read äº‹ä»¶ï¼Œæ­¤æ—¶ï¼Œå†…æ ¸å°±ä¼šå›è°ƒ Redis ç›¸åº”çš„ accept å’Œ get å‡½æ•°è¿›è¡Œå¤„ç†ã€‚</p><h3 id="å¤šçº¿ç¨‹æ¨¡å‹"><a href="#å¤šçº¿ç¨‹æ¨¡å‹" class="headerlink" title="å¤šçº¿ç¨‹æ¨¡å‹"></a>å¤šçº¿ç¨‹æ¨¡å‹</h3><p>&emsp;&emsp;éšç€ç¡¬ä»¶æ€§èƒ½æå‡ï¼ŒRedis çš„æ€§èƒ½ç“¶é¢ˆå¯èƒ½å‡ºç°ç½‘ç»œ IO çš„è¯»å†™ï¼Œä¹Ÿå°±æ˜¯ï¼šå•ä¸ªçº¿ç¨‹å¤„ç†ç½‘ç»œè¯»å†™çš„é€Ÿåº¦è·Ÿä¸ä¸Šåº•å±‚ç½‘ç»œç¡¬ä»¶çš„é€Ÿåº¦ã€‚è¯»å†™ç½‘ç»œçš„ <code>read/write</code> ç³»ç»Ÿè°ƒç”¨å ç”¨äº†Redis æ‰§è¡ŒæœŸé—´å¤§éƒ¨åˆ†CPU æ—¶é—´ï¼Œç“¶é¢ˆä¸»è¦åœ¨äºç½‘ç»œçš„ IO æ¶ˆè€—ã€‚æ‰€ä»¥ï¼ŒRedis6.0ç‰ˆæœ¬ é‡‡ç”¨å¤šä¸ª IO çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œæé«˜ç½‘ç»œè¯·æ±‚å¤„ç†çš„å¹¶è¡Œåº¦ã€‚<strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis å¤š IO çº¿ç¨‹æ¨¡å‹åªç”¨æ¥å¤„ç†ç½‘ç»œè¯»å†™è¯·æ±‚ï¼Œå¯¹äº Redis çš„è¯»å†™å‘½ä»¤ï¼Œä¾ç„¶æ˜¯å•çº¿ç¨‹å¤„ç†</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œç½‘ç»œå¤„ç†ç»å¸¸æ˜¯ç“¶é¢ˆï¼Œé€šè¿‡å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†å¯æé«˜æ€§èƒ½ã€‚<br>æ¶æ„å›¾å¦‚ä¸‹ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis13.jpg" alt="avatar"><br>ä¸»çº¿ç¨‹ä¸ IO å¤šçº¿ç¨‹æ˜¯å¦‚ä½•å®ç°åä½œå‘¢ï¼Ÿ<br><img lazyload src="/images/loading.svg" data-src="redis14.jpg" alt="avatar"><br>ä¸»è¦æµç¨‹ï¼š</p><ol><li>ä¸»çº¿ç¨‹è´Ÿè´£æ¥æ”¶å»ºç«‹è¿æ¥è¯·æ±‚ï¼Œè·å– <code>socket</code> æ”¾å…¥å…¨å±€ç­‰å¾…è¯»å¤„ç†é˜Ÿåˆ—ï¼›</li><li>ä¸»çº¿ç¨‹é€šè¿‡è½®è¯¢å°†å¯è¯» <code>socket</code> åˆ†é…ç»™ IO çº¿ç¨‹ï¼›</li><li>ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾… IO çº¿ç¨‹è¯»å– <code>socket</code> å®Œæˆï¼›</li><li>ä¸»çº¿ç¨‹æ‰§è¡Œ IO çº¿ç¨‹è¯»å–å’Œè§£æå‡ºæ¥çš„ Redis è¯·æ±‚å‘½ä»¤ï¼›</li><li>ä¸»çº¿ç¨‹é˜»å¡ç­‰å¾… IO çº¿ç¨‹å°†æŒ‡ä»¤æ‰§è¡Œç»“æœå›å†™å› <code>socket</code>å®Œæ¯•ï¼›</li><li>ä¸»çº¿ç¨‹æ¸…ç©ºå…¨å±€é˜Ÿåˆ—ï¼Œç­‰å¾…å®¢æˆ·ç«¯åç»­çš„è¯·æ±‚ã€‚</li></ol><p>æ€è·¯ï¼š<strong>å°†ä¸»çº¿ç¨‹ IO è¯»å†™ä»»åŠ¡æ‹†åˆ†å‡ºæ¥ç»™ä¸€ç»„ç‹¬ç«‹çš„çº¿ç¨‹å¤„ç†ï¼Œä½¿å¾—å¤šä¸ª socket è¯»å†™å¯ä»¥å¹¶è¡ŒåŒ–ï¼Œä½†æ˜¯ Redis å‘½ä»¤è¿˜æ˜¯ä¸»çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œã€‚</strong></p><p>æ¨¡å‹ç¼ºé™·:<br>&emsp;&emsp;Redis çš„å¤šçº¿ç¨‹ç½‘ç»œæ¨¡å‹å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ <code>Multi-Reactors/Master-Workers</code> æ¨¡å‹ã€‚Redis çš„å¤šçº¿ç¨‹æ–¹æ¡ˆä¸­ï¼ŒI/O çº¿ç¨‹ä»»åŠ¡ä»…ä»…æ˜¯é€šè¿‡ socket è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å‘½ä»¤å¹¶è§£æï¼Œå´æ²¡æœ‰çœŸæ­£å»æ‰§è¡Œå‘½ä»¤ã€‚æ‰€æœ‰å®¢æˆ·ç«¯å‘½ä»¤æœ€åè¿˜éœ€è¦å›åˆ°ä¸»çº¿ç¨‹å»æ‰§è¡Œï¼Œå› æ­¤å¯¹å¤šæ ¸çš„åˆ©ç”¨ç‡å¹¶ä¸ç®—é«˜ï¼Œè€Œä¸”æ¯æ¬¡ä¸»çº¿ç¨‹éƒ½å¿…é¡»åœ¨åˆ†é…å®Œä»»åŠ¡ä¹‹åå¿™è½®è¯¢ç­‰å¾…æ‰€æœ‰ I/O çº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œå…¶ä»–é€»è¾‘ã€‚</p><h1 id="AOF-æ—¥å¿—"><a href="#AOF-æ—¥å¿—" class="headerlink" title="AOF æ—¥å¿—"></a>AOF æ—¥å¿—</h1><h2 id="AOF-æ—¥å¿—æ˜¯å¦‚ä½•å®ç°çš„"><a href="#AOF-æ—¥å¿—æ˜¯å¦‚ä½•å®ç°çš„" class="headerlink" title="AOF æ—¥å¿—æ˜¯å¦‚ä½•å®ç°çš„"></a>AOF æ—¥å¿—æ˜¯å¦‚ä½•å®ç°çš„</h2><p>&emsp;&emsp;å¯¹äºSQLè¿™ç±»çš„æ•°æ®åº“ï¼ŒåŸºæœ¬éƒ½æ˜¯å†™å‰æ—¥å¿—ï¼ˆWrite Ahead Log, WALï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨å®é™…å†™æ•°æ®å‰ï¼Œå…ˆå°†æ•°æ®è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œä»¥ä¾¿æ•…éšœæ—¶æ¢å¤ã€‚AOF æ­£å¥½ç›¸åï¼Œå®ƒæ˜¯å†™åæ—¥å¿—ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆæ‰§è¡Œ Redis å‘½ä»¤å†™å…¥æ•°æ®ï¼Œå†è®°å½•æ—¥å¿—ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis15.jpg" alt="avatar"></p><p>&emsp;&emsp;ä¼ ç»Ÿçš„æ•°æ®åº“æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯ä¿®æ”¹åçš„æ•°æ®ï¼Œè€Œ AOF è®°å½•çš„æ˜¯ Redis æ”¶åˆ°çš„æ¯ä¸€æ¡å‘½ä»¤ï¼Œè¿™äº›å‘½ä»¤æ˜¯ä»¥æ–‡æœ¬å½¢å¼ä¿å­˜ä¸‹æ¥çš„ã€‚æˆ‘ä»¬ä»¥ Redis æ”¶åˆ°â€œset testkey testvalueâ€å‘½ä»¤åè®°å½•çš„æ—¥å¿—ä¸ºä¾‹ï¼Œçœ‹çœ‹ AOF æ—¥å¿—çš„å†…å®¹ã€‚å…¶ä¸­ï¼Œâ€œ*3â€è¡¨ç¤ºå½“å‰å‘½ä»¤æœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†éƒ½æ˜¯ç”±â€œ$+æ•°å­—â€å¼€å¤´ï¼Œåé¢ç´§è·Ÿç€ å…·ä½“çš„å‘½ä»¤ã€é”®æˆ–å€¼ã€‚è¿™é‡Œï¼Œâ€œæ•°å­—â€è¡¨ç¤ºè¿™éƒ¨åˆ†ä¸­çš„å‘½ä»¤ã€é”®æˆ–å€¼ä¸€å…±æœ‰å¤šå°‘å­—èŠ‚ã€‚ä¾‹ å¦‚ï¼Œâ€œ$3 setâ€è¡¨ç¤ºè¿™éƒ¨åˆ†æœ‰ 3 ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯â€œsetâ€å‘½ä»¤ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis16.jpg" alt="avatar"></p><p>&emsp;&emsp;AOF é‡‡ç”¨å†™åæ—¥å¿—çš„æ–¹å¼æœ‰ä¸¤ä¸ªå¥½å¤„ï¼šç¬¬ä¸€ï¼Œä¸éœ€è¦æ¶ˆè€—é¢å¤–çš„èµ„æºæ£€æŸ¥å‘½ä»¤æ˜¯å¦æ­£ç¡®ï¼Œåªéœ€è¦åœ¨æˆåŠŸå†™å…¥ä¹‹åæ›´æ–°æ—¥å¿—å³å¯ï¼›ç¬¬äºŒï¼Œå› ä¸ºæ˜¯åœ¨å†™å…¥åæ›´æ–°æ—¥å¿—ï¼Œä¸å¿…æ‹…å¿ƒè¢«é˜»å¡å½“å‰çš„å†™æ“ä½œã€‚<br>&emsp;&emsp;ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿæœ‰å¤©ç„¶çš„ç¼ºç‚¹ï¼Œç¬¬ä¸€ï¼Œå¦‚æœåœ¨ä¸€æ¡å‘½ä»¤æˆåŠŸæ‰§è¡ŒåæœåŠ¡å™¨çªç„¶å®•æœºï¼Œæ­¤æ—¶è¿˜æ²¡æ¥å¾—åŠåœ¨ AOF æ—¥å¿—ä¸­ä¿å­˜ä¸‹è¿™æ¡å‘½ä»¤ï¼Œé‚£ä¹ˆå†é‡å¯æœåŠ¡åè¿™æ¡å‘½ä»¤çš„å†™å…¥/æ›´æ–°æ“ä½œå°±ä¸ä¼šè¢«æ‰§è¡Œï¼›ç¬¬äºŒï¼Œè™½ç„¶ä¸ä¼šé˜»å¡å½“å‰çš„å†™æ“ä½œï¼Œä½†æ˜¯å†™æ—¥å¿—ä¹Ÿæ˜¯åœ¨ä¸»è¿›ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå¦‚æœç£ç›˜çš„IOå‹åŠ›å¾ˆå¤§å¯¼è‡´å†™æ—¥å¿—å¾ˆæ…¢ï¼Œé‚£ä¹ˆä¹‹åçš„ Redis å‘½ä»¤å°±ä¼šè¢«é˜»å¡ã€‚<br>&emsp;&emsp;è¿™ä¸¤ä¸ªé£é™©éƒ½æ˜¯å’Œ AOF å†™å›ç£ç›˜çš„æ—¶æœºç›¸å…³çš„ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶ä¸€ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œå AOF æ—¥å¿—å†™å›ç£ç›˜çš„æ—¶æœºï¼Œè¿™ä¸¤ä¸ªé£é™©å°±è§£é™¤äº†ã€‚</p><h2 id="ä¸‰ç§å†™å›ç­–ç•¥"><a href="#ä¸‰ç§å†™å›ç­–ç•¥" class="headerlink" title="ä¸‰ç§å†™å›ç­–ç•¥"></a>ä¸‰ç§å†™å›ç­–ç•¥</h2><ul><li>Alwaysï¼ŒåŒæ­¥å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œç«‹é©¬åŒæ­¥åœ°å°†æ—¥å¿—å†™å›ç£ç›˜ï¼›</li><li>Everysecï¼Œæ¯ç§’å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œæ¯éš”ä¸€ç§’æŠŠç¼“å†²åŒºä¸­çš„å†…å®¹å†™å…¥ç£ç›˜ï¼›</li><li>Noï¼Œæ“ä½œç³»ç»Ÿæ§åˆ¶çš„å†™å›ï¼šæ¯ä¸ªå†™å‘½ä»¤æ‰§è¡Œå®Œï¼Œåªæ˜¯å…ˆæŠŠæ—¥å¿—å†™åˆ° AOF æ–‡ä»¶çš„å†…å­˜ç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜ã€‚</li></ul><p>ä¸‰ç§å†™å›ç­–ç•¥çš„æ¯”è¾ƒï¼š<br><img lazyload src="/images/loading.svg" data-src="redis17.jpg" alt="avatar"><br>&emsp;&emsp;è¿™æ—¶æˆ‘ä»¬å°±è¦æ ¹æ®æˆ‘ä»¬çš„ç³»ç»Ÿçš„éœ€æ±‚æ¥è¿›è¡Œ trade-off äº†ï¼Œå¦‚æœæƒ³è¦ä¿è¯é«˜å¯é ï¼Œé‚£ä¹ˆå°±é‡‡å– Always çš„ç­–ç•¥ï¼›å¦‚æœè¿½æ±‚çš„æ˜¯é«˜æ€§èƒ½ï¼Œé‚£ä¹ˆä¹…é‡‡ç”¨ no ç­–ç•¥ï¼Œå°†æ§åˆ¶å†™å›çš„æ—¶æœºå®Œå…¨äº¤ç»™æ“ä½œç³»ç»Ÿï¼›å¦‚æœæƒ³è¦å…¼é¡¾ä¸¤è€…ï¼Œé‚£å°±é€‰æ‹© everysec ç­–ç•¥ã€‚</p><h2 id="AOF-é‡å†™æœºåˆ¶"><a href="#AOF-é‡å†™æœºåˆ¶" class="headerlink" title="AOF é‡å†™æœºåˆ¶"></a>AOF é‡å†™æœºåˆ¶</h2><p>&emsp;&emsp;éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒRedis çš„ AOF æ—¥å¿—æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶å¯èƒ½æœ‰ä¸‰ç§å› ç´ å…±åŒåˆ¶çº¦æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼š</p><ol><li>æ“ä½œç³»ç»Ÿå¯¹æ¯ä¸ªæ–‡ä»¶çš„å¤§å°ä¸Šé™æœ‰é™åˆ¶ï¼›</li><li>æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œæ¯æ¬¡è¦æ‰“å¼€æ–‡ä»¶å¾€é‡Œé¢å†™å…¥ï¼Œå¯¹æ€§èƒ½çš„æŸè€—å°±è¶Šå¤§ï¼›</li><li>å½“ä½¿ç”¨ AOF æ—¥å¿—æ¢å¤æ•°æ®æ—¶ï¼Œç”±äº AOF æ—¥å¿—è¿‡å¤§ï¼Œæ•´ä¸ªæ¢å¤è¿‡ç¨‹å°±ä¼šå¾ˆæ…¢ã€‚</li></ol><p>&emsp;&emsp;è¿™ä¸ªæ—¶å€™ï¼ŒAOF é‡å†™æœºåˆ¶å°±ç™»åœºäº†ã€‚AOF ä¼šæ ¹æ®æ—¥å¿—çš„ç°çŠ¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå¯¹ä¸€ä¸ªé”®å€¼å¯¹çš„ä¿®æ”¹å¯èƒ½æ˜¯ç»è¿‡å¾ˆå¤šæ¡ Redis å‘½ä»¤åå½¢æˆçš„æœ€ç»ˆçš„ç»“æœï¼Œæ­¤æ—¶åªéœ€è¦ä¸€æ¡å‘½ä»¤å°±èƒ½æ›¿æ¢æ‰ä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªé”®å€¼å¯¹åœ¨é‡å†™æ—¥å¿—ä¸­åªç”¨ä¸€æ¡å‘½ä»¤å°±è¡Œäº†ï¼Œåœ¨æ—¥å¿—æ¢å¤æ—¶ï¼Œåªç”¨æ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼Œå°±å¯ä»¥ç›´æ¥å®Œæˆè¿™ä¸ªé”®å€¼å¯¹çš„å†™å…¥äº†ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼š<br><img lazyload src="/images/loading.svg" data-src="redis18.jpg" alt="avatar"></p><p>&emsp;&emsp;é‡å†™æœºåˆ¶è™½ç„¶èƒ½å¤Ÿå¤§å¤§ç¼©å‡æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œä½†æ˜¯å¯ä»¥æƒ³è§ï¼Œè¿™å¿…å®šæ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—èµ„æºçš„æ“ä½œï¼Œé‚£ä¹ˆ AOF é‡å†™ä¼šé˜»å¡ä¸»çº¿ç¨‹å—ï¼Ÿä¸ºé¿å… AOF é‡å†™é˜»å¡ä¸»çº¿ç¨‹ï¼Œé‡å†™è¿‡ç¨‹ä¼šåœ¨åå°èµ·ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆã€‚å¯ä»¥æ€»ç»“ä¸ºä¸€å¥è¯ï¼šâ€œ<strong>ä¸€ä¸ªæ‹·è´ï¼Œä¸¤å¤„æ—¥å¿—</strong>â€ã€‚</p><ul><li><strong>ä¸€ä¸ªæ‹·è´</strong>ï¼šä¸»çº¿ç¨‹ fork ä¸€ä¸ªçº¿ç¨‹æ¥é‡å†™ AOF æ—¥å¿—æ—¶ï¼Œä¼šå°†ä¸»çº¿ç¨‹å†…å­˜æ‹·è´ä¸€ä»½ç»™å­çº¿ç¨‹ï¼Œè¿™é‡Œé¢åŒ…å«äº†æ•°æ®åº“çš„æœ€æ–°æ•°æ®ï¼Œå­çº¿ç¨‹å°±å¯ä»¥åœ¨ä¸å½±å“ä¸»çº¿ç¨‹çš„å‰æä¸‹é€ä¸€æŠŠæ‹·è´çš„æ•°æ®å†™æˆæ“ä½œå­˜å…¥é‡å†™æ—¥å¿—ã€‚</li><li><strong>ä¸¤å¤„æ—¥å¿—</strong>ï¼šå¦‚æœæœ‰å†™æ“ä½œï¼Œç¬¬ä¸€å¤„æ—¥å¿—å°±æ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨çš„ AOF æ—¥å¿—ï¼ŒRedis ä¼šæŠŠè¿™ä¸ªæ“ä½œå†™åˆ°å®ƒçš„ç¼“å†²åŒºã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºäº†ï¼Œè¿™ ä¸ª AOF æ—¥å¿—çš„æ“ä½œä»ç„¶æ˜¯é½å…¨çš„ï¼Œå¯ä»¥ç”¨äºæ¢å¤ï¼›è€Œç¬¬äºŒå¤„æ—¥å¿—ï¼Œå°±æ˜¯æŒ‡æ–°çš„ AOF é‡å†™æ—¥å¿—ã€‚è¿™ä¸ªæ“ä½œä¹Ÿä¼šè¢«å†™åˆ°é‡å†™æ—¥å¿—çš„ç¼“å†²åŒºã€‚è¿™ æ ·ï¼Œé‡å†™æ—¥å¿—ä¹Ÿä¸ä¼šä¸¢å¤±æœ€æ–°çš„æ“ä½œã€‚ç­‰åˆ°æ‹·è´æ•°æ®çš„æ‰€æœ‰æ“ä½œè®°å½•é‡å†™å®Œæˆåï¼Œé‡å†™æ—¥ å¿—è®°å½•çš„è¿™äº›æœ€æ–°æ“ä½œä¹Ÿä¼šå†™å…¥æ–°çš„ AOF æ–‡ä»¶ï¼Œä»¥ä¿è¯æ•°æ®åº“æœ€æ–°çŠ¶æ€çš„è®°å½•ã€‚æ­¤æ—¶ï¼Œæˆ‘ ä»¬å°±å¯ä»¥ç”¨æ–°çš„ AOF æ–‡ä»¶æ›¿ä»£æ—§æ–‡ä»¶äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis19.jpg" alt="avatar"><br>&emsp;&emsp; æ€»ç»“æ¥è¯´ï¼Œæ¯æ¬¡ AOF é‡å†™æ—¶ï¼ŒRedis ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå†…å­˜æ‹·è´ï¼Œç”¨äºé‡å†™ï¼›ç„¶åï¼Œä½¿ç”¨ä¸¤ä¸ª æ—¥å¿—ä¿è¯åœ¨é‡å†™è¿‡ç¨‹ä¸­ï¼Œæ–°å†™å…¥çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚è€Œä¸”ï¼Œå› ä¸º Redis é‡‡ç”¨é¢å¤–çš„çº¿ç¨‹è¿›è¡Œæ•°æ®é‡å†™ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</li></ul><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><ol><li>AOF æ—¥å¿—é‡å†™çš„æ—¶å€™ï¼Œæ˜¯ç”± bgrewriteaof å­è¿›ç¨‹æ¥å®Œæˆçš„ï¼Œä¸ç”¨ä¸»çº¿ç¨‹å‚ä¸ï¼Œæˆ‘ä»¬ä»Šå¤©è¯´çš„éé˜»å¡ä¹Ÿæ˜¯æŒ‡å­è¿›ç¨‹çš„æ‰§è¡Œä¸é˜»å¡ä¸»çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œä½ è§‰å¾—ï¼Œè¿™ä¸ªé‡å†™è¿‡ç¨‹æœ‰æ²¡æœ‰å…¶ä»–æ½œåœ¨çš„é˜»å¡é£é™©å‘¢ï¼Ÿå¦‚æœæœ‰çš„è¯ï¼Œä¼šåœ¨å“ªé‡Œé˜»å¡ï¼Ÿ<br>ç­”ï¼šforkå­è¿›ç¨‹ï¼Œforkè¿™ä¸ªç¬é—´ä¸€å®šæ˜¯ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„ï¼ˆæ³¨æ„ï¼Œforkæ—¶å¹¶ä¸ä¼šä¸€æ¬¡æ€§æ‹·è´æ‰€æœ‰å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹ï¼‰ï¼Œforké‡‡ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„å†™å®å¤åˆ¶(Copy On Write)æœºåˆ¶ï¼Œå°±æ˜¯ä¸ºäº†é¿å…ä¸€æ¬¡æ€§æ‹·è´å¤§é‡å†…å­˜æ•°æ®ç»™å­è¿›ç¨‹é€ æˆçš„é•¿æ—¶é—´é˜»å¡é—®é¢˜ï¼Œä½†<strong>forkå­è¿›ç¨‹éœ€è¦æ‹·è´è¿›ç¨‹å¿…è¦çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯æ‹·è´å†…å­˜é¡µè¡¨</strong>ï¼ˆè™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„æ˜ å°„ç´¢å¼•è¡¨ï¼‰ï¼Œè¿™ä¸ªæ‹·è´è¿‡ç¨‹ä¼šæ¶ˆè€—å¤§é‡CPUèµ„æºï¼Œæ‹·è´å®Œæˆä¹‹å‰æ•´ä¸ªè¿›ç¨‹æ˜¯ä¼šé˜»å¡çš„ï¼Œé˜»å¡æ—¶é—´å–å†³äºæ•´ä¸ªå®ä¾‹çš„å†…å­˜å¤§å°ï¼Œå®ä¾‹è¶Šå¤§ï¼Œå†…å­˜é¡µè¡¨è¶Šå¤§ï¼Œforké˜»å¡æ—¶é—´è¶Šä¹…ã€‚æ‹·è´å†…å­˜é¡µè¡¨å®Œæˆåï¼Œå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹æŒ‡å‘ç›¸åŒçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶è™½ç„¶äº§ç”Ÿäº†å­è¿›ç¨‹ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”³è¯·ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„å†…å­˜å¤§å°ã€‚é‚£ä»€ä¹ˆæ—¶å€™çˆ¶å­è¿›ç¨‹æ‰ä¼šçœŸæ­£å†…å­˜åˆ†ç¦»å‘¢ï¼Ÿâ€œå†™å®å¤åˆ¶â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯åœ¨å†™å‘ç”Ÿæ—¶ï¼Œæ‰çœŸæ­£æ‹·è´å†…å­˜çœŸæ­£çš„æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œçˆ¶è¿›ç¨‹ä¹Ÿå¯èƒ½ä¼šäº§ç”Ÿé˜»å¡çš„é£é™©ï¼Œå°±æ˜¯ä¸‹é¢ä»‹ç»çš„åœºæ™¯ã€‚</li></ol><p>forkå‡ºçš„å­è¿›ç¨‹æŒ‡å‘ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ­¤æ—¶å­è¿›ç¨‹å°±å¯ä»¥æ‰§è¡ŒAOFé‡å†™ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®å†™å…¥åˆ°AOFæ–‡ä»¶ä¸­ã€‚ä½†æ˜¯æ­¤æ—¶çˆ¶è¿›ç¨‹ä¾æ—§æ˜¯ä¼šæœ‰æµé‡å†™å…¥çš„ï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ“ä½œçš„æ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„keyï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å°±ä¼šçœŸæ­£æ‹·è´è¿™ä¸ªkeyå¯¹åº”çš„å†…å­˜æ•°æ®ï¼Œç”³è¯·æ–°çš„å†…å­˜ç©ºé—´ï¼Œè¿™æ ·é€æ¸åœ°ï¼Œçˆ¶å­è¿›ç¨‹å†…å­˜æ•°æ®å¼€å§‹åˆ†ç¦»ï¼Œçˆ¶å­è¿›ç¨‹é€æ¸æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„å†…å­˜ç©ºé—´ã€‚å› ä¸ºå†…å­˜åˆ†é…æ˜¯ä»¥é¡µä¸ºå•ä½è¿›è¡Œåˆ†é…çš„ï¼Œé»˜è®¤4kï¼Œå¦‚æœçˆ¶è¿›ç¨‹æ­¤æ—¶æ“ä½œçš„æ˜¯ä¸€ä¸ªbigkeyï¼Œé‡æ–°ç”³è¯·å¤§å—å†…å­˜è€—æ—¶ä¼šå˜é•¿ï¼Œå¯èƒ½ä¼šäº§é˜»å¡é£é™©ã€‚å¦å¤–ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿå¼€å¯äº†å†…å­˜å¤§é¡µæœºåˆ¶(Huge Pageï¼Œé¡µé¢å¤§å°2M)ï¼Œé‚£ä¹ˆçˆ¶è¿›ç¨‹ç”³è¯·å†…å­˜æ—¶é˜»å¡çš„æ¦‚ç‡å°†ä¼šå¤§å¤§æé«˜ï¼Œæ‰€ä»¥åœ¨Redisæœºå™¨ä¸Šéœ€è¦å…³é—­Huge Pageæœºåˆ¶ã€‚Redisæ¯æ¬¡forkç”ŸæˆRDBæˆ–AOFé‡å†™å®Œæˆåï¼Œéƒ½å¯ä»¥åœ¨Redis logä¸­çœ‹åˆ°çˆ¶è¿›ç¨‹é‡æ–°ç”³è¯·äº†å¤šå¤§çš„å†…å­˜ç©ºé—´ã€‚</p><ol start="2"><li>AOF é‡å†™ä¹Ÿæœ‰ä¸€ä¸ªé‡å†™æ—¥å¿—ï¼Œä¸ºä»€ä¹ˆå®ƒä¸å…±äº«ä½¿ç”¨ AOF æœ¬èº«çš„æ—¥å¿—å‘¢ï¼Ÿ<br>ç­”ï¼šä¸€ä¸ªåŸå› æ˜¯çˆ¶å­è¿›ç¨‹å†™åŒä¸€ä¸ªæ–‡ä»¶å¿…ç„¶ä¼šäº§ç”Ÿç«äº‰é—®é¢˜ï¼Œæ§åˆ¶ç«äº‰å°±æ„å‘³ç€ä¼šå½±å“çˆ¶è¿›ç¨‹çš„æ€§èƒ½ã€‚äºŒæ˜¯å¦‚æœAOFé‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œé‚£ä¹ˆåŸæœ¬çš„AOFæ–‡ä»¶ç›¸å½“äºè¢«æ±¡æŸ“äº†ï¼Œæ— æ³•åšæ¢å¤ä½¿ç”¨ã€‚æ‰€ä»¥Redis AOFé‡å†™ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œé‡å†™å¤±è´¥çš„è¯ï¼Œç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶å°±å¥½äº†ï¼Œä¸ä¼šå¯¹åŸå…ˆçš„AOFæ–‡ä»¶äº§ç”Ÿå½±å“ã€‚ç­‰é‡å†™å®Œæˆä¹‹åï¼Œç›´æ¥æ›¿æ¢æ—§æ–‡ä»¶å³å¯ã€‚</li></ol><h1 id="RDB-å†…å­˜å¿«ç…§"><a href="#RDB-å†…å­˜å¿«ç…§" class="headerlink" title="RDB å†…å­˜å¿«ç…§"></a>RDB å†…å­˜å¿«ç…§</h1><p>&emsp;&emsp;ä¸Šä¸€èŠ‚è¯´åˆ° AOF æ—¥å¿—å°† Redis çš„å†™å‘½ä»¤é€ä¸€è®°å½•ä¸‹æ¥ï¼Œåœ¨æœåŠ¡é‡å¯æ—¶å†é€ä¸€æ‰§è¡Œæ¢å¤æ•°æ®ã€‚å¦‚æœ AOF æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼Œè¿™ä¸€è¿‡ç¨‹é€šå¸¸æ˜¯å¾ˆç¼“æ…¢çš„ã€‚è¿™ä¸€èŠ‚å°†è®¨è®ºå¦ä¸€ç§æŒä¹…åŒ–æ–¹å¼ï¼šå†…å­˜å¿«ç…§ã€‚æ‰€è°“å†…å­˜å¿«ç…§ï¼Œå°±æ˜¯æŒ‡å†…å­˜ä¸­çš„æ•°æ®åœ¨æŸä¸€ä¸ªæ—¶åˆ»çš„çŠ¶æ€è®°å½•ã€‚è¿™å°±ç±»ä¼¼äºç…§ç‰‡ï¼Œå½“ä½ ç»™æœ‹å‹æ‹ç…§æ—¶ï¼Œä¸€å¼ ç…§ç‰‡å°±èƒ½æŠŠæœ‹å‹ä¸€ç¬é—´çš„å½¢è±¡å®Œå…¨è®°ä¸‹æ¥ã€‚å¯¹ Redis æ¥è¯´ï¼Œå®ƒå®ç°ç±»ä¼¼ç…§ç‰‡è®°å½•æ•ˆæœçš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠæŸä¸€æ—¶åˆ»çš„çŠ¶æ€ä»¥æ–‡ä»¶çš„å½¢å¼å†™åˆ°ç£ç›˜ä¸Šï¼Œä¹Ÿå°±æ˜¯å¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿å®•æœºï¼Œå¿«ç…§æ–‡ä»¶ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œæ•°æ®çš„å¯é æ€§ä¹Ÿå°±å¾—åˆ°äº†ä¿è¯ã€‚è¿™ä¸ªå¿«ç…§æ–‡ä»¶å°±ç§°ä¸º RDB æ–‡ä»¶ï¼Œå…¶ä¸­ï¼ŒRDB å°±æ˜¯ Redis DataBase çš„ç¼©å†™ã€‚å’Œ AOF ç›¸æ¯”ï¼ŒRDB è®°å½•çš„æ˜¯æŸä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ“ä½œï¼Œæ‰€ä»¥ï¼Œåœ¨åšæ•°æ®æ¢å¤æ—¶ï¼Œæˆ‘ ä»¬å¯ä»¥ç›´æ¥æŠŠ RDB æ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œå¾ˆå¿«åœ°å®Œæˆæ¢å¤ã€‚å¬èµ·æ¥å¥½åƒå¾ˆä¸é”™ï¼Œä½†å†…å­˜å¿«ç…§ä¹Ÿå¹¶ä¸æ˜¯æœ€ä¼˜é€‰é¡¹ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæœ‰å¦ä¸ªé—®é¢˜è¦è€ƒè™‘ï¼š</p><ol><li>æˆ‘ä»¬åº”è¯¥å¯¹é‚£äº›æ•°æ®åšå¿«ç…§ï¼Ÿè¿™å…³ç³»åˆ°å¿«ç…§çš„æ‰§è¡Œæ•ˆç‡é—®é¢˜ï¼›</li><li>åšå¿«ç…§æ—¶ï¼Œæ•°æ®è¿˜èƒ½è¢«å¢åˆ æ”¹å—ï¼Ÿè¿™å…³ç³»åˆ° Redis æ˜¯å¦è¢«é˜»å¡ï¼Œèƒ½å¦åŒæ—¶æ­£å¸¸å¤„ç†è¯·æ±‚ã€‚</li></ol><p>æ‹¿æ‹ç…§ç‰‡æ¥ä¸¾ä¾‹å­ã€‚æˆ‘ä»¬åœ¨æ‹ç…§æ—¶ï¼Œé€šå¸¸è¦å…³æ³¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å¦‚ä½•å–æ™¯ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰“ç®—æŠŠå“ªäº›äººã€å“ªäº›ç‰©æ‹åˆ°ç…§ç‰‡ä¸­ï¼›</li><li>åœ¨æŒ‰å¿«é—¨å‰ï¼Œè¦è®°ç€æé†’æœ‹å‹ä¸è¦ä¹±åŠ¨ï¼Œå¦åˆ™æ‹å‡ºæ¥çš„ç…§ç‰‡å°±æ¨¡ç³Šäº†ã€‚</li></ol><h2 id="ç»™å“ªäº›æ•°æ®åšå¿«ç…§"><a href="#ç»™å“ªäº›æ•°æ®åšå¿«ç…§" class="headerlink" title="ç»™å“ªäº›æ•°æ®åšå¿«ç…§?"></a>ç»™å“ªäº›æ•°æ®åšå¿«ç…§?</h2><p>&emsp;&emsp;Redis çš„æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸ºäº†æä¾›æ‰€æœ‰æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯<strong>å…¨é‡å¿«ç…§</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ï¼Œè¿™å°±ç±»ä¼¼äºç»™ 100 ä¸ªäººæ‹åˆå½±ï¼ŒæŠŠæ¯ä¸€ä¸ªäººéƒ½æ‹è¿›ç…§ç‰‡é‡Œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œä¸€æ¬¡æ€§è®°å½•äº†æ‰€æœ‰æ•°æ®ï¼Œä¸€ä¸ªéƒ½ä¸å°‘ã€‚åŒæ ·ï¼Œç»™å†…å­˜çš„å…¨é‡æ•°æ®åšå¿«ç…§ï¼Œ æŠŠå®ƒä»¬å…¨éƒ¨å†™å…¥ç£ç›˜ä¹Ÿä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚è€Œä¸”ï¼Œå…¨é‡æ•°æ®è¶Šå¤šï¼ŒRDB æ–‡ä»¶å°±è¶Šå¤§ï¼Œå¾€ç£ç›˜ä¸Šå†™æ•°æ®çš„æ—¶é—´å¼€é”€å°±è¶Šå¤§ã€‚å¯¹äº Redis è€Œè¨€ï¼Œå®ƒçš„å•çº¿ç¨‹æ¨¡å‹å°±å†³å®šäº†ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…æ‰€æœ‰ä¼šé˜»å¡ä¸»çº¿ç¨‹çš„æ“ä½œï¼Œ æ‰€ä»¥ï¼Œé’ˆå¯¹ä»»ä½•æ“ä½œï¼Œæˆ‘ä»¬éƒ½ä¼šæä¸€ä¸ªçµé­‚ä¹‹é—®ï¼šâ€œå®ƒä¼šé˜»å¡ä¸»çº¿ç¨‹å—?â€ã€‚RDB æ–‡ä»¶çš„ç”Ÿæˆæ˜¯å¦ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œè¿™å°±å…³ç³»åˆ°æ˜¯å¦ä¼šé™ä½ Redis çš„æ€§èƒ½ã€‚</p><p>Redis æä¾›äº†ä¸¤ä¸ªå‘½ä»¤æ¥ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ save å’Œ bgsaveã€‚</p><ul><li>saveï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¼šå¯¼è‡´é˜»å¡ï¼›</li><li>bgsaveï¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œä¸“é—¨ç”¨äºå†™å…¥ RDB æ–‡ä»¶ï¼Œé¿å…äº†ä¸»çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™ä¹Ÿæ˜¯ Redis RDB æ–‡ä»¶ç”Ÿæˆçš„é»˜è®¤é…ç½®ã€‚</li></ul><p>&emsp;&emsp;æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ bgsave å‘½ä»¤æ¥æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œè¿™æ—¢æä¾›äº†æ•°æ®çš„å¯é æ€§ä¿è¯ï¼Œä¹Ÿé¿å…äº†å¯¹ Redis çš„æ€§èƒ½å½±å“ã€‚</p><p>&emsp;&emsp;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å…³æ³¨çš„é—®é¢˜å°±æ˜¯ï¼Œåœ¨å¯¹å†…å­˜æ•°æ®åšå¿«ç…§æ—¶ï¼Œè¿™äº›æ•°æ®è¿˜èƒ½â€œåŠ¨â€å—? ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ•°æ®è¿˜èƒ½è¢«ä¿®æ”¹å—ï¼Ÿ è¿™ä¸ªé—®é¢˜éå¸¸é‡è¦ï¼Œè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ•°æ®èƒ½è¢«ä¿®æ”¹ï¼Œé‚£å°±æ„å‘³ç€ Redis è¿˜èƒ½æ­£å¸¸å¤„ç†å†™æ“ä½œã€‚å¦åˆ™ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½å¾—ç­‰åˆ°å¿«ç…§å®Œäº†æ‰èƒ½æ‰§è¡Œï¼Œæ€§èƒ½ä¸€ä¸‹å­å°±é™ä½äº†ã€‚</p><h2 id="å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—"><a href="#å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—" class="headerlink" title="å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—?"></a>å¿«ç…§æ—¶æ•°æ®èƒ½ä¿®æ”¹å—?</h2><p>&emsp;&emsp;å½“æˆ‘ä»¬é‡‡ç”¨ bgsave æ–¹å¼æ¥ç”Ÿæˆå¿«ç…§æ—¶ï¼Œå…¶å®æ˜¯ fork äº†ä¸€ä¸ªå­è¿›ç¨‹ã€‚æ ¹æ® Linux ä¸­ fork ç³»ç»Ÿè°ƒç”¨çš„è§„åˆ™ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºåå¹¶ä¸ä¼šå°†çˆ¶è¿›ç¨‹æ‰€æœ‰çš„å†…å­˜æ•°æ®éƒ½å•ç‹¬æ‹·è´ä¸€ä»½ï¼Œè€Œæ˜¯æ‹·è´ä¸€ä»½é¡µè¡¨ï¼ŒèƒŒåæŒ‡å‘å’Œçˆ¶è¿›ç¨‹ä¸€æ ·çš„ç‰©ç†åœ°å€ã€‚å½“æœ‰æ–°çš„ Redis å†™å…¥å‘½ä»¤æ—¶ï¼ŒåŸæ¥çš„é”®å€¼å¯¹å‘ç”Ÿäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆå°±ä¼šå¯ç”¨ copy-on-write æ€æƒ³ï¼Œå­è¿›ç¨‹ä¼šåœ¨å†…å­˜ä¸­å¤åˆ¶ä¸€ä»½è¯¥é”®å€¼å¯¹ï¼Œå¹¶é€šè¿‡é¡µè¡¨æŒ‡å‘è¯¥æ–°åˆ›å»ºçš„åœ°å€ï¼Œè¿™å°±åšåˆ°äº†åœ¨è¿›è¡Œå¿«ç…§æ—¶ï¼Œæ•°æ®å‘ç”Ÿäº†ä¿®æ”¹ï¼Œå­è¿›ç¨‹ä»ç„¶å¯ä»¥æŠŠè¿™ä¸ªå‰¯æœ¬æ•°æ®å†™å…¥ RDB æ–‡ä»¶ï¼Œè€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹ä»ç„¶å¯ä»¥ç›´æ¥ä¿®æ”¹åŸæ¥çš„æ•°æ®ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis20.jpg" alt="avatar"><br>&emsp;&emsp;è¿™æ—¢ä¿è¯äº†å¿«ç…§çš„å®Œæ•´æ€§ï¼Œä¹Ÿå…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œé¿å…äº†å¯¹æ­£å¸¸ä¸šåŠ¡çš„å½± å“ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±è§£å†³äº†å¯¹â€œå“ªäº›æ•°æ®åšå¿«ç…§â€ä»¥åŠâ€œåšå¿«ç…§æ—¶æ•°æ®èƒ½å¦ä¿®æ”¹â€è¿™ä¸¤å¤§é—® é¢˜ï¼šRedis ä¼šä½¿ç”¨ bgsave å¯¹å½“å‰å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®åšå¿«ç…§ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å­è¿›ç¨‹åœ¨åå°å®Œ æˆçš„ï¼Œè¿™å°±å…è®¸ä¸»çº¿ç¨‹åŒæ—¶å¯ä»¥ä¿®æ”¹æ•°æ®ã€‚</p><p>&emsp;&emsp;ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ä¸ªé—®é¢˜ï¼šå¤šä¹…åšä¸€æ¬¡å¿«ç…§ï¼Ÿæˆ‘ä»¬åœ¨æ‹ç…§çš„æ—¶å€™ï¼Œè¿˜æœ‰é¡¹æŠ€æœ¯å«â€œè¿ æ‹â€ï¼Œå¯ä»¥è®°å½•äººæˆ–ç‰©è¿ç»­å¤šä¸ªç¬é—´çš„çŠ¶æ€ã€‚é‚£ä¹ˆï¼Œå¿«ç…§ä¹Ÿé€‚åˆâ€œè¿æ‹â€å—ï¼Ÿ</p><h2 id="å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§å—ï¼Ÿ"><a href="#å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§å—ï¼Ÿ" class="headerlink" title="å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§å—ï¼Ÿ"></a>å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§å—ï¼Ÿ</h2><p>&emsp;&emsp;å¯¹äºå¿«ç…§æ¥è¯´ï¼Œæ‰€è°“â€œè¿æ‹â€å°±æ˜¯æŒ‡è¿ç»­åœ°åšå¿«ç…§ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§çš„é—´éš”æ—¶é—´å˜å¾—å¾ˆçŸ­ï¼Œå³ä½¿æŸä¸€æ—¶åˆ»å‘ç”Ÿå®•æœºäº†ï¼Œå› ä¸ºä¸Šä¸€æ—¶åˆ»å¿«ç…§åˆšæ‰§è¡Œï¼Œä¸¢å¤±çš„æ•°æ®ä¹Ÿä¸ä¼šå¤ªå¤šã€‚ä½†æ˜¯ï¼Œè¿™å…¶ä¸­çš„å¿«ç…§é—´éš”æ—¶é—´å°±å¾ˆå…³é”®äº†ã€‚<br>&emsp;&emsp;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆåœ¨ T0 æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œç„¶ååˆåœ¨ T0+t æ—¶åˆ»åšäº†ä¸€æ¬¡å¿«ç…§ï¼Œåœ¨è¿™æœŸé—´ï¼Œæ•°æ®å— 5 å’Œ 9 è¢«ä¿®æ”¹äº†ã€‚å¦‚æœåœ¨ t è¿™æ®µæ—¶é—´å†…ï¼Œæœºå™¨å®•æœºäº†ï¼Œé‚£ä¹ˆï¼Œåªèƒ½æŒ‰ç…§ T0 æ—¶åˆ»çš„å¿«ç…§è¿›è¡Œæ¢å¤ã€‚æ­¤æ—¶ï¼Œæ•°æ®å— 5 å’Œ 9 çš„ä¿®æ”¹å€¼å› ä¸ºæ²¡æœ‰å¿«ç…§è®°å½•ï¼Œå°±æ— æ³•æ¢å¤äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis21.jpg" alt="avatar"><br>&emsp;&emsp;æ‰€ä»¥ï¼Œè¦æƒ³å°½å¯èƒ½æ¢å¤æ•°æ®ï¼Œt å€¼å°±è¦å°½å¯èƒ½å°ï¼Œt è¶Šå°ï¼Œå°±è¶Šåƒâ€œè¿æ‹â€ã€‚é‚£ä¹ˆï¼Œt å€¼å¯ä»¥å°åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Œæ¯”å¦‚è¯´æ˜¯ä¸æ˜¯å¯ä»¥æ¯ç§’åšä¸€æ¬¡å¿«ç…§ï¼Ÿæ¯•ç«Ÿï¼Œæ¯æ¬¡å¿«ç…§éƒ½æ˜¯ç”± bgsave å­è¿›ç¨‹åœ¨åå°æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚è¿™ç§æƒ³æ³•å…¶å®æ˜¯é”™è¯¯çš„ã€‚è™½ç„¶ <strong>bgsave æ‰§è¡Œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œå¦‚æœé¢‘ç¹åœ°æ‰§è¡Œå…¨é‡å¿«ç…§ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸¤æ–¹é¢çš„å¼€é”€</strong>ã€‚</p><ol><li>ä¸€æ–¹é¢ï¼Œå¯¹äº<strong>ç£ç›˜</strong>è€Œè¨€ï¼Œé¢‘ç¹å°†å…¨é‡æ•°æ®å†™å…¥ç£ç›˜ï¼Œä¼šç»™ç£ç›˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œå¤šä¸ªå¿«ç…§ç«äº‰æœ‰é™çš„ç£ç›˜å¸¦å®½ï¼Œå‰ä¸€ä¸ªå¿«ç…§è¿˜æ²¡æœ‰åšå®Œï¼Œåä¸€ä¸ªåˆå¼€å§‹åšäº†ï¼Œå®¹æ˜“é€ æˆæ¶æ€§å¾ªç¯ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œbgsave å­è¿›ç¨‹éœ€è¦é€šè¿‡ fork æ“ä½œä»ä¸»çº¿ç¨‹åˆ›å»ºå‡ºæ¥ã€‚è™½ç„¶ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºå ä¸ä¼šå†é˜»å¡ä¸»çº¿ç¨‹ï¼Œä½†æ˜¯ï¼Œ<strong>fork è¿™ä¸ªåˆ›å»ºè¿‡ç¨‹æœ¬èº«ä¼šé˜»å¡ä¸»çº¿ç¨‹</strong>ï¼Œè€Œä¸”ä¸»çº¿ç¨‹çš„å†…å­˜è¶Š å¤§ï¼Œé˜»å¡æ—¶é—´è¶Šé•¿ã€‚å¦‚æœé¢‘ç¹ fork å‡º bgsave å­è¿›ç¨‹ï¼Œè¿™å°±ä¼šé¢‘ç¹é˜»å¡ä¸»çº¿ç¨‹äº†ã€‚</li></ol><p>&emsp;&emsp;æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åš<strong>å¢é‡å¿«ç…§</strong>ï¼Œæ‰€è°“å¢é‡å¿«ç…§ï¼Œå°±æ˜¯æŒ‡ï¼Œåšäº†ä¸€æ¬¡å…¨é‡å¿«ç…§åï¼Œåç»­çš„å¿«ç…§åªå¯¹ä¿®æ”¹çš„æ•°æ®è¿›è¡Œå¿«ç…§è®°å½•ï¼Œè¿™æ ·å¯ä»¥é¿å…æ¯æ¬¡å…¨é‡å¿«ç…§çš„å¼€é”€ã€‚</p><p>&emsp;&emsp;åœ¨ç¬¬ä¸€æ¬¡åšå®Œå…¨é‡å¿«ç…§åï¼ŒT1 å’Œ T2 æ—¶åˆ»å¦‚æœå†åšå¿«ç…§ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¢«ä¿®æ”¹çš„æ•°æ®å†™å…¥å¿«ç…§æ–‡ä»¶å°±è¡Œã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆåšçš„å‰ææ˜¯ï¼Œæˆ‘ä»¬éœ€è¦<strong>è®°ä½å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†</strong>ã€‚ä½ å¯ä¸è¦å°ç§ è¿™ä¸ªâ€œè®°ä½â€åŠŸèƒ½ï¼Œå®ƒéœ€è¦æˆ‘ä»¬ä½¿ç”¨é¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯å»è®°å½•å“ªäº›æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„ç©ºé—´å¼€é”€é—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis22.jpg" alt="avatar"><br>&emsp;&emsp;å¦‚æœæˆ‘ä»¬å¯¹æ¯ä¸€ä¸ªé”®å€¼å¯¹çš„ä¿®æ”¹ï¼Œéƒ½åšä¸ªè®°å½•ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæœ‰ 1 ä¸‡ä¸ªè¢«ä¿®æ”¹çš„é”®å€¼å¯¹ï¼Œæˆ‘ä»¬å°±éœ€è¦æœ‰ 1 ä¸‡æ¡é¢å¤–çš„è®°å½•ã€‚è€Œä¸”ï¼Œæœ‰çš„æ—¶å€™ï¼Œé”®å€¼å¯¹éå¸¸å°ï¼Œæ¯”å¦‚åªæœ‰ 32 å­—èŠ‚ï¼Œè€Œè®°å½•å®ƒè¢«ä¿®æ”¹çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¯èƒ½å°±éœ€è¦ 8 å­—èŠ‚ï¼Œè¿™æ ·çš„ç”»ï¼Œä¸ºäº†â€œè®°ä½â€ä¿®æ”¹ï¼Œå¼•å…¥çš„é¢å¤–ç©ºé—´å¼€é”€æ¯”è¾ƒå¤§ã€‚è¿™å¯¹äºå†…å­˜èµ„æºå®è´µçš„ Redis æ¥è¯´ï¼Œæœ‰äº›å¾—ä¸å¿å¤±ã€‚</p><p>&emsp;&emsp;åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥å‘ç°ï¼Œè™½ç„¶è·Ÿ AOF ç›¸æ¯”ï¼Œå¿«ç…§çš„æ¢å¤é€Ÿåº¦å¿«ï¼Œä½†æ˜¯ï¼Œå¿«ç…§çš„é¢‘ç‡ä¸å¥½æŠŠæ¡ï¼Œå¦‚æœé¢‘ç‡å¤ªä½ï¼Œä¸¤æ¬¡å¿«ç…§é—´ä¸€æ—¦å®•æœºï¼Œå°±å¯èƒ½æœ‰æ¯”è¾ƒå¤šçš„æ•°æ®ä¸¢å¤±ã€‚å¦‚æœé¢‘ç‡å¤ªé«˜ï¼Œåˆä¼šäº§ç”Ÿé¢å¤–å¼€é”€ï¼Œé‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•æ—¢èƒ½åˆ©ç”¨ RDB çš„å¿«é€Ÿæ¢å¤ï¼Œåˆèƒ½ä»¥è¾ƒå°çš„å¼€é”€åšåˆ°å°½é‡å°‘ä¸¢æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬å†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œä½¿ç”¨ AOF æ—¥å¿—ä¸æ˜¯èƒ½å¾ˆå¥½çš„è®°å½•ä¿®æ”¹å—ã€‚</p><h2 id="æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œå†…å­˜å¿«ç…§"><a href="#æ··åˆä½¿ç”¨-AOF-æ—¥å¿—å’Œå†…å­˜å¿«ç…§" class="headerlink" title="æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§"></a>æ··åˆä½¿ç”¨ AOF æ—¥å¿—å’Œå†…å­˜å¿«ç…§</h2><p>&emsp;&emsp;ç®€å•æ¥è¯´ï¼Œå†…å­˜å¿«ç…§ä»¥ä¸€å®šçš„é¢‘ç‡æ‰§è¡Œï¼Œåœ¨ä¸¤æ¬¡å¿«ç…§ä¹‹é—´ï¼Œä½¿ç”¨ AOF æ—¥å¿—è®°å½•è¿™æœŸé—´çš„æ‰€æœ‰å‘½ä»¤æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œå¿«ç…§ä¸ç”¨å¾ˆé¢‘ç¹åœ°æ‰§è¡Œï¼Œè¿™å°±é¿å…äº†é¢‘ç¹ fork å¯¹ä¸»çº¿ç¨‹çš„å½±å“ã€‚è€Œä¸”ï¼ŒAOF æ—¥å¿—ä¹Ÿåªç”¨è®°å½•ä¸¤æ¬¡å¿«ç…§é—´çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸éœ€è¦è®°å½•æ‰€æœ‰æ“ä½œäº†ï¼Œå› æ­¤ï¼Œå°±ä¸ä¼šå‡ºç°æ–‡ä»¶è¿‡å¤§çš„æƒ…å†µäº†ï¼Œä¹Ÿå¯ä»¥é¿å…é‡å†™å¼€é”€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒT1 å’Œ T2 æ—¶åˆ»çš„ä¿®æ”¹ï¼Œç”¨ AOF æ—¥å¿—è®°å½•ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡åšå…¨é‡å¿«ç…§æ—¶ï¼Œå°±å¯ä»¥æ¸…ç©º AOF æ—¥å¿—ï¼Œå› ä¸ºæ­¤æ—¶çš„ä¿®æ”¹éƒ½å·²ç»è®°å½•åˆ°å¿«ç…§ä¸­äº†ï¼Œæ¢å¤æ—¶å°±ä¸å†ç”¨æ—¥å¿—äº†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis23.jpg" alt="avatar"><br>&emsp;&emsp;è¿™ä¸ªæ–¹æ³•æ—¢èƒ½äº«å—åˆ° RDB æ–‡ä»¶å¿«é€Ÿæ¢å¤çš„å¥½å¤„ï¼Œåˆèƒ½äº«å—åˆ° AOF åªè®°å½•æ“ä½œå‘½ä»¤çš„ç®€å•ä¼˜åŠ¿ã€‚</p><h1 id="ä¸»ä»åº“åŒæ­¥"><a href="#ä¸»ä»åº“åŒæ­¥" class="headerlink" title="ä¸»ä»åº“åŒæ­¥"></a>ä¸»ä»åº“åŒæ­¥</h1><p>&emsp;&emsp;å½“å¯åŠ¨å¤šä¸ª Redis å®ä¾‹çš„æ—¶å€™ï¼Œå®ƒä»¬ä¹‹é—´å°±å¯ä»¥é€šè¿‡ replicaof ï¼ˆRedis 5.0 ä¹‹å‰ä½¿ç”¨ slaveofï¼‰å‘½ä»¤å½¢æˆä¸»åº“å’Œä»åº“çš„å…³ç³»ï¼Œä¹‹åä¼šæŒ‰ç…§ä¸‰ä¸ªé˜¶æ®µå®Œæˆæ•°æ®çš„ç¬¬ä¸€æ¬¡åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æœ‰å®ä¾‹ 1ï¼ˆipï¼š172.16.19.3ï¼‰å’Œå®ä¾‹ 2ï¼ˆipï¼š172.16.19.5ï¼‰ï¼Œæˆ‘ä»¬åœ¨å®ä¾‹ 2 ä¸Šæ‰§è¡Œä»¥ä¸‹è¿™ä¸ªå‘½ä»¤åï¼Œå®ä¾‹ 2 å°±å˜æˆäº†å®ä¾‹ 1 çš„ä»åº“ï¼Œå¹¶ä»å®ä¾‹ 1 ä¸Šå¤åˆ¶æ•°æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">replicaof 172.16.19.3 6379</span><br></pre></td></tr></table></figure><h2 id="ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥"><a href="#ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥" class="headerlink" title="ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥"></a>ä¸»ä»åº“ç¬¬ä¸€æ¬¡åŒæ­¥</h2><p>ä¸‰ä¸ªé˜¶æ®µï¼š<br><img lazyload src="/images/loading.svg" data-src="redis24.jpg" alt="avatar"></p><ul><li><p>é˜¶æ®µä¸€ï¼š<br>&emsp;&emsp;ä¸»ä»åº“å»ºç«‹è¿æ¥ï¼Œåå•†åŒæ­¥ï¼Œä¸»è¦æ˜¯ä¸ºå…¨é‡å¤åˆ¶åšå‡†å¤‡ã€‚å…·ä½“æ¥è¯´ï¼Œä»åº“ç»™ä¸»åº“å‘é€ psync å‘½ä»¤ï¼Œè¡¨ç¤ºè¦è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œä¸»åº“æ ¹æ®è¿™ä¸ªå‘½ä»¤çš„å‚æ•°æ¥å¯åŠ¨å¤åˆ¶ã€‚psync å‘½ä»¤åŒ…å«äº†ä¸»åº“çš„ runID å’Œå¤åˆ¶è¿›åº¦ offset ä¸¤ä¸ªå‚æ•°ã€‚<br>runIDï¼Œæ˜¯æ¯ä¸ª Redis å®ä¾‹å¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ªéšæœº IDï¼Œç”¨æ¥å”¯ä¸€æ ‡è®°è¿™ä¸ªå®ä¾‹ã€‚å½“ä»åº“å’Œä¸»åº“ç¬¬ä¸€æ¬¡å¤åˆ¶æ—¶ï¼Œå› ä¸ºä¸çŸ¥é“ä¸»åº“çš„ runIDï¼Œæ‰€ä»¥å°† runID è®¾ ä¸ºâ€œï¼Ÿâ€ã€‚<br>offsetï¼Œæ­¤æ—¶è®¾ä¸º -1ï¼Œè¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶ã€‚</p></li><li><p>ç¬¬äºŒé˜¶æ®µ<br>&emsp;&emsp;ä¸»åº“æ”¶åˆ° psync å‘½ä»¤åï¼Œä¼šç”¨ FULLRESYNC å“åº”å‘½ä»¤å¸¦ä¸Šä¸¤ä¸ªå‚æ•°ï¼šä¸»åº“ runID å’Œä¸»åº“ç›®å‰çš„å¤åˆ¶è¿›åº¦ offsetï¼Œè¿”å›ç»™ä»åº“ã€‚ä»åº“æ”¶åˆ°å“åº”åï¼Œä¼šè®°å½•ä¸‹è¿™ä¸¤ä¸ªå‚æ•°ã€‚<strong>FULLRESYNC å“åº”è¡¨ç¤ºç¬¬ä¸€æ¬¡å¤åˆ¶é‡‡ç”¨çš„å…¨é‡å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“ä¸»åº“æ‰§è¡Œ bgsave å‘½ä»¤ï¼ŒæŠŠå½“å‰æ‰€æœ‰çš„æ•°æ®éƒ½å¤åˆ¶ç»™ä»åº“</strong>ã€‚ä»åº“æ”¶åˆ°æ•°æ®åï¼Œåœ¨æœ¬åœ°å®Œæˆæ•°æ®åŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¾èµ–äºå†…å­˜å¿«ç…§ç”Ÿæˆçš„ RDB æ–‡ä»¶ã€‚ä»åº“æ¥æ”¶åˆ° RDB æ–‡ä»¶åï¼Œä¼šå…ˆæ¸…ç©ºå½“å‰æ•°æ®åº“ï¼Œç„¶ååŠ è½½ RDB æ–‡ä»¶ã€‚è¿™æ˜¯å› ä¸ºä»åº“åœ¨é€šè¿‡ replicaof å‘½ä»¤å¼€å§‹å’Œä¸»åº“åŒæ­¥å‰ï¼Œå¯èƒ½ä¿å­˜äº†å…¶ä»–æ•°æ®ã€‚ä¸ºäº†é¿å…ä¹‹å‰æ•°æ®çš„å½±å“ï¼Œä»åº“éœ€è¦å…ˆæŠŠå½“å‰æ•°æ®åº“æ¸…ç©ºã€‚</p></li><li><p>ç¬¬ä¸‰é˜¶æ®µ<br>&emsp;&emsp;åœ¨ä¸»åº“å°†æ•°æ®åŒæ­¥ç»™ä»åº“çš„è¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¸ä¼šè¢«é˜»å¡ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸æ¥æ”¶è¯·æ±‚ã€‚å¦åˆ™ï¼ŒRedis çš„æœåŠ¡å°±è¢«ä¸­æ–­äº†ã€‚ä½†æ˜¯ï¼Œè¿™äº›è¯·æ±‚ä¸­çš„å†™æ“ä½œå¹¶æ²¡æœ‰è®°å½•åˆ°åˆšåˆšç”Ÿæˆçš„ RDB æ–‡ä»¶ä¸­ã€‚ä¸ºäº†ä¿è¯ä¸»ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ï¼Œä¸»åº“ä¼šåœ¨å†…å­˜ä¸­ç”¨ä¸“é—¨çš„ replication bufferï¼Œè®°å½• RDB æ–‡ä»¶ç”Ÿæˆåæ”¶åˆ°çš„æ‰€æœ‰å†™æ“ä½œã€‚å½“ä¸»åº“å®Œæˆ RDB æ–‡ä»¶å‘é€åï¼Œå°±ä¼šæŠŠæ­¤æ—¶ replication buffer ä¸­çš„ä¿®æ”¹æ“ä½œå‘ç»™ä»åº“ï¼Œä»åº“å†é‡æ–°æ‰§è¡Œè¿™äº›æ“ä½œã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸»ä»åº“å°±å®ç°åŒæ­¥äº†ã€‚</p></li></ul><h2 id="ä¸»ä»çº§è”åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶ä¸»åº“çš„å‹åŠ›"><a href="#ä¸»ä»çº§è”åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶ä¸»åº“çš„å‹åŠ›" class="headerlink" title="ä¸»ä»çº§è”åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶ä¸»åº“çš„å‹åŠ›"></a>ä¸»ä»çº§è”åˆ†æ‹…å…¨é‡å¤åˆ¶æ—¶ä¸»åº“çš„å‹åŠ›</h2><p>&emsp;&emsp;å¯¹äºä¸»åº“æ¥è¯´ï¼Œå®Œæˆç¬¬ä¸€æ¬¡ä¸»ä»åŒæ­¥ï¼Œå³ä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œæœ‰ä¸¤ä¸ªè€—æ—¶çš„æ“ä½œï¼šç”Ÿæˆ RDB æ–‡ä»¶å’Œä¼ è¾“ RDB æ–‡ä»¶ã€‚å¦‚æœä»åº“è¿‡å¤šï¼Œè€Œä¸”éƒ½è¦å’Œä¸»åº“è¿›è¡Œå…¨é‡å¤åˆ¶çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸»åº“å¿™äº fork å­è¿›ç¨‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œè¿›è¡Œæ•°æ®å…¨é‡åŒæ­¥ã€‚fork è¿™ä¸ªæ“ä½œä¼šé˜»å¡ä¸»çº¿ç¨‹å¤„ç†æ­£å¸¸è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ä¸»åº“å“åº”åº”ç”¨ç¨‹åºçš„è¯·æ±‚é€Ÿåº¦å˜æ…¢ã€‚æ­¤å¤–ï¼Œä¼ è¾“ RDB æ–‡ä»¶ä¹Ÿä¼šå ç”¨ä¸»åº“çš„ç½‘ç»œå¸¦å®½ï¼ŒåŒæ ·ä¼šç»™ä¸»åº“çš„èµ„æºä½¿ç”¨å¸¦æ¥å‹åŠ›ã€‚å¯ä»¥ä½¿ç”¨â€œä¸»-ä»-ä»â€æ¨¡å¼å°†ä¸»åº“ç”Ÿæˆ RDB å’Œä¼ è¾“ RDB çš„å‹åŠ›ï¼Œä»¥çº§è”çš„æ–¹å¼åˆ†æ•£åˆ°ä»åº“ä¸Šã€‚<br><img lazyload src="/images/loading.svg" data-src="redis25.jpg" alt="avatar"></p><h2 id="ä¸»ä»åº“é—´çš„ç½‘ç»œæ–­äº†æ€ä¹ˆåŠï¼Ÿ"><a href="#ä¸»ä»åº“é—´çš„ç½‘ç»œæ–­äº†æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ä¸»ä»åº“é—´çš„ç½‘ç»œæ–­äº†æ€ä¹ˆåŠï¼Ÿ"></a>ä¸»ä»åº“é—´çš„ç½‘ç»œæ–­äº†æ€ä¹ˆåŠï¼Ÿ</h2><p>&emsp;&emsp;åœ¨ Redis 2.8 ä¹‹å‰ï¼Œå¦‚æœä¸»ä»åº“åœ¨å‘½ä»¤ä¼ æ’­æ—¶å‡ºç°äº†ç½‘ç»œé—ªæ–­ï¼Œé‚£ä¹ˆï¼Œä»åº“å°±ä¼šå’Œä¸»åº“é‡æ–°è¿›è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ï¼Œå¼€é”€éå¸¸å¤§ã€‚ä» Redis 2.8 å¼€å§‹ï¼Œç½‘ç»œæ–­äº†ä¹‹åï¼Œä¸»ä»åº“ä¼šé‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼ç»§ç»­åŒæ­¥ã€‚å¬åå­—å¤§æ¦‚å°±å¯ä»¥çŒœåˆ°å®ƒå’Œå…¨é‡å¤åˆ¶çš„ä¸åŒï¼šå…¨é‡å¤åˆ¶æ˜¯åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œè€Œå¢é‡å¤åˆ¶åªä¼šæŠŠä¸»ä»åº“ç½‘ç»œæ–­è¿æœŸé—´ä¸»åº“æ”¶åˆ°çš„å‘½ä»¤ï¼ŒåŒæ­¥ç»™ä»åº“ã€‚é‚£ä¹ˆï¼Œå¢é‡å¤åˆ¶æ—¶ï¼Œä¸»ä»åº“ä¹‹é—´å…·ä½“æ˜¯æ€ä¹ˆä¿æŒåŒæ­¥çš„å‘¢ï¼Ÿè¿™é‡Œçš„å¥¥å¦™å°±åœ¨äº repl_backlog_buffer è¿™ä¸ªç¼“å†²åŒºã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹å®ƒæ˜¯å¦‚ä½•ç”¨äºå¢é‡å‘½ä»¤çš„åŒæ­¥çš„ã€‚<br>&emsp;&emsp;å½“ä¸»ä»åº“æ–­è¿åï¼Œä¸»åº“ä¼šæŠŠæ–­è¿æœŸé—´æ”¶åˆ°çš„å†™æ“ä½œå‘½ä»¤ï¼Œå†™å…¥ replication bufferï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›æ“ä½œå‘½ä»¤ä¹Ÿå†™å…¥ repl_backlog_buffer è¿™ä¸ªç¼“å†²åŒºã€‚repl_backlog_buffer æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œä¸»åº“ä¼šè®°å½•è‡ªå·±å†™åˆ°çš„ä½ç½®ï¼Œä»åº“åˆ™ä¼šè®°å½•è‡ªå·± å·²ç»è¯»åˆ°çš„ä½ç½®ã€‚åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸»åº“å’Œä»åº“çš„å†™è¯»ä½ç½®åœ¨ä¸€èµ·ï¼Œè¿™ç®—æ˜¯å®ƒä»¬çš„èµ·å§‹ä½ç½®ã€‚éšç€ä¸»åº“ä¸æ–­æ¥æ”¶æ–°çš„å†™æ“ä½œï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„å†™ä½ç½®ä¼šé€æ­¥åç¦»èµ·å§‹ä½ç½®ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨åç§»é‡æ¥è¡¡é‡è¿™ä¸ªåç§»è·ç¦»çš„å¤§å°ï¼Œå¯¹ä¸»åº“æ¥è¯´ï¼Œå¯¹åº”çš„åç§»é‡å°±æ˜¯ master_repl_offsetã€‚ä¸»åº“æ¥æ”¶çš„æ–°å†™æ“ä½œè¶Šå¤šï¼Œè¿™ä¸ªå€¼å°±ä¼šè¶Šå¤§ã€‚åŒæ ·ï¼Œä»åº“åœ¨å¤åˆ¶å®Œå†™æ“ä½œå‘½ä»¤åï¼Œå®ƒåœ¨ç¼“å†²åŒºä¸­çš„è¯»ä½ç½®ä¹Ÿå¼€å§‹é€æ­¥åç§»åˆšæ‰çš„èµ·å§‹ä½ç½®ï¼Œæ­¤æ—¶ï¼Œä»åº“å·²å¤åˆ¶çš„åç§»é‡ slave_repl_offset ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ä¸ªåç§»é‡åŸºæœ¬ç›¸ç­‰ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis26.jpg" alt="avatar"><br><img lazyload src="/images/loading.svg" data-src="redis27.jpg" alt="avatar"><br>&emsp;&emsp;ï¼Œå› ä¸º repl_backlog_buffer æ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ‰€ä»¥åœ¨ ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»åº“ä¼šç»§ç»­å†™å…¥ï¼Œæ­¤æ—¶ï¼Œå°±ä¼šè¦†ç›–æ‰ä¹‹å‰å†™å…¥çš„æ“ä½œã€‚å¦‚æœä»åº“çš„è¯»å–é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä»åº“è¿˜æœªè¯»å–çš„æ“ä½œè¢«ä¸»åº“æ–°å†™çš„æ“ä½œè¦†ç›–äº†ï¼Œè¿™ä¼šå¯¼è‡´ä¸»ä»åº“é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œä¸€æ–¹é¢ï¼Œå¯ä»¥æ ¹æ® Redis æ‰€åœ¨æœåŠ¡å™¨çš„å†…å­˜èµ„æºå†é€‚å½“å¢åŠ  repl_backlog_size å€¼ï¼Œæ¯”å¦‚è¯´è®¾ç½®æˆç¼“å†²ç©ºé—´å¤§å°çš„ 4 å€ï¼Œå¦ä¸€æ–¹é¢ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åˆ‡ç‰‡é›†ç¾¤æ¥åˆ†æ‹…å•ä¸ªä¸»åº“çš„è¯·æ±‚å‹åŠ›ã€‚</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨-RDB-æ–‡ä»¶è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œè€Œä¸æ˜¯ç”¨-AOFï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨-RDB-æ–‡ä»¶è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œè€Œä¸æ˜¯ç”¨-AOFï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨ RDB æ–‡ä»¶è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œè€Œä¸æ˜¯ç”¨ AOFï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨ RDB æ–‡ä»¶è¿›è¡Œä¸»ä»å¤åˆ¶ï¼Œè€Œä¸æ˜¯ç”¨ AOFï¼Ÿ</h2><ol><li>ç›¸åŒæ•°æ®ä¸‹ï¼ŒAOF æ–‡ä»¶æ¯” RDB æ›´å¤§ï¼Œå› æ­¤éœ€è¦çš„ç½‘ç»œå¸¦å®½æ›´å¤šï¼›</li><li>åœ¨æ¢å¤æ•°æ®æ—¶ï¼Œä½¿ç”¨RDBæ›´å¿«ã€‚RDB æ˜¯æ•°æ®åº“çš„å¿«ç…§æ–‡ä»¶ï¼Œè®°å½•çš„æ˜¯æŸä¸€æ—¶åˆ»æ•°æ®åº“ä¸­æ‰€æœ‰é”®å€¼å¯¹çš„çŠ¶æ€ï¼Œè€Œ AOF æ–‡ä»¶è®°å½•çš„æ˜¯æ‰€æœ‰çš„å†™ Redis å‘½ä»¤ï¼Œåœ¨åšå…¨é‡å¤åˆ¶çš„æ—¶å€™ä¼šéœ€è¦å¤§é‡çš„æ—¶é—´ï¼›</li><li>å¦‚æœä½¿ç”¨AOFæ–‡ä»¶æ¥åŒæ­¥ç›¸å¯¹æ¥è¯´ä¸¢çš„æ•°æ®æ›´å°‘ï¼Œä½†æ˜¯ä¸è¡¨ç¤ºä¸ä¸¢æ•°æ®ã€‚å³ä¹Ÿéœ€è¦ç¬¬ä¸‰ ä¸ªé˜¶æ®µæ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚å› æ­¤ç›¸å¯¹æ¥è¯´ä½¿ç”¨RDBå¼€é”€æ›´å°äº›ã€‚</li></ol><h1 id="å“¨å…µæœºåˆ¶"><a href="#å“¨å…µæœºåˆ¶" class="headerlink" title="å“¨å…µæœºåˆ¶"></a>å“¨å…µæœºåˆ¶</h1><p>&emsp;&emsp;åœ¨ä¸»ä»æ¨¡å¼ä¸‹ã€‚å¦‚æœä»åº“æŒ‚äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šè¢«å…¶ä»–æ­£å¸¸å·¥ä½œçš„ä»åº“æ¥æ”¶ã€‚ä½†å¦‚æœæ˜¯ä¸»åº“æŒ‚äº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„å†™è¯·æ±‚å°†ä¸å†èƒ½å¤Ÿè¢«å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis28.jpg" alt="avatar"><br>&emsp;&emsp;æ— è®ºæ˜¯å†™æœåŠ¡ä¸­æ–­ï¼Œè¿˜æ˜¯ä»åº“æ— æ³•åŒæ­¥æ•°æ®ï¼Œéƒ½æ˜¯ä¸å¯æ¥å—çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸»åº“æŒ‚äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿è¡Œä¸€ä¸ªæ–°çš„ä¸»åº“ï¼Œæ¯”å¦‚æ‰‹å°†ä¸€ä¸ªä»åº“åˆ‡æ¢ä¸ºä¸»åº“ã€‚è¿™å°±æ¶‰åŠä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li>ä¸»åº“çœŸçš„æŒ‚äº†å—ï¼Ÿ</li><li>è¯¥é€‰æ‹©å“ªä¸ªä»åº“ä½œä¸ºä¸»åº“ï¼Ÿ</li><li>æ€ä¹ˆæŠŠæ–°ä¸»åº“çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»åº“å’Œå®¢æˆ·ç«¯å‘¢ï¼Ÿ</li></ol><h2 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h2><p>&emsp;&emsp;å“¨å…µå…¶å®å°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œä¸»ä»åº“å®ä¾‹è¿è¡Œçš„åŒæ—¶ï¼Œå®ƒä¹Ÿåœ¨è¿è¡Œã€‚å“¨å…µä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä¸ªä»»åŠ¡ï¼šç›‘æ§ã€é€‰ä¸»ï¼ˆé€‰æ‹©ä¸»åº“ï¼‰å’Œé€šçŸ¥ã€‚</p><ul><li><p>ç›‘æ§<br>&emsp;&emsp;ç›‘æ§æ˜¯æŒ‡å“¨å…µè¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œå‘¨æœŸæ€§åœ°ç»™æ‰€æœ‰ä¸»ä»åº“å‘é€ PING å‘½ä»¤ï¼Œæ£€æµ‹å®ƒä»¬æ˜¯å¦ä»ç„¶åœ¨çº¿ã€‚å¦‚æœä»åº“æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…ç›¸åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šå°†å®ƒæ ‡è®°ä¸ºâ€œä¸‹çº¿çŠ¶æ€â€œï¼›åŒæ ·ï¼Œå¦‚æœä¸»åº“ä¹Ÿæ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”å“¨å…µçš„ PING å‘½ä»¤ï¼Œå“¨å…µå°±ä¼šåˆ¤å®šä¸»åº“ä¸‹é™ï¼Œç„¶åå¼€å§‹è‡ªåŠ¨åˆ‡æ¢ä¸»åº“çš„æµç¨‹ã€‚</p></li><li><p>é€‰ä¸»<br>&emsp;&emsp;ä¸»åº“æŒ‚äº†ä»¥åï¼Œå“¨å…µå°±éœ€è¦ä»å¾ˆå¤šä¸ªä»åº“é‡Œï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™é€‰æ‹©ä¸€ä¸ªä»åº“å®ä¾‹ï¼ŒæŠŠå®ƒä½œä¸ºæ–°çš„ä¸»åº“ã€‚è¿™ä¸€æ­¥å®Œæˆåï¼Œç°åœ¨çš„é›†ç¾¤é‡Œå°±æœ‰äº†æ–°ä¸»åº“ã€‚</p></li><li><p>é€šçŸ¥<br>&emsp;&emsp;åœ¨æ‰§è¡Œé€šçŸ¥ä»»åŠ¡æ—¶ï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯å‘ç»™å…¶ä»–ä»åº“ï¼Œè®©å®ƒä»¬æ‰§è¡Œ replicaof å‘½ä»¤ï¼Œå’Œæ–°ä¸»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œæ•°æ®å¤åˆ¶ã€‚åŒæ—¶ï¼Œå“¨å…µä¼šæŠŠæ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯é€šçŸ¥ç»™å®¢æˆ·ç«¯ï¼Œè®©å®ƒä»¬æŠŠè¯·æ±‚æ“ä½œå‘åˆ°æ–°ä¸»åº“ä¸Šã€‚</p></li></ul><p><img lazyload src="/images/loading.svg" data-src="redis29.jpg" alt="avatar"></p><h2 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h2><h3 id="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"><a href="#ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿" class="headerlink" title="ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿"></a>ä¸»è§‚ä¸‹çº¿å’Œå®¢è§‚ä¸‹çº¿</h3><ul><li>ä¸»è§‚ä¸‹çº¿<br>&emsp;&emsp;å“¨å…µè¿›ç¨‹ä¼šä½¿ç”¨ PING å‘½ä»¤æ£€æµ‹å®ƒè‡ªå·±å’Œä¸»ã€ä»åº“çš„ç½‘ç»œè¿æ¥æƒ…å†µï¼Œæ¥åˆ¤æ–­å®ä¾‹çš„çŠ¶æ€ã€‚å¦‚æœå“¨å…µå‘ç°ä¸»åº“æˆ–ä»åº“å¯¹ PING å‘½ä»¤çš„å“åº”è¶…æ—¶äº†ï¼Œé‚£ä¹ˆå“¨å…µä¼šå°†å®ƒæ ‡è®°ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ã€‚</li></ul><p>&emsp;&emsp;é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“å•¥å«è¯¯åˆ¤ã€‚å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸»åº“å®é™…å¹¶æ²¡æœ‰ä¸‹çº¿ï¼Œä½†æ˜¯å“¨å…µè¯¯ä»¥ä¸ºå®ƒä¸‹çº¿äº†ã€‚è¯¯åˆ¤ä¸€èˆ¬ä¼šå‘ç”Ÿåœ¨é›†ç¾¤ç½‘ç»œå‹åŠ›è¾ƒå¤§ã€ç½‘ç»œæ‹¥å¡ï¼Œæˆ–è€…æ˜¯ä¸»åº“æœ¬èº«å‹åŠ›è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚å“¨å…µæœºåˆ¶<strong>é€šå¸¸ä¼šé‡‡ç”¨å¤šå®ä¾‹ç»„æˆçš„é›†ç¾¤æ¨¡å¼è¿›è¡Œéƒ¨ç½²ï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºå“¨å…µé›†ç¾¤</strong>æ¥å‡å°‘è¯¯åˆ¤ã€‚å¼•å…¥å¤šä¸ªå“¨å…µå®ä¾‹ä¸€èµ·æ¥åˆ¤æ–­ï¼Œå°±å¯ä»¥é¿å…å•ä¸ªå“¨å…µå› ä¸ºè‡ªèº«ç½‘ç»œçŠ¶å†µä¸å¥½ï¼Œè€Œè¯¯åˆ¤ä¸»åº“ä¸‹çº¿çš„æƒ…å†µã€‚åŒæ—¶ï¼Œå¤šä¸ªå“¨å…µçš„ç½‘ç»œåŒæ—¶ä¸ç¨³å®šçš„æ¦‚ç‡è¾ƒå°ï¼Œç”±å®ƒä»¬ä¸€èµ·åšå†³ç­–ï¼Œè¯¯åˆ¤ç‡ä¹Ÿèƒ½é™ä½ã€‚åœ¨åˆ¤æ–­ä¸»åº“æ˜¯å¦ä¸‹çº¿æ—¶ï¼Œä¸èƒ½ç”±ä¸€ä¸ªå“¨å…µè¯´äº†ç®—ï¼Œåªæœ‰å¤§å¤šæ•°çš„å“¨å…µå®ä¾‹ï¼Œéƒ½åˆ¤æ–­ä¸»åº“å·²ç»â€œä¸»è§‚ä¸‹çº¿â€äº†ï¼Œä¸»åº“æ‰ä¼šè¢«æ ‡è®°ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ï¼Œè¿™ä¸ªå«æ³•ä¹Ÿæ˜¯è¡¨æ˜ä¸»åº“ä¸‹çº¿æˆä¸ºä¸€ä¸ªå®¢è§‚äº‹å®äº†ã€‚è¿™ä¸ªåˆ¤æ–­åŸåˆ™å°±æ˜¯ï¼šå°‘æ•°æœä»å¤šæ•°ã€‚åŒæ—¶ï¼Œè¿™ä¼šè¿›ä¸€æ­¥è§¦å‘å“¨å…µå¼€å§‹ä¸»ä»åˆ‡æ¢æµç¨‹ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis30.jpg" alt="avatar"></p><ul><li>å®¢è§‚ä¸‹çº¿<br>&emsp;&emsp;ç®€å•æ¥è¯´ï¼Œâ€œå®¢è§‚ä¸‹çº¿â€çš„æ ‡å‡†å°±æ˜¯ï¼Œå½“æœ‰ N ä¸ªå“¨å…µå®ä¾‹æ—¶ï¼Œæœ€å¥½è¦æœ‰ N/2 + 1 ä¸ªå®ä¾‹åˆ¤æ–­ä¸»åº“ä¸ºâ€œä¸»è§‚ä¸‹çº¿â€ï¼Œæ‰èƒ½æœ€ç»ˆåˆ¤å®šä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥å‡å°‘è¯¯åˆ¤ çš„æ¦‚ç‡ï¼Œä¹Ÿèƒ½é¿å…è¯¯åˆ¤å¸¦æ¥çš„æ— è°“çš„ä¸»ä»åº“åˆ‡æ¢ã€‚ï¼ˆå½“ç„¶ï¼Œæœ‰å¤šå°‘ä¸ªå®ä¾‹åšå‡ºâ€œä¸»è§‚ä¸‹çº¿â€çš„åˆ¤æ–­æ‰å¯ä»¥ï¼Œå¯ä»¥ç”± Redis ç®¡ç†å‘˜è‡ªè¡Œè®¾å®šï¼‰ã€‚</li></ul><h2 id="é€‰ä¸»"><a href="#é€‰ä¸»" class="headerlink" title="é€‰ä¸»"></a>é€‰ä¸»</h2><p>&emsp;&emsp;æˆ‘ä»¬åœ¨å¤šä¸ªä»åº“ä¸­ï¼Œå…ˆæŒ‰ç…§<strong>ä¸€å®šçš„ç­›é€‰æ¡ä»¶</strong>ï¼ŒæŠŠä¸ç¬¦åˆæ¡ä»¶çš„ä»åº“å»æ‰ã€‚ç„¶åï¼Œæˆ‘ä»¬å†æŒ‰ç…§<strong>ä¸€å®šçš„è§„åˆ™</strong>ï¼Œç»™å‰©ä¸‹çš„ä»åº“é€ä¸ªæ‰“åˆ†ï¼Œå°†å¾—åˆ†æœ€é«˜çš„ä»åº“é€‰ä¸ºæ–°ä¸»åº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis31.jpg" alt="avatar"></p><ul><li><p>ä¸€å®šçš„ç­›é€‰æ¡ä»¶<br>&emsp;&emsp;åœ¨é€‰ä¸»æ—¶ï¼Œ<strong>é™¤äº†è¦æ£€æŸ¥ä»åº“çš„å½“å‰åœ¨çº¿çŠ¶æ€ï¼Œè¿˜è¦åˆ¤æ–­å®ƒä¹‹å‰çš„ç½‘ç»œè¿æ¥çŠ¶æ€</strong>ã€‚å¦‚æœä»åº“æ€»æ˜¯å’Œä¸»åº“æ–­è¿ï¼Œè€Œä¸”æ–­è¿æ¬¡æ•°è¶…å‡ºäº†ä¸€å®šçš„é˜ˆå€¼ï¼Œæˆ‘ä»¬å°±æœ‰ç†ç”±ç›¸ä¿¡ï¼Œè¿™ä¸ªä»åº“çš„ç½‘ç»œçŠ¶å†µå¹¶ä¸æ˜¯å¤ªå¥½ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªä»åº“ç­›æ‰äº†ã€‚</p></li><li><p>ä¸€å®šçš„è§„åˆ™<br>&emsp;&emsp;æˆ‘ä»¬å¯ä»¥åˆ†åˆ«æŒ‰ç…§ä¸‰ä¸ªè§„åˆ™ä¾æ¬¡è¿›è¡Œä¸‰è½®æ‰“åˆ†ï¼Œè¿™ä¸‰ä¸ªè§„åˆ™åˆ†åˆ«æ˜¯ä»åº“ä¼˜å…ˆçº§ã€ä»åº“å¤åˆ¶è¿›åº¦ä»¥åŠä»åº“ ID å·ã€‚åªè¦åœ¨æŸä¸€è½®ä¸­ï¼Œæœ‰ä»åº“å¾—åˆ†æœ€é«˜ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸»åº“äº†ï¼Œé€‰ä¸»è¿‡ç¨‹åˆ°æ­¤ç»“æŸã€‚å¦‚æœæ²¡æœ‰å‡ºç°å¾—åˆ†æœ€é«˜çš„ä»åº“ï¼Œé‚£ä¹ˆå°±ç»§ç»­è¿›è¡Œä¸‹ä¸€è½®ã€‚</p></li></ul><ol><li><p>ç¬¬ä¸€è½®ï¼šä¼˜å…ˆçº§æœ€é«˜çš„ä»åº“å¾—åˆ†é«˜ã€‚<br>&emsp;&esmsp;ç”¨æˆ·å¯ä»¥é€šè¿‡ slave-priority é…ç½®é¡¹ï¼Œç»™ä¸åŒçš„ä»åº“è®¾ç½®ä¸åŒä¼˜å…ˆçº§ã€‚æ¯”å¦‚ï¼Œä½ æœ‰ä¸¤ä¸ªä»åº“ï¼Œå®ƒä»¬çš„å†…å­˜å¤§å°ä¸ä¸€æ ·ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ç»™å†…å­˜å¤§çš„å®ä¾‹è®¾ç½®ä¸€ä¸ªé«˜ä¼˜å…ˆçº§ã€‚åœ¨é€‰ä¸»æ—¶ï¼Œå“¨å…µä¼šç»™ä¼˜å…ˆçº§é«˜çš„ä»åº“æ‰“é«˜åˆ†ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä»åº“ä¼˜å…ˆçº§æœ€é«˜ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯æ–°ä¸»åº“äº†ã€‚å¦‚æœä»åº“çš„ä¼˜å…ˆçº§éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆå“¨å…µå¼€å§‹ç¬¬äºŒè½®æ‰“åˆ†ã€‚</p></li><li><p>ç¬¬äºŒè½®ï¼šå’Œæ—§ä¸»åº“åŒæ­¥ç¨‹åº¦æœ€æ¥è¿‘çš„ä»åº“å¾—åˆ†é«˜ã€‚<br>&emsp;&emsp;è¿™ä¸ªè§„åˆ™çš„ä¾æ®æ˜¯ï¼Œå¦‚æœé€‰æ‹©å’Œæ—§ä¸»åº“åŒæ­¥æœ€æ¥è¿‘çš„é‚£ä¸ªä»åº“ä½œä¸ºä¸»åº“ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªæ–°ä¸»åº“ä¸Šå°±æœ‰æœ€æ–°çš„æ•°æ®ã€‚ä¸»ä»åº“åŒæ­¥æ—¶æœ‰ä¸ªå‘½ä»¤ä¼ æ’­çš„è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»åº“ä¼šç”¨ master_repl_offset è®°å½•å½“å‰çš„æœ€æ–°å†™æ“ä½œåœ¨ repl_backlog_buffer ä¸­çš„ä½ç½®ï¼Œè€Œä»åº“ä¼šç”¨ slave_repl_offset è¿™ä¸ªå€¼è®°å½•å½“å‰çš„å¤åˆ¶è¿›åº¦ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦æ‰¾çš„ä»åº“ï¼Œå®ƒçš„ slave_repl_offset éœ€è¦æœ€æ¥è¿‘ master_repl_offsetã€‚å¦‚æœåœ¨æ‰€æœ‰ä»åº“ä¸­ï¼Œæœ‰ä»åº“çš„ slave_repl_offset æœ€æ¥è¿‘ master_repl_offsetï¼Œé‚£ä¹ˆå®ƒçš„å¾—åˆ†å°±æœ€é«˜ï¼Œå¯ä»¥ä½œä¸ºæ–°ä¸»åº“ã€‚å°±åƒä¸‹å›¾æ‰€ç¤ºï¼Œæ—§ä¸»åº“çš„ master_repl_offset æ˜¯ 1000ï¼Œä»åº“ 1ã€2 å’Œ 3 çš„ slave_repl_offset åˆ†åˆ«æ˜¯ 950ã€990 å’Œ 900ï¼Œé‚£ä¹ˆï¼Œä»åº“ 2 å°±åº”è¯¥è¢«é€‰ä¸ºæ–°ä¸»åº“ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis32.jpg" alt="avatar"><br>å½“ç„¶ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªä»åº“çš„ slave_repl_offset å€¼å¤§å°æ˜¯ä¸€æ ·çš„ï¼ˆä¾‹å¦‚ï¼Œä»åº“ 1 å’Œä»åº“ 2 çš„ slave_repl_offset å€¼éƒ½æ˜¯ 990ï¼‰ï¼Œæˆ‘ä»¬å°±éœ€è¦ç»™å®ƒä»¬è¿›è¡Œç¬¬ä¸‰è½®æ‰“åˆ†äº†ã€‚</p></li><li><p>ç¬¬ä¸‰è½®ï¼šID å·å°çš„ä»åº“å¾—åˆ†é«˜ã€‚</p></li></ol><h2 id="å“¨å…µé›†ç¾¤çš„åŸç†"><a href="#å“¨å…µé›†ç¾¤çš„åŸç†" class="headerlink" title="å“¨å…µé›†ç¾¤çš„åŸç†"></a>å“¨å…µé›†ç¾¤çš„åŸç†</h2><p>&emsp;&emsp;æˆ‘ä»¬é€šå¸¸é€šè¿‡ä½¿ç”¨å“¨å…µé›†ç¾¤æ¥å¯¹ä¸»ä»åº“çš„çŠ¶æ€è¿›è¡Œç›‘æ§å¹¶åœ¨ä¸»åº“æŒ‚æ‰æ—¶é€‰å‡ºæ–°çš„ä¸»åº“ã€‚é‚£ä¹ˆå“¨å…µå‡ºç°æ•…éšœå‘¢ï¼Ÿå®é™…ä¸Šï¼Œä¸€æ—¦å¤šä¸ªå®ä¾‹ç»„æˆå“¨å…µé›†ç¾¤ï¼Œå³ä½¿ä¸€ä¸ªå®ä¾‹æŒ‚æ‰ï¼Œå‰©ä¸‹çš„å“¨å…µä¾ç„¶ä¼šç»§ç»­å±¥è¡ŒåŸå§‹çš„èŒèƒ½ï¼Œé€šè¿‡å“¨å…µé›†ç¾¤çš„é…ç½®é¡¹ï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå“¨å…µåœ¨å»ºç«‹çš„ä¸€å¼€å§‹å¯¹å½¼æ­¤æ˜¯æ²¡æœ‰æ„ŸçŸ¥çš„ï¼Œå®ƒä»¬å„è‡ªçŸ¥é“çš„åªæœ‰ Redis ä¸»åº“çš„ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;åœ¨é…ç½®å“¨å…µçš„ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨åˆ°ä¸‹é¢çš„è¿™ä¸ªé…ç½®é¡¹ï¼Œè®¾ç½®ä¸»åº“çš„ IP å’Œç«¯å£ï¼Œå¹¶æ²¡æœ‰é…ç½®å…¶ä»–å“¨å…µçš„è¿æ¥ä¿¡æ¯ã€‚</p><h3 id="åŸºäº-Pub-Sub-æœºåˆ¶çš„å“¨å…µé›†ç¾¤çš„ç›¸äº’æ„ŸçŸ¥"><a href="#åŸºäº-Pub-Sub-æœºåˆ¶çš„å“¨å…µé›†ç¾¤çš„ç›¸äº’æ„ŸçŸ¥" class="headerlink" title="åŸºäº Pub/Sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤çš„ç›¸äº’æ„ŸçŸ¥"></a>åŸºäº Pub/Sub æœºåˆ¶çš„å“¨å…µé›†ç¾¤çš„ç›¸äº’æ„ŸçŸ¥</h3><p>&emsp;&emsp;å“¨å…µä¹‹é—´èƒ½å¤Ÿç›¸äº’å‘ç°ï¼Œè¦å½’åŠŸäº Redis çš„pub/sub æœºåˆ¶ï¼Œå³å‘å¸ƒ/è®¢é˜…æœºåˆ¶ã€‚å“¨å…µåªè¦å’Œä¸»åº“å»ºç«‹äº†è¿æ¥ï¼Œå°±å¯ä»¥åœ¨ä¸»åº“ä¸Šå‘å¸ƒæ¶ˆæ¯äº†ï¼Œæ¯”å¦‚è¯´å‘å¸ƒå®ƒè‡ªå·±çš„è¿æ¥ä¿¡ æ¯ï¼ˆIP å’Œç«¯å£ï¼‰ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ä»ä¸»åº“ä¸Šè®¢é˜…æ¶ˆæ¯ï¼Œè·å¾—å…¶ä»–å“¨å…µå‘å¸ƒçš„è¿æ¥ä¿¡æ¯ã€‚å½“å¤šä¸ªå“¨å…µå®ä¾‹éƒ½åœ¨ä¸»åº“ä¸Šåšäº†å‘å¸ƒå’Œè®¢é˜…æ“ä½œåï¼Œå®ƒä»¬ä¹‹é—´å°±èƒ½çŸ¥é“å½¼æ­¤çš„ IP åœ°å€å’Œç«¯å£ã€‚<br>&emsp;&emsp;é™¤äº†å“¨å…µå®ä¾‹ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„åº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥é€šè¿‡ Redis è¿›è¡Œæ¶ˆæ¯çš„å‘å¸ƒå’Œè®¢é˜…ã€‚æ‰€ä»¥ï¼Œä¸ºäº†åŒºåˆ†ä¸åŒåº”ç”¨çš„æ¶ˆæ¯ï¼ŒRedis ä¼šä»¥é¢‘é“çš„å½¢å¼ï¼Œå¯¹è¿™äº›æ¶ˆæ¯è¿›è¡Œåˆ†é—¨åˆ«ç±»çš„ç®¡ç†ã€‚æ‰€è°“çš„é¢‘é“ï¼Œå®é™…ä¸Šå°±æ˜¯æ¶ˆæ¯çš„ç±»åˆ«ã€‚å½“æ¶ˆæ¯ç±»åˆ«ç›¸åŒæ—¶ï¼Œå®ƒä»¬å°±å±äºåŒä¸€ä¸ªé¢‘é“ã€‚ åä¹‹ï¼Œå°±å±äºä¸åŒçš„é¢‘é“ã€‚åªæœ‰è®¢é˜…äº†åŒä¸€ä¸ªé¢‘é“çš„åº”ç”¨ï¼Œæ‰èƒ½é€šè¿‡å‘å¸ƒçš„æ¶ˆæ¯è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚<br>&emsp;&emsp;åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸»åº“ä¸Šæœ‰ä¸€ä¸ªåä¸ºâ€œ__sentinel__:helloâ€çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ã€‚<br>&emsp;&emsp;ä¸¾ä¸ªä¾‹å­ï¼Œå…·ä½“è¯´æ˜ä¸€ä¸‹ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œå“¨å…µ 1 æŠŠè‡ªå·±çš„ IPï¼ˆ172.16.19.3ï¼‰å’Œç«¯å£ ï¼ˆ26579ï¼‰å‘å¸ƒåˆ°â€œ__sentinel__:helloâ€é¢‘é“ä¸Šï¼Œå“¨å…µ 2 å’Œ 3 è®¢é˜…äº†è¯¥é¢‘é“ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œå“¨å…µ 2 å’Œ 3 å°±å¯ä»¥ä»è¿™ä¸ªé¢‘é“ç›´æ¥è·å–å“¨å…µ 1 çš„ IP åœ°å€å’Œç«¯å£å·ã€‚ç„¶åï¼Œå“¨å…µ 2ã€3 å¯ä»¥å’Œå“¨å…µ 1 å»ºç«‹ç½‘ç»œè¿æ¥ã€‚é€šè¿‡è¿™ä¸ªæ–¹å¼ï¼Œå“¨å…µ 2 å’Œ 3 ä¹Ÿå¯ä»¥å»ºç«‹ç½‘ç»œè¿æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå“¨å…µé›†ç¾¤å°±å½¢æˆäº†ã€‚å®ƒä»¬ç›¸äº’é—´å¯ä»¥é€šè¿‡ç½‘ç»œè¿æ¥è¿›è¡Œé€šä¿¡ï¼Œæ¯”å¦‚è¯´å¯¹ä¸»åº“æœ‰æ²¡æœ‰ä¸‹çº¿è¿™ä»¶äº‹å„¿è¿›è¡Œåˆ¤æ–­å’Œåå•†ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis33.jpg" alt="avatar"><br>&emsp;&emsp;å“¨å…µé™¤äº†å½¼æ­¤ä¹‹é—´å»ºç«‹èµ·è¿æ¥å½¢æˆé›†ç¾¤å¤–ï¼Œè¿˜éœ€è¦å’Œä»åº“å»ºç«‹è¿æ¥ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨å“¨å…µçš„ç›‘æ§ä»»åŠ¡ä¸­ï¼Œå®ƒéœ€è¦å¯¹ä¸»ä»åº“éƒ½è¿›è¡Œå¿ƒè·³åˆ¤æ–­ï¼Œè€Œä¸”åœ¨ä¸»ä»åº“åˆ‡æ¢å®Œæˆåï¼Œå®ƒè¿˜éœ€è¦é€šçŸ¥ä»åº“ï¼Œè®©å®ƒä»¬å’Œæ–°ä¸»åº“è¿›è¡ŒåŒæ­¥ã€‚</p><h3 id="å“¨å…µå¦‚ä½•ä½•çŸ¥é“ä»åº“çš„-IP-åœ°å€å’Œç«¯å£"><a href="#å“¨å…µå¦‚ä½•ä½•çŸ¥é“ä»åº“çš„-IP-åœ°å€å’Œç«¯å£" class="headerlink" title="å“¨å…µå¦‚ä½•ä½•çŸ¥é“ä»åº“çš„ IP åœ°å€å’Œç«¯å£"></a>å“¨å…µå¦‚ä½•ä½•çŸ¥é“ä»åº“çš„ IP åœ°å€å’Œç«¯å£</h3><p>&emsp;&emsp;å“¨å…µå‘ä¸»åº“å‘é€ INFO å‘½ä»¤æ¥å®Œæˆçš„ã€‚å°±åƒä¸‹å›¾æ‰€ç¤ºï¼Œå“¨å…µ 2 ç»™ä¸»åº“å‘é€ INFO å‘½ä»¤ï¼Œä¸»åº“æ¥å—åˆ°è¿™ä¸ªå‘½ä»¤åï¼Œå°±ä¼šæŠŠä»åº“åˆ—è¡¨è¿”å›ç»™å“¨å…µã€‚æ¥ç€ï¼Œå“¨å…µå°±å¯ä»¥æ ¹æ®ä»åº“åˆ—è¡¨ä¸­çš„è¿æ¥ä¿¡æ¯ï¼Œå’Œæ¯ä¸ªä»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶åœ¨è¿™ä¸ªè¿æ¥ä¸ŠæŒç»­åœ°å¯¹ä»åº“è¿›è¡Œç›‘æ§ã€‚å“¨å…µ 1 å’Œ 3 å¯ä»¥é€šè¿‡ç›¸åŒçš„æ–¹æ³•å’Œä»åº“å»ºç«‹è¿æ¥ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis34.jpg" alt="avatar"><br>&emsp;&emsp;é€šè¿‡ pub/sub æœºåˆ¶ï¼Œå“¨å…µä¹‹é—´å¯ä»¥ç»„æˆé›†ç¾¤ï¼ŒåŒæ—¶ï¼Œå“¨å…µåˆé€šè¿‡ INFO å‘½ä»¤ï¼Œè·å¾—äº†ä»åº“è¿æ¥ä¿¡æ¯ï¼Œä¹Ÿèƒ½å’Œä»åº“å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œç›‘æ§äº†ã€‚</p><h3 id="åŸºäº-pub-sub-æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥"><a href="#åŸºäº-pub-sub-æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥" class="headerlink" title="åŸºäº pub/sub æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥"></a>åŸºäº pub/sub æœºåˆ¶çš„å®¢æˆ·ç«¯äº‹ä»¶é€šçŸ¥</h3><p>&emsp;&emsp;å“¨å…µä¸èƒ½åªå’Œä¸»ã€ä»åº“è¿æ¥ã€‚å› ä¸ºï¼Œä¸»ä»åº“åˆ‡æ¢åï¼Œå®¢æˆ·ç«¯ä¹Ÿéœ€è¦çŸ¥é“æ–°ä¸»åº“çš„è¿æ¥ä¿¡æ¯ï¼Œæ‰èƒ½å‘æ–°ä¸»åº“å‘é€è¯·æ±‚æ“ä½œã€‚æ‰€ä»¥ï¼Œå“¨å…µè¿˜éœ€è¦å®ŒæˆæŠŠæ–°ä¸»åº“çš„ä¿¡æ¯å‘Šè¯‰å®¢æˆ·ç«¯è¿™ä¸ªä»»åŠ¡ã€‚è€Œä¸”ï¼Œåœ¨å®é™…ä½¿ç”¨å“¨å…µæ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼šå¦‚ä½•åœ¨å®¢æˆ·ç«¯é€šè¿‡ç›‘æ§äº†è§£å“¨å…µè¿›è¡Œä¸»ä»åˆ‡æ¢çš„è¿‡ç¨‹å‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œä¸»ä»åˆ‡æ¢è¿›è¡Œåˆ°å“ªä¸€æ­¥äº†ï¼Ÿè¿™å…¶å®å°±æ˜¯è¦æ±‚ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿè·å–åˆ°å“¨å…µé›†ç¾¤åœ¨ç›‘æ§ã€é€‰ä¸»ã€åˆ‡æ¢è¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç”Ÿçš„å„ç§äº‹ä»¶ã€‚<br>&emsp;&emsp;ä»æœ¬è´¨ä¸Šè¯´ï¼Œå“¨å…µå°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹å®šæ¨¡å¼ä¸‹çš„ Redis å®ä¾‹ï¼Œåªä¸è¿‡å®ƒå¹¶ä¸æœåŠ¡è¯·æ±‚æ“ä½œï¼Œåªæ˜¯å®Œæˆç›‘æ§ã€é€‰ä¸»å’Œé€šçŸ¥çš„ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œæ¯ä¸ªå“¨å…µå®ä¾‹ä¹Ÿæä¾› pub/sub æœºåˆ¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä»å“¨å…µè®¢é˜…æ¶ˆæ¯ã€‚å“¨å…µæä¾›çš„æ¶ˆæ¯è®¢é˜…é¢‘é“æœ‰å¾ˆå¤šï¼Œä¸åŒé¢‘é“åŒ…å«äº†ä¸»ä»åº“åˆ‡æ¢è¿‡ç¨‹ä¸­çš„ä¸åŒå…³é”®äº‹ä»¶ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis35.jpg" alt="avatar"><br>&emsp;&emsp;çŸ¥é“äº†è¿™äº›é¢‘é“ä¹‹åï¼Œä½ å°±å¯ä»¥è®©å®¢æˆ·ç«¯ä»å“¨å…µè¿™é‡Œè®¢é˜…æ¶ˆæ¯äº†ã€‚å…·ä½“çš„æ“ä½œæ­¥éª¤æ˜¯ï¼Œå®¢æˆ·ç«¯è¯»å–å“¨å…µçš„é…ç½®æ–‡ä»¶åï¼Œå¯ä»¥è·å¾—å“¨å…µçš„åœ°å€å’Œç«¯å£ï¼Œå’Œå“¨å…µå»ºç«‹ç½‘ç»œè¿æ¥ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯æ‰§è¡Œè®¢é˜…å‘½ä»¤ï¼Œæ¥è·å–ä¸åŒçš„äº‹ä»¶æ¶ˆæ¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œæ¥è®¢é˜…â€œæ‰€æœ‰å®ä¾‹è¿›å…¥å®¢è§‚ä¸‹çº¿çŠ¶æ€çš„äº‹ä»¶â€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE +odown</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œè®¢é˜…æ‰€æœ‰çš„äº‹ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSUBSCRIBE *</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å½“å“¨å…µæŠŠæ–°ä¸»åº“é€‰æ‹©å‡ºæ¥åï¼Œå®¢æˆ·ç«¯å°±ä¼šçœ‹åˆ°ä¸‹é¢çš„ switch-master äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶è¡¨ç¤ºä¸»åº“å·²ç»åˆ‡æ¢äº†ï¼Œæ–°ä¸»åº“çš„ IP åœ°å€å’Œç«¯å£ä¿¡æ¯å·²ç»æœ‰äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ç”¨è¿™é‡Œé¢çš„æ–°ä¸»åº“åœ°å€å’Œç«¯å£è¿›è¡Œé€šä¿¡äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">switch-master &lt;master name&gt; &lt;oldip&gt; &lt;oldport&gt; &lt;newip&gt; &lt;newport&gt;</span><br></pre></td></tr></table></figure><h3 id="ç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢"><a href="#ç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢" class="headerlink" title="ç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢?"></a>ç”±å“ªä¸ªå“¨å…µæ‰§è¡Œä¸»ä»åˆ‡æ¢?</h3><p>&emsp;&emsp;å®é™…ä¸Šï¼Œ<strong>é€‰ä¸»å’Œæ‰§è¡Œä¸»ä»åˆ‡æ¢è¿™ä¸¤ä¸ªæµç¨‹æ˜¯åˆ†è£‚çš„ï¼Œå¹¶ä¸æ˜¯ç”±å‘ç°ä¸»åº“ä¸‹çº¿çš„å“¨å…µç›´æ¥æ‰§è¡Œï¼Œè€Œä¹Ÿæ˜¯é€šè¿‡â€œæŠ•ç¥¨â€çš„æ–¹å¼é€‰å‡ºæ‰§è¡Œçš„å“¨å…µ</strong>ã€‚å“¨å…µé›†ç¾¤è¦åˆ¤å®šä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€ï¼Œéœ€è¦æœ‰ä¸€å®šæ•°é‡çš„å®ä¾‹éƒ½è®¤ä¸ºè¯¥ä¸»åº“å·²ç»â€œä¸»è§‚ä¸‹çº¿â€äº†ã€‚ä»»ä½•ä¸€ä¸ªå®ä¾‹åªè¦è‡ªèº«åˆ¤æ–­ä¸»åº“â€œä¸»è§‚ä¸‹çº¿â€åï¼Œå°±ä¼šç»™å…¶ä»–å®ä¾‹å‘é€ is-master-downby-addr å‘½ä»¤ã€‚æ¥ç€ï¼Œå…¶ä»–å®ä¾‹ä¼šæ ¹æ®è‡ªå·±å’Œä¸»åº“çš„è¿æ¥æƒ…å†µï¼Œåšå‡º Y æˆ– N çš„å“åº”ï¼ŒY ç›¸ å½“äºèµæˆç¥¨ï¼ŒN ç›¸å½“äºåå¯¹ç¥¨ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis36.jpg" alt="avatar"></p><p>&emsp;&emsp;ä¸€ä¸ªå“¨å…µè·å¾—äº†ä»²è£æ‰€éœ€çš„èµæˆç¥¨æ•°åï¼Œå°±å¯ä»¥æ ‡è®°ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€ã€‚è¿™ä¸ªæ‰€éœ€çš„èµæˆç¥¨æ•°æ˜¯é€šè¿‡å“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum é…ç½®é¡¹è®¾å®šçš„ã€‚ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ 5 ä¸ªå“¨å…µï¼Œquorum é…ç½®çš„æ˜¯ 3ï¼Œé‚£ä¹ˆï¼Œä¸€ä¸ªå“¨å…µéœ€è¦ 3 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥æ ‡è®°ä¸»åº“ä¸ºâ€œå®¢è§‚ä¸‹çº¿â€äº†ã€‚è¿™ 3 å¼ èµæˆç¥¨åŒ…æ‹¬å“¨å…µè‡ªå·±çš„ä¸€å¼ èµæˆç¥¨å’Œå¦å¤–ä¸¤ä¸ªå“¨å…µçš„èµæˆç¥¨ã€‚<br>&emsp;&emsp;æ­¤æ—¶ï¼Œè¿™ä¸ªå“¨å…µå°±å¯ä»¥å†ç»™å…¶ä»–å“¨å…µå‘é€å‘½ä»¤ï¼Œè¡¨æ˜å¸Œæœ›ç”±è‡ªå·±æ¥æ‰§è¡Œä¸»ä»åˆ‡æ¢ï¼Œå¹¶è®©æ‰€æœ‰å…¶ä»–å“¨å…µè¿›è¡ŒæŠ•ç¥¨ã€‚è¿™ä¸ªæŠ•ç¥¨è¿‡ç¨‹ç§°ä¸ºâ€œLeader é€‰ä¸¾â€ã€‚å› ä¸ºæœ€ç»ˆæ‰§è¡Œä¸»ä»åˆ‡æ¢çš„å“¨å…µ ç§°ä¸º Leaderï¼ŒæŠ•ç¥¨è¿‡ç¨‹å°±æ˜¯ç¡®å®š Leaderã€‚åœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µï¼Œè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼šç¬¬ä¸€ï¼Œæ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ï¼›ç¬¬äºŒï¼Œæ‹¿åˆ°çš„ç¥¨æ•°åŒæ—¶è¿˜éœ€è¦å¤§äºç­‰äºå“¨å…µé…ç½®æ–‡ä»¶ä¸­çš„ quorum å€¼ã€‚ä»¥ 3 ä¸ªå“¨å…µä¸ºä¾‹ï¼Œå‡è®¾æ­¤æ—¶çš„ quorum è®¾ç½®ä¸º 2ï¼Œé‚£ä¹ˆï¼Œä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µåªè¦æ‹¿åˆ° 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥äº†ã€‚</p><p>ä¸‹é¢å±•ç¤ºä¸€ä¸‹ 3 ä¸ªå“¨å…µã€quorum ä¸º 2 çš„é€‰ä¸¾è¿‡ç¨‹ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis37.jpg" alt="avatar"><br>&emsp;&emsp;å¦‚æœ S3 æ²¡æœ‰æ‹¿åˆ° 2 ç¥¨ Yï¼Œé‚£ä¹ˆè¿™è½®æŠ•ç¥¨å°±ä¸ä¼šäº§ç”Ÿ Leaderã€‚å“¨å…µé›†ç¾¤ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¹Ÿå°±æ˜¯å“¨å…µæ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´çš„ 2 å€ï¼‰ï¼Œå†é‡æ–°é€‰ä¸¾ã€‚è¿™æ˜¯å› ä¸ºï¼Œå“¨å…µé›†ç¾¤èƒ½å¤Ÿè¿›è¡ŒæˆåŠŸæŠ•ç¥¨ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºé€‰ä¸¾å‘½ä»¤çš„æ­£å¸¸ç½‘ç»œä¼ æ’­ã€‚å¦‚æœç½‘ç»œå‹åŠ›è¾ƒå¤§æˆ–æœ‰çŸ­æ—¶å µå¡ï¼Œ å°±å¯èƒ½å¯¼è‡´æ²¡æœ‰ä¸€ä¸ªå“¨å…µèƒ½æ‹¿åˆ°åŠæ•°ä»¥ä¸Šçš„èµæˆç¥¨ã€‚æ‰€ä»¥ï¼Œç­‰åˆ°ç½‘ç»œæ‹¥å¡å¥½è½¬ä¹‹åï¼Œå†è¿›è¡ŒæŠ•ç¥¨é€‰ä¸¾ï¼ŒæˆåŠŸçš„æ¦‚ç‡å°±ä¼šå¢åŠ ã€‚</p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p>&emsp;&emsp;å‡è®¾æœ‰ä¸€ä¸ª Redis é›†ç¾¤ï¼Œæ˜¯â€œä¸€ä¸»å››ä»â€ï¼ŒåŒæ—¶é…ç½®äº†åŒ…å« 5 ä¸ªå“¨å…µå®ä¾‹çš„é›†ç¾¤ï¼Œquorum å€¼è®¾ä¸º 2ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ 3 ä¸ªå“¨å…µå®ä¾‹éƒ½å‘ç”Ÿæ•…éšœäº†ï¼Œæ­¤æ—¶ï¼ŒRedis ä¸»åº“å¦‚æœæœ‰æ•…éšœï¼Œè¿˜èƒ½æ­£ç¡®åœ°åˆ¤æ–­ä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€å—ï¼Ÿå¦‚æœå¯ä»¥çš„è¯ï¼Œè¿˜èƒ½è¿›è¡Œä¸»ä»åº“è‡ªåŠ¨åˆ‡æ¢å—ï¼Ÿ<br>ç­”ï¼š1ã€å¯ä»¥æ­£ç¡®çš„åˆ¤æ–­ä¸»åº“â€œå®¢è§‚ä¸‹çº¿â€ï¼Œä»¥ä¸ºå…¶ä¸­ä¸€ä¸ªå“¨å…µå·²ç»è·å¾—äº†â€œå®¢è§‚ä¸‹çº¿â€æ‰€éœ€è¦ çš„æŠ•ç¥¨æ•°ï¼›2ã€ä¸èƒ½è¿›è¡Œè‡ªåŠ¨çš„ä¸»ä»åˆ‡æ¢ï¼Œå› ä¸ºåœ¨ä¸»ä»åˆ‡æ¢çš„æ—¶å€™ï¼Œå¿…é¡»é€‰æ‹©å‡ºä¸€ä¸ªä¸»å“¨å…µï¼Œä½†æ˜¯é€‰æ‹© ä¸»å“¨å…µæœ‰2ä¸ªæ¡ä»¶ï¼š2.1ã€è·å¾—åŠæ•°ä»¥ä¸Šçš„ç¥¨æ•°ï¼›2.2ã€ç¥¨æ•°å¤§äºç­‰äº quorum å€¼ã€‚åœ¨å·²ç»æœ‰3ä¸ªå“¨å…µæŒ‚æ‰çš„æƒ…å†µä¸‹ä¸å¯èƒ½è·å¾—è¶…è¿‡åŠæ•°çš„ç¥¨ã€‚</p><h1 id="Redis-åˆ‡ç‰‡é›†ç¾¤"><a href="#Redis-åˆ‡ç‰‡é›†ç¾¤" class="headerlink" title="Redis åˆ‡ç‰‡é›†ç¾¤"></a>Redis åˆ‡ç‰‡é›†ç¾¤</h1><p>&emsp;&emsp;æˆ‘ä»¬å…ˆè®¾æƒ³ä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœè¦å­˜å‚¨ä¸€ä¸ªå¾ˆå¤§è§„æ¨¡çš„æ•°æ®ï¼Œä¾‹å¦‚è¦ç”¨ Redis ä¿å­˜ 5000 ä¸‡ä¸ªé”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®å€¼å¯¹å¤§çº¦æ˜¯ 512Bï¼Œç²—ç•¥åœ°è®¡ç®—äº†ä¸€ä¸‹ï¼Œè¿™äº›é”®å€¼å¯¹æ‰€å çš„å†…å­˜ç©ºé—´å¤§çº¦æ˜¯ 25GBï¼ˆ5000 ä¸‡ *512Bï¼‰ã€‚é€‰æ‹©ä¸€å° 32 GB å†…å­˜çš„ä¸»æœºæ¥éƒ¨ç½² Redisï¼Œ32GB çš„å†…å­˜èƒ½ä¿å­˜æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸”è¿˜ç•™æœ‰ 7GBï¼Œå¯ä»¥ä¿è¯ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚åŒæ—¶é‡‡ç”¨ RDB å¯¹æ•°æ®åšæŒä¹…åŒ–ï¼Œä»¥ç¡®ä¿ Redis å®ä¾‹æ•…éšœåï¼Œè¿˜èƒ½ä» RDB æ¢å¤æ•°æ®ã€‚ä½†æ˜¯ï¼Œåœ¨å®é™…çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼Œè¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´ Redis çš„å“åº”ç›¸å½“æ…¢ï¼Œè¿™è·Ÿ Redis çš„æŒä¹…åŒ–æœºåˆ¶æœ‰å…³ç³»ã€‚åœ¨ä½¿ç”¨ RDB è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼ŒRedis ä¼š fork å­è¿›ç¨‹æ¥å®Œæˆï¼Œfork æ“ä½œçš„ç”¨æ—¶å’Œ Redis çš„æ•°æ®é‡æ˜¯æ­£ç›¸å…³çš„ï¼Œè€Œ fork åœ¨æ‰§è¡Œæ—¶ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚æ•°æ®é‡è¶Šå¤§ï¼Œfork æ“ä½œé€ æˆçš„ä¸»çº¿ç¨‹é˜»å¡çš„æ—¶é—´è¶Šé•¿ã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ RDB å¯¹ 25GB çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–æ—¶ï¼Œæ•°æ®é‡è¾ƒå¤§ï¼Œåå°è¿è¡Œçš„å­è¿›ç¨‹åœ¨ fork åˆ›å»ºæ—¶é˜»å¡äº†ä¸»çº¿ç¨‹ï¼Œäºæ˜¯å°±å¯¼è‡´ Redis å“åº”å˜æ…¢äº†ã€‚<br>&emsp;&emsp;è¿™æ ·çœ‹æ¥ï¼Œå…‰æ˜¯é€šè¿‡æ‰©å®¹å†…å­˜æ¥è§£å†³æ•°æ®é‡å¤§çš„é—®é¢˜ä¼šå¼•å…¥æ–°çš„é—®é¢˜ã€‚è¿™æ—¶æˆ‘ä»¬å¯ä»¥è€ƒè™‘ Redis çš„åˆ‡ç‰‡é›†ç¾¤ï¼Œå®ƒå¯ä»¥ä¿å­˜å¤§é‡æ•°æ®ï¼Œè€Œä¸”å¯¹ Redis ä¸»çº¿ç¨‹çš„é˜»å¡å½±å“è¾ƒå°ã€‚</p><h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><p>&emsp;&emsp;åˆ‡ç‰‡é›†ç¾¤ï¼Œä¹Ÿå«åˆ†ç‰‡é›†ç¾¤ï¼Œå°±æ˜¯æŒ‡å¯åŠ¨å¤šä¸ª Redis å®ä¾‹ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼ŒæŠŠæ”¶åˆ°çš„æ•°æ®åˆ’åˆ†æˆå¤šä»½ï¼Œæ¯ä¸€ä»½ç”¨ä¸€ä¸ªå®ä¾‹æ¥ä¿å­˜ã€‚å›åˆ°æˆ‘ä»¬åˆšåˆšçš„åœºæ™¯ä¸­ï¼Œå¦‚æœæŠŠ 25GB çš„æ•°æ®å¹³å‡åˆ†æˆ 5 ä»½ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸åšå‡åˆ†ï¼‰ï¼Œä½¿ç”¨ 5 ä¸ªå®ä¾‹æ¥ä¿å­˜ï¼Œæ¯ä¸ªå®ä¾‹åªéœ€è¦ä¿å­˜ 5GB æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis38.jpg" alt="avatar"><br>&emsp;&emsp;é‚£ä¹ˆï¼Œåœ¨åˆ‡ç‰‡é›†ç¾¤ä¸­ï¼Œå®ä¾‹åœ¨ä¸º 5GB æ•°æ®ç”Ÿæˆ RDB æ—¶ï¼Œæ•°æ®é‡å°±å°äº†å¾ˆå¤šï¼Œfork å­è¿›ç¨‹ä¸€èˆ¬ä¸ä¼šç»™ä¸»çº¿ç¨‹å¸¦æ¥è¾ƒé•¿æ—¶é—´çš„é˜»å¡ã€‚é‡‡ç”¨å¤šä¸ªå®ä¾‹ä¿å­˜æ•°æ®åˆ‡ç‰‡åï¼Œæˆ‘ä»¬æ—¢èƒ½ä¿å­˜25GB æ•°æ®ï¼Œåˆé¿å…äº† fork å­è¿›ç¨‹é˜»å¡ä¸»çº¿ç¨‹è€Œå¯¼è‡´çš„å“åº”çªç„¶å˜æ…¢ã€‚</p><h2 id="å¦‚ä½•ä¿å­˜æ›´å¤šæ•°æ®"><a href="#å¦‚ä½•ä¿å­˜æ›´å¤šæ•°æ®" class="headerlink" title="å¦‚ä½•ä¿å­˜æ›´å¤šæ•°æ®"></a>å¦‚ä½•ä¿å­˜æ›´å¤šæ•°æ®</h2><p>&emsp;&emsp;ä¸ºäº†ä¿å­˜å¤§é‡æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤§å†…å­˜äº‘ä¸»æœºå’Œåˆ‡ç‰‡é›†ç¾¤ä¸¤ç§æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™ä¸¤ç§æ–¹æ³•åˆ†åˆ«å¯¹åº”ç€ Redis åº”å¯¹æ•°æ®é‡å¢å¤šçš„ä¸¤ç§æ–¹æ¡ˆï¼šçºµå‘æ‰©å±•ï¼ˆscale upï¼‰å’Œæ¨ªå‘æ‰©å±•ï¼ˆscale outï¼‰ã€‚</p><ul><li>çºµå‘æ‰©å±•ï¼šå‡çº§å•ä¸ª Redis å®ä¾‹çš„èµ„æºé…ç½®ï¼ŒåŒ…æ‹¬å¢åŠ å†…å­˜å®¹é‡ã€å¢åŠ ç£ç›˜å®¹é‡ã€ä½¿ç”¨æ›´é«˜é…ç½®çš„ CPUã€‚å°±åƒä¸‹å›¾ä¸­ï¼ŒåŸæ¥çš„å®ä¾‹å†…å­˜æ˜¯ 8GBï¼Œç¡¬ç›˜æ˜¯ 50GBï¼Œçºµå‘æ‰©å±•åï¼Œ å†…å­˜å¢åŠ åˆ° 24GBï¼Œç£ç›˜å¢åŠ åˆ° 150GBã€‚</li><li>æ¨ªå‘æ‰©å±•ï¼šæ¨ªå‘å¢åŠ å½“å‰ Redis å®ä¾‹çš„ä¸ªæ•°ï¼Œå°±åƒä¸‹å›¾ä¸­ï¼ŒåŸæ¥ä½¿ç”¨ 1 ä¸ª 8GB å†…å­˜ã€ 50GB ç£ç›˜çš„å®ä¾‹ï¼Œç°åœ¨ä½¿ç”¨ä¸‰ä¸ªç›¸åŒé…ç½®çš„å®ä¾‹ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis39.jpg" alt="avatar"></li></ul><h2 id="æ•°æ®åˆ‡ç‰‡å’Œå®ä¾‹çš„å¯¹åº”åˆ†å¸ƒå…³ç³»"><a href="#æ•°æ®åˆ‡ç‰‡å’Œå®ä¾‹çš„å¯¹åº”åˆ†å¸ƒå…³ç³»" class="headerlink" title="æ•°æ®åˆ‡ç‰‡å’Œå®ä¾‹çš„å¯¹åº”åˆ†å¸ƒå…³ç³»"></a>æ•°æ®åˆ‡ç‰‡å’Œå®ä¾‹çš„å¯¹åº”åˆ†å¸ƒå…³ç³»</h2><p>&emsp;&emsp;åœ¨åˆ‡ç‰‡é›†ç¾¤ä¸­ï¼Œæ•°æ®éœ€è¦åˆ†å¸ƒåœ¨ä¸åŒå®ä¾‹ä¸Šï¼Œé‚£ä¹ˆï¼Œæ•°æ®å’Œå®ä¾‹ä¹‹é—´å¦‚ä½•å¯¹åº”å‘¢ï¼Ÿè¿™å°±å’Œæ¥ä¸‹æ¥æˆ‘è¦è®²çš„ Redis Cluster æ–¹æ¡ˆæœ‰å…³äº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¦å…ˆå¼„æ˜ç™½åˆ‡ç‰‡é›†ç¾¤å’Œ Redis Cluster çš„è”ç³»ä¸åŒºåˆ«ã€‚å®é™…ä¸Šï¼Œåˆ‡ç‰‡é›†ç¾¤æ˜¯ä¸€ç§ä¿å­˜å¤§é‡æ•°æ®çš„é€šç”¨æœºåˆ¶ï¼Œè¿™ä¸ªæœºåˆ¶å¯ä»¥æœ‰ä¸åŒçš„å®ç°æ–¹æ¡ˆã€‚åœ¨ Redis 3.0 ä¹‹å‰ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰é’ˆå¯¹åˆ‡ç‰‡é›†ç¾¤æä¾›å…·ä½“çš„æ–¹æ¡ˆã€‚ä» 3.0 å¼€å§‹ï¼Œå®˜æ–¹æä¾›äº†ä¸€ä¸ªåä¸º Redis Cluster çš„æ–¹æ¡ˆï¼Œç”¨äºå®ç°åˆ‡ç‰‡é›†ç¾¤ã€‚Redis Cluster æ–¹æ¡ˆä¸­å°±è§„å®šäº†æ•°æ®å’Œå®ä¾‹çš„å¯¹åº”è§„åˆ™ã€‚<br>&emsp;&emsp;Redis Cluster æ–¹æ¡ˆé‡‡ç”¨å“ˆå¸Œæ§½æ¥å¤„ç†æ•°æ®ä¸å®ä¾‹çš„æ˜ å°„å…³ç³»ã€‚ä¸€ä¸ª Redis åˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½ï¼Œï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ã€‚<br>&emsp;&emsp;å…·ä½“çš„æ˜ å°„åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>æ ¹æ®é”®å€¼å¯¹çš„ key è®¡ç®—å‡ºä¸€ä¸ªå“ˆå¸Œå€¼ï¼ŒåŒ¹é…åˆ°æŸä¸€ä¸ªå“ˆå¸Œæ§½ä¸Š</li><li>å°†å…·ä½“çš„å“ˆå¸Œæ§½ä¸ Redis åˆ‡ç‰‡å®ä¾‹å…³è”ä¸Š</li></ol><p>&emsp;&emsp;æˆ‘ä»¬åœ¨éƒ¨ç½² Redis Cluster æ–¹æ¡ˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ cluster create å‘½ä»¤åˆ›å»ºé›†ç¾¤ï¼Œæ­¤æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨æŠŠè¿™äº›æ§½å¹³å‡åˆ†å¸ƒåœ¨é›†ç¾¤å®ä¾‹ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœé›†ç¾¤ä¸­æœ‰ N ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆï¼Œæ¯ä¸ªå®ä¾‹ä¸Šçš„æ§½ä¸ªæ•°ä¸º 16384/N ä¸ªã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ cluster meet å‘½ä»¤æ‰‹åŠ¨å»ºç«‹å®ä¾‹é—´çš„è¿æ¥ï¼Œå½¢æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨ cluster addslots å‘½ä»¤ï¼ŒæŒ‡å®šæ¯ä¸ªå®ä¾‹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°ã€‚å‡è®¾é›†ç¾¤ä¸­ä¸åŒ Redis å®ä¾‹çš„å†…å­˜å¤§å°é…ç½®ä¸ä¸€ï¼Œå¦‚æœæŠŠå“ˆå¸Œæ§½å‡åˆ†åœ¨å„ä¸ªå®ä¾‹ä¸Šï¼Œåœ¨ä¿å­˜ç›¸åŒæ•°é‡çš„é”®å€¼å¯¹æ—¶ï¼Œå’Œå†…å­˜å¤§çš„å®ä¾‹ç›¸æ¯”ï¼Œå†…å­˜å°çš„å®ä¾‹å°±ä¼šæœ‰æ›´å¤§çš„å®¹é‡å‹åŠ›ã€‚é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œä½ å¯ä»¥æ ¹æ®ä¸åŒå®ä¾‹çš„èµ„æºé…ç½®æƒ…å†µï¼Œä½¿ç”¨ cluster addslots å‘½ä»¤æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½ã€‚<br>&emsp;&emsp;æ•°æ®ã€å“ˆå¸Œæ§½ã€å®ä¾‹è¿™ä¸‰è€…çš„æ˜ å°„åˆ†å¸ƒæƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img lazyload src="/images/loading.svg" data-src="redis40.jpg" alt="avatar"><br>&emsp;&emsp;ç¤ºæ„å›¾ä¸­çš„åˆ‡ç‰‡é›†ç¾¤ä¸€å…±æœ‰ 3 ä¸ªå®ä¾‹ï¼ŒåŒæ—¶å‡è®¾æœ‰ 5 ä¸ªå“ˆå¸Œæ§½ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½ï¼šå®ä¾‹ 1 ä¿å­˜å“ˆå¸Œæ§½ 0 å’Œ 1ï¼Œå®ä¾‹ 2 ä¿å­˜å“ˆå¸Œæ§½ 2 å’Œ 3ï¼Œå®ä¾‹ 3 ä¿å­˜å“ˆå¸Œæ§½ 4ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 172.16.19.3 â€“p 6379 cluster addslots 0,1 </span><br><span class="line">redis-cli -h 172.16.19.4 â€“p 6379 cluster addslots 2,3 </span><br><span class="line">redis-cli -h 172.16.19.5 â€“p 6379 cluster addslots 4</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®"><a href="#å®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®" class="headerlink" title="å®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®"></a>å®¢æˆ·ç«¯å¦‚ä½•å®šä½æ•°æ®</h2><p>&emsp;&emsp;ä¸€èˆ¬æ¥è¯´ï¼Œå®¢æˆ·ç«¯å’Œé›†ç¾¤å®ä¾‹å»ºç«‹è¿æ¥åï¼Œå®ä¾‹å°±ä¼šæŠŠå“ˆå¸Œæ§½çš„åˆ†é…ä¿¡æ¯å‘ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ï¼Œåœ¨é›†ç¾¤åˆšåˆšåˆ›å»ºçš„æ—¶å€™ï¼Œæ¯ä¸ªå®ä¾‹åªçŸ¥é“è‡ªå·±è¢«åˆ†é…äº†å“ªäº›å“ˆå¸Œæ§½ï¼Œæ˜¯ä¸çŸ¥é“å…¶ä»–å®ä¾‹æ‹¥æœ‰çš„å“ˆå¸Œæ§½ä¿¡æ¯çš„ã€‚é‚£ä¹ˆï¼Œå®¢æˆ·ç«¯ä¸ºä»€ä¹ˆå¯ä»¥åœ¨è®¿é—®ä»»ä½•ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œéƒ½èƒ½è·å¾—æ‰€æœ‰çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼ŒRedis å®ä¾‹ä¼šæŠŠè‡ªå·±çš„å“ˆå¸Œæ§½ä¿¡æ¯å‘ç»™å’Œå®ƒç›¸è¿æ¥çš„å…¶å®ƒå®ä¾‹ï¼Œæ¥å®Œæˆå“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯çš„æ‰©æ•£ã€‚å½“å®ä¾‹ä¹‹é—´ç›¸äº’è¿æ¥åï¼Œæ¯ä¸ªå®ä¾‹å°±æœ‰æ‰€æœ‰å“ˆå¸Œæ§½çš„æ˜ å°„å…³ç³»äº†ã€‚å®¢æˆ·ç«¯æ”¶åˆ°å“ˆå¸Œæ§½ä¿¡æ¯åï¼Œä¼šæŠŠå“ˆå¸Œæ§½ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚é”®å€¼å¯¹æ—¶ï¼Œä¼šå…ˆè®¡ç®—é”®æ‰€å¯¹åº”çš„å“ˆå¸Œæ§½ï¼Œç„¶åå°±å¯ä»¥ç»™ç›¸åº”çš„å®ä¾‹å‘é€è¯·æ±‚äº†ã€‚<br>&emsp;&emsp;ä½†æ˜¯ï¼Œåœ¨é›†ç¾¤ä¸­ï¼Œå®ä¾‹å’Œå“ˆå¸Œæ§½çš„å¯¹åº”å…³ç³»å¹¶ä¸æ˜¯ä¸€æˆä¸å˜çš„ï¼Œæœ€å¸¸è§çš„å˜åŒ–æœ‰ä¸¤ä¸ªï¼š</p><ol><li>åœ¨é›†ç¾¤ä¸­ï¼Œå®ä¾‹æœ‰æ–°å¢æˆ–åˆ é™¤ï¼ŒRedis éœ€è¦é‡æ–°åˆ†é…å“ˆå¸Œæ§½ï¼›</li><li>ä¸ºäº†è´Ÿè½½å‡è¡¡ï¼ŒRedis éœ€è¦æŠŠå“ˆå¸Œæ§½åœ¨æ‰€æœ‰å®ä¾‹ä¸Šé‡æ–°åˆ†å¸ƒä¸€éã€‚</li></ol><p>&emsp;&emsp;æ­¤æ—¶ï¼Œå®ä¾‹ä¹‹é—´è¿˜å¯ä»¥é€šè¿‡ç›¸äº’ä¼ é€’æ¶ˆæ¯ï¼Œè·å¾—æœ€æ–°çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ï¼Œä½†æ˜¯ï¼Œå®¢æˆ·ç«¯æ˜¯æ— æ³•ä¸»åŠ¨æ„ŸçŸ¥è¿™äº›å˜åŒ–çš„ã€‚è¿™å°±ä¼šå¯¼è‡´ï¼Œå®ƒç¼“å­˜çš„åˆ†é…ä¿¡æ¯å’Œæœ€æ–°çš„åˆ†é…ä¿¡æ¯å°±ä¸ä¸€è‡´äº†ã€‚Redis Cluster æ–¹æ¡ˆæä¾›äº†ä¸€ç§é‡å®šå‘æœºåˆ¶ï¼Œæ‰€è°“çš„â€œé‡å®šå‘â€ï¼Œå°±æ˜¯æŒ‡ï¼Œå®¢æˆ·ç«¯ç»™ä¸€ä¸ªå®ä¾‹å‘é€æ•°æ®è¯»å†™æ“ä½œæ—¶ï¼Œè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰ç›¸åº”çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯è¦å†ç»™ä¸€ä¸ªæ–°å®ä¾‹å‘é€æ“ä½œå‘½ä»¤ã€‚é‚£å®¢æˆ·ç«¯åˆæ˜¯æ€ä¹ˆçŸ¥é“é‡å®šå‘æ—¶çš„æ–°å®ä¾‹çš„è®¿é—®åœ°å€å‘¢ï¼Ÿå½“å®¢æˆ·ç«¯æŠŠä¸€ä¸ªé”®å€¼å¯¹çš„æ“ä½œè¯·æ±‚å‘ç»™ä¸€ä¸ªå®ä¾‹æ—¶ï¼Œå¦‚æœè¿™ä¸ªå®ä¾‹ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªé”®å€¼å¯¹æ˜ å°„çš„å“ˆå¸Œæ§½ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªå®ä¾‹å°±ä¼šç»™å®¢æˆ·ç«¯è¿”å›ä¸‹é¢çš„ MOVED å‘½ä»¤å“åº”ç»“æœï¼Œè¿™ä¸ªç»“æœä¸­å°±åŒ…å«äº†æ–°å®ä¾‹çš„è®¿é—®åœ°å€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET hello:key (error) MOVED 13320 172.16.19.5:6379</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;å…¶ä¸­ï¼ŒMOVED å‘½ä»¤è¡¨ç¤ºï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„é”®å€¼å¯¹æ‰€åœ¨çš„å“ˆå¸Œæ§½ 13320ï¼Œå®é™…æ˜¯åœ¨ 172.16.19.5 è¿™ä¸ªå®ä¾‹ä¸Šã€‚é€šè¿‡è¿”å›çš„ MOVED å‘½ä»¤ï¼Œå°±ç›¸å½“äºæŠŠå“ˆå¸Œæ§½æ‰€åœ¨çš„æ–°å®ä¾‹çš„ä¿¡æ¯å‘Šè¯‰ç»™å®¢æˆ·ç«¯äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥ç›´æ¥å’Œ 172.16.19.5 è¿æ¥ï¼Œå¹¶å‘é€æ“ä½œè¯·æ±‚äº†ã€‚</p><p>&emsp;&emsp;å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”±äºè´Ÿè½½å‡è¡¡ï¼Œ Slot 2 ä¸­çš„æ•°æ®å·²ç»ä»å®ä¾‹ 2 è¿ç§»åˆ°äº†å®ä¾‹ 3ï¼Œä½†æ˜¯ï¼Œå®¢æˆ·ç«¯ç¼“å­˜ä»ç„¶è®°å½•ç€â€œSlot 2 åœ¨å®ä¾‹ 2â€çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¼šç»™å®ä¾‹ 2 å‘é€å‘½ä»¤ã€‚å®ä¾‹ 2 ç»™å®¢æˆ·ç«¯è¿”å›ä¸€æ¡ MOVED å‘½ä»¤ï¼ŒæŠŠ Slot 2 çš„æœ€æ–°ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯åœ¨å®ä¾‹ 3 ä¸Šï¼‰ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å°±ä¼šå†æ¬¡å‘å®ä¾‹ 3 å‘é€è¯·æ±‚ï¼ŒåŒæ—¶è¿˜ä¼šæ›´æ–°æœ¬åœ°ç¼“å­˜ï¼ŒæŠŠ Slot 2 ä¸å®ä¾‹çš„å¯¹åº”å…³ç³»æ›´æ–°è¿‡æ¥ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis41.jpg" alt="avatar"></p><p>&emsp;&emsp;åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜ä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼Œå®¢æˆ·ç«¯å‘å®ä¾‹ 2 å‘é€è¯·æ±‚ï¼Œä½†æ­¤æ—¶ï¼ŒSlot 2 ä¸­çš„æ•°æ®åªæœ‰ä¸€éƒ¨åˆ†è¿ç§»åˆ°äº†å®ä¾‹ 3ï¼Œè¿˜æœ‰éƒ¨åˆ†æ•°æ®æ²¡æœ‰è¿ç§»ã€‚åœ¨è¿™ç§è¿ç§»éƒ¨åˆ†å®Œæˆçš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å°±ä¼šæ”¶åˆ°ä¸€æ¡ ASK æŠ¥é”™ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET hello:key </span><br><span class="line">(error) ASK 13320 172.16.19.5:6379</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;è¿™ä¸ªç»“æœä¸­çš„ ASK å‘½ä»¤å°±è¡¨ç¤ºï¼Œå®¢æˆ·ç«¯è¯·æ±‚çš„é”®å€¼å¯¹æ‰€åœ¨çš„å“ˆå¸Œæ§½ 13320ï¼Œåœ¨ 172.16.19.5 è¿™ä¸ªå®ä¾‹ä¸Šï¼Œä½†æ˜¯è¿™ä¸ªå“ˆå¸Œæ§½æ­£åœ¨è¿ç§»ã€‚æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯éœ€è¦å…ˆç»™ 172.16.19.5 è¿™ä¸ªå®ä¾‹å‘é€ä¸€ä¸ª ASKING å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤çš„æ„æ€æ˜¯ï¼Œè®©è¿™ä¸ªå®ä¾‹å…è®¸æ‰§è¡Œå®¢æˆ·ç«¯æ¥ä¸‹æ¥å‘é€çš„å‘½ä»¤ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯å†å‘è¿™ä¸ªå®ä¾‹å‘é€ GET å‘½ä»¤ï¼Œä»¥è¯»å–æ•°æ®ã€‚<br><img lazyload src="/images/loading.svg" data-src="redis42.jpg" alt="avatar"></p><p>&emsp;&emsp;å’Œ MOVED å‘½ä»¤ä¸åŒï¼ŒASK å‘½ä»¤å¹¶ä¸ä¼šæ›´æ–°å®¢æˆ·ç«¯ç¼“å­˜çš„å“ˆå¸Œæ§½åˆ†é…ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸Šå›¾ä¸­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚ Slot 2 ä¸­çš„æ•°æ®ï¼Œå®ƒè¿˜æ˜¯ä¼šç»™å®ä¾‹ 2 å‘é€è¯·æ±‚ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼ŒASK å‘½ä»¤çš„ä½œç”¨åªæ˜¯è®©å®¢æˆ·ç«¯èƒ½ç»™æ–°å®ä¾‹å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè€Œä¸åƒ MOVED å‘½ä»¤é‚£æ ·ï¼Œä¼šæ›´æ”¹æœ¬åœ°ç¼“å­˜ï¼Œè®©åç»­æ‰€æœ‰å‘½ä»¤éƒ½å‘å¾€æ–°å®ä¾‹ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿&quot;&gt;&lt;a href=&quot;#ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿&quot; class=&quot;headerlink&quot; title=&quot;ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿&quot;&gt;&lt;/a&gt;ä¸¤å¤§çº¬åº¦ï¼Œä¸‰å¤§ä¸»çº¿&lt;/h1&gt;&lt;p&gt;&lt;img lazyload src=&quot;/images/loading.svg&quot; da</summary>
      
    
    
    
    <category term="ä¸­é—´ä»¶" scheme="http://jiahaohong1997.github.io/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
    <category term="Redis" scheme="http://jiahaohong1997.github.io/tags/Redis/"/>
    
  </entry>
  
  <entry>
    <title>å¾®æœåŠ¡å¯ç”¨æ€§è®¾è®¡</title>
    <link href="http://jiahaohong1997.github.io/2021/12/29/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8F%AF%E7%94%A8%E6%80%A7%E8%AE%BE%E8%AE%A1/"/>
    <id>http://jiahaohong1997.github.io/2021/12/29/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%8F%AF%E7%94%A8%E6%80%A7%E8%AE%BE%E8%AE%A1/</id>
    <published>2021-12-29T07:00:00.000Z</published>
    <updated>2022-01-02T10:06:50.418Z</updated>
    
    <content type="html"><![CDATA[<h1 id="éš”ç¦»"><a href="#éš”ç¦»" class="headerlink" title="éš”ç¦»"></a>éš”ç¦»</h1><p>&emsp;&emsp;æœ¬è´¨ä¸Šæ˜¯å¯¹ç³»ç»Ÿæˆ–èµ„æºè¿›è¡Œåˆ†å‰²ï¼Œä»è€Œå®ç°å½“ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶èƒ½é™å®šä¼ æ’­èŒƒå›´å’Œå½±å“èŒƒå›´ï¼Œå³å‘ç”Ÿæ•…éšœååªæœ‰å‡ºé—®é¢˜çš„æœåŠ¡ä¸å¯ç”¨ï¼Œä¿è¯å…¶ä»–æœåŠ¡ä»ç„¶å¯ç”¨ã€‚</p><ul><li>æœåŠ¡éš”ç¦»</li></ul><ol><li><p>åŠ¨é™éš”ç¦»</p><p> å°åˆ° CPU çš„ cacheline <a class="link" href="https://www.cnblogs.com/cyfonly/p/5800758.html">false sharing<i class="fas fa-external-link-alt"></i></a>ã€æ•°æ®åº“ mysql è¡¨è®¾è®¡ä¸­é¿å… bufferpool é¢‘ç¹è¿‡æœŸï¼Œéš”ç¦»åŠ¨é™è¡¨ï¼Œå¤§åˆ°æ¶æ„è®¾è®¡ä¸­çš„å›¾ç‰‡ã€é™æ€èµ„æºç­‰ç¼“å­˜åŠ é€Ÿã€‚æœ¬è´¨ä¸Šéƒ½ä½“ç°çš„ä¸€æ ·çš„æ€è·¯ï¼Œå³åŠ é€Ÿ/ç¼“å­˜è®¿é—®å˜æ¢é¢‘æ¬¡å°çš„ã€‚<br> æ¡ˆä¾‹ä¸€ï¼š CDN åœºæ™¯ä¸­ï¼Œå°†é™æ€èµ„æºå’ŒåŠ¨æ€ API åˆ†ç¦»ï¼Œä¹Ÿæ˜¯ä½“ç°äº†éš”ç¦»çš„æ€è·¯:<br><img lazyload src="/images/loading.svg" data-src="CDN.png" alt="avatar"></p><p> *. é™ä½äº†åº”ç”¨æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œé™æ€æ–‡ä»¶è®¿é—®è´Ÿè½½å…¨éƒ¨é€šè¿‡CDNï¼›<br> *. å¯¹è±¡å­˜å‚¨è´¹ç”¨æœ€ä½ï¼›<br> *. æµ·é‡å­˜å‚¨ç©ºé—´ï¼Œæ— éœ€è€ƒè™‘å­˜å‚¨æ¶æ„çš„å‡çº§ï¼›<br> *. é™æ€CDNå¸¦å®½åŠ é€Ÿï¼Œå»¶è¿Ÿä½ã€‚</p><p>æ¡ˆä¾‹äºŒï¼šç”¨æˆ·åˆ›ä½œç¨¿ä»¶åº“<br> archive: ç¨¿ä»¶è¡¨ï¼Œå­˜å‚¨ç¨¿ä»¶çš„åç§°ã€ä½œè€…ã€åˆ†ç±»ã€tagã€çŠ¶æ€ç­‰ä¿¡æ¯ï¼Œè¡¨ç¤ºç¨¿ä»¶çš„åŸºæœ¬ä¿¡æ¯ã€‚åœ¨ä¸€ä¸ªæŠ•ç¨¿æµç¨‹ä¸­ï¼Œä¸€æ—¦ç¨¿ä»¶åˆ›å»ºæ”¹åŠ¨çš„é¢‘ç‡æ¯”è¾ƒä½ã€‚<br> archive_stat: ç¨¿ä»¶ç»Ÿè®¡è¡¨ï¼Œè¡¨ç¤ºç¨¿ä»¶çš„æ’­æ”¾ã€ç‚¹èµã€æ”¶è—ã€æŠ•å¸æ•°é‡ï¼Œæ¯”è¾ƒé«˜é¢‘çš„æ›´æ–°ã€‚éšç€ç¨¿ä»¶è·å–æµé‡ï¼Œç¨¿ä»¶è¢«ç”¨æˆ·æ‰€æ¶ˆè´¹ï¼Œå„ç±»è®¡æ•°ä¿¡æ¯æ›´æ–°æ¯”è¾ƒé¢‘ç¹ã€‚<br><img lazyload src="/images/loading.svg" data-src="archive.png" alt="avatar"><br> MySQL BufferPool æ˜¯ç”¨äºç¼“å­˜ DataPage çš„ï¼ŒDataPage å¯ä»¥ç†è§£ä¸ºç¼“å­˜äº†è¡¨çš„è¡Œï¼Œé‚£ä¹ˆå¦‚æœé¢‘ç¹æ›´æ–° DataPage ä¸æ–­ä¼šç½®æ¢ï¼Œä¼šå¯¼è‡´å‘½ä¸­ç‡ä¸‹é™çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¡¨è®¾è®¡ä¸­ï¼Œä»ç„¶å¯ä»¥æ²¿ç”¨ç±»ä¼¼çš„æ€è·¯ï¼Œå…¶ä¸»è¡¨åŸºæœ¬æ›´æ–°ï¼Œåœ¨ä¸Šæ¸¸ Cache æœªå‘½ä¸­ï¼Œé€ç©¿åˆ° MySQLï¼Œä»ç„¶æœ‰ BufferPool çš„ç¼“å­˜ã€‚</p></li><li><p>è¯»å†™åˆ†ç¦»ï¼šä¸»ä»ã€Replicasetã€CQRS</p></li></ol><ul><li>è½»é‡éš”ç¦»</li></ul><ol><li><p>æ ¸å¿ƒéš”ç¦»</p><p> ä¸šåŠ¡æŒ‰ç…§ Level è¿›è¡Œèµ„æºæ± åˆ’åˆ†ï¼ˆL0/L1/L2ï¼‰<br><img lazyload src="/images/loading.svg" data-src="level.png" alt="avatar"><br> æ ¸å¿ƒ/éæ ¸å¿ƒçš„æ•…éšœåŸŸçš„å·®å¼‚æ€§éš”ç¦»ï¼ˆæœºå™¨èµ„æºã€ä¾èµ–èµ„æºï¼‰<br> å¤šé›†ç¾¤ï¼Œé€šè¿‡å†—ä½™èµ„æºæ¥æå‡ååå’Œå®¹ç¾èƒ½åŠ›ã€‚</p></li><li><p>å¿«æ…¢éš”ç¦»<br>&emsp;&emsp;æˆ‘ä»¬å¯ä»¥æŠŠæœåŠ¡çš„ååæƒ³è±¡ä¸ºä¸€ä¸ªæ± ï¼Œå½“çªç„¶æ´ªæµè¿›æ¥æ—¶ï¼Œæ± å­éœ€è¦ä¸€å®šæ—¶é—´æ‰èƒ½æ’æ”¾å®Œï¼Œè¿™æ—¶å€™å…¶ä»–æ”¯æµåœ¨æ± å­é‡Œå¾…çš„æ—¶é—´å–å†³äºå‰é¢çš„æ’æ”¾èƒ½åŠ›ï¼Œè€—æ—¶å°±ä¼šå¢é«˜ï¼Œå¯¹å°è¯·æ±‚äº§ç”Ÿå½±å“ã€‚</p></li></ol><p>æ—¥å¿—ä¼ è¾“ä½“ç³»çš„æ¶æ„è®¾è®¡ä¸­ï¼Œæ•´ä¸ªæµéƒ½ä¼šæŠ•æ”¾åˆ°ä¸€ä¸ª kafka topic ä¸­ï¼ˆæ—©æœŸè®¾è®¡ç›®çš„: æ›´å¥½çš„é¡ºåº IOï¼‰ï¼Œæµå†…ä¼šåŒºåˆ†ä¸åŒçš„ logidï¼Œlogid ä¼šæœ‰ä¸åŒçš„ sink ç«¯ï¼Œå®ƒä»¬ä¹‹å‰ä¼šå‡ºç°å·®é€Ÿï¼Œæ¯”å¦‚ HDFS æŠ–åŠ¨ååä¸‹é™ï¼ŒES æ­£å¸¸æ°´ä½ï¼Œå…¨å±€æ•°æ®å°±ä¼šæ•´ä½“åå‹ã€‚<br><img lazyload src="/images/loading.svg" data-src="kafka.png" alt="avatar"><br>æŒ‰ç…§å„ç§çº¬åº¦éš”ç¦»ï¼šsinkã€éƒ¨é—¨ã€ä¸šåŠ¡ã€logidã€é‡è¦æ€§ï¼ˆS/A/B/Cï¼‰ã€‚<br>ä¸šåŠ¡æ—¥å¿—ä¹Ÿå±äºæŸä¸ª logidï¼Œæ—¥å¿—ç­‰çº§å°±å¯ä»¥ä½œä¸ºéš”ç¦»é€šé“ã€‚</p><ol start="3"><li>çƒ­ç‚¹éš”ç¦»(ä¹Ÿæ˜¯è§£å†³ç¼“å­˜å‡»ç©¿çš„ç­–ç•¥)</li></ol><p>ä½•ä¸ºçƒ­ç‚¹ï¼Ÿçƒ­ç‚¹å³ç»å¸¸è®¿é—®çš„æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»Ÿè®¡æŸä¸ªçƒ­ç‚¹æ•°æ®ä¸­è®¿é—®é¢‘æ¬¡æœ€é«˜çš„ Top K æ•°æ®ï¼Œå¹¶å¯¹å…¶è®¿é—®è¿›è¡Œç¼“å­˜ã€‚æ¯”å¦‚ï¼š<br>å°è¡¨å¹¿æ’­ï¼ˆå•èµ·ä¸€ä¸ªgoroutineï¼Œé‡‡ç”¨copy-on-writeçš„æ–¹å¼æ›´æ–°localcacheï¼‰: ä» remotecache æå‡ä¸º localcacheï¼Œapp å®šæ—¶æ›´æ–°ï¼Œç”šè‡³å¯ä»¥è®©è¿è¥å¹³å°æ”¯æŒå¹¿æ’­åˆ·æ–° localcacheã€‚<a class="link" href="https://pkg.go.dev/sync/atomic">atomic.Value<i class="fas fa-external-link-alt"></i></a><br><img lazyload src="/images/loading.svg" data-src="atomic.png" alt="avatar"><br>ä¸»åŠ¨é¢„çƒ­ï¼ˆæ—è·¯ç›‘æ§æ–¹å¼ï¼Œç±»ä¼¼åœ°éœ‡å‰30ç§’çš„é¢„è­¦ï¼Œæå‰ä¸€æ®µæ—¶é—´å°†ç¼“å­˜ä¸­çš„çƒ­ç‚¹æ•°æ®å˜æˆlocalcache å­˜å‚¨ï¼‰: æ¯”å¦‚ç›´æ’­æˆ¿é—´é¡µé«˜åœ¨çº¿æƒ…å†µä¸‹ bypass ç›‘æ§ä¸»åŠ¨é˜²å¾¡ã€‚<br><img lazyload src="/images/loading.svg" data-src="monitor.png" alt="avatar"></p><ul><li>ç‰©ç†éš”ç¦»</li></ul><ol><li><p>çº¿ç¨‹éš”ç¦»<br>&emsp;&emsp;ä¸»è¦é€šè¿‡çº¿ç¨‹æ± è¿›è¡Œéš”ç¦»ï¼Œä¹Ÿæ˜¯å®ç°æœåŠ¡éš”ç¦»çš„åŸºç¡€ã€‚æŠŠä¸šåŠ¡è¿›è¡Œåˆ†ç±»å¹¶äº¤ç»™ä¸åŒçš„çº¿ç¨‹æ± è¿›è¡Œå¤„ç†ï¼Œå½“æŸä¸ªçº¿ç¨‹æ± å¤„ç†ä¸€ç§ä¸šåŠ¡è¯·æ±‚å‘ç”Ÿé—®é¢˜æ—¶ï¼Œä¸ä¼šè®²æ•…éšœæ‰©æ•£å’Œå½±å“åˆ°å…¶ä»–çº¿ç¨‹æ± ï¼Œä¿è¯æœåŠ¡å¯ç”¨ã€‚<br>å¯¹äº Go æ¥è¯´ï¼Œæ‰€æœ‰ IO éƒ½æ˜¯ Nonblockingï¼Œä¸”æ‰˜ç®¡ç»™äº† Runtimeï¼Œåªä¼šé˜»å¡ Goroutineï¼Œä¸é˜»å¡ Mï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ Goroutine æ€»é‡çš„æ§åˆ¶ï¼Œä¸éœ€è¦çº¿ç¨‹æ¨¡å‹è¯­è¨€çš„çº¿ç¨‹éš”ç¦»ã€‚<br><img lazyload src="/images/loading.svg" data-src="java.png" alt="avatar"></p></li><li><p>è¿›ç¨‹éš”ç¦»<br>&emsp;&emsp;å®¹å™¨åŒ–ï¼ˆdockerï¼‰ï¼Œå®¹å™¨ç¼–æ’å¼•æ“ï¼ˆk8sï¼‰ã€‚æˆ‘ä»¬15å¹´åœ¨ KVM ä¸Šéƒ¨ç½²æœåŠ¡ï¼›16å¹´ä½¿ç”¨ Docker Swarmï¼›17å¹´è¿ç§»åˆ° Kubernetesï¼Œåˆ°å¹´åº•åœ¨çº¿åº”ç”¨å°±å…¨æ‰˜ç®¡äº†ï¼Œä¹‹åå¾ˆå¿«åœ¨çº¿åº”ç”¨å¼¹æ€§å…¬æœ‰äº‘ä¸Šçº¿ï¼›20å¹´ç¦»çº¿ Yarn å’Œ åœ¨çº¿ K8s åšäº†åœ¨ç¦»çº¿æ··éƒ¨ï¼ˆé”™å³°ä½¿ç”¨ï¼‰ï¼Œä¹‹åè®¡åˆ’å¼¹æ€§å…¬æœ‰äº‘é…åˆè‡ªå»º IDC åšåˆ°ç¦»çº¿çš„æ··åˆäº‘æ¶æ„ã€‚</p></li><li><p>é›†ç¾¤éš”ç¦»<br>&emsp;&emsp;è¿‡å¤šé›†ç¾¤æ–¹æ¡ˆï¼Œå³é€»è¾‘ä¸Šæ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œç‰©ç†ä¸Šéƒ¨ç½²å¤šå¥—åº”ç”¨ï¼Œé€šè¿‡ cluster åŒºåˆ†ã€‚</p></li></ol><h2 id="Case"><a href="#Case" class="headerlink" title="Case"></a>Case</h2><ol><li>è½¬ç é›†ç¾¤è¢«è¶…å¤§è§†é¢‘æ”»å‡»ï¼Œå¯¼è‡´è½¬ç å¤§é‡å»¶è¿Ÿã€‚</li></ol><p>&emsp;&emsp;é’ˆå¯¹å¤§è§†é¢‘ã€è¾ƒå¤§è§†é¢‘ã€é‡è¦è§†é¢‘åˆ†åˆ«è®¾ç½®è½¬ç é›†ç¾¤ï¼Œå½“å†é­é‡è½¬ç æ”»å‡»ï¼Œåªä¼šå½±å“éƒ¨åˆ†çš„æœåŠ¡å™¨ï¼Œè¿˜èƒ½ç»´æŒæ•´ä½“çš„å¯ç”¨ã€‚</p><ol start="2"><li>ç¼©ç•¥å›¾æœåŠ¡ï¼Œè¢«å¤§å›¾å®æ—¶ç¼©ç•¥åƒå®Œæ‰€æœ‰ CPUï¼Œå¯¼è‡´æ­£å¸¸çš„å°å›¾ç¼©ç•¥è¢«ä¸¢å¼ƒï¼Œå¤§é‡503ã€‚</li></ol><p>&emsp;&emsp;å¯¹äºè¯·æ±‚çš„å›¾åƒï¼Œä¸ä¼šä¸“é—¨é’ˆå¯¹æ‰€æœ‰è®¾å¤‡éƒ½é¢„è®¾å¥½å›¾ç‰‡çš„å°ºå¯¸ï¼Œä¼šæ ¹æ®ç”¨æˆ·çš„è®¾å¤‡å¤§å°è¿›è¡Œå®æ—¶çš„ç¼©ç•¥ã€‚å¦‚æœè¯·æ±‚äº†å¤§é‡çš„ gifï¼Œé‚£ä¹ˆå¯¹ gifçš„æ¯ä¸€å¸§éƒ½è¦è¿›è¡Œå®æ—¶ç¼©ç•¥ï¼Œè€—æ—¶æ¯”å›¾åƒè¦ä¹…å¾ˆå¤šã€‚æŠŠ gif å’Œæ­£å¸¸å›¾åƒåˆ†ä¸ºä¸¤ä¸ªé›†ç¾¤æ¥å¤„ç†ï¼Œå°†å…¨å‰§æ•…éšœåŒ–è§£ä¸ºå±€éƒ¨æ•…éšœã€‚</p><ol start="3"><li><p> æ•°æ®åº“å®ä¾‹ cgroup æœªéš”ç¦»ï¼Œå¯¼è‡´å¤§ SQL å¼•èµ·çš„é›†ä½“æ•…éšœã€‚</p></li><li><p> INFO æ—¥å¿—é‡è¿‡å¤§ï¼Œå¯¼è‡´å¼‚å¸¸ ERROR æ—¥å¿—é‡‡é›†å»¶è¿Ÿã€‚</p></li></ol><h1 id="è¶…æ—¶"><a href="#è¶…æ—¶" class="headerlink" title="è¶…æ—¶"></a>è¶…æ—¶</h1><p>&emsp;&emsp;è¶…æ—¶æ§åˆ¶ï¼Œæˆ‘ä»¬çš„ç»„ä»¶èƒ½å¤Ÿå¿«é€Ÿå¤±æ•ˆï¼ˆfail fastï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ç­‰åˆ°æ–­å¼€çš„å®ä¾‹ç›´åˆ°è¶…æ—¶ã€‚æ²¡æœ‰ä»€ä¹ˆæ¯”æŒ‚èµ·çš„è¯·æ±‚å’Œæ— å“åº”çš„ç•Œé¢æ›´ä»¤äººå¤±æœ›ã€‚è¿™ä¸ä»…æµªè´¹èµ„æºï¼Œè€Œä¸”è¿˜ä¼šè®©ç”¨æˆ·ä½“éªŒå˜å¾—æ›´å·®ã€‚æˆ‘ä»¬çš„æœåŠ¡æ˜¯äº’ç›¸è°ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨è¿™äº›å»¶è¿Ÿå åŠ å‰ï¼Œåº”è¯¥ç‰¹åˆ«æ³¨æ„é˜²æ­¢é‚£äº›è¶…æ—¶çš„æ“ä½œã€‚<br><img lazyload src="/images/loading.svg" data-src="timeout.png" alt="avatar"></p><ul><li>ç½‘è·¯ä¼ é€’å…·æœ‰ä¸ç¡®å®šæ€§ã€‚</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸ä¸€è‡´çš„è¶…æ—¶ç­–ç•¥å¯¼è‡´èµ„æºæµªè´¹ã€‚</li><li>é»˜è®¤å€¼â€ç­–ç•¥ã€‚(ä¸å»ºè®®ä½¿ç”¨â€œæ°¸ä¸è¶…æ—¶â€é»˜è®¤å€¼)</li><li>é«˜å»¶è¿ŸæœåŠ¡å¯¼è‡´ client æµªè´¹èµ„æºç­‰å¾…ï¼Œä½¿ç”¨è¶…æ—¶ä¼ é€’: è¿›ç¨‹é—´ä¼ é€’ + è·¨è¿›ç¨‹ä¼ é€’ã€‚</li></ul><p>&emsp;&emsp;è¶…æ—¶æ§åˆ¶æ˜¯å¾®æœåŠ¡å¯ç”¨æ€§çš„ç¬¬ä¸€é“å…³ï¼Œè‰¯å¥½çš„è¶…æ—¶ç­–ç•¥ï¼Œå¯ä»¥å°½å¯èƒ½è®©æœåŠ¡ä¸å †ç§¯è¯·æ±‚ï¼Œå°½å¿«æ¸…ç©ºé«˜å»¶è¿Ÿçš„è¯·æ±‚ï¼Œé‡Šæ”¾ Goroutineã€‚</p><h2 id="è¶…æ—¶æ§åˆ¶"><a href="#è¶…æ—¶æ§åˆ¶" class="headerlink" title="è¶…æ—¶æ§åˆ¶"></a>è¶…æ—¶æ§åˆ¶</h2><p>&emsp;&emsp;å®é™…ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¾èµ–çš„å¾®æœåŠ¡çš„è¶…æ—¶ç­–ç•¥å¹¶ä¸æ¸…æ¥šï¼Œæˆ–è€…éšç€ä¸šåŠ¡è¿­ä»£è€—æ—¶è¶…ç”Ÿäº†å˜åŒ–ï¼Œæ„å¤–çš„å¯¼è‡´ä¾èµ–è€…å‡ºç°äº†è¶…æ—¶ã€‚<br>å¤„ç†ç­–ç•¥ï¼š</p><ul><li> æœåŠ¡æä¾›è€…å®šä¹‰å¥½ latency SLOï¼Œæ›´æ–°åˆ° gRPC Proto å®šä¹‰ä¸­ï¼ŒæœåŠ¡åç»­è¿­ä»£ï¼Œéƒ½åº”ä¿è¯ SLOã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> google.example.library.v1;</span><br><span class="line"></span><br><span class="line">service LibraryService &#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Lagency SLO: 95th in 100ms, 99th in 150ms.</span></span><br><span class="line"></span><br><span class="line"> rpc CreateBook(CreateBookRequest) returns (Book);</span><br><span class="line"></span><br><span class="line"> rpc GetBook(GetBookRequest) returns Book);</span><br><span class="line"></span><br><span class="line"> rpc ListBooks(ListBooksRequest) returns (ListBooksResponse);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¿å…å‡ºç°æ„å¤–çš„é»˜è®¤è¶…æ—¶ç­–ç•¥ï¼Œæˆ–è€…æ„å¤–çš„é…ç½®è¶…æ—¶ç­–ç•¥ã€‚</p><ul><li>kit åŸºç¡€åº“å…œåº•é»˜è®¤è¶…æ—¶ï¼Œæ¯”å¦‚ 100msï¼Œè¿›è¡Œé…ç½®é˜²å¾¡ä¿æŠ¤ï¼Œé¿å…å‡ºç°ç±»ä¼¼ 60s ä¹‹ç±»çš„è¶…å¤§è¶…æ—¶ç­–ç•¥ã€‚</li><li>é…ç½®ä¸­å¿ƒå…¬å…±æ¨¡ç‰ˆï¼Œå¯¹äºæœªé…ç½®çš„æœåŠ¡ä½¿ç”¨å…¬å…±é…ç½®ã€‚</li></ul><h3 id="è¶…æ—¶ä¼ é€’"><a href="#è¶…æ—¶ä¼ é€’" class="headerlink" title="è¶…æ—¶ä¼ é€’"></a>è¶…æ—¶ä¼ é€’</h3><p> &emsp;&emsp;è¶…æ—¶ä¼ é€’: å½“ä¸Šæ¸¸æœåŠ¡å·²ç»è¶…æ—¶è¿”å› 504ï¼Œä½†ä¸‹æ¸¸æœåŠ¡ä»ç„¶åœ¨æ‰§è¡Œï¼Œä¼šå¯¼è‡´æµªè´¹èµ„æºåšæ— ç”¨åŠŸã€‚è¶…æ—¶ä¼ é€’æŒ‡çš„æ˜¯æŠŠå½“å‰æœåŠ¡çš„å‰©ä½™ Quota ä¼ é€’åˆ°ä¸‹æ¸¸æœåŠ¡ä¸­ï¼Œç»§æ‰¿è¶…æ—¶ç­–ç•¥ï¼Œæ§åˆ¶è¯·æ±‚çº§åˆ«çš„å…¨å±€è¶…æ—¶æ§åˆ¶ã€‚<br> <img lazyload src="/images/loading.svg" data-src="timetransfer.png" alt="avatar"><br> å–é…ç½®çš„è¶…æ—¶æ§åˆ¶ç­–ç•¥ä¸å‰©ä½™æ—¶é—´çš„æœ€å°å€¼ã€‚</p><ul><li><p>è¿›ç¨‹å†…è¶…æ—¶æ§åˆ¶<br>&emsp;&emsp;ä¸€ä¸ªè¯·æ±‚åœ¨æ¯ä¸ªé˜¶æ®µ(ç½‘ç»œè¯·æ±‚)å¼€å§‹å‰ï¼Œå°±è¦æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¶³å¤Ÿçš„å‰©ä½™æ¥å¤„ç†è¯·æ±‚ï¼Œä»¥åŠç»§æ‰¿ä»–çš„è¶…æ—¶ç­–ç•¥ï¼Œä½¿ç”¨ Go æ ‡å‡†åº“çš„ <a class="link" href="https://pkg.go.dev/context">context.WithTimeout<i class="fas fa-external-link-alt"></i></a>ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *asiiConn)</span> <span class="title">Get</span><span class="params">(ctx context.Context, key <span class="keyword">string</span>)</span> <span class="params">(result \*Item, err error)</span></span> &#123;</span><br><span class="line">c.conn.SetWriteDeadline(shrinkDeadline(ctx, c.writeTimeout))</span><br><span class="line"><span class="keyword">if</span> _, err = fmt.Fprintf(c.rw, <span class="string">&quot;gets %s\r\n&quot;</span>, key); err != <span class="literal">nil</span> &#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¤šè¿›ç¨‹çš„è¶…æ—¶æ§åˆ¶<br><img lazyload src="/images/loading.svg" data-src="processcontrol.png" alt="avatar"></p></li></ul><ol><li>A gRPC è¯·æ±‚ Bï¼Œ1sè¶…æ—¶ã€‚</li><li>B ä½¿ç”¨äº†300ms å¤„ç†è¯·æ±‚ï¼Œå†è½¬å‘è¯·æ±‚ Cã€‚</li><li>C é…ç½®äº†600ms è¶…æ—¶ï¼Œä½†æ˜¯å®é™…åªç”¨äº†500msã€‚</li><li>åˆ°å…¶ä»–çš„ä¸‹æ¸¸ï¼Œå‘ç°ä½™é‡ä¸è¶³ï¼Œå–æ¶ˆä¼ é€’ã€‚</li></ol><p>åœ¨éœ€è¦å¼ºåˆ¶æ‰§è¡Œæ—¶ï¼Œä¸‹æ¸¸çš„æœåŠ¡å¯ä»¥è¦†ç›–ä¸Šæ¸¸çš„è¶…æ—¶ä¼ é€’å’Œé…é¢ã€‚<br>åœ¨ gRPC æ¡†æ¶ä¸­ï¼Œä¼šä¾èµ– gRPC Metadata Exchangeï¼ŒåŸºäº HTTP2 çš„ Headers ä¼ é€’ grpc-timeout å­—æ®µï¼Œè‡ªåŠ¨ä¼ é€’åˆ°ä¸‹æ¸¸ï¼Œæ„å»ºå¸¦ timeout çš„ contextã€‚</p><p><img lazyload src="/images/loading.svg" data-src="Bimodel.png" alt="avatar"></p><ul><li>åŒå³°åˆ†å¸ƒ: 95%çš„è¯·æ±‚è€—æ—¶åœ¨100mså†…ï¼Œ5%çš„è¯·æ±‚å¯èƒ½æ°¸è¿œä¸ä¼šå®Œæˆï¼ˆé•¿è¶…æ—¶ï¼‰ã€‚</li><li>å¯¹äºç›‘æ§ä¸è¦åªçœ‹ meanï¼Œå¯ä»¥çœ‹çœ‹è€—æ—¶åˆ†å¸ƒç»Ÿè®¡ï¼Œæ¯”å¦‚ 95thï¼Œ99thã€‚</li><li>è®¾ç½®åˆç†çš„è¶…æ—¶ï¼Œæ‹’ç»è¶…é•¿è¯·æ±‚ï¼Œæˆ–è€…å½“Server ä¸å¯ç”¨è¦ä¸»åŠ¨å¤±è´¥ã€‚</li></ul><p><strong>è¶…æ—¶å†³å®šç€æœåŠ¡çº¿ç¨‹è€—å°½ã€‚</strong></p><h2 id="Case-Study"><a href="#Case-Study" class="headerlink" title="Case Study"></a>Case Study</h2><ul><li>SLB å…¥å£ Nginx æ²¡é…ç½®è¶…æ—¶å¯¼è‡´è¿é”æ•…éšœã€‚</li><li>æœåŠ¡ä¾èµ–çš„ DB è¿æ¥æ± æ¼é…è¶…æ—¶ï¼Œå¯¼è‡´è¯·æ±‚é˜»å¡ï¼Œæœ€ç»ˆæœåŠ¡é›†ä½“ OOMã€‚</li><li>ä¸‹æ¸¸æœåŠ¡å‘ç‰ˆè€—æ—¶å¢åŠ ï¼Œè€Œä¸Šæ¸¸æœåŠ¡é…ç½®è¶…æ—¶è¿‡çŸ­ï¼Œå¯¼è‡´ä¸Šæ¸¸è¯·æ±‚å¤±è´¥ã€‚</li></ul><h1 id="è¿‡è½½ä¿æŠ¤å’Œé™æµ"><a href="#è¿‡è½½ä¿æŠ¤å’Œé™æµ" class="headerlink" title="è¿‡è½½ä¿æŠ¤å’Œé™æµ"></a>è¿‡è½½ä¿æŠ¤å’Œé™æµ</h1><h2 id="è¿‡è½½ä¿æŠ¤"><a href="#è¿‡è½½ä¿æŠ¤" class="headerlink" title="è¿‡è½½ä¿æŠ¤"></a>è¿‡è½½ä¿æŠ¤</h2><h3 id="ä»¤ç‰Œæ¡¶ç®—æ³•"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•"></a>ä»¤ç‰Œæ¡¶ç®—æ³•</h3><p>   ä¸€ä¸ªå­˜æ”¾å›ºå®šå®¹é‡ä»¤ç‰Œçš„æ¡¶ï¼ŒæŒ‰ç…§å›ºå®šé€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œã€‚ä»¤ç‰Œæ¡¶ç®—æ³•çš„æè¿°å¦‚ä¸‹ï¼š</p><ul><li>å‡è®¾é™åˆ¶2r/sï¼Œåˆ™æŒ‰ç…§500æ¯«ç§’çš„å›ºå®šé€Ÿç‡å¾€æ¡¶ä¸­æ·»åŠ ä»¤ç‰Œã€‚</li><li>æ¡¶ä¸­æœ€å¤šå­˜æ”¾ b ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶æ»¡æ—¶ï¼Œæ–°æ·»åŠ çš„ä»¤ç‰Œè¢«ä¸¢å¼ƒæˆ–æ‹’ç»ã€‚</li><li>å½“ä¸€ä¸ª n ä¸ªå­—èŠ‚å¤§å°çš„æ•°æ®åŒ…åˆ°è¾¾ï¼Œå°†ä»æ¡¶ä¸­åˆ é™¤n ä¸ªä»¤ç‰Œï¼Œæ¥ç€æ•°æ®åŒ…è¢«å‘é€åˆ°ç½‘ç»œä¸Šã€‚</li><li>å¦‚æœæ¡¶ä¸­çš„ä»¤ç‰Œä¸è¶³ n ä¸ªï¼Œåˆ™ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä¸”è¯¥æ•°æ®åŒ…å°†è¢«é™æµï¼ˆè¦ä¹ˆä¸¢å¼ƒï¼Œè¦ä¹ˆç¼“å†²åŒºç­‰å¾…ï¼‰ã€‚</li></ul><p><img lazyload src="/images/loading.svg" data-src="token-bucket.png" alt="avatar"><br>token-bucket rate limit algorithm: <a class="link" href="https://pkg.go.dev/golang.org/x/time/rate">/x/time/rate<i class="fas fa-external-link-alt"></i></a></p><h3 id="æ¼æ¡¶ç®—æ³•"><a href="#æ¼æ¡¶ç®—æ³•" class="headerlink" title="æ¼æ¡¶ç®—æ³•"></a>æ¼æ¡¶ç®—æ³•</h3><p>ä½œä¸ºè®¡é‡å·¥å…·ï¼ˆThe Leaky Bucket Algorithm as a Meterï¼‰æ—¶ï¼Œå¯ä»¥ç”¨äºæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œæµé‡æ§åˆ¶ï¼ˆTrafficPolicingï¼‰ï¼Œæ¼æ¡¶ç®—æ³•çš„æè¿°å¦‚ä¸‹ï¼š</p><ul><li> ä¸€ä¸ªå›ºå®šå®¹é‡çš„æ¼æ¡¶ï¼ŒæŒ‰ç…§å¸¸é‡å›ºå®šé€Ÿç‡æµå‡ºæ°´æ»´ã€‚</li><li>å¦‚æœæ¡¶æ˜¯ç©ºçš„ï¼Œåˆ™ä¸éœ€æµå‡ºæ°´æ»´ã€‚</li><li>å¯ä»¥ä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´æ»´åˆ°æ¼æ¡¶ã€‚</li><li>å¦‚æœæµå…¥æ°´æ»´è¶…å‡ºäº†æ¡¶çš„å®¹é‡ï¼Œåˆ™æµå…¥çš„æ°´æ»´æº¢å‡ºäº†ï¼ˆè¢«ä¸¢å¼ƒï¼‰ï¼Œè€Œæ¼æ¡¶å®¹é‡æ˜¯ä¸å˜çš„ã€‚<br><img lazyload src="/images/loading.svg" data-src="leaky-bucket.png" alt="avatar"><br>leaky-bucket rate limit algorithm: <a class="link" href="https://pkg.go.dev/go.uber.org/ratelimit">/go.uber.org/ratelimit<i class="fas fa-external-link-alt"></i></a></li></ul><h3 id="ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•çš„å¼Šç«¯"><a href="#ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•çš„å¼Šç«¯" class="headerlink" title="ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•çš„å¼Šç«¯"></a>ä»¤ç‰Œæ¡¶å’Œæ¼æ¡¶ç®—æ³•çš„å¼Šç«¯</h3><p>&emsp;&emsp;æ¼æ–—æ¡¶/ä»¤ç‰Œæ¡¶ç¡®å®èƒ½å¤Ÿä¿æŠ¤ç³»ç»Ÿä¸è¢«æ‹–å®, ä½†ä¸ç®¡æ¼æ–—æ¡¶è¿˜æ˜¯ä»¤ç‰Œæ¡¶, å…¶é˜²æŠ¤æ€è·¯éƒ½æ˜¯è®¾å®šä¸€ä¸ªæŒ‡æ ‡, å½“è¶…è¿‡è¯¥æŒ‡æ ‡åå°±é˜»æ­¢æˆ–å‡å°‘æµé‡çš„ç»§ç»­è¿›å…¥ï¼Œå½“ç³»ç»Ÿè´Ÿè½½é™ä½åˆ°æŸä¸€æ°´å¹³ååˆ™æ¢å¤æµé‡çš„è¿›å…¥ã€‚ä½†å…¶é€šå¸¸éƒ½æ˜¯è¢«åŠ¨çš„ï¼Œå…¶å®é™…æ•ˆæœå–å†³äºé™æµé˜ˆå€¼è®¾ç½®æ˜¯å¦åˆç†ï¼Œä½†å¾€å¾€è®¾ç½®åˆç†ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚</p><ul><li>é›†ç¾¤å¢åŠ æœºå™¨æˆ–è€…å‡å°‘æœºå™¨é™æµé˜ˆå€¼æ˜¯å¦è¦é‡æ–°è®¾ç½®?</li><li>è®¾ç½®é™æµé˜ˆå€¼çš„ä¾æ®æ˜¯ä»€ä¹ˆ?</li><li>äººåŠ›è¿ç»´æˆæœ¬æ˜¯å¦è¿‡é«˜?</li><li>å½“è°ƒç”¨æ–¹åé¦ˆ429æ—¶, è¿™ä¸ªæ—¶å€™é‡æ–°è®¾ç½®é™æµ, å…¶å®æµé‡é«˜å³°å·²ç»è¿‡äº†é‡æ–°è¯„ä¼°é™æµæ˜¯å¦æœ‰æ„ä¹‰?</li></ul><p>&emsp;&emsp;è¿™äº›å…¶å®éƒ½æ˜¯é‡‡ç”¨æ¼æ–—æ¡¶/ä»¤ç‰Œæ¡¶çš„ç¼ºç‚¹, æ€»ä½“æ¥è¯´å°±æ˜¯å¤ªè¢«åŠ¨, ä¸èƒ½å¿«é€Ÿé€‚åº”æµé‡å˜åŒ–ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§è‡ªé€‚åº”çš„é™æµç®—æ³•ï¼Œå³: è¿‡è½½ä¿æŠ¤ï¼Œæ ¹æ®ç³»ç»Ÿå½“å‰çš„è´Ÿè½½è‡ªåŠ¨ä¸¢å¼ƒæµé‡ã€‚</p><h3 id="æ ¹æ®ç³»ç»Ÿè´Ÿè½½åšè¿‡è½½ä¿æŠ¤"><a href="#æ ¹æ®ç³»ç»Ÿè´Ÿè½½åšè¿‡è½½ä¿æŠ¤" class="headerlink" title="æ ¹æ®ç³»ç»Ÿè´Ÿè½½åšè¿‡è½½ä¿æŠ¤"></a>æ ¹æ®ç³»ç»Ÿè´Ÿè½½åšè¿‡è½½ä¿æŠ¤</h3><p>&emsp;&emsp;è®¡ç®—ç³»ç»Ÿä¸´è¿‘è¿‡è½½æ—¶çš„å³°å€¼ååä½œä¸ºé™æµçš„é˜ˆå€¼æ¥è¿›è¡Œæµé‡æ§åˆ¶ï¼Œè¾¾åˆ°ç³»ç»Ÿä¿æŠ¤ã€‚</p><ul><li>æœåŠ¡å™¨ä¸´è¿‘è¿‡è½½æ—¶ï¼Œä¸»åŠ¨æŠ›å¼ƒä¸€å®šé‡çš„è´Ÿè½½ï¼Œç›®æ ‡æ˜¯è‡ªä¿ã€‚</li><li>åœ¨ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œä¿æŒç³»ç»Ÿçš„ååé‡ã€‚</li></ul><p>å¸¸è§åšæ³•ï¼šåˆ©ç‰¹å°”æ³•åˆ™<br><img lazyload src="/images/loading.svg" data-src="lierte.png" alt="avatar"></p><ul><li>CPUã€å†…å­˜ä½œä¸ºä¿¡å·é‡è¿›è¡ŒèŠ‚æµã€‚</li><li>é˜Ÿåˆ—ç®¡ç†: é˜Ÿåˆ—é•¿åº¦ã€LIFOã€‚</li><li>å¯æ§å»¶è¿Ÿç®—æ³•: <a class="link" href="https://blog.csdn.net/dog250/article/details/72849893">Co<i class="fas fa-external-link-alt"></i></a><a class="link" href="https://blog.csdn.net/dog250/article/details/72849893">D<i class="fas fa-external-link-alt"></i></a><a class="link" href="https://blog.csdn.net/dog250/article/details/72849893">el<i class="fas fa-external-link-alt"></i></a>ã€‚</li></ul><p>å¦‚ä½•è®¡ç®—æ¥è¿‘å³°å€¼æ—¶çš„ç³»ç»Ÿååï¼Ÿ</p><ul><li><p>CPU: ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹é‡‡æ ·ï¼Œæ¯éš” 250ms è§¦å‘ä¸€æ¬¡ã€‚åœ¨è®¡ç®—å‡å€¼æ—¶ï¼Œä½¿ç”¨äº†ç®€å•æ»‘åŠ¨å¹³å‡å»é™¤å³°å€¼çš„å½±å“ã€‚<br><img lazyload src="/images/loading.svg" data-src="cpu.png" alt="avatar"></p></li><li><p>Inflight: å½“å‰æœåŠ¡ä¸­æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚çš„æ•°é‡ã€‚</p></li><li><p>Pass&amp;RT: æœ€è¿‘5sï¼Œpass ä¸ºæ¯100msé‡‡æ ·çª—å£å†…æˆåŠŸè¯·æ±‚çš„æ•°é‡ï¼Œrt ä¸ºå•ä¸ªé‡‡æ ·çª—å£ä¸­å¹³å‡å“åº”æ—¶é—´ã€‚<br><img lazyload src="/images/loading.svg" data-src="slide.png" alt="avatar"></p></li><li><p>ä½¿ç”¨ CPU çš„æ»‘åŠ¨å‡å€¼ï¼ˆCPU &gt; 800ï¼‰ä½œä¸ºå¯å‘é˜ˆå€¼ï¼Œä¸€æ—¦è§¦å‘è¿›å…¥åˆ°è¿‡è½½ä¿æŠ¤é˜¶æ®µï¼Œç®—æ³•ä¸ºï¼š(pass* rt) &lt; inflight</p></li><li><p>é™æµæ•ˆæœç”Ÿæ•ˆåï¼ŒCPU ä¼šåœ¨ä¸´ç•Œå€¼ï¼ˆ800ï¼‰é™„è¿‘æŠ–åŠ¨ï¼Œå¦‚æœä¸ä½¿ç”¨å†·å´æ—¶é—´ï¼Œé‚£ä¹ˆä¸€ä¸ªçŸ­æ—¶é—´çš„ CPU ä¸‹é™å°±å¯èƒ½å¯¼è‡´å¤§é‡è¯·æ±‚è¢«æ”¾è¡Œï¼Œä¸¥é‡æ—¶ä¼šæ‰“æ»¡ CPUã€‚</p></li><li><p>åœ¨å†·å´æ—¶é—´åï¼Œé‡æ–°åˆ¤æ–­é˜ˆå€¼ï¼ˆCPU &gt; 800 ï¼‰ï¼Œæ˜¯å¦æŒç»­è¿›å…¥è¿‡è½½ä¿æŠ¤ã€‚</p></li></ul><h2 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h2><p>&amp;emsp&emsp;åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå®šä¹‰æŸä¸ªå®¢æˆ·æˆ–åº”ç”¨å¯ä»¥æ¥æ”¶æˆ–å¤„ç†å¤šå°‘ä¸ªè¯·æ±‚çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡é™æµï¼Œä½ å¯ä»¥è¿‡æ»¤æ‰äº§ç”Ÿæµé‡å³°å€¼çš„å®¢æˆ·å’Œå¾®æœåŠ¡ï¼Œæˆ–è€…å¯ä»¥ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºåœ¨è‡ªåŠ¨æ‰©å±•ï¼ˆAuto Scalingï¼‰å¤±æ•ˆå‰éƒ½ä¸ä¼šå‡ºç°è¿‡è½½çš„æƒ…å†µã€‚</p><ul><li>ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ é’ˆå¯¹å•ä¸ªèŠ‚ç‚¹ï¼Œæ— æ³•åˆ†å¸ƒå¼é™æµã€‚</li><li>QPS é™æµ<ul><li>ä¸åŒçš„è¯·æ±‚å¯èƒ½éœ€è¦æ•°é‡è¿¥å¼‚çš„èµ„æºæ¥å¤„ç†ã€‚</li><li>æŸç§é™æ€ QPS é™æµä¸æ˜¯ç‰¹åˆ«å‡†ã€‚</li></ul></li><li>ç»™æ¯ä¸ªç”¨æˆ·è®¾ç½®é™åˆ¶<ul><li>å…¨å±€è¿‡è½½å‘ç”Ÿæ—¶å€™ï¼Œé’ˆå¯¹æŸäº›â€œå¼‚å¸¸â€è¿›è¡Œæ§åˆ¶ã€‚</li><li>ä¸€å®šç¨‹åº¦çš„â€œè¶…å–â€é…é¢ã€‚</li></ul></li><li>æŒ‰ç…§ä¼˜å…ˆçº§ä¸¢å¼ƒã€‚</li><li>æ‹’ç»è¯·æ±‚ä¹Ÿéœ€è¦æˆæœ¬ã€‚<br><img lazyload src="/images/loading.svg" data-src="rateLimitEnabled.png" alt="avatar"></li></ul><h3 id="åˆ†å¸ƒå¼é™æµ"><a href="#åˆ†å¸ƒå¼é™æµ" class="headerlink" title="åˆ†å¸ƒå¼é™æµ"></a>åˆ†å¸ƒå¼é™æµ</h3><p>&emsp;&emsp; åˆ†å¸ƒå¼é™æµï¼Œæ˜¯ä¸ºäº†æ§åˆ¶æŸä¸ªåº”ç”¨å…¨å±€çš„æµé‡ï¼Œè€ŒéçœŸå¯¹å•ä¸ªèŠ‚ç‚¹çº¬åº¦ã€‚</p><ul><li>å•ä¸ªå¤§æµé‡çš„æ¥å£ï¼Œä½¿ç”¨ redis å®¹æ˜“äº§ç”Ÿçƒ­ç‚¹ã€‚</li><li>pre-request æ¨¡å¼å¯¹æ€§èƒ½æœ‰ä¸€å®šå½±å“ï¼Œé«˜é¢‘çš„ç½‘ç»œå¾€è¿”ã€‚  </li></ul><p><img lazyload src="/images/loading.svg" data-src="distributed.png" alt="avatar"></p><p>æ€è€ƒï¼š<br>&emsp;&emsp;ä»è·å–å•ä¸ª quota å‡çº§æˆæ‰¹é‡ quotaã€‚quota: è¡¨ç¤ºé€Ÿç‡ï¼Œè·å–åä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•æ¥é™åˆ¶ã€‚</p><ul><li>æ¯æ¬¡å¿ƒè·³åï¼Œå¼‚æ­¥æ‰¹é‡è·å– quotaï¼Œå¯ä»¥å¤§å¤§å‡å°‘è¯·æ±‚ redis çš„é¢‘æ¬¡ï¼Œè·å–å®Œä»¥åæœ¬åœ°æ¶ˆè´¹ï¼ŒåŸºäºä»¤ç‰Œæ¡¶æ‹¦æˆª</li><li>æ¯æ¬¡ç”³è¯·çš„é…é¢éœ€è¦æ‰‹åŠ¨è®¾å®šé™æ€å€¼ç•¥æ¬ çµæ´»ï¼Œæ¯”å¦‚æ¯æ¬¡è¦20ï¼Œè¿˜æ˜¯50</li></ul><p><img lazyload src="/images/loading.svg" data-src="redis.png" alt="avatar"></p><p>å¦‚ä½•åŸºäºå•ä¸ªèŠ‚ç‚¹æŒ‰éœ€ç”³è¯·ï¼Œå¹¶ä¸”é¿å…å‡ºç°ä¸å…¬å¹³çš„ç°è±¡ï¼Ÿ<br>åˆæ¬¡ä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸€æ—¦æœ‰è¿‡å»å†å²çª—å£çš„æ•°æ®ï¼Œå¯ä»¥åŸºäºå†å²çª—å£æ•°æ®è¿›è¡Œ quota è¯·æ±‚ã€‚</p><p>æ€è€ƒï¼š<br>æˆ‘ä»¬ç»å¸¸é¢ä¸´ç»™ä¸€ç»„ç”¨æˆ·åˆ’åˆ†ç¨€æœ‰èµ„æºçš„é—®é¢˜ï¼Œä»–ä»¬éƒ½äº«æœ‰ç­‰ä»·çš„æƒåˆ©æ¥è·å–èµ„æºï¼Œä½†æ˜¯å…¶ä¸­ä¸€äº›ç”¨æˆ·å®é™…ä¸Šåªéœ€è¦æ¯”å…¶ä»–ç”¨æˆ·å°‘çš„èµ„æºã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•æ¥åˆ†é…èµ„æºå‘¢ï¼Ÿä¸€ç§åœ¨å®é™…ä¸­å¹¿æ³›ä½¿ç”¨çš„åˆ†äº«æŠ€æœ¯ç§°ä½œâ€œæœ€å¤§æœ€å°å…¬å¹³åˆ†äº«â€ï¼ˆMax-Min Fairnessï¼‰ã€‚<br><img lazyload src="/images/loading.svg" data-src="max-min.png" alt="avatar"></p><p>ç›´è§‚ä¸Šï¼Œå…¬å¹³åˆ†äº«åˆ†é…ç»™æ¯ä¸ªç”¨æˆ·æƒ³è¦çš„å¯ä»¥æ»¡è¶³çš„æœ€å°éœ€æ±‚ï¼Œç„¶åå°†æ²¡æœ‰ä½¿ç”¨çš„èµ„æºå‡åŒ€çš„åˆ†é…ç»™éœ€è¦â€˜å¤§èµ„æºâ€™çš„ç”¨æˆ·ã€‚</p><p>æœ€å¤§æœ€å°å…¬å¹³åˆ†é…ç®—æ³•çš„å½¢å¼åŒ–å®šä¹‰å¦‚ä¸‹ï¼š<br>â€¢èµ„æºæŒ‰ç…§éœ€æ±‚é€’å¢çš„é¡ºåºè¿›è¡Œåˆ†é…ã€‚<br>â€¢ä¸å­˜åœ¨ç”¨æˆ·å¾—åˆ°çš„èµ„æºè¶…è¿‡è‡ªå·±çš„éœ€æ±‚ã€‚<br>â€¢æœªå¾—åˆ°æ»¡è¶³çš„ç”¨æˆ·ç­‰ä»·çš„åˆ†äº«èµ„æºã€‚</p><p><img lazyload src="/images/loading.svg" data-src="compare.png" alt="avatar"></p><h3 id="é‡è¦æ€§"><a href="#é‡è¦æ€§" class="headerlink" title="é‡è¦æ€§"></a>é‡è¦æ€§</h3><p>&emsp;&emsp;æ¯ä¸ªæ¥å£é…ç½®é˜ˆå€¼ï¼Œè¿è¥å·¥ä½œç¹é‡ï¼Œæœ€ç®€å•çš„æˆ‘ä»¬é…ç½®æœåŠ¡çº§åˆ« quotaï¼Œæ›´ç»†ç²’åº¦çš„ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒé‡è¦æ€§è®¾å®š quotaï¼Œæˆ‘ä»¬å¼•å…¥äº†é‡è¦æ€§ï¼ˆcriticalityï¼‰:</p><p>â€¢æœ€é‡è¦ CRITICAL_PLUSï¼Œä¸ºæœ€ç»ˆçš„è¦æ±‚é¢„ç•™çš„ç±»å‹ï¼Œæ‹’ç»è¿™äº›è¯·æ±‚ä¼šé€ æˆéå¸¸ä¸¥é‡çš„ç”¨æˆ·å¯è§çš„é—®é¢˜ã€‚<br>â€¢é‡è¦ CRITICALï¼Œç”Ÿäº§ä»»åŠ¡å‘å‡ºçš„é»˜è®¤è¯·æ±‚ç±»å‹ã€‚æ‹’ç»è¿™äº›è¯·æ±‚ä¹Ÿä¼šé€ æˆç”¨æˆ·å¯è§çš„é—®é¢˜ã€‚ä½†æ˜¯å¯èƒ½æ²¡é‚£ä¹ˆä¸¥é‡ã€‚<br>â€¢å¯ä¸¢å¼ƒçš„ SHEDDABLE_PLUS è¿™äº›æµé‡å¯ä»¥å®¹å¿æŸç§ç¨‹åº¦çš„ä¸å¯ç”¨æ€§ã€‚è¿™æ˜¯æ‰¹é‡ä»»åŠ¡å‘å‡ºçš„è¯·æ±‚çš„é»˜è®¤å€¼ã€‚è¿™äº›è¯·æ±‚é€šå¸¸å¯ä»¥è¿‡å‡ åˆ†é’Ÿã€å‡ å°æ—¶åé‡è¯•ã€‚<br>â€¢å¯ä¸¢å¼ƒçš„ SHEDDABLE è¿™äº›æµé‡å¯èƒ½ä¼šç»å¸¸é‡åˆ°éƒ¨åˆ†ä¸å¯ç”¨æƒ…å†µï¼Œå¶å°”ä¼šå®Œå…¨ä¸å¯ç”¨ã€‚</p><p>&emsp;&emsp;gRPC ç³»ç»Ÿä¹‹é—´ï¼Œéœ€è¦è‡ªåŠ¨ä¼ é€’é‡è¦æ€§ä¿¡æ¯ã€‚å¦‚æœåç«¯æ¥å—åˆ°è¯·æ±‚ Aï¼Œåœ¨å¤„ç†è¿‡ç¨‹ä¸­å‘å‡ºäº†è¯·æ±‚ B å’Œ C ç»™å…¶ä»–åç«¯ï¼Œè¯·æ±‚ B å’Œ C ä¼šä½¿ç”¨ä¸ A ç›¸åŒçš„é‡è¦æ€§å±æ€§ã€‚</p><p>â€¢å…¨å±€é…é¢ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ‹’ç»ä½ä¼˜å…ˆçº§çš„ã€‚<br>â€¢å…¨å±€é…é¢ï¼Œå¯ä»¥æŒ‰ç…§é‡è¦æ€§åˆ†åˆ«è®¾ç½®ã€‚<br>â€¢è¿‡è½½ä¿æŠ¤æ—¶ï¼Œä½ä¼˜å…ˆçº§çš„è¯·æ±‚å…ˆè¢«æ‹’ç»ã€‚</p><h3 id="ç†”æ–­"><a href="#ç†”æ–­" class="headerlink" title="ç†”æ–­"></a>ç†”æ–­</h3><p>&emsp;&emsp;æ–­è·¯å™¨ï¼ˆCircuit Breakersï¼‰: ä¸ºäº†é™åˆ¶æ“ä½œçš„æŒç»­æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¶…æ—¶ï¼Œè¶…æ—¶å¯ä»¥é˜²æ­¢æŒ‚èµ·æ“ä½œå¹¶ä¿è¯ç³»ç»Ÿå¯ä»¥å“åº”ã€‚å› ä¸ºæˆ‘ä»¬å¤„äºé«˜åº¦åŠ¨æ€çš„ç¯å¢ƒä¸­ï¼Œå‡ ä¹ä¸å¯èƒ½ç¡®å®šåœ¨æ¯ç§æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œçš„å‡†ç¡®çš„æ—¶é—´é™åˆ¶ã€‚æ–­è·¯å™¨ä»¥ç°å®ä¸–ç•Œçš„ç”µå­å…ƒä»¶å‘½åï¼Œå› ä¸ºå®ƒä»¬çš„è¡Œä¸ºæ˜¯éƒ½æ˜¯ç›¸åŒçš„ã€‚æ–­è·¯å™¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºé‡å¤çš„æ•…éšœå¯èƒ½ä¼šå¯¼è‡´é›ªçƒæ•ˆåº”ï¼Œå¹¶ä½¿æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</p><ul><li>æœåŠ¡ä¾èµ–çš„èµ„æºå‡ºç°å¤§é‡é”™è¯¯ã€‚</li><li>æŸä¸ªç”¨æˆ·è¶…è¿‡èµ„æºé…é¢æ—¶ï¼Œåç«¯ä»»åŠ¡ä¼šå¿«é€Ÿæ‹’ç»è¯·æ±‚ï¼Œè¿”å›â€œé…é¢ä¸è¶³â€çš„é”™è¯¯ï¼Œä½†æ˜¯æ‹’ç»å›å¤ä»ç„¶ä¼šæ¶ˆè€—ä¸€å®šèµ„æºã€‚æœ‰å¯èƒ½åç«¯å¿™ç€ä¸åœå‘é€æ‹’ç»è¯·æ±‚ï¼Œå¯¼è‡´è¿‡è½½ã€‚<br><img lazyload src="/images/loading.svg" data-src="rongduan.png" alt="avatar"></li></ul><p>Google SRE<br>max(0, (requests - K*accepts) / (requests + 1))<br><img lazyload src="/images/loading.svg" data-src="google.png" alt="avatar"><br><img lazyload src="/images/loading.svg" data-src="google1.png" alt="avatar"></p><h3 id="Gutter"><a href="#Gutter" class="headerlink" title="Gutter"></a>Gutter</h3><p>&emsp;&emsp;åŸºäºç†”æ–­çš„ gutter kafka ï¼Œç”¨äºæ¥ç®¡è‡ªåŠ¨ä¿®å¤ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­çš„è´Ÿè½½ï¼Œè¿™æ ·åªéœ€è¦ä»˜å‡º10%çš„èµ„æºå°±èƒ½è§£å†³éƒ¨åˆ†ç³»ç»Ÿå¯ç”¨æ€§é—®é¢˜ã€‚æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ failover çš„æ€è·¯ï¼Œä½†æ˜¯å®Œæ•´çš„ failover éœ€è¦ç¿»å€çš„æœºå™¨èµ„æºï¼Œå¹³å¸¸ä¸æ¥å—æµé‡æ—¶ï¼Œèµ„æºæµªè´¹ã€‚é«˜è´Ÿè½½æƒ…å†µä¸‹æ¥ç®¡æµé‡åˆä¸ä¸€å®šå®Œæ•´èƒ½æ¥ä½ã€‚æ‰€ä»¥è¿™é‡Œæ ¸å¿ƒåˆ©ç”¨ç†”æ–­çš„æ€è·¯ï¼Œæ˜¯æŠŠæŠ›å¼ƒçš„æµé‡è½¬ç§»åˆ° gutter é›†ç¾¤ï¼Œå¦‚æœ gutter ä¹Ÿæ¥å—ä¸ä½çš„æµé‡ï¼Œé‡æ–°å›æŠ›åˆ°ä¸»é›†ç¾¤ï¼Œæœ€å¤§åŠ›åº¦æ¥æ¥å—ã€‚<br><img lazyload src="/images/loading.svg" data-src="gutter.png" alt="avatar"></p><h3 id="å®¢æˆ·ç«¯æµæ§"><a href="#å®¢æˆ·ç«¯æµæ§" class="headerlink" title="å®¢æˆ·ç«¯æµæ§"></a>å®¢æˆ·ç«¯æµæ§</h3><p>positive feedback: ç”¨æˆ·æ€»æ˜¯ç§¯æé‡è¯•ï¼Œè®¿é—®ä¸€ä¸ªä¸å¯è¾¾çš„æœåŠ¡ã€‚<br>â€¢å®¢æˆ·ç«¯éœ€è¦é™åˆ¶è¯·æ±‚é¢‘æ¬¡ï¼Œretry backoff åšä¸€å®šçš„è¯·æ±‚é€€è®©ã€‚<br><img lazyload src="/images/loading.svg" data-src="backoff.png" alt="avatar"><br>â€¢å¯ä»¥é€šè¿‡æ¥å£çº§åˆ«çš„ error_detailsï¼ŒæŒ‚è½½åˆ°æ¯ä¸ª API è¿”å›çš„å“åº”é‡Œã€‚<br><img lazyload src="/images/loading.svg" data-src="error.png" alt="avatar"></p><h3 id="Case-1"><a href="#Case-1" class="headerlink" title="Case"></a>Case</h3><ol><li>äºŒå±‚ç¼“å­˜ç©¿é€ã€å¤§é‡å›æºå¯¼è‡´çš„æ ¸å¿ƒæœåŠ¡ï¼ˆä¾‹å¦‚Mysqlï¼‰æ•…éšœã€‚</li></ol><p>é€šè¿‡é™æµç­–ç•¥ï¼Œæ§åˆ¶åˆ°è¾¾Mysqlçš„è¯·æ±‚é€Ÿç‡ï¼Œè®©Mysqlçš„ç¼“å­˜é€æ­¥å»ºç«‹ï¼Œé¿å…è¢«æµ·é‡çš„è¯·æ±‚ç›´æ¥æ‰“æ­»ã€‚</p><ol start="2"><li>å¼‚å¸¸å®¢æˆ·ç«¯å¼•èµ·çš„æœåŠ¡æ•…éšœï¼ˆquery of deathï¼‰</li></ol><ul><li>è¯·æ±‚æ”¾å¤§ã€‚</li><li>èµ„æºæ•°æ”¾å¤§</li></ul><p>é’ˆå¯¹ç›¸åº”çš„ç”¨æˆ·åšä¸“é—¨çš„é™åˆ¶ï¼Œæ¯”å¦‚æœ€å¤šåªæ”¾è¡Œ k ä¸ªè¯·æ±‚ã€‚</p><ol start="3"><li>ç”¨æˆ·é‡è¯•å¯¼è‡´çš„å¤§é¢ç§¯æ•…éšœã€‚</li></ol><p>åœ¨å®¢æˆ·ç«¯é™åˆ¶ç”¨æˆ·çš„è¯·æ±‚é¢‘æ¬¡ã€‚</p><h1 id="é™çº§"><a href="#é™çº§" class="headerlink" title="é™çº§"></a>é™çº§</h1><p>&emsp;&emsp;é€šè¿‡é™çº§å›å¤æ¥å‡å°‘å·¥ä½œé‡ï¼Œæˆ–è€…ä¸¢å¼ƒä¸é‡è¦çš„è¯·æ±‚ã€‚è€Œä¸”éœ€è¦äº†è§£å“ªäº›æµé‡å¯ä»¥é™çº§ï¼Œå¹¶ä¸”æœ‰èƒ½åŠ›åŒºåˆ†ä¸åŒçš„è¯·æ±‚ã€‚æˆ‘ä»¬é€šå¸¸æä¾›é™ä½å›å¤çš„è´¨é‡æ¥ç­”å¤å‡å°‘æ‰€éœ€çš„è®¡ç®—é‡æˆ–è€…æ—¶é—´ã€‚æˆ‘ä»¬è‡ªåŠ¨é™çº§é€šå¸¸éœ€è¦è€ƒè™‘å‡ ä¸ªç‚¹ï¼š<br>â€¢ç¡®å®šå…·ä½“é‡‡ç”¨å“ªä¸ªæŒ‡æ ‡ä½œä¸ºæµé‡è¯„ä¼°å’Œä¼˜é›…é™çº§çš„å†³å®šæ€§æŒ‡æ ‡ï¼ˆå¦‚ï¼ŒCPUã€å»¶è¿Ÿã€é˜Ÿåˆ—é•¿åº¦ã€çº¿ç¨‹æ•°é‡ã€é”™è¯¯ç­‰ï¼‰ã€‚<br>â€¢å½“æœåŠ¡è¿›å…¥é™çº§æ¨¡å¼æ—¶ï¼Œéœ€è¦æ‰§è¡Œä»€ä¹ˆåŠ¨ä½œï¼Ÿ<br>â€¢æµé‡æŠ›å¼ƒæˆ–è€…ä¼˜é›…é™çº§åº”è¯¥åœ¨æœåŠ¡çš„å“ªä¸€å±‚å®ç°ï¼Ÿæ˜¯å¦éœ€è¦åœ¨æ•´ä¸ªæœåŠ¡çš„æ¯ä¸€å±‚éƒ½å®ç°ï¼Œè¿˜æ˜¯å¯ä»¥é€‰æ‹©æŸä¸ªé«˜å±‚é¢çš„å…³é”®èŠ‚ç‚¹æ¥å®ç°ï¼Ÿ</p><p>åŒæ—¶æˆ‘ä»¬è¦è€ƒè™‘ä¸€ä¸‹å‡ ç‚¹ï¼š<br>â€¢ä¼˜é›…é™çº§ä¸åº”è¯¥è¢«ç»å¸¸è§¦å‘ - é€šå¸¸è§¦å‘æ¡ä»¶ç°å®äº†å®¹é‡è§„åˆ’çš„å¤±è¯¯ï¼Œæˆ–è€…æ˜¯æ„å¤–çš„è´Ÿè½½ã€‚<br>â€¢æ¼”ç»ƒï¼Œä»£ç å¹³æ—¶ä¸ä¼šè§¦å‘å’Œä½¿ç”¨ï¼Œéœ€è¦å®šæœŸé’ˆå¯¹ä¸€å°éƒ¨åˆ†çš„æµé‡è¿›è¡Œæ¼”ç»ƒï¼Œä¿è¯æ¨¡å¼çš„æ­£å¸¸ã€‚<br>â€¢åº”è¯¥è¶³å¤Ÿç®€å•ã€‚</p><h2 id="é™çº§æœ¬è´¨ä¸º-æä¾›æœ‰æŸæœåŠ¡ã€‚"><a href="#é™çº§æœ¬è´¨ä¸º-æä¾›æœ‰æŸæœåŠ¡ã€‚" class="headerlink" title="é™çº§æœ¬è´¨ä¸º: æä¾›æœ‰æŸæœåŠ¡ã€‚"></a>é™çº§æœ¬è´¨ä¸º: æä¾›æœ‰æŸæœåŠ¡ã€‚</h2><ol><li><p>UI æ¨¡å—åŒ–ï¼Œéæ ¸å¿ƒæ¨¡å—é™çº§ã€‚</p><ul><li>BFF å±‚èšåˆ APIï¼Œæ¨¡å—é™çº§ã€‚<br><img lazyload src="/images/loading.svg" data-src="bilibili.png" alt="avatar"></li></ul></li><li><p>é¡µé¢ä¸Šä¸€æ¬¡ç¼“å­˜å‰¯æœ¬ã€‚</p></li><li><p>é»˜è®¤å€¼ã€çƒ­é—¨æ¨èç­‰ã€‚</p></li><li><p>æµé‡æ‹¦æˆª + å®šæœŸæ•°æ®ç¼“å­˜(è¿‡æœŸå‰¯æœ¬ç­–ç•¥)ã€‚</p></li></ol><p>å¤„ç†ç­–ç•¥<br>â€¢é¡µé¢é™çº§ã€å»¶è¿ŸæœåŠ¡ã€å†™/è¯»é™çº§ã€ç¼“å­˜é™çº§<br>â€¢æŠ›å¼‚å¸¸ã€è¿”å›çº¦å®šåè®®ã€Mock æ•°æ®ã€Fallback å¤„ç†<br><img lazyload src="/images/loading.svg" data-src="fallback.png" alt="avatar"></p><h2 id="Case-2"><a href="#Case-2" class="headerlink" title="Case"></a>Case</h2><ol><li>å®¢æˆ·ç«¯è§£æåè®®å¤±è´¥ï¼Œapp å¥”æºƒã€‚</li></ol><p>è¦è¿”å›çš„é»˜è®¤é™çº§æ•°æ®ï¼ˆç©ºæ•°ç»„ã€nilï¼‰ä¸€å®šè¦å’Œå®¢æˆ·ç«¯çš„å¼€å‘äººå‘˜è¿›è¡Œæ²Ÿé€šï¼Œå¦åˆ™ä¼šå¯¼è‡´å®¢æˆ·ç«¯è§£æå¤±è´¥è€Œé—ªé€€ã€‚</p><ol start="2"><li>å®¢æˆ·ç«¯éƒ¨åˆ†åè®®ä¸å…¼å®¹ï¼Œå¯¼è‡´é¡µé¢å¤±è´¥ã€‚</li><li> local cache æ•°æ®æºç¼“å­˜ï¼Œå‘ç‰ˆå¤±æ•ˆ + ä¾èµ–æ¥å£æ•…éšœï¼Œå¼•èµ·çš„ç™½å±ã€‚</li></ol><p>è§£å†³æ–¹æ¡ˆï¼šåœ¨è¿œç¨‹remote cache ä¸­å†ä¿å­˜ä¸€ä»½ã€‚</p><h1 id="é‡è¯•"><a href="#é‡è¯•" class="headerlink" title="é‡è¯•"></a>é‡è¯•</h1><p>&emsp;&emsp;å½“è¯·æ±‚è¿”å›é”™è¯¯ï¼ˆä¾‹: é…é¢ä¸è¶³ã€è¶…æ—¶ã€å†…éƒ¨é”™è¯¯ç­‰ï¼‰ï¼Œå¯¹äº backend éƒ¨åˆ†èŠ‚ç‚¹è¿‡è½½çš„æƒ…å†µä¸‹ï¼Œå€¾å‘äºç«‹åˆ»é‡è¯•ï¼Œä½†æ˜¯éœ€è¦ç•™æ„é‡è¯•å¸¦æ¥çš„æµé‡æ”¾å¤§:</p><p>â€¢é™åˆ¶é‡è¯•æ¬¡æ•°å’ŒåŸºäºé‡è¯•åˆ†å¸ƒçš„ç­–ç•¥ï¼ˆé‡è¯•æ¯”ç‡: 10%ï¼‰ã€‚<br>â€¢éšæœºåŒ–ã€æŒ‡æ•°å‹é€’å¢çš„é‡è¯•å‘¨æœŸ: exponential ackoff + jitterã€‚<br>â€¢client æµ‹è®°å½•é‡è¯•æ¬¡æ•°ç›´æ–¹å›¾ï¼Œä¼ é€’åˆ° serverï¼Œè¿›è¡Œåˆ†å¸ƒåˆ¤å®šï¼Œäº¤ç”± server åˆ¤å®šæ‹’ç»ã€‚<br>â€¢åªåº”è¯¥åœ¨å¤±è´¥çš„è¿™å±‚è¿›è¡Œé‡è¯•ï¼Œå½“é‡è¯•ä»ç„¶å¤±è´¥ï¼Œå…¨å±€çº¦å®šé”™è¯¯ç â€œè¿‡è½½ï¼Œæ— é¡»é‡è¯•â€ï¼Œé¿å…çº§è”é‡è¯•ã€‚</p><h2 id="Case-3"><a href="#Case-3" class="headerlink" title="Case"></a>Case</h2><ol><li>Nginx upstream retry è¿‡å¤§ï¼Œå¯¼è‡´æœåŠ¡é›ªå´©ã€‚</li></ol><ol start="2"><li><p>ä¸šåŠ¡ä¸å¹‚ç­‰ï¼Œå¯¼è‡´çš„é‡è¯•ï¼Œæ•°æ®é‡å¤ã€‚<br>â€¢å…¨å±€å”¯ä¸€ ID: æ ¹æ®ä¸šåŠ¡ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ IDï¼Œåœ¨è°ƒç”¨æ¥å£æ—¶ä¼šä¼ å…¥è¯¥ IDï¼Œæ¥å£æä¾›æ–¹ä¼šä»ç›¸åº”çš„å­˜å‚¨ç³»ç»Ÿæ¯”å¦‚ redis ä¸­å»æ£€ç´¢è¿™ä¸ªå…¨å±€ ID æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è¯´æ˜è¯¥æ“ä½œå·²ç»æ‰§è¡Œè¿‡äº†ï¼Œå°†æ‹’ç»æœ¬æ¬¡æœåŠ¡è¯·æ±‚ï¼›å¦åˆ™å°†ç›¸åº”è¯¥æœåŠ¡è¯·æ±‚å¹¶å°†å…¨å±€ ID å­˜å…¥å­˜å‚¨ç³»ç»Ÿä¸­,ä¹‹ååŒ…å«ç›¸åŒä¸šåŠ¡ ID å‚æ•°çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€‚<br>â€¢å»é‡è¡¨: è¿™ç§æ–¹æ³•é€‚ç”¨äºåœ¨ä¸šåŠ¡ä¸­æœ‰å”¯ä¸€æ ‡è¯†çš„æ’å…¥åœºæ™¯ã€‚æ¯”å¦‚åœ¨æ”¯ä»˜åœºæ™¯ä¸­ï¼Œä¸€ä¸ªè®¢å•åªä¼šæ”¯ä»˜ä¸€æ¬¡ï¼Œå¯ä»¥å»ºç«‹ä¸€å¼ å»é‡è¡¨,å°†è®¢å• ID ä½œä¸ºå”¯ä¸€ç´¢å¼•ã€‚æŠŠæ”¯ä»˜å¹¶ä¸”å†™å…¥æ”¯ä»˜å•æ®åˆ°å»é‡è¡¨æ”¾å…¥ä¸€ä¸ªäº‹åŠ¡ä¸­äº†ï¼Œè¿™æ ·å½“å‡ºç°é‡å¤æ”¯ä»˜æ—¶ï¼Œæ•°æ®åº“å°±ä¼šæŠ›å‡ºå”¯ä¸€çº¦æŸå¼‚å¸¸,æ“ä½œå°±ä¼šå›æ»šã€‚è¿™æ ·ä¿è¯äº†è®¢å•åªä¼šè¢«æ”¯ä»˜ä¸€æ¬¡ã€‚<br>â€¢å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶: é€‚åˆå¯¹æ›´æ–°è¯·æ±‚ä½œå¹‚ç­‰æ€§æ§åˆ¶,æ¯”å¦‚è¦æ›´æ–°å•†å“çš„åå­—ï¼Œè¿™æ˜¯å°±å¯ä»¥åœ¨æ›´æ–°çš„æ¥å£ä¸­å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·æ¥åšå¹‚ç­‰æ€§æ§åˆ¶ã€‚</p></li><li><p>å¤šå±‚çº§é‡è¯•ä¼ é€’ï¼Œæ”¾å¤§æµé‡å¼•èµ·é›ªå´©ã€‚</p></li></ol><h1 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h1><h2 id="æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„è´Ÿè½½å‡è¡¡"><a href="#æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„è´Ÿè½½å‡è¡¡" class="headerlink" title="æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„è´Ÿè½½å‡è¡¡"></a>æ•°æ®ä¸­å¿ƒå†…éƒ¨çš„è´Ÿè½½å‡è¡¡</h2><p>&emsp;&emsp;åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼ŒæŸä¸ªæœåŠ¡çš„è´Ÿè½½ä¼šå®Œå…¨å‡åŒ€åœ°åˆ†å‘ç»™æ‰€æœ‰çš„åç«¯ä»»åŠ¡ã€‚åœ¨ä»»ä½•æ—¶åˆ»ï¼Œæœ€å¿™å’Œæœ€ä¸å¿™çš„èŠ‚ç‚¹æ°¸è¿œæ¶ˆè€—åŒæ ·æ•°é‡çš„CPUã€‚<br>ç›®æ ‡ï¼š<br>â€¢å‡è¡¡çš„æµé‡åˆ†å‘ã€‚<br>â€¢å¯é çš„è¯†åˆ«å¼‚å¸¸èŠ‚ç‚¹ã€‚<br>â€¢scale-outï¼Œå¢åŠ åŒè´¨èŠ‚ç‚¹æ‰©å®¹ã€‚<br>â€¢å‡å°‘é”™è¯¯ï¼Œæé«˜å¯ç”¨æ€§ã€‚<br><img lazyload src="/images/loading.svg" data-src="SLB.png" alt="avatar"></p><p>   åœ¨ backend ä¹‹é—´çš„ load å·®å¼‚æ¯”è¾ƒå¤§ï¼š</p><ul><li>æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æˆæœ¬ä¸åŒã€‚</li><li>ç‰©ç†æœºç¯å¢ƒçš„å·®å¼‚:<ul><li>æœåŠ¡å™¨å¾ˆéš¾å¼ºåŒè´¨æ€§ã€‚</li><li>å­˜åœ¨å…±äº«èµ„æºäº‰ç”¨ï¼ˆå†…å­˜ç¼“å­˜ã€å¸¦å®½ã€IOç­‰ï¼‰ã€‚</li></ul></li><li>æ€§èƒ½å› ç´ :<ul><li>FullGCã€‚</li><li>JVM JITã€‚<br><img lazyload src="/images/loading.svg" data-src="load.png" alt="avatar"></li></ul></li></ul><p>å‚è€ƒJSQï¼ˆæœ€é—²è½®è®­ï¼‰è´Ÿè½½å‡è¡¡ç®—æ³•å¸¦æ¥çš„é—®é¢˜ï¼Œç¼ºä¹çš„æ˜¯æœåŠ¡ç«¯å…¨å±€è§†å›¾ï¼Œå› æ­¤æˆ‘ä»¬ç›®æ ‡éœ€è¦ç»¼åˆè€ƒè™‘ï¼šè´Ÿè½½+å¯ç”¨æ€§ã€‚<br><img lazyload src="/images/loading.svg" data-src="LB.png" alt="avatar"></p><p><img lazyload src="/images/loading.svg" data-src="S.png" alt="avatar"></p><h1 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="headerlink" title="æœ€ä½³å®è·µ"></a>æœ€ä½³å®è·µ</h1><ul><li>å˜æ›´ç®¡ç†:<ul><li>70ï¼…çš„é—®é¢˜æ˜¯ç”±å˜æ›´å¼•èµ·çš„ï¼Œæ¢å¤å¯ç”¨ä»£ç å¹¶ä¸æ€»æ˜¯åäº‹ã€‚</li></ul></li><li>é¿å…è¿‡è½½:<ul><li>è¿‡è½½ä¿æŠ¤ã€æµé‡è°ƒåº¦ç­‰ã€‚</li></ul></li><li>ä¾èµ–ç®¡ç†:<ul><li>ä»»ä½•ä¾èµ–éƒ½å¯èƒ½æ•…éšœï¼Œåš chaos monkey testingï¼Œæ³¨å…¥æ•…éšœæµ‹è¯•ã€‚</li></ul></li><li>ä¼˜é›…é™çº§:<ul><li>æœ‰æŸæœåŠ¡ï¼Œé¿å…æ ¸å¿ƒé“¾è·¯ä¾èµ–æ•…éšœã€‚</li></ul></li><li>é‡è¯•é€€é¿:<ul><li>é€€è®©ç®—æ³•ï¼Œå†»ç»“æ—¶é—´ï¼ŒAPI retry detail æ§åˆ¶ç­–ç•¥ã€‚</li></ul></li><li>è¶…æ—¶æ§åˆ¶:<ul><li>è¿›ç¨‹å†… + æœåŠ¡é—´ è¶…æ—¶æ§åˆ¶ã€‚</li></ul></li><li>æé™å‹æµ‹ + æ•…éšœæ¼”ç»ƒã€‚</li><li>æ‰©å®¹ + é‡å¯ + æ¶ˆé™¤æœ‰å®³æµé‡ã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;éš”ç¦»&quot;&gt;&lt;a href=&quot;#éš”ç¦»&quot; class=&quot;headerlink&quot; title=&quot;éš”ç¦»&quot;&gt;&lt;/a&gt;éš”ç¦»&lt;/h1&gt;&lt;p&gt;&amp;emsp;&amp;emsp;æœ¬è´¨ä¸Šæ˜¯å¯¹ç³»ç»Ÿæˆ–èµ„æºè¿›è¡Œåˆ†å‰²ï¼Œä»è€Œå®ç°å½“ç³»ç»Ÿå‘ç”Ÿæ•…éšœæ—¶èƒ½é™å®šä¼ æ’­èŒƒå›´å’Œå½±å“èŒƒå›´ï¼Œå³å‘ç”Ÿæ•…éšœååªæœ‰å‡ºé—®é¢˜çš„æœåŠ¡ä¸å¯ç”¨ï¼Œ</summary>
      
    
    
    
    <category term="å¾®æœåŠ¡" scheme="http://jiahaohong1997.github.io/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="å¼€å‘" scheme="http://jiahaohong1997.github.io/tags/%E5%BC%80%E5%8F%91/"/>
    
  </entry>
  
</feed>
